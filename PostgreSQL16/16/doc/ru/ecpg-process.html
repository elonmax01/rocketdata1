<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>36.10. Компиляция программ со встраиваемым SQL</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="ecpg-preproc.html" title="36.9. Директивы препроцессора" /><link rel="next" href="ecpg-library.html" title="36.11. Библиотечные функции" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">36.10. Компиляция программ со встраиваемым SQL</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="ecpg-preproc.html" title="36.9. Директивы препроцессора">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="ecpg.html" title="Глава 36. ECPG — Встраиваемый SQL в C">Наверх</a></td><th width="60%" align="center">Глава 36. <span class="application">ECPG</span> — Встраиваемый <acronym class="acronym">SQL</acronym> в C</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="ecpg-library.html" title="36.11. Библиотечные функции">След.</a></td></tr></table><hr /></div><div class="sect1" id="ECPG-PROCESS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">36.10. Компиляция программ со встраиваемым SQL <a href="#ECPG-PROCESS" class="id_link">#</a></h2></div></div></div><p>Теперь, когда вы получили представление, как писать программы на C со встраиваемым SQL, вы наверное хотите узнать, как их компилировать. Прежде чем компилировать код C, необходимо пропустить исходный файл через препроцессор встраиваемого <acronym class="acronym">SQL</acronym> в <acronym class="acronym">C</acronym>, который преобразует записанные вами операторы <acronym class="acronym">SQL</acronym> в вызовы специальных функций. После компиляции полученный объектный код нужно скомпоновать со специальной библиотекой, содержащей необходимые функции. Эти функции получают информацию из аргументов, выполняют команды <acronym class="acronym">SQL</acronym> через интерфейс <span class="application">libpq</span>, и помещают результат в аргументы, заданные для вывода.</p><p>Программа препроцессора называется <code class="filename">ecpg</code> и входит в состав обычной инсталляции <span class="productname">PostgreSQL</span>. Программам со встраиваемым SQL, как правило, даются имена с расширением <code class="filename">.pgc</code>. Если вы создали код программы в файле <code class="filename">prog1.pgc</code>, вы можете обработать его, просто выполнив: </p><pre class="programlisting">ecpg prog1.pgc</pre><p> При этом будет создан файл <code class="filename">prog1.c</code>. Если имена входных файлов не следуют этому соглашению, имя выходного файла можно задать явно в аргументе <code class="option">-o</code>.</p><p>Обработанный препроцессором файл можно скомпилировать обычным образом, например, так: </p><pre class="programlisting">cc -c prog1.c</pre><p> В сгенерированные исходные файлы C включаются заголовочные файлы из инсталляции <span class="productname">PostgreSQL</span>, поэтому если вы установили <span class="productname">PostgreSQL</span> так, что соответствующий каталог не просматривается по умолчанию, вам придётся добавить указание вида <code class="literal">-I/usr/local/pgsql/include</code> в командную строку компиляции.</p><p>Чтобы скомпоновать программу со встраиваемым SQL, необходимо подключить библиотеку <code class="filename">libecpg</code> примерно так: </p><pre class="programlisting">cc -o myprog prog1.o prog2.o ... -lecpg</pre><p> Возможно, и для этого понадобится добавить в командную строку указание вида <code class="literal">-L/usr/local/pgsql/lib</code>.</p><p>Чтобы узнать пути вашей инсталляции, можно воспользоваться командой <code class="command">pg_config</code><a id="id-1.7.5.16.6.2" class="indexterm"></a> или <code class="command">pkg-config</code><a id="id-1.7.5.16.6.4" class="indexterm"></a> (в качестве имени пакета нужно указать <code class="literal">libecpg</code>).</p><p>Если вы организуете процесс сборки большого проекта с применением <span class="application">make</span>, может быть удобно включить в ваши сборочные файлы следующее неявное правило: </p><pre class="programlisting">ECPG = ecpg

%.c: %.pgc
        $(ECPG) $&lt;</pre><p>Полный синтаксис вызова команды <code class="command">ecpg</code> приведён в описании <a class="xref" href="app-ecpg.html" title="ecpg"><span class="refentrytitle"><span class="application">ecpg</span></span></a>.</p><p>Библиотека <span class="application">ecpg</span> по умолчанию потокобезопасна. Однако для компиляции клиентского кода могут потребоваться параметры командной строки для настройки многопоточности.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ecpg-preproc.html" title="36.9. Директивы препроцессора">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="ecpg.html" title="Глава 36. ECPG — Встраиваемый SQL в C">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="ecpg-library.html" title="36.11. Библиотечные функции">След.</a></td></tr><tr><td width="40%" align="left" valign="top">36.9. Директивы препроцессора </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 36.11. Библиотечные функции</td></tr></table></div></body></html>