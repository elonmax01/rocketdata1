<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>21.2. Файл сопоставления имён пользователей</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="auth-pg-hba-conf.html" title="21.1. Файл pg_hba.conf" /><link rel="next" href="auth-methods.html" title="21.3. Методы аутентификации" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">21.2. Файл сопоставления имён пользователей</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="auth-pg-hba-conf.html" title="21.1. Файл pg_hba.conf">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения">Наверх</a></td><th width="60%" align="center">Глава 21. Аутентификация клиентского приложения</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="auth-methods.html" title="21.3. Методы аутентификации">След.</a></td></tr></table><hr /></div><div class="sect1" id="AUTH-USERNAME-MAPS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">21.2. Файл сопоставления имён пользователей <a href="#AUTH-USERNAME-MAPS" class="id_link">#</a></h2></div></div></div><a id="id-1.6.8.9.2" class="indexterm"></a><p>Когда используется внешняя система аутентификации, например Ident или GSSAPI, имя пользователя операционной системы, устанавливающего подключение, может не совпадать с именем целевого пользователя (роли) базы данных. В этом случае можно применить сопоставление имён пользователей, чтобы сменить имя пользователя операционной системы на имя пользователя БД. Чтобы задействовать сопоставление имён, укажите <code class="literal">map</code>=<em class="replaceable"><code>имя-сопоставления</code></em> в поле параметров в <code class="filename">pg_hba.conf</code>. Этот параметр поддерживается для всех методов аутентификации, которые принимают внешние имена пользователей. Так как для разных подключений могут требоваться разные сопоставления, сопоставление определяется параметром <em class="replaceable"><code>имя-сопоставления</code></em> в <code class="filename">pg_hba.conf</code> для каждого отдельного подключения.</p><p>Сопоставления имён пользователя определяются в файле сопоставления ident, который по умолчанию называется <code class="filename">pg_ident.conf</code><a id="id-1.6.8.9.4.2" class="indexterm"></a> и хранится в каталоге данных кластера. (Файл сопоставления может быть помещён и в другое место, обратитесь к информации о настройке параметра <a class="xref" href="runtime-config-file-locations.html#GUC-IDENT-FILE">ident_file</a>.) Файл сопоставления ident содержит строки общих форм: </p><pre class="synopsis">
<em class="replaceable"><code>имя-сопоставления</code></em> <em class="replaceable"><code>имя-системного пользователя</code></em> <em class="replaceable"><code>имя-пользователя-БД</code></em>
<em class="replaceable"><code>include</code></em> <em class="replaceable"><code>файл</code></em>
<em class="replaceable"><code>include_if_exists</code></em> <em class="replaceable"><code>файл</code></em>
<em class="replaceable"><code>include_dir</code></em> <em class="replaceable"><code>каталог</code></em>
</pre><p> Комментарии и пробелы применяются так же, как и в файле <code class="filename">pg_hba.conf</code>. <em class="replaceable"><code>имя-сопоставления</code></em> является произвольным именем, на которое будет ссылаться файл сопоставления файла <code class="filename">pg_hba.conf</code>. Два других поля указывают имя пользователя операционной системы и соответствующее имя пользователя базы данных. <em class="replaceable"><code>имя-сопоставления</code></em> может быть использовано неоднократно, чтобы указывать множественные сопоставления пользовательских имён в рамках одного файла сопоставления.</p><p>Что касается <code class="filename">pg_hba.conf</code>, строки в этом файле могут быть директивами включения, которые следуют тем же правилам.</p><p>Нет никаких ограничений по количеству пользователей баз данных, на которые может ссылаться пользователь операционной системы, и наоборот. Тем не менее записи в файле скорее подразумевают, что <span class="quote">«<span class="quote">пользователь этой операционной системы может подключиться как пользователь этой базы данных</span>»</span>, нежели показывают, что эти имена пользователей эквивалентны. Подключение разрешается, если существует запись в файле сопоставления, соединяющая имя, полученное от внешней системы аутентификации, с именем пользователя базы данных, под которым пользователь хочет подключиться. Значение <code class="literal">all</code> можно использовать в качестве <em class="replaceable"><code>имени-пользователя-БД</code></em>, чтобы указать, что если оно совпадает с <em class="replaceable"><code>именем-системного-пользователя</code></em>, то этому пользователю разрешено входить в систему как любому из существующих пользователей базы данных. Ключевое слово <code class="literal">all</code> теряет своё особое значение.</p><p>Если <em class="replaceable"><code>имя-пользователя-БД</code></em> начинается с символа <code class="literal">+</code>, пользователь операционной системы может войти в систему как любой пользователь, включённый в эту роль, аналогично тому, как имена пользователей, начинающиеся с <code class="literal">+</code>, обрабатываются в <code class="literal">pg_hba.conf</code>. Таким образом, знак <code class="literal">+</code> означает <span class="quote">«<span class="quote">совпадение любых ролей, которые прямо или косвенно являются членами роли</span>»</span>, тогда как имя без знака <code class="literal">+</code> является подходящим только для этой конкретной роли. Заключение имени пользователя, начинающегося с <code class="literal">+</code>, в кавычки приводит к тому, что <code class="literal">+</code> теряет своё особое значение.</p><p>Если поле <em class="replaceable"><code>имени-системного-пользователя</code></em> начинается со знака (<code class="literal">/</code>), оставшаяся его часть рассматривается как регулярное выражение. (Подробнее синтаксис регулярных выражений <span class="productname">PostgreSQL</span> описан в <a class="xref" href="functions-matching.html#POSIX-SYNTAX-DETAILS" title="9.7.3.1. Подробное описание регулярных выражений">Подразделе 9.7.3.1</a>.) Регулярное выражение может включать в себя одну группу, или заключённое в скобки подвыражение, на которое можно сослаться в поле <em class="replaceable"><code>имени-пользователя-БД</code></em>, написав <code class="literal">\1</code> (с одной обратной косой). Это позволяет сопоставить несколько имён пользователя с одной строкой, что особенно удобно для простых замен. Например, эти строки </p><pre class="programlisting">mymap   /^(.*)@mydomain\.com$      \1
mymap   /^(.*)@otherdomain\.com$   guest</pre><p> удалят часть домена для имён пользователей, которые заканчиваются на <code class="literal">@mydomain.com</code>, и позволят пользователям, чьё имя пользователя системы заканчивается на <code class="literal">@otherdomain.com</code>, подключиться как <code class="literal">guest</code>. Заключение <em class="replaceable"><code>имени-пользователя-БД</code></em>, содержащего <code class="literal">\1</code>, в кавычки <span class="emphasis"><em>не</em></span> заставит <code class="literal">\1</code> потерять своё особое значение.</p><p>Если поле <em class="replaceable"><code>имени-пользователя-БД</code></em> начинается со знака (<code class="literal">/</code>), оставшаяся его часть рассматривается как регулярное выражение. (Подробнее синтаксис регулярных выражений <span class="productname">PostgreSQL</span> описан в <a class="xref" href="functions-matching.html#POSIX-SYNTAX-DETAILS" title="9.7.3.1. Подробное описание регулярных выражений">Подразделе 9.7.3.1</a>.) Нельзя использовать <code class="literal">\1</code> для использования захвата из регулярного выражения в <em class="replaceable"><code>имени-системного-пользователя</code></em> для регулярного выражения в <em class="replaceable"><code>имени-пользователя-БД</code></em>.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Помните, что по умолчанию, регулярное выражение может совпасть только с частью строки. Разумным выходом будет использование символов <code class="literal">^</code> и <code class="literal">$</code>, как показано в примере выше, для принудительного совпадения со всем именем пользователя операционной системы</p></div><p>Файл <code class="filename">pg_ident.conf</code> прочитывается при запуске системы, а также в тот момент, когда основной сервер получает сигнал <span class="systemitem">SIGHUP</span><a id="id-1.6.8.9.11.3" class="indexterm"></a>. Если вы редактируете файл во время работы системы, необходимо послать сигнал процессу postmaster (используя <code class="literal">pg_ctl reload</code>, вызвав SQL-функцию <code class="function">pg_reload_conf()</code> или выполнив <code class="literal">kill -HUP</code>), чтобы он прочел обновлённый файл.</p><p>Системное представление <a class="link" href="view-pg-ident-file-mappings.html" title="54.10. pg_ident_file_mappings"><code class="structname">pg_ident_file_mappings</code></a> может быть полезно для предварительной проверки изменений в файле <code class="filename">pg_ident.conf</code> или для диагностики проблем, когда перезагрузка этого файла не даёт желаемого эффекта. Строки в этом представлении, содержащие в поле <code class="structfield">error</code> не NULL, указывают на проблемы в соответствующих строках файла.</p><p>Файл <code class="filename">pg_ident.conf</code>, который может быть использован в сочетании с файлом <code class="filename">pg_hba.conf</code> (см. <a class="xref" href="auth-pg-hba-conf.html#EXAMPLE-PG-HBA.CONF" title="Пример 21.1. Примеры записей pg_hba.conf">Пример 21.1</a>), показан в <a class="xref" href="auth-username-maps.html#EXAMPLE-PG-IDENT.CONF" title="Пример 21.2. Пример файла pg_ident.conf">Примере 21.2</a>. В этом примере любым пользователям компьютеров в сети 192.168 с именами, отличными от <code class="literal">bryanh</code>, <code class="literal">ann</code> или <code class="literal">robert</code>, будет отказано в доступе. Пользователь системы <code class="literal">robert</code> получит доступ только тогда, когда подключается как пользователь <span class="productname">PostgreSQL</span> <code class="literal">bob</code>, а не как <code class="literal">robert</code>, или какой-либо другой пользователь. Пользователь <code class="literal">ann</code> сможет подключиться только как <code class="literal">ann</code>. Пользователь <code class="literal">bryanh</code> сможет подключиться как <code class="literal">bryanh</code> или как <code class="literal">guest1</code>.</p><div class="example" id="EXAMPLE-PG-IDENT.CONF"><p class="title"><strong>Пример 21.2. Пример файла <code class="filename">pg_ident.conf</code></strong></p><div class="example-contents"><pre class="programlisting"># MAPNAME       SYSTEM-USERNAME         PG-USERNAME

omicron         bryanh                  bryanh
omicron         ann                     ann
# на этих машинах у пользователя bob имя robert
omicron         robert                  bob
# bryanh также может подключаться как guest1
omicron         bryanh                  guest1</pre></div></div><br class="example-break" /></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="auth-pg-hba-conf.html" title="21.1. Файл pg_hba.conf">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="auth-methods.html" title="21.3. Методы аутентификации">След.</a></td></tr><tr><td width="40%" align="left" valign="top">21.1. Файл <code class="filename">pg_hba.conf</code> </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 21.3. Методы аутентификации</td></tr></table></div></body></html>