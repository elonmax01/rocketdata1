<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>pg_recvlogical</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="app-pgreceivewal.html" title="pg_receivewal" /><link rel="next" href="app-pgrestore.html" title="pg_restore" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center"><span class="application">pg_recvlogical</span></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="app-pgreceivewal.html" title="pg_receivewal">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><th width="60%" align="center">Клиентские приложения PostgreSQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="app-pgrestore.html" title="pg_restore">След.</a></td></tr></table><hr /></div><div class="refentry" id="APP-PGRECVLOGICAL"><div class="titlepage"></div><a id="id-1.9.4.17.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle"><span class="application">pg_recvlogical</span></span></h2><p>pg_recvlogical — управлять потоками логического декодирования <span class="productname">PostgreSQL</span></p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><div class="cmdsynopsis"><p id="id-1.9.4.17.4.1"><code class="command">pg_recvlogical</code> [<em class="replaceable"><code>параметр</code></em>...]</p></div></div><div class="refsect1" id="id-1.9.4.17.5"><h2>Описание</h2><p>Утилита <code class="command">pg_recvlogical</code> управляет слотами логического декодирования и принимает данные из таких слотов репликации.</p><p>Она создаёт соединение в режиме репликации, так что на него распространяются те же ограничения, что и с <a class="xref" href="app-pgreceivewal.html" title="pg_receivewal"><span class="refentrytitle"><span class="application">pg_receivewal</span></span></a>, плюс ограничения логической репликации (см. <a class="xref" href="logicaldecoding.html" title="Глава 49. Логическое декодирование">Главу 49</a>).</p><p><code class="command">pg_recvlogical</code> не предоставляет возможностей, соответствующих режимам peek и get в SQL-интерфейсе логического декодирования. Она передаёт серверу подтверждения воспроизведения данных по мере их получения и при штатном выходе. Чтобы просмотреть данные, ожидающие передачи через слот, не принимая их, воспользуйтесь функцией <a class="link" href="functions-admin.html#FUNCTIONS-REPLICATION" title="9.27.6. Функции управления репликацией"><code class="function">pg_logical_slot_peek_changes</code></a>.</p><p>В отсутствие критических ошибок <span class="application">pg_recvlogical</span> будет выполняться до прерывания сигналом <span class="systemitem">SIGINT</span> (<span class="keycap"><strong>Control</strong></span>+<span class="keycap"><strong>C</strong></span>) или <span class="systemitem">SIGTERM</span>.</p></div><div class="refsect1" id="id-1.9.4.17.6"><h2>Параметры</h2><p>Для выбора действия необходимо указать минимум один из этих параметров: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--create-slot</code></span></dt><dd><p>Создать новый слот логической репликации с именем, заданным аргументом <code class="option">--slot</code>, используя модуль вывода, заданный аргументом <code class="option">--plugin</code>, для базы данных, указанной в <code class="option">--dbname</code>.</p><p>Вы можете использовать параметр <code class="option">--two-phase</code> с <code class="option">--create-slot</code>, чтобы включить декодирование подготовленных транзакций.</p></dd><dt><span class="term"><code class="option">--drop-slot</code></span></dt><dd><p>Удалить слот репликации с именем, заданным аргументом <code class="option">--slot</code>, и завершиться.</p></dd><dt><span class="term"><code class="option">--start</code></span></dt><dd><p>Начать приём потока изменений из слота логической репликации с именем, заданным аргументом <code class="option">--slot</code>, и продолжать до сигнала прерывания. Если передача потока прерывается на другой стороне из-за выключения или остановки сервера, цикл подключения и передачи повторяется (если не добавлен параметр <code class="option">--no-loop</code>).</p><p>Формат потока определяется модулем вывода, выбранным при создании слота.</p><p>Для получения потока подключаться нужно к той же базе, для которой создавался слот.</p></dd></dl></div><p>Параметры <code class="option">--create-slot</code> и <code class="option">--start</code> исключают друг друга. Действие <code class="option">--drop-slot</code> несовместимо с любыми другими действиями.</p><p>Следующие параметры командной строки управляют расположением и форматом выводимых данных, а также другим поведением репликации: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-E <em class="replaceable"><code>lsn</code></em></code><br /></span><span class="term"><code class="option">--endpos=<em class="replaceable"><code>lsn</code></em></code></span></dt><dd><p>В режиме <code class="option">--start</code> автоматически закончить репликацию и выйти с кодом обычного завершения 0, когда при приёме данных достигается указанный LSN. Если этот ключ указывается не в режиме <code class="option">--start</code>, выдаётся ошибка.</p><p>Если встречается запись с LSN, в точности равным <em class="replaceable"><code>lsn</code></em>, эта запись будет выведена.</p><p>С указанием <code class="option">--endpos</code> границы транзакций не отслеживаются, так что вывод программы может оказаться обрезанным посередине транзакции. Частично полученная транзакция не будет считаться принятой и будет воспроизведена заново при следующем чтении из этого слота. Отдельные сообщения не обрезаются никогда.</p></dd><dt><span class="term"><code class="option">-f <em class="replaceable"><code>имя_файла</code></em></code><br /></span><span class="term"><code class="option">--file=<em class="replaceable"><code>имя_файла</code></em></code></span></dt><dd><p>Записывать полученные и декодированные данные транзакций в указанный файл. Для вывода в <span class="systemitem">stdout</span> укажите <code class="literal">-</code> (минус).</p></dd><dt><span class="term"><code class="option">-F <em class="replaceable"><code>секунды</code></em></code><br /></span><span class="term"><code class="option">--fsync-interval=<em class="replaceable"><code>секунды</code></em></code></span></dt><dd><p>Устанавливает, как часто <span class="application">pg_recvlogical</span> будет вызывать <code class="function">fsync()</code>, чтобы гарантировать, что выходной файл надёжно сохранён на диске.</p><p>Сервер время от времени даёт клиенту команду сохранить данные и сообщить сохранённую позицию, но этот параметр позволяет выполнять сохранение чаще.</p><p>При значении, равном <code class="literal">0</code>, функция <code class="function">fsync()</code> вообще не вызывается, но серверу сообщается новая позиция. Это может привести к потере данных в случае сбоя.</p></dd><dt><span class="term"><code class="option">-I <em class="replaceable"><code>lsn</code></em></code><br /></span><span class="term"><code class="option">--startpos=<em class="replaceable"><code>lsn</code></em></code></span></dt><dd><p>В режиме <code class="option">--start</code> репликация начнётся с данного LSN. Как это работает, подробно описывается в <a class="xref" href="logicaldecoding.html" title="Глава 49. Логическое декодирование">Главе 49</a> и <a class="xref" href="protocol-replication.html" title="55.4. Протокол потоковой репликации">Разделе 55.4</a>. В других режимах игнорируется.</p></dd><dt><span class="term"><code class="option">--if-not-exists</code></span></dt><dd><p>Не выдавать ошибку, когда указан параметр <code class="option">--create-slot</code> и слот с заданным именем уже существует.</p></dd><dt><span class="term"><code class="option">-n</code><br /></span><span class="term"><code class="option">--no-loop</code></span></dt><dd><p>Когда подключение к серверу потеряно, не повторять цикл, просто завершить работу.</p></dd><dt><span class="term"><code class="option">-o <em class="replaceable"><code>имя</code></em>[=<em class="replaceable"><code>значение</code></em>]</code><br /></span><span class="term"><code class="option">--option=<em class="replaceable"><code>имя</code></em>[=<em class="replaceable"><code>значение</code></em>]</code></span></dt><dd><p>Передаёт параметр <em class="replaceable"><code>имя_параметра</code></em> модулю вывода, при этом может быть передано и его <em class="replaceable"><code>значение</code></em>. Набор параметров и их действия зависят от выбранного модуля вывода.</p></dd><dt><span class="term"><code class="option">-P <em class="replaceable"><code>модуль</code></em></code><br /></span><span class="term"><code class="option">--plugin=<em class="replaceable"><code>модуль</code></em></code></span></dt><dd><p>Использовать указанный модуль вывода логического декодирования при создании слота. См. <a class="xref" href="logicaldecoding.html" title="Глава 49. Логическое декодирование">Главу 49</a>. Этот параметр не действует, если слот уже существует.</p></dd><dt><span class="term"><code class="option">-s <em class="replaceable"><code>секунды</code></em></code><br /></span><span class="term"><code class="option">--status-interval=<em class="replaceable"><code>секунды</code></em></code></span></dt><dd><p>Этот параметр действует так же, как одноимённый параметр <a class="xref" href="app-pgreceivewal.html" title="pg_receivewal"><span class="refentrytitle"><span class="application">pg_receivewal</span></span></a> (см. его описание там).</p></dd><dt><span class="term"><code class="option">-S <em class="replaceable"><code>имя_слота</code></em></code><br /></span><span class="term"><code class="option">--slot=<em class="replaceable"><code>имя_слота</code></em></code></span></dt><dd><p>Этот параметр задаёт имя слота логической репликации, который будет использоваться в режиме <code class="option">--start</code>, создаваться в режиме <code class="option">--create-slot</code> или удаляться в режиме <code class="option">--drop-slot</code>.</p></dd><dt><span class="term"><code class="option">-t</code><br /></span><span class="term"><code class="option">--two-phase</code></span></dt><dd><p>Включает декодирование подготовленных транзакций. Этот параметр можно указать только с <code class="option">--create-slot</code>.</p></dd><dt><span class="term"><code class="option">-v</code><br /></span><span class="term"><code class="option">--verbose</code></span></dt><dd><p>Включает режим подробных сообщений.</p></dd></dl></div><p>Далее описаны параметры управления подключением. </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-d <em class="replaceable"><code>имя_бд</code></em></code><br /></span><span class="term"><code class="option">--dbname=<em class="replaceable"><code>имя_бд</code></em></code></span></dt><dd><p>Имя базы данных для подключения. Как именно используется данная база, рассказывается в описании действий программы. В данном аргументе может задаваться <a class="link" href="libpq-connect.html#LIBPQ-CONNSTRING" title="34.1.1. Строки параметров подключения">строка подключения</a>. В этом случае параметры в строке подключения переопределяют одноимённые параметры, заданные в командной строке. По умолчанию в качестве имени базы выбирается имя пользователя.</p></dd><dt><span class="term"><code class="option">-h <em class="replaceable"><code>имя_компьютера-или-ip</code></em></code><br /></span><span class="term"><code class="option">--host=<em class="replaceable"><code>имя_компьютера-или-ip</code></em></code></span></dt><dd><p>Указывает имя компьютера, на котором работает сервер. Если значение начинается с косой черты, оно определяет каталог Unix-сокета. Значение по умолчанию берётся из переменной окружения <code class="envar">PGHOST</code>, если она установлена. В противном случае выполняется подключение к Unix-сокету.</p></dd><dt><span class="term"><code class="option">-p <em class="replaceable"><code>порт</code></em></code><br /></span><span class="term"><code class="option">--port=<em class="replaceable"><code>порт</code></em></code></span></dt><dd><p>Указывает TCP-порт или расширение файла локального Unix-сокета, через который сервер принимает подключения. Значение по умолчанию определяется переменной окружения <code class="envar">PGPORT</code>, если она установлена, либо числом, заданным при компиляции.</p></dd><dt><span class="term"><code class="option">-U <em class="replaceable"><code>user</code></em></code><br /></span><span class="term"><code class="option">--username=<em class="replaceable"><code>user</code></em></code></span></dt><dd><p>Имя пользователя для подключения. По умолчанию это имя текущего пользователя операционной системы.</p></dd><dt><span class="term"><code class="option">-w</code><br /></span><span class="term"><code class="option">--no-password</code></span></dt><dd><p>Не выдавать запрос на ввод пароля. Если сервер требует аутентификацию по паролю и пароль не доступен с помощью других средств, таких как файл <code class="filename">.pgpass</code>, попытка соединения не удастся. Этот параметр может быть полезен в пакетных заданиях и скриптах, где нет пользователя, который вводит пароль.</p></dd><dt><span class="term"><code class="option">-W</code><br /></span><span class="term"><code class="option">--password</code></span></dt><dd><p>Принудительно запрашивать пароль перед подключением к базе данных.</p><p>Это несущественный параметр, так как <span class="application">pg_recvlogical</span> запрашивает пароль автоматически, если сервер проверяет подлинность по паролю. Однако чтобы понять это, <span class="application">pg_recvlogical</span> лишний раз подключается к серверу. Поэтому иногда имеет смысл ввести <code class="option">-W</code>, чтобы исключить эту ненужную попытку подключения.</p></dd></dl></div><p>Также есть следующие дополнительные параметры: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span></dt><dd><p>Сообщить версию <span class="application">pg_recvlogical</span> и завершиться.</p></dd><dt><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help</code></span></dt><dd><p>Показать справку по аргументам командной строки <span class="application">pg_recvlogical</span> и завершиться.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.4.17.7"><h2>Код завершения</h2><p><span class="application">pg_recvlogical</span> завершится с кодом 0 при прерывании сигналом <span class="systemitem">SIGINT</span> или <span class="systemitem">SIGTERM</span>. (Это штатный способ его завершения, поэтому получение этого сигнала не считается ошибкой.) При критических ошибках или получении других сигналов код завершения будет ненулевым.</p></div><div class="refsect1" id="id-1.9.4.17.8"><h2>Переменные окружения</h2><p>Как и большинство других утилит <span class="productname">PostgreSQL</span>, приложение также использует переменные окружения, поддерживаемые <span class="application">libpq</span> (см. <a class="xref" href="libpq-envars.html" title="34.15. Переменные окружения">Раздел 34.15</a>).</p><p>Переменная окружения <code class="envar">PG_COLOR</code> выбирает вариант использования цвета в диагностических сообщениях. Возможные значения: <code class="literal">always</code> (всегда), <code class="literal">auto</code> (автоматически) и <code class="literal">never</code> (никогда).</p></div><div class="refsect1" id="id-1.9.4.17.9"><h2>Замечания</h2><p><span class="application">pg_recvlogical</span> сохранит разрешения для группы в полученных файлах WAL, если такие разрешения установлены в исходном кластере.</p></div><div class="refsect1" id="id-1.9.4.17.10"><h2>Примеры</h2><p>Примеры использования можно найти в <a class="xref" href="logicaldecoding-example.html" title="49.1. Примеры логического декодирования">Разделе 49.1</a>.</p></div><div class="refsect1" id="id-1.9.4.17.11"><h2>См. также</h2><span class="simplelist"><a class="xref" href="app-pgreceivewal.html" title="pg_receivewal"><span class="refentrytitle"><span class="application">pg_receivewal</span></span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="app-pgreceivewal.html" title="pg_receivewal">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="app-pgrestore.html" title="pg_restore">След.</a></td></tr><tr><td width="40%" align="left" valign="top"><span class="application">pg_receivewal</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> <span class="application">pg_restore</span></td></tr></table></div></body></html>