<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>34.18. Получение параметров соединения через LDAP</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="libpq-pgservice.html" title="34.17. Файл соединений служб" /><link rel="next" href="libpq-ssl.html" title="34.19. Поддержка SSL" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">34.18. Получение параметров соединения через LDAP</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="libpq-pgservice.html" title="34.17. Файл соединений служб">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="libpq.html" title="Глава 34. libpq — библиотека для языка C">Наверх</a></td><th width="60%" align="center">Глава 34. <span class="application">libpq</span> — библиотека для языка C</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="libpq-ssl.html" title="34.19. Поддержка SSL">След.</a></td></tr></table><hr /></div><div class="sect1" id="LIBPQ-LDAP"><div class="titlepage"><div><div><h2 class="title" style="clear: both">34.18. Получение параметров соединения через LDAP <a href="#LIBPQ-LDAP" class="id_link">#</a></h2></div></div></div><a id="id-1.7.3.25.2" class="indexterm"></a><p>Если библиотека <span class="application">libpq</span> была собрана с поддержка LDAP (<code class="command">configure</code> передавался ключ <code class="literal"><code class="option">--with-ldap</code></code>), такие параметры соединения, как <code class="literal">host</code> и <code class="literal">dbname</code>, можно получить через LDAP с центрального сервера. Преимущество такого подхода в том, что при изменении параметров подключения к базе данных свойства соединения не придётся изменять на всех клиентских компьютерах.</p><p>Для получения параметров соединений через LDAP используется файл соединений служб <code class="filename">pg_service.conf</code> (см. <a class="xref" href="libpq-pgservice.html" title="34.17. Файл соединений служб">Раздел 34.17</a>). Строка в <code class="filename">pg_service.conf</code>, начинающаяся с указания протокола <code class="literal">ldap://</code>, будет воспринята как URL в LDAP и выполнится как запрос к LDAP. Результатом запроса должен быть список пар <code class="literal">keyword = value</code>, которые и будут задавать параметры соединений. Заданный URL должен соответствовать <a class="ulink" href="https://datatracker.ietf.org/doc/html/rfc1959" target="_top">RFC 1959</a> и иметь следующий вид: </p><pre class="synopsis">
ldap://[<em class="replaceable"><code>имя_сервера</code></em>[:<em class="replaceable"><code>порт</code></em>]]/<em class="replaceable"><code>база_поиска</code></em>?<em class="replaceable"><code>атрибут</code></em>?<em class="replaceable"><code>область_поиска</code></em>?<em class="replaceable"><code>фильтр</code></em>
</pre><p>; по умолчанию <em class="replaceable"><code>имя_сервера</code></em> — <code class="literal">localhost</code>, а <em class="replaceable"><code>порт</code></em> — 389.</p><p>Обработка <code class="filename">pg_service.conf</code> прекращается после удачного поиска в LDAP, но если с сервером LDAP связаться не удаётся, обрабатываются следующие строки этого файла. Так сделано для того, чтобы можно было реализовать запасные варианты, добавив дополнительные строки с URL LDAP, указывающими на другие серверы LDAP, или классические пары <code class="literal">keyword = value</code>, либо используя параметры соединений по умолчанию. Если же вы хотите получить ошибку в этой ситуации, добавьте после строки с URL-адресом LDAP синтаксически некорректную строку.</p><p>Простую запись LDAP, созданную из такого файла LDIF </p><pre class="programlisting">version:1
dn:cn=mydatabase,dc=mycompany,dc=com
changetype:add
objectclass:top
objectclass:device
cn:mydatabase
description:host=dbserver.mycompany.com
description:port=5439
description:dbname=mydb
description:user=mydb_user
description:sslmode=require</pre><p> можно запросить из каталога LDAP, указав следующий URL: </p><pre class="programlisting">ldap://ldap.mycompany.com/dc=mycompany,dc=com?description?one?(cn=mydatabase)</pre><p>Также возможно сочетать обычные записи в файле служб с поиском в LDAP. Полный пример описания службы в <code class="filename">pg_service.conf</code> может быть таким: </p><pre class="programlisting"># в LDAP хранится только имя и порт сервера; имя базы и пользователя нужно задать явно
[customerdb]
dbname=customer
user=appuser
ldap://ldap.acme.com/cn=dbserver,cn=hosts?pgconnectinfo?base?(objectclass=*)</pre></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="libpq-pgservice.html" title="34.17. Файл соединений служб">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="libpq.html" title="Глава 34. libpq — библиотека для языка C">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="libpq-ssl.html" title="34.19. Поддержка SSL">След.</a></td></tr><tr><td width="40%" align="left" valign="top">34.17. Файл соединений служб </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 34.19. Поддержка SSL</td></tr></table></div></body></html>