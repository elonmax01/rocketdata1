<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>33.4. TAP-тесты</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="regress-variant.html" title="33.3. Вариативные сравнительные файлы" /><link rel="next" href="regress-coverage.html" title="33.5. Определение покрытия кода тестами" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">33.4. TAP-тесты</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="regress-variant.html" title="33.3. Вариативные сравнительные файлы">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="regress.html" title="Глава 33. Регрессионные тесты">Наверх</a></td><th width="60%" align="center">Глава 33. Регрессионные тесты</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="regress-coverage.html" title="33.5. Определение покрытия кода тестами">След.</a></td></tr></table><hr /></div><div class="sect1" id="REGRESS-TAP"><div class="titlepage"><div><div><h2 class="title" style="clear: both">33.4. TAP-тесты <a href="#REGRESS-TAP" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="regress-tap.html#REGRESS-TAP-VARS">33.4.1. Переменные окружения</a></span></dt></dl></div><p>Различные тесты, особенно тесты клиентских программ в <code class="filename">src/bin</code>, используют инструменты Perl TAP и запускаются программой тестирования Perl <code class="command">prove</code>. Вы можете передать аргументы командной строки команде <code class="command">prove</code>, установив для <code class="command">make</code> переменную <code class="varname">PROVE_FLAGS</code>, например: </p><pre class="programlisting">make -C src/bin check PROVE_FLAGS='--timer'</pre><p> За дополнительными сведениями обратитесь к странице руководства по <code class="command">prove</code>.</p><p>В переменной <code class="varname">PROVE_TESTS</code>, которую воспринимает <code class="command">make</code>, может быть указан список разделённых пробелами путей, заданных относительно расположения <code class="filename">Makefile</code>, вызывающего <code class="command">prove</code>. Этот список определяет подмножество тестов для выполнения, вместо всех по умолчанию (<code class="filename">t/*.pl</code>). Например: </p><pre class="programlisting">make check PROVE_TESTS='t/001_test1.pl t/003_test3.pl'</pre><p>TAP-тесты требуют модуля Perl <code class="literal">IPC::Run</code>. Этот модуль можно найти в <a class="ulink" href="https://metacpan.org/dist/IPC-Run" target="_top">CPAN</a> или в пакете операционной системы. Для их выполнения также требуется сконфигурировать <span class="productname">PostgreSQL</span> с параметром <code class="option">--enable-tap-tests</code>.</p><p>Вообще говоря, TAP-тесты при выполнении <code class="literal">make installcheck</code> тестируют исполняемые файлы в ранее созданном дереве инсталляции, а при <code class="literal">make check</code> строят локальное дерево инсталляции из текущего исходного кода. В любом случае для тестирования инициализируется локальный экземпляр (каталог данных), и в нём временно запускается сервер. Для некоторых тестов могут запускаться и несколько серверов. Таким образом, эти тесты могут быть весьма ресурсоёмкими.</p><p>Важно понимать, что TAP-тесты запускают тестовый сервер (серверы), даже когда вы даёте команду <code class="literal">make installcheck</code>; этим они отличаются от обычных тестов, не в инфраструктуре TAP, которые в таком режимы рассчитаны на использование уже работающего сервера. В некоторых подкаталогах в дереве PostgreSQL TAP-тесты соседствуют с традиционными, что означает, что в результате <code class="literal">make installcheck</code> будут получены смешанные результаты от временных серверов и от уже работающего тестового сервера.</p><div class="sect2" id="REGRESS-TAP-VARS"><div class="titlepage"><div><div><h3 class="title">33.4.1. Переменные окружения <a href="#REGRESS-TAP-VARS" class="id_link">#</a></h3></div></div></div><p>Каталогам данных присваиваются имена в соответствии с именем файла теста; каталоги сохраняются, если тест не пройден. Если задана переменная окружения <code class="varname">PG_TEST_NOCLEAN</code>, каталоги данных сохраняются вне зависимости от статуса теста. Например, каталог данных сохраняется вне зависимости от результатов тестов во время выполнения тестов <span class="application">pg_dump</span>: </p><pre class="programlisting">PG_TEST_NOCLEAN=1 make -C src/bin/pg_dump check</pre><p> Эта переменная окружения также предотвращает удаление временных каталогов теста.</p><p>В сценариях тестов многие операции используют тайм-аут в 180 секунд, и на медленных узлах такой тайм-аут может наступать под нагрузкой. Во избежание этого задайте более высокое значение для переменной окружения <code class="varname">PG_TEST_TIMEOUT_DEFAULT</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="regress-variant.html" title="33.3. Вариативные сравнительные файлы">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="regress.html" title="Глава 33. Регрессионные тесты">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="regress-coverage.html" title="33.5. Определение покрытия кода тестами">След.</a></td></tr><tr><td width="40%" align="left" valign="top">33.3. Вариативные сравнительные файлы </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 33.5. Определение покрытия кода тестами</td></tr></table></div></body></html>