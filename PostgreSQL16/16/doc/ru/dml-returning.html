<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>6.4. Возврат данных из изменённых строк</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="dml-delete.html" title="6.3. Удаление данных" /><link rel="next" href="queries.html" title="Глава 7. Запросы" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">6.4. Возврат данных из изменённых строк</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="dml-delete.html" title="6.3. Удаление данных">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="dml.html" title="Глава 6. Модификация данных">Наверх</a></td><th width="60%" align="center">Глава 6. Модификация данных</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="queries.html" title="Глава 7. Запросы">След.</a></td></tr></table><hr /></div><div class="sect1" id="DML-RETURNING"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.4. Возврат данных из изменённых строк <a href="#DML-RETURNING" class="id_link">#</a></h2></div></div></div><a id="id-1.5.5.6.2" class="indexterm"></a><a id="id-1.5.5.6.3" class="indexterm"></a><a id="id-1.5.5.6.4" class="indexterm"></a><a id="id-1.5.5.6.5" class="indexterm"></a><p>Иногда бывает полезно получать данные из модифицируемых строк в процессе их обработки. Это возможно с использованием предложения <code class="literal">RETURNING</code>, которое можно задать для команд <code class="command">INSERT</code>, <code class="command">UPDATE</code> и <code class="command">DELETE</code>. Применение <code class="literal">RETURNING</code> позволяет обойтись без дополнительного запроса к базе для сбора данных и это особенно ценно, когда как-то иначе трудно получить изменённые строки надёжным образом.</p><p>В предложении <code class="literal">RETURNING</code> допускается то же содержимое, что и в выходном списке команды <code class="command">SELECT</code> (см. <a class="xref" href="queries-select-lists.html" title="7.3. Списки выборки">Раздел 7.3</a>). Оно может содержать имена столбцов целевой таблицы команды или значения выражений с этими столбцами. Также часто применяется краткая запись <code class="literal">RETURNING *</code>, выбирающая все столбцы целевой таблицы по порядку.</p><p>В команде <code class="command">INSERT</code> данные, выдаваемые в <code class="literal">RETURNING</code>, образуются из строки в том виде, в каком она была вставлена. Это не очень полезно при простом добавлении, так как в результате будут получены те же данные, что были переданы клиентом. Но это может быть очень удобно при использовании вычисляемых значений по умолчанию. Например, если в таблице есть столбец <a class="link" href="datatype-numeric.html#DATATYPE-SERIAL" title="8.1.4. Последовательные типы"><code class="type">serial</code></a>, в котором генерируются уникальные идентификаторы, команда <code class="literal">RETURNING</code> может возвратить идентификатор, назначенный новой строке: </p><pre class="programlisting">CREATE TABLE users (firstname text, lastname text, id serial primary key);

INSERT INTO users (firstname, lastname) VALUES ('Joe', 'Cool') RETURNING id;</pre><p> Предложение <code class="literal">RETURNING</code> также очень полезно с <code class="literal">INSERT ... SELECT</code>.</p><p>В команде <code class="command">UPDATE</code> данные, выдаваемые в <code class="literal">RETURNING</code>, образуются новым содержимым изменённой строки. Например: </p><pre class="programlisting">UPDATE products SET price = price * 1.10
  WHERE price &lt;= 99.99
  RETURNING name, price AS new_price;</pre><p>В команде <code class="command">DELETE</code> данные, выдаваемые в <code class="literal">RETURNING</code>, образуются содержимым удалённой строки. Например: </p><pre class="programlisting">DELETE FROM products
  WHERE obsoletion_date = 'today'
  RETURNING *;</pre><p>Если для целевой таблицы заданы триггеры (см. <a class="xref" href="triggers.html" title="Глава 39. Триггеры">Главу 39</a>), в <code class="literal">RETURNING</code> выдаются данные из строки, изменённой триггерами. Таким образом, <code class="literal">RETURNING</code> часто применяется и для того, чтобы проверить содержимое столбцов, изменяемых триггерами.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dml-delete.html" title="6.3. Удаление данных">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="dml.html" title="Глава 6. Модификация данных">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="queries.html" title="Глава 7. Запросы">След.</a></td></tr><tr><td width="40%" align="left" valign="top">6.3. Удаление данных </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> Глава 7. Запросы</td></tr></table></div></body></html>