<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>44.4. Глобальные данные в PL/Tcl</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="pltcl-data.html" title="44.3. Значения данных в PL/Tcl" /><link rel="next" href="pltcl-dbaccess.html" title="44.5. Обращение к базе данных из PL/Tcl" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">44.4. Глобальные данные в PL/Tcl</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="pltcl-data.html" title="44.3. Значения данных в PL/Tcl">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="pltcl.html" title="Глава 44. PL/Tcl — процедурный язык Tcl">Наверх</a></td><th width="60%" align="center">Глава 44. PL/Tcl — процедурный язык Tcl</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="pltcl-dbaccess.html" title="44.5. Обращение к базе данных из PL/Tcl">След.</a></td></tr></table><hr /></div><div class="sect1" id="PLTCL-GLOBAL"><div class="titlepage"><div><div><h2 class="title" style="clear: both">44.4. Глобальные данные в PL/Tcl <a href="#PLTCL-GLOBAL" class="id_link">#</a></h2></div></div></div><a id="id-1.8.9.8.2" class="indexterm"></a><p>Иногда полезно иметь некоторые глобальные данные, сохраняемые между двумя вызовами функции или совместно используемые разными функциями. Это легко сделать в PL/Tcl, но есть некоторые ограничения, которые необходимо понимать.</p><p>По соображениям безопасности, PL/Tcl выполняет функции, вызываемые некоторой ролью SQL в отдельном интерпретаторе Tcl, выделенном для этой роли. Это предотвращает случайное или злонамеренное влияние одного пользователя на поведение функций PL/Tcl другого пользователя. В каждом интерпретаторе будут свои значения всех <span class="quote">«<span class="quote">глобальных</span>»</span> переменных Tcl. Таким образом, в двух функциях PL/Tcl будут общие глобальные переменные, только если они выполняются одной ролью SQL. В приложении, выполняющем код в одном сеансе с разными ролями SQL (вызывающем функции <code class="literal">SECURITY DEFINER</code>, использующем команду <code class="command">SET ROLE</code> и т. д.) может понадобиться явно предпринять дополнительные меры, чтобы функции могли разделять свои данные. Для этого сначала установите для функций, которые должны взаимодействовать, одного владельца, а затем задайте для них свойство <code class="literal">SECURITY DEFINER</code>. Разумеется, при этом нужно позаботиться о том, чтобы эти функции не могли сделать ничего непредусмотренного.</p><p>Все функции PL/TclU, вызываемые в одном сеансе, выполняются одним интерпретатором Tcl, который, конечно, отличается от интерпретатора(ов), используемого для функций PL/Tcl. Поэтому глобальные данные функций PL/TclU автоматически становятся общими. Это не считается угрозой безопасности, так как все функции PL/TclU выполняются на одном уровне доверия, а именно уровне суперпользователя базы данных.</p><p>Чтобы защитить функции PL/Tcl от непреднамеренного влияния друг на друга, каждой из них предоставляется глобальная переменная-массив через команду <code class="function">upvar</code>. Глобальным именем этой переменной является внутреннее имя функции, а в качестве локального выбрано <code class="literal">GD</code>. Переменную <code class="literal">GD</code> рекомендуется использовать для постоянных внутренних данных функции. Обычные глобальные переменные Tcl следует использовать только для значений, которые предназначены именно для совместного использования несколькими функциями. (Заметьте, что массивы <code class="literal">GD</code> являются глобальными только для конкретного интерпретатора, так что они не нарушают ограничения безопасности, описанные выше.)</p><p>Использование <code class="literal">GD</code> демонстрируется в примере <code class="function">spi_execp</code>, приведённом ниже.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pltcl-data.html" title="44.3. Значения данных в PL/Tcl">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="pltcl.html" title="Глава 44. PL/Tcl — процедурный язык Tcl">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="pltcl-dbaccess.html" title="44.5. Обращение к базе данных из PL/Tcl">След.</a></td></tr><tr><td width="40%" align="left" valign="top">44.3. Значения данных в PL/Tcl </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 44.5. Обращение к базе данных из PL/Tcl</td></tr></table></div></body></html>