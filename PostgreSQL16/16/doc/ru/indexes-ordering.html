<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>11.4. Индексы и предложения ORDER BY</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="indexes-multicolumn.html" title="11.3. Составные индексы" /><link rel="next" href="indexes-bitmap-scans.html" title="11.5. Объединение нескольких индексов" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">11.4. Индексы и предложения <code class="literal">ORDER BY</code></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="indexes-multicolumn.html" title="11.3. Составные индексы">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="indexes.html" title="Глава 11. Индексы">Наверх</a></td><th width="60%" align="center">Глава 11. Индексы</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="indexes-bitmap-scans.html" title="11.5. Объединение нескольких индексов">След.</a></td></tr></table><hr /></div><div class="sect1" id="INDEXES-ORDERING"><div class="titlepage"><div><div><h2 class="title" style="clear: both">11.4. Индексы и предложения <code class="literal">ORDER BY</code> <a href="#INDEXES-ORDERING" class="id_link">#</a></h2></div></div></div><a id="id-1.5.10.7.2" class="indexterm"></a><p>Помимо простого поиска строк для выдачи в результате запроса, индексы также могут применяться для сортировки строк в определённом порядке. Это позволяет учесть предложение <code class="literal">ORDER BY</code> в запросе, не выполняя сортировку дополнительно. Из всех типов индексов, которые поддерживает <span class="productname">PostgreSQL</span>, сортировать данные могут только B-деревья — индексы других типов возвращают строки в неопределённом, зависящем от реализации порядке.</p><p>Планировщик может выполнить указание <code class="literal">ORDER BY</code>, либо просканировав существующий индекс, подходящий этому указанию, либо просканировав таблицу в физическом порядке и выполнив сортировку явно. Для запроса, требующего сканирования большой части таблицы, явная сортировка скорее всего будет быстрее, чем применение индекса, так как при последовательном чтении она потребует меньше операций ввода/вывода. Важный особый случай представляет <code class="literal">ORDER BY</code> в сочетании с <code class="literal">LIMIT</code> <em class="replaceable"><code>n</code></em>: при явной сортировке системе потребуется обработать все данные, чтобы выбрать первые <em class="replaceable"><code>n</code></em> строк, но при наличии индекса, соответствующего столбцам в <code class="literal">ORDER BY</code>, первые <em class="replaceable"><code>n</code></em> строк можно получить сразу, не просматривая остальные вовсе.</p><p>По умолчанию элементы B-дерева хранятся в порядке возрастания, при этом значения NULL идут в конце (для упорядочивания равных записей используется табличный столбец TID). Это означает, что при прямом сканировании индекса по столбцу <code class="literal">x</code> порядок оказывается соответствующим указанию <code class="literal">ORDER BY x</code> (или точнее, <code class="literal">ORDER BY x ASC NULLS LAST</code>). Индекс также может сканироваться в обратную сторону, и тогда порядок соответствует указанию <code class="literal">ORDER BY x DESC</code> (или точнее, <code class="literal">ORDER BY x DESC NULLS FIRST</code>, так как для <code class="literal">ORDER BY DESC</code> подразумевается <code class="literal">NULLS FIRST</code>).</p><p>Вы можете изменить порядок сортировки элементов B-дерева, добавив уточнения <code class="literal">ASC</code>, <code class="literal">DESC</code>, <code class="literal">NULLS FIRST</code> и/или <code class="literal">NULLS LAST</code> при создании индекса; например: </p><pre class="programlisting">CREATE INDEX test2_info_nulls_low ON test2 (info NULLS FIRST);
CREATE INDEX test3_desc_index ON test3 (id DESC NULLS LAST);</pre><p> Индекс, в котором элементы хранятся в порядке возрастания и значения NULL идут первыми, может удовлетворять указаниям <code class="literal">ORDER BY x ASC NULLS FIRST</code> или <code class="literal">ORDER BY x DESC NULLS LAST</code>, в зависимости от направления просмотра.</p><p>У вас может возникнуть вопрос, зачем нужны все четыре варианта при создании индексов, когда и два варианта с учётом обратного просмотра покрывают все виды <code class="literal">ORDER BY</code>. Для индексов по одному столбцу это и в самом деле излишне, но для индексов по многим столбцам это может быть полезно. Рассмотрим индекс по двум столбцам <code class="literal">(x, y)</code>: он может удовлетворять указанию <code class="literal">ORDER BY x, y</code> при прямом сканировании или <code class="literal">ORDER BY x DESC, y DESC</code> при обратном. Но вполне возможно, что приложение будет часто выполнять <code class="literal">ORDER BY x ASC, y DESC</code>. В этом случае получить такую сортировку от простого индекса нельзя, но можно получить подходящий индекс, определив его как <code class="literal">(x ASC, y DESC)</code> или <code class="literal">(x DESC, y ASC)</code>.</p><p>Очевидно, что индексы с нестандартными правилами сортировки весьма специфичны, но иногда они могут кардинально ускорить определённые запросы. Стоит ли вводить такие индексы, зависит от того, как часто выполняются запросы с необычным порядком сортировки.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="indexes-multicolumn.html" title="11.3. Составные индексы">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="indexes.html" title="Глава 11. Индексы">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="indexes-bitmap-scans.html" title="11.5. Объединение нескольких индексов">След.</a></td></tr><tr><td width="40%" align="left" valign="top">11.3. Составные индексы </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 11.5. Объединение нескольких индексов</td></tr></table></div></body></html>