<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5.6. Изменение таблиц</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="ddl-system-columns.html" title="5.5. Системные столбцы" /><link rel="next" href="ddl-priv.html" title="5.7. Права" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">5.6. Изменение таблиц</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="ddl-system-columns.html" title="5.5. Системные столбцы">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="ddl.html" title="Глава 5. Определение данных">Наверх</a></td><th width="60%" align="center">Глава 5. Определение данных</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="ddl-priv.html" title="5.7. Права">След.</a></td></tr></table><hr /></div><div class="sect1" id="DDL-ALTER"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.6. Изменение таблиц <a href="#DDL-ALTER" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="ddl-alter.html#DDL-ALTER-ADDING-A-COLUMN">5.6.1. Добавление столбца</a></span></dt><dt><span class="sect2"><a href="ddl-alter.html#DDL-ALTER-REMOVING-A-COLUMN">5.6.2. Удаление столбца</a></span></dt><dt><span class="sect2"><a href="ddl-alter.html#DDL-ALTER-ADDING-A-CONSTRAINT">5.6.3. Добавление ограничения</a></span></dt><dt><span class="sect2"><a href="ddl-alter.html#DDL-ALTER-REMOVING-A-CONSTRAINT">5.6.4. Удаление ограничения</a></span></dt><dt><span class="sect2"><a href="ddl-alter.html#DDL-ALTER-COLUMN-DEFAULT">5.6.5. Изменение значения по умолчанию</a></span></dt><dt><span class="sect2"><a href="ddl-alter.html#DDL-ALTER-COLUMN-TYPE">5.6.6. Изменение типа данных столбца</a></span></dt><dt><span class="sect2"><a href="ddl-alter.html#DDL-ALTER-RENAMING-COLUMN">5.6.7. Переименование столбца</a></span></dt><dt><span class="sect2"><a href="ddl-alter.html#DDL-ALTER-RENAMING-TABLE">5.6.8. Переименование таблицы</a></span></dt></dl></div><a id="id-1.5.4.8.2" class="indexterm"></a><p>Если вы создали таблицы, а затем поняли, что допустили ошибку, или изменились требования вашего приложения, вы можете удалить её и создать заново. Но это будет неудобно, если таблица уже заполнена данными, или если на неё ссылаются другие объекты базы данных (например, по внешнему ключу). Поэтому <span class="productname">PostgreSQL</span> предоставляет набор команд для модификации таблиц. Заметьте, что это по сути отличается от изменения данных, содержащихся в таблице: здесь мы обсуждаем модификацию определения, или структуры, таблицы.</p><p>Вы можете: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>Добавлять столбцы</p></li><li class="listitem"><p>Удалять столбцы</p></li><li class="listitem"><p>Добавлять ограничения</p></li><li class="listitem"><p>Удалять ограничения</p></li><li class="listitem"><p>Изменять значения по умолчанию</p></li><li class="listitem"><p>Изменять типы столбцов</p></li><li class="listitem"><p>Переименовывать столбцы</p></li><li class="listitem"><p>Переименовывать таблицы</p></li></ul></div><p> Все эти действия выполняются с помощью команды <a class="xref" href="sql-altertable.html" title="ALTER TABLE"><span class="refentrytitle">ALTER TABLE</span></a>; подробнее о ней вы можете узнать в её справке.</p><div class="sect2" id="DDL-ALTER-ADDING-A-COLUMN"><div class="titlepage"><div><div><h3 class="title">5.6.1. Добавление столбца <a href="#DDL-ALTER-ADDING-A-COLUMN" class="id_link">#</a></h3></div></div></div><a id="id-1.5.4.8.5.2" class="indexterm"></a><p>Добавить столбец вы можете так: </p><pre class="programlisting">ALTER TABLE products ADD COLUMN description text;</pre><p> Новый столбец заполняется заданным для него значением по умолчанию (или значением NULL, если вы не добавите указание <code class="literal">DEFAULT</code>).</p><div class="tip"><h3 class="title">Подсказка</h3><p>Начиная с <span class="productname">PostgreSQL</span> 11, добавление столбца с постоянным значением по умолчанию более не означает, что при выполнении команды <code class="command">ALTER TABLE</code> будут изменены все строки таблицы. Вместо этого установленное значение по умолчанию будет просто выдаваться при следующем обращении к строкам, а сохранится в строках при перезаписи таблицы. Благодаря этому операция <code class="command">ALTER TABLE</code> и с большими таблицами выполняется очень быстро.</p><p>Однако если значение по умолчанию изменчивое (например, это <code class="function">clock_timestamp()</code>), в каждую строку нужно будет внести значение, вычисленное в момент выполнения <code class="command">ALTER TABLE</code>. Чтобы избежать потенциально длительной операции изменения всех строк, если вы планируете заполнить столбец в основном не значениями по умолчанию, лучше будет добавить столбец без значения по умолчанию, затем вставить требуемые значения с помощью <code class="command">UPDATE</code>, а потом определить значение по умолчанию, как описано ниже.</p></div><p>При этом вы можете сразу определить ограничения столбца, используя обычный синтаксис: </p><pre class="programlisting">ALTER TABLE products ADD COLUMN description text CHECK (description &lt;&gt; '');</pre><p> На самом деле здесь можно использовать все конструкции, допустимые в определении столбца в команде <code class="command">CREATE TABLE</code>. Помните однако, что значение по умолчанию должно удовлетворять данным ограничениям, чтобы операция <code class="literal">ADD</code> выполнилась успешно. Вы также можете сначала заполнить столбец правильно, а затем добавить ограничения (см. ниже).</p></div><div class="sect2" id="DDL-ALTER-REMOVING-A-COLUMN"><div class="titlepage"><div><div><h3 class="title">5.6.2. Удаление столбца <a href="#DDL-ALTER-REMOVING-A-COLUMN" class="id_link">#</a></h3></div></div></div><a id="id-1.5.4.8.6.2" class="indexterm"></a><p>Удалить столбец можно так: </p><pre class="programlisting">ALTER TABLE products DROP COLUMN description;</pre><p> Данные, которые были в этом столбце, исчезают. Вместе со столбцом удаляются и включающие его ограничения таблицы. Однако если на столбец ссылается ограничение внешнего ключа другой таблицы, <span class="productname">PostgreSQL</span> не удалит это ограничение неявно. Разрешить удаление всех зависящих от этого столбца объектов можно, добавив указание <code class="literal">CASCADE</code>: </p><pre class="programlisting">ALTER TABLE products DROP COLUMN description CASCADE;</pre><p> Общий механизм, стоящий за этим, описывается в <a class="xref" href="ddl-depend.html" title="5.14. Отслеживание зависимостей">Разделе 5.14</a>.</p></div><div class="sect2" id="DDL-ALTER-ADDING-A-CONSTRAINT"><div class="titlepage"><div><div><h3 class="title">5.6.3. Добавление ограничения <a href="#DDL-ALTER-ADDING-A-CONSTRAINT" class="id_link">#</a></h3></div></div></div><a id="id-1.5.4.8.7.2" class="indexterm"></a><p>Для добавления ограничения используется синтаксис ограничения таблицы. Например: </p><pre class="programlisting">ALTER TABLE products ADD CHECK (name &lt;&gt; '');
ALTER TABLE products ADD CONSTRAINT some_name UNIQUE (product_no);
ALTER TABLE products ADD FOREIGN KEY (product_group_id)
  REFERENCES product_groups;</pre><p> Чтобы добавить ограничение NOT NULL, которое нельзя записать в виде ограничения таблицы, используйте такой синтаксис: </p><pre class="programlisting">ALTER TABLE products ALTER COLUMN product_no SET NOT NULL;</pre><p>Ограничение проходит проверку автоматически и будет добавлено, только если ему удовлетворяют данные таблицы.</p></div><div class="sect2" id="DDL-ALTER-REMOVING-A-CONSTRAINT"><div class="titlepage"><div><div><h3 class="title">5.6.4. Удаление ограничения <a href="#DDL-ALTER-REMOVING-A-CONSTRAINT" class="id_link">#</a></h3></div></div></div><a id="id-1.5.4.8.8.2" class="indexterm"></a><p>Для удаления ограничения вы должны знать его имя. Если вы не присваивали ему имя, это неявно сделала система, и вы должны выяснить его. Здесь может быть полезна команда <span class="application">psql</span> <code class="literal">\d <em class="replaceable"><code>имя_таблицы</code></em></code> (или другие программы, показывающие подробную информацию о таблицах). Зная имя, вы можете использовать команду: </p><pre class="programlisting">ALTER TABLE products DROP CONSTRAINT some_name;</pre><p> (Если вы имеете дело с именем ограничения вида <code class="literal">$2</code>, не забудьте заключить его в кавычки, чтобы это был допустимый идентификатор.)</p><p>Как и при удалении столбца, если вы хотите удалить ограничение с зависимыми объектами, добавьте указание <code class="literal">CASCADE</code>. Примером такой зависимости может быть ограничение внешнего ключа, связанное со столбцами ограничения первичного ключа.</p><p>Так можно удалить ограничения любых типов, кроме NOT NULL. Чтобы удалить ограничение NOT NULL, используйте команду: </p><pre class="programlisting">ALTER TABLE products ALTER COLUMN product_no DROP NOT NULL;</pre><p> (Вспомните, что у ограничений NOT NULL нет имён.)</p></div><div class="sect2" id="DDL-ALTER-COLUMN-DEFAULT"><div class="titlepage"><div><div><h3 class="title">5.6.5. Изменение значения по умолчанию <a href="#DDL-ALTER-COLUMN-DEFAULT" class="id_link">#</a></h3></div></div></div><a id="id-1.5.4.8.9.2" class="indexterm"></a><p>Назначить столбцу новое значение по умолчанию можно так: </p><pre class="programlisting">ALTER TABLE products ALTER COLUMN price SET DEFAULT 7.77;</pre><p> Заметьте, что это никак не влияет на существующие строки таблицы, а просто задаёт значение по умолчанию для последующих команд <code class="command">INSERT</code>.</p><p>Чтобы удалить значение по умолчанию, выполните: </p><pre class="programlisting">ALTER TABLE products ALTER COLUMN price DROP DEFAULT;</pre><p> При этом по сути значению по умолчанию просто присваивается NULL. Как следствие, ошибки не будет, если вы попытаетесь удалить значение по умолчанию, не определённое явно, так как неявно оно существует и равно NULL.</p></div><div class="sect2" id="DDL-ALTER-COLUMN-TYPE"><div class="titlepage"><div><div><h3 class="title">5.6.6. Изменение типа данных столбца <a href="#DDL-ALTER-COLUMN-TYPE" class="id_link">#</a></h3></div></div></div><a id="id-1.5.4.8.10.2" class="indexterm"></a><p>Чтобы преобразовать столбец в другой тип данных, используйте команду: </p><pre class="programlisting">ALTER TABLE products ALTER COLUMN price TYPE numeric(10,2);</pre><p> Она будет успешна, только если все существующие значения в столбце могут быть неявно приведены к новому типу. Если требуется более сложное преобразование, вы можете добавить указание <code class="literal">USING</code>, определяющее, как получить новые значения из старых.</p><p><span class="productname">PostgreSQL</span> попытается также преобразовать к новому типу значение столбца по умолчанию (если оно определено) и все связанные с этим столбцом ограничения. Но преобразование может оказаться неправильным, и тогда вы получите неожиданные результаты. Поэтому обычно лучше удалить все ограничения столбца, перед тем как менять его тип, а затем воссоздать модифицированные должным образом ограничения.</p></div><div class="sect2" id="DDL-ALTER-RENAMING-COLUMN"><div class="titlepage"><div><div><h3 class="title">5.6.7. Переименование столбца <a href="#DDL-ALTER-RENAMING-COLUMN" class="id_link">#</a></h3></div></div></div><a id="id-1.5.4.8.11.2" class="indexterm"></a><p>Чтобы переименовать столбец, выполните: </p><pre class="programlisting">ALTER TABLE products RENAME COLUMN product_no TO product_number;</pre></div><div class="sect2" id="DDL-ALTER-RENAMING-TABLE"><div class="titlepage"><div><div><h3 class="title">5.6.8. Переименование таблицы <a href="#DDL-ALTER-RENAMING-TABLE" class="id_link">#</a></h3></div></div></div><a id="id-1.5.4.8.12.2" class="indexterm"></a><p>Таблицу можно переименовать так: </p><pre class="programlisting">ALTER TABLE products RENAME TO items;</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ddl-system-columns.html" title="5.5. Системные столбцы">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="ddl.html" title="Глава 5. Определение данных">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="ddl-priv.html" title="5.7. Права">След.</a></td></tr><tr><td width="40%" align="left" valign="top">5.5. Системные столбцы </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 5.7. Права</td></tr></table></div></body></html>