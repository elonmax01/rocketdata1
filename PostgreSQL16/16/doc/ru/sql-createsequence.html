<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE SEQUENCE</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-createschema.html" title="CREATE SCHEMA" /><link rel="next" href="sql-createserver.html" title="CREATE SERVER" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">CREATE SEQUENCE</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-createschema.html" title="CREATE SCHEMA">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><th width="60%" align="center">Команды SQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-createserver.html" title="CREATE SERVER">След.</a></td></tr></table><hr /></div><div class="refentry" id="SQL-CREATESEQUENCE"><div class="titlepage"></div><a id="id-1.9.3.81.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">CREATE SEQUENCE</span></h2><p>CREATE SEQUENCE — создать генератор последовательности</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">CREATE [ { TEMPORARY | TEMP } | UNLOGGED ] SEQUENCE [ IF NOT EXISTS ] <em class="replaceable"><code>имя</code></em>
    [ AS <em class="replaceable"><code>тип_данных</code></em> ]
    [ INCREMENT [ BY ] <em class="replaceable"><code>шаг</code></em> ]
    [ MINVALUE <em class="replaceable"><code>мин_значение</code></em> | NO MINVALUE ] [ MAXVALUE <em class="replaceable"><code>макс_значение</code></em> | NO MAXVALUE ]
    [ START [ WITH ] <em class="replaceable"><code>начало</code></em> ] [ CACHE <em class="replaceable"><code>кеш</code></em> ] [ [ NO ] CYCLE ]
    [ OWNED BY { <em class="replaceable"><code>имя_таблицы</code></em>.<em class="replaceable"><code>имя_столбца</code></em> | NONE } ]</pre></div><div class="refsect1" id="id-1.9.3.81.5"><h2>Описание</h2><p><code class="command">CREATE SEQUENCE</code> создаёт генератор последовательности. Эта операция включает создание и инициализацию специальной таблицы <em class="replaceable"><code>имя</code></em>, содержащей одну строку. Владельцем генератора будет пользователь, выполняющий эту команду.</p><p>Если указано имя схемы, последовательность создаётся в заданной схеме, в противном случае — в текущей. Временные последовательности существуют в специальной схеме, так что при создании таких последовательностей имя схемы задать нельзя. Имя последовательности должно отличаться от имён других отношений (таблиц, последовательностей, индексов, представлений, материализованных представлений или сторонних таблиц), уже существующих в этой схеме.</p><p>После создания последовательности работать с ней можно, вызывая функции <code class="function">nextval</code>, <code class="function">currval</code> и <code class="function">setval</code>. Эти функции документированы в <a class="xref" href="functions-sequence.html" title="9.17. Функции для работы с последовательностями">Разделе 9.17</a>.</p><p>Хотя непосредственно изменить значение последовательности нельзя, получить её параметры и текущее состояние можно таким запросом: </p><pre class="programlisting">SELECT * FROM <em class="replaceable"><code>name</code></em>;</pre><p> В частности, поле <code class="literal">last_value</code> последовательности будет содержать последнее значение, выделенное для какого-либо сеанса. (Конечно, ко времени вывода это значение может стать неактуальным, если другие сеансы активно вызывают <code class="function">nextval</code>.)</p></div><div class="refsect1" id="id-1.9.3.81.6"><h2>Параметры</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">TEMPORARY</code> или <code class="literal">TEMP</code></span></dt><dd><p>Если указано, объект последовательности создаётся только для данного сеанса и автоматически удаляется при завершении сеанса. Существующая постоянная последовательность с тем же именем не будут видна (в этом сеансе), пока существует временная, однако к ней можно обратиться, дополнив имя указанием схемы.</p></dd><dt><span class="term"><code class="literal">UNLOGGED</code></span></dt><dd><p>С этим указанием последовательность создаётся как нежурналируемая. Изменения нежурналируемых последовательностей не проходят через журнал предзаписи. Такие последовательности не защищены от сбоев: нежурналируемая последовательность автоматически сбрасывается в исходное состояние после сбоя или аварийного отключения сервера. Кроме того, нежурналируемые последовательности не реплицируются на ведомые серверы.</p><p>В отличие от нежурналируемых таблиц, нежурналируемые последовательности не дают значительного выигрыша в производительности. Это указание полезно, в первую очередь, когда последовательность связана через столбцы идентификаторов или столбцы serial с нежурналируемыми таблицами. В таких случаях обычно не имеет смысла журналировать и реплицировать саму последовательность, но не таблицу, с которой она связана.</p></dd><dt><span class="term"><code class="literal">IF NOT EXISTS</code></span></dt><dd><p>Не считать ошибкой, если отношение с таким именем уже существует. В этом случае будет выдано замечание. Заметьте, что нет никакой гарантии, что существующее отношение как-то соотносится с последовательностью, которая могла бы быть создана — это может быть даже не последовательность.</p></dd><dt><span class="term"><em class="replaceable"><code>имя</code></em></span></dt><dd><p>Имя создаваемой последовательности (возможно, дополненное схемой).</p></dd><dt><span class="term"><em class="replaceable"><code>тип_данных</code></em></span></dt><dd><p>Необязательное предложение <code class="literal">AS <em class="replaceable"><code>тип_данных</code></em></code> задаёт тип данных для последовательности. Допустимые типы: <code class="literal">smallint</code>, <code class="literal">integer</code> и <code class="literal">bigint</code>. По умолчанию устанавливается тип <code class="literal">bigint</code>. От типа данных зависят принимаемые по умолчанию минимальное и максимальное значения последовательности.</p></dd><dt><span class="term"><em class="replaceable"><code>шаг</code></em></span></dt><dd><p>Необязательное предложение <code class="literal">INCREMENT BY <em class="replaceable"><code>шаг</code></em></code> определяет, какое число будет добавляться к текущему значению последовательности для получения нового значения. С положительным шагом последовательность будет возрастающей, а с отрицательным — убывающей. Значение по умолчанию: 1.</p></dd><dt><span class="term"><em class="replaceable"><code>мин_значение</code></em><br /></span><span class="term"><code class="literal">NO MINVALUE</code></span></dt><dd><p>Необязательное предложение <code class="literal">MINVALUE <em class="replaceable"><code>мин_значение</code></em></code> определяет наименьшее число, которое будет генерировать последовательность. Если это предложение опущено либо указано <code class="option">NO MINVALUE</code>, используется значение по умолчанию: 1 для возрастающей последовательности или минимальное значение типа данных — для убывающей.</p></dd><dt><span class="term"><em class="replaceable"><code>макс_значение</code></em><br /></span><span class="term"><code class="literal">NO MAXVALUE</code></span></dt><dd><p>Необязательное предложение <code class="literal">MAXVALUE <em class="replaceable"><code>макс_значение</code></em></code> определяет наибольшее число, которое будет генерировать последовательность. Если это предложение опущено либо указано <code class="option">NO MAXVALUE</code>, используется значение по умолчанию: максимальное значение типа данных для возрастающей последовательности или -1 — для убывающей.</p></dd><dt><span class="term"><em class="replaceable"><code>начало</code></em></span></dt><dd><p>Необязательное предложение <code class="literal">START WITH <em class="replaceable"><code>начало</code></em></code> позволяет запустить последовательность с любого значения. По умолчанию началом считается <em class="replaceable"><code>мин_значение</code></em> для возрастающих последовательностей и <em class="replaceable"><code>макс_значение</code></em> для убывающих.</p></dd><dt><span class="term"><em class="replaceable"><code>кеш</code></em></span></dt><dd><p>Необязательное предложение <code class="literal">CACHE <em class="replaceable"><code>кеш</code></em></code> определяет, сколько чисел последовательности будет выделяться и сохраняться в памяти для ускорения доступа к ним. Минимальное значение равно 1 (за один раз генерируется только одно значение, т. е. кеширования нет), и оно же предполагается по умолчанию.</p></dd><dt><span class="term"><code class="literal">CYCLE</code><br /></span><span class="term"><code class="literal">NO CYCLE</code></span></dt><dd><p>Параметр <code class="literal">CYCLE</code> позволяет зациклить последовательность при достижении <em class="replaceable"><code>макс_значения</code></em> или <em class="replaceable"><code>мин_значения</code></em> для возрастающей или убывающей последовательности, соответственно. Когда этот предел достигается, следующим числом этих последовательностей будет соответственно <em class="replaceable"><code>мин_значение</code></em> или <em class="replaceable"><code>макс_значение</code></em>.</p><p>Если указывается <code class="literal">NO CYCLE</code>, при каждом вызове <code class="function">nextval</code> после достижения предельного значения будет возникать ошибка. Если указания <code class="literal">CYCLE</code> и <code class="literal">NO CYCLE</code> отсутствуют, по умолчанию предполагается <code class="literal">NO CYCLE</code>.</p></dd><dt><span class="term"><code class="literal">OWNED BY</code> <em class="replaceable"><code>имя_таблицы</code></em>.<em class="replaceable"><code>имя_столбца</code></em><br /></span><span class="term"><code class="literal">OWNED BY NONE</code></span></dt><dd><p>Предложение <code class="literal">OWNED BY</code> позволяет связать последовательность с определённым столбцом таблицы так, чтобы при удалении этого столбца (или всей таблицы) последовательность удалялась автоматически. Указанная таблица должна иметь того же владельца и находиться в той же схеме, что и последовательность. Подразумеваемое по умолчанию предложение <code class="literal">OWNED BY NONE</code> указывает, что такая связь не устанавливается.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.3.81.7"><h2>Замечания</h2><p>Для удаления последовательности применяется команда <code class="command">DROP SEQUENCE</code>.</p><p>Последовательности основаны на арифметике <code class="type">bigint</code>, так что их значения не могут выходить за диапазон восьмибайтовых целых (-9223372036854775808 .. 9223372036854775807).</p><p>Так как вызовы <code class="function">nextval</code> и <code class="function">setval</code> никогда не откатываются, объекты последовательностей не подходят, если требуется обеспечить непрерывное назначение номеров последовательностей. Непрерывное назначение можно организовать, используя исключительную блокировку таблицы со счётчиком; однако это решение будет гораздо дороже, чем применение объектов последовательностей, особенно когда последовательные номера будут затребоваться сразу многими транзакциями.</p><p>Если значение параметра <em class="replaceable"><code>кеш</code></em> больше единицы, и объект последовательности используется параллельно в нескольких сеансах, результат может оказаться не вполне ожидаемым. Каждый сеанс будет выделять и кешировать несколько очередных значений последовательности при одном обращении к объекту последовательности и соответственно увеличивать <code class="literal">последнее_значение</code> этого объекта. Затем при следующих <em class="replaceable"><code>кеш</code></em>-1 вызовах <code class="function">nextval</code> в этом сеансе будет просто возвращать заготовленные значения, не касаясь объекта последовательности. В результате, все числа, выделенные, но не использованные в сеансе, будут потеряны при завершении сеанса, что приведёт к образовании <span class="quote">«<span class="quote">дырок</span>»</span> в последовательности.</p><p>Более того, хотя разным сеансам гарантированно выделяются различные значения последовательности, если рассмотреть все сеансы в целом, порядок этих значений может быть нарушен. Например, при значении <em class="replaceable"><code>кеш</code></em>, равном 10, сеанс A может зарезервировать значения 1..10 и получить <code class="function">nextval</code>=1, затем сеанс B может зарезервировать значения 11..20 и получить <code class="function">nextval</code>=11 до того, как в сеансе A сгенерируется <code class="function">nextval</code>=2. Таким образом, при значении <em class="replaceable"><code>кеш</code></em>, равном одному, можно быть уверенными в том, что <code class="function">nextval</code> генерирует последовательные значения; но если <em class="replaceable"><code>кеш</code></em> больше одного, рассчитывать можно только на то, что все значения <code class="function">nextval</code> различны; их порядок может быть непоследовательным. Кроме того, <code class="literal">last_value</code> возвращает последнее зарезервированное значение для всех сеансов, вне зависимости от того, было ли оно уже возвращено функцией <code class="function">nextval</code>.</p><p>Также следует учитывать, что действие функции <code class="function">setval</code>, выполненной для такой последовательности, проявится в других сеансах только после того, как в них будут использованы все предварительно закешированные значения.</p></div><div class="refsect1" id="id-1.9.3.81.8"><h2>Примеры</h2><p>Создание возрастающей последовательности с именем <code class="literal">serial</code>, с начальным значением 101: </p><pre class="programlisting">CREATE SEQUENCE serial START 101;</pre><p>Получение следующего номера этой последовательности: </p><pre class="programlisting">SELECT nextval('serial');

 nextval
---------
     101</pre><p>Получение следующего номера этой последовательности: </p><pre class="programlisting">SELECT nextval('serial');

 nextval
---------
     102</pre><p>Использование этой последовательности в команде <code class="command">INSERT</code>: </p><pre class="programlisting">INSERT INTO distributors VALUES (nextval('serial'), 'nothing');</pre><p>Изменение значения последовательности после <code class="command">COPY FROM</code>: </p><pre class="programlisting">BEGIN;
COPY distributors FROM 'input_file';
SELECT setval('serial', max(id)) FROM distributors;
END;</pre></div><div class="refsect1" id="id-1.9.3.81.9"><h2>Совместимость</h2><p>Команда <code class="command">CREATE SEQUENCE</code> соответствует стандарту <acronym class="acronym">SQL</acronym>, со следующими исключениями: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Для получения следующего значения применяется функция <code class="function">nextval()</code>, а не выражение <code class="command">NEXT VALUE FOR</code>, как того требует стандарт.</p></li><li class="listitem"><p>Предложение <code class="literal">OWNED BY</code> является расширением <span class="productname">PostgreSQL</span>.</p></li></ul></div></div><div class="refsect1" id="id-1.9.3.81.10"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-altersequence.html" title="ALTER SEQUENCE"><span class="refentrytitle">ALTER SEQUENCE</span></a>, <a class="xref" href="sql-dropsequence.html" title="DROP SEQUENCE"><span class="refentrytitle">DROP SEQUENCE</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-createschema.html" title="CREATE SCHEMA">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-createserver.html" title="CREATE SERVER">След.</a></td></tr><tr><td width="40%" align="left" valign="top">CREATE SCHEMA </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> CREATE SERVER</td></tr></table></div></body></html>