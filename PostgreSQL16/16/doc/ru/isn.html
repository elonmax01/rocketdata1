<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.21. isn — типы данных для международных стандартов нумерации (ISBN, EAN, UPC и т. д.)</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="intarray.html" title="F.20. intarray — работа с массивами целых чисел" /><link rel="next" href="lo.html" title="F.22. lo — управление большими объектами" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.21. isn — типы данных для международных стандартов нумерации (ISBN, EAN, UPC и т. д.)</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="intarray.html" title="F.20. intarray — работа с массивами целых чисел">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><th width="60%" align="center">Приложение F. Дополнительно поставляемые модули и расширения</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="lo.html" title="F.22. lo — управление большими объектами">След.</a></td></tr></table><hr /></div><div class="sect1" id="ISN"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.21. isn — типы данных для международных стандартов нумерации (ISBN, EAN, UPC и т. д.) <a href="#ISN" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="isn.html#ISN-DATA-TYPES">F.21.1. Типы данных</a></span></dt><dt><span class="sect2"><a href="isn.html#ISN-CASTS">F.21.2. Приведения</a></span></dt><dt><span class="sect2"><a href="isn.html#ISN-FUNCS-OPS">F.21.3. Функции и операторы</a></span></dt><dt><span class="sect2"><a href="isn.html#ISN-EXAMPLES">F.21.4. Примеры</a></span></dt><dt><span class="sect2"><a href="isn.html#ISN-BIBLIOGRAPHY">F.21.5. Библиография</a></span></dt><dt><span class="sect2"><a href="isn.html#ISN-AUTHOR">F.21.6. Автор</a></span></dt></dl></div><a id="id-1.11.7.31.2" class="indexterm"></a><p>Модуль <code class="filename">isn</code> предоставляет типы данных для следующих международных стандартов нумерации товаров: EAN13, UPC, ISBN (книги), ISMN (музыка) и ISSN (серийные номера). Номера проверяются на входе согласно жёстко заданному списку префиксов: этот список префиксов также применяется для группирования цифр при выводе. Так как время от времени появляются новые префиксы, этот список префиксов может устаревать. Ожидается, что будущая версия этого модуля будет получать список префиксов из одной или нескольких таблиц, благодаря чему его при необходимости смогут легко обновлять пользователи; однако в настоящее время этот список можно изменить, только модифицировав исходный код и перекомпилировав его. Также есть вероятность, что в будущем этот модуль лишится функций проверки префиксов и группирования цифр.</p><p>Данный модуль считается <span class="quote">«<span class="quote">доверенным</span>»</span>, то есть его могут устанавливать обычные пользователи, имеющие право <code class="literal">CREATE</code> в текущей базе данных.</p><div class="sect2" id="ISN-DATA-TYPES"><div class="titlepage"><div><div><h3 class="title">F.21.1. Типы данных <a href="#ISN-DATA-TYPES" class="id_link">#</a></h3></div></div></div><p>В <a class="xref" href="isn.html#ISN-DATATYPES" title="Таблица F.11. Типы данных isn">Таблице F.11</a> перечислены типы данных, реализованные модулем <code class="filename">isn</code>.</p><div class="table" id="ISN-DATATYPES"><p class="title"><strong>Таблица F.11. Типы данных <code class="filename">isn</code></strong></p><div class="table-contents"><table class="table" summary="Типы данных isn" border="1"><colgroup><col class="col1" /><col class="col2" /></colgroup><thead><tr><th>Тип данных</th><th>Описание</th></tr></thead><tbody><tr><td><code class="type">EAN13</code></td><td>European Article Number (Европейский номер товара), всегда выводится в формате EAN13</td></tr><tr><td><code class="type">ISBN13</code></td><td>International Standard Book Number (Международный стандартный книжный номер), выводимый в новом формате EAN13</td></tr><tr><td><code class="type">ISMN13</code></td><td>International Standard Music Number (Международный стандартный музыкальный номер), выводимый в новом формате EAN13</td></tr><tr><td><code class="type">ISSN13</code></td><td>International Standard Serial Number (Международный стандартный серийный номер), выводимый в новом формате EAN13</td></tr><tr><td><code class="type">ISBN</code></td><td>Международный стандартный книжный номер, выводимый в старом коротком формате</td></tr><tr><td><code class="type">ISMN</code></td><td>Международный стандартный музыкальный номер, выводимый в старом коротком формате</td></tr><tr><td><code class="type">ISSN</code></td><td>Международный стандартный серийный номер, выводимый в старом коротком формате</td></tr><tr><td><code class="type">UPC</code></td><td>Universal Product Code (Универсальный код товара)</td></tr></tbody></table></div></div><br class="table-break" /><p>Замечания:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Номера ISBN13, ISMN13, ISSN13 являются номерами EAN13.</p></li><li class="listitem"><p>Не все номера EAN13 (только их подмножество) представляют ISBN13, ISMN13 или ISSN13.</p></li><li class="listitem"><p>Некоторые номера ISBN13 можно вывести в формате ISBN.</p></li><li class="listitem"><p>Некоторые номера ISMN13 можно вывести в формате ISMN.</p></li><li class="listitem"><p>Некоторые номера ISSN13 можно вывести в формате ISSN.</p></li><li class="listitem"><p>Номера UPC являются подмножеством номеров EAN13 (по сути они являются номерами EAN13 без первой цифры <code class="literal">0</code>).</p></li><li class="listitem"><p>Любые номера UPC, ISBN, ISMN и ISSN можно представить как номера EAN13.</p></li></ol></div><p>Внутри все эти типы представляются одинаково (64-битными целыми числами) и все они взаимозаменяемы. Различные типы введены для управления форматированием при выводе и для строгой проверки правильности ввода, что и определяет конкретный тип номера.</p><p>Типы <code class="type">ISBN</code>, <code class="type">ISMN</code> и <code class="type">ISSN</code> выводят короткую версию числа (ISxN 10), когда это возможно, либо выбирают формат ISxN 13 для чисел, не умещающихся в короткую версию. Типы <code class="type">EAN13</code>, <code class="type">ISBN13</code>, <code class="type">ISMN13</code> и <code class="type">ISSN13</code> всегда выводят длинную версию ISxN (EAN13).</p></div><div class="sect2" id="ISN-CASTS"><div class="titlepage"><div><div><h3 class="title">F.21.2. Приведения <a href="#ISN-CASTS" class="id_link">#</a></h3></div></div></div><p>Модуль <code class="filename">isn</code> предоставляет следующие пары приведений типов:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ISBN13 &lt;=&gt; EAN13</p></li><li class="listitem"><p>ISMN13 &lt;=&gt; EAN13</p></li><li class="listitem"><p>ISSN13 &lt;=&gt; EAN13</p></li><li class="listitem"><p>ISBN &lt;=&gt; EAN13</p></li><li class="listitem"><p>ISMN &lt;=&gt; EAN13</p></li><li class="listitem"><p>ISSN &lt;=&gt; EAN13</p></li><li class="listitem"><p>UPC &lt;=&gt; EAN13</p></li><li class="listitem"><p>ISBN &lt;=&gt; ISBN13</p></li><li class="listitem"><p>ISMN &lt;=&gt; ISMN13</p></li><li class="listitem"><p>ISSN &lt;=&gt; ISSN13</p></li></ul></div><p>При приведении <code class="type">EAN13</code> к другому типу выполняется проверка времени выполнения, соответствует ли исходное значение целевому типу, и если это не так, выдаётся ошибка. При других приведениях значения просто перемечаются, так что они успешно выполняются всегда.</p></div><div class="sect2" id="ISN-FUNCS-OPS"><div class="titlepage"><div><div><h3 class="title">F.21.3. Функции и операторы <a href="#ISN-FUNCS-OPS" class="id_link">#</a></h3></div></div></div><p>Модуль <code class="filename">isn</code> предоставляет стандартные операторы сравнения плюс поддержку индексов по хешу и B-деревьев для этих типов данных. Кроме того, он реализует ряд специализированных функций; они перечислены в <a class="xref" href="isn.html#ISN-FUNCTIONS" title="Таблица F.12. Функции isn">Таблице F.12</a>. В этой таблице под <code class="type">isn</code> понимается один из типов данных модуля.</p><div class="table" id="ISN-FUNCTIONS"><p class="title"><strong>Таблица F.12. Функции <code class="filename">isn</code></strong></p><div class="table-contents"><table class="table" summary="Функции isn" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.31.7.3.2.2.1.1.1.1" class="indexterm"></a> <code class="function">isn_weak</code> ( <code class="type">boolean</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Устанавливает ослабленный режим проверки ввода и возвращает новое состояние.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><code class="function">isn_weak</code> () → <code class="returnvalue">boolean</code></p>
       <p>Выдаёт текущее состояние ослабленного режима.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.31.7.3.2.2.3.1.1.1" class="indexterm"></a> <code class="function">make_valid</code> ( <code class="type">isn</code> ) → <code class="returnvalue">isn</code></p>
       <p>Делает неверный номер верным (сбрасывает флаг ошибки).</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.31.7.3.2.2.4.1.1.1" class="indexterm"></a> <code class="function">is_valid</code> ( <code class="type">isn</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Проверяет присутствие флага ошибки.</p></td></tr></tbody></table></div></div><br class="table-break" /><p><em class="firstterm">Ослабленный</em> режим позволяет вставлять в таблицу неверные значения. Под неверным значением понимается номер, в котором не сходится проверочная цифра, а не номер отсутствует вовсе.</p><p>Зачем может понадобиться ослабленный режим? Ну например, у вас может быть большой набор номеров ISBN, и очень многие из них по каким-то странным причинам содержат неверную контрольную цифру (возможно, номера были отсканированы с печатного листа и были распознаны неправильно, или они вводились вручную, кто знает...). В любом случае суть в том, что вы хотите с этим разобраться, но вам нужно загрузить все эти номера в базу данных, а затем, возможно, использовать дополнительное средство поиска неверных номеров в базе данных, чтобы проверить и исправить данные; так что, например, вам нужно будет выбрать все неверные номера в таблице.</p><p>Если попытаться вставить в таблицу неверный номер в ослабленном режиме проверки, номер будет вставлен с исправленной проверочной цифрой, но выводиться будет с восклицательным знаком (<code class="literal">!</code>) в конце, например <code class="literal">0-11-000322-5!</code>. Этот маркер ошибки можно проверить с помощью функции <code class="function">is_valid</code> и очистить функцией <code class="function">make_valid</code>.</p><p>Вы также можете принудительно вставить числа даже не в ослабленном режиме, добавив символ <code class="literal">!</code> в конце номера.</p><p>Есть ещё одна особенность — во вводимом номере вместо проверочной цифры можно указать <code class="literal">?</code> и нужная проверочная цифра будет вставлена автоматически.</p></div><div class="sect2" id="ISN-EXAMPLES"><div class="titlepage"><div><div><h3 class="title">F.21.4. Примеры <a href="#ISN-EXAMPLES" class="id_link">#</a></h3></div></div></div><pre class="programlisting">-- Использование типов напрямую:
SELECT isbn('978-0-393-04002-9');
SELECT isbn13('0901690546');
SELECT issn('1436-4522');

-- Приведение типов:
--  заметьте, что номер ean13 можно привести к другому типу, только когда
--  этот номер будет допустимым для целевого типа;
--  таким образом, это НЕ будет работать: select isbn(ean13('0220356483481'));
--  а это будет:
SELECT upc(ean13('0220356483481'));
SELECT ean13(upc('220356483481'));

-- Создание таблицы с одним столбцом, который будет содержать номера ISBN:
CREATE TABLE test (id isbn);
INSERT INTO test VALUES('9780393040029');

-- Автоматическое вычисление проверочных цифр (обратите внимание на '?'):
INSERT INTO test VALUES('220500896?');
INSERT INTO test VALUES('978055215372?');

SELECT issn('3251231?');
SELECT ismn('979047213542?');

-- Использование ослабленного режима:
SELECT isn_weak(true);
INSERT INTO test VALUES('978-0-11-000533-4');
INSERT INTO test VALUES('9780141219307');
INSERT INTO test VALUES('2-205-00876-X');
SELECT isn_weak(false);

SELECT id FROM test WHERE NOT is_valid(id);
UPDATE test SET id = make_valid(id) WHERE id = '2-205-00876-X!';

SELECT * FROM test;

SELECT isbn13(id) FROM test;</pre></div><div class="sect2" id="ISN-BIBLIOGRAPHY"><div class="titlepage"><div><div><h3 class="title">F.21.5. Библиография <a href="#ISN-BIBLIOGRAPHY" class="id_link">#</a></h3></div></div></div><p>Информация, на основе которой реализован этот модуль, была собрана с нескольких сайтов, включая: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="ulink" href="https://www.isbn-international.org/" target="_top">https://www.isbn-international.org/</a></p></li><li class="listitem"><p><a class="ulink" href="https://www.issn.org/" target="_top">https://www.issn.org/</a></p></li><li class="listitem"><p><a class="ulink" href="https://www.ismn-international.org/" target="_top">https://www.ismn-international.org/</a></p></li><li class="listitem"><p><a class="ulink" href="https://www.wikipedia.org/" target="_top">https://www.wikipedia.org/</a></p></li></ul></div><p> Префиксы, используемые для группирования цифр, были также взяты с: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="ulink" href="https://www.gs1.org/standards/id-keys" target="_top">https://www.gs1.org/standards/id-keys</a></p></li><li class="listitem"><p><a class="ulink" href="https://en.wikipedia.org/wiki/List_of_ISBN_identifier_groups" target="_top">https://en.wikipedia.org/wiki/List_of_ISBN_identifier_groups</a></p></li><li class="listitem"><p><a class="ulink" href="https://www.isbn-international.org/content/isbn-users-manual" target="_top">https://www.isbn-international.org/content/isbn-users-manual</a></p></li><li class="listitem"><p><a class="ulink" href="https://en.wikipedia.org/wiki/International_Standard_Music_Number" target="_top">https://en.wikipedia.org/wiki/International_Standard_Music_Number</a></p></li><li class="listitem"><p><a class="ulink" href="https://www.ismn-international.org/ranges.html" target="_top">https://www.ismn-international.org/ranges.html</a></p></li></ul></div><p> Алгоритмы реализованы со всей тщательностью и скрупулёзно сверены с алгоритмами, предлагаемыми в официальных руководствах ISBN, ISMN, ISSN.</p></div><div class="sect2" id="ISN-AUTHOR"><div class="titlepage"><div><div><h3 class="title">F.21.6. Автор <a href="#ISN-AUTHOR" class="id_link">#</a></h3></div></div></div><p>Герман Мендез Браво (Kronuz), 2004–2006</p><p>Этот модуль написан под влиянием кода <code class="filename">isbn_issn</code> Гаретта А. Уоллмена.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="intarray.html" title="F.20. intarray — работа с массивами целых чисел">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="lo.html" title="F.22. lo — управление большими объектами">След.</a></td></tr><tr><td width="40%" align="left" valign="top">F.20. intarray — работа с массивами целых чисел </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> F.22. lo — управление большими объектами</td></tr></table></div></body></html>