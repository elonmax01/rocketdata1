<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>17.7. Замечания по отдельным платформам</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="supported-platforms.html" title="17.6. Поддерживаемые платформы" /><link rel="next" href="install-windows.html" title="Глава 18. Установка из исходного кода в Windows" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">17.7. Замечания по отдельным платформам</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="supported-platforms.html" title="17.6. Поддерживаемые платформы">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="installation.html" title="Глава 17. Установка из исходного кода">Наверх</a></td><th width="60%" align="center">Глава 17. Установка из исходного кода</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="install-windows.html" title="Глава 18. Установка из исходного кода в Windows">След.</a></td></tr></table><hr /></div><div class="sect1" id="INSTALLATION-PLATFORM-NOTES"><div class="titlepage"><div><div><h2 class="title" style="clear: both">17.7. Замечания по отдельным платформам <a href="#INSTALLATION-PLATFORM-NOTES" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="installation-platform-notes.html#INSTALLATION-NOTES-AIX">17.7.1. AIX</a></span></dt><dt><span class="sect2"><a href="installation-platform-notes.html#INSTALLATION-NOTES-CYGWIN">17.7.2. Cygwin</a></span></dt><dt><span class="sect2"><a href="installation-platform-notes.html#INSTALLATION-NOTES-MACOS">17.7.3. macOS</a></span></dt><dt><span class="sect2"><a href="installation-platform-notes.html#INSTALLATION-NOTES-MINGW">17.7.4. MinGW/Собственная сборка Windows</a></span></dt><dt><span class="sect2"><a href="installation-platform-notes.html#INSTALLATION-NOTES-SOLARIS">17.7.5. Solaris</a></span></dt></dl></div><p>В этом разделе приведены дополнительные замечания по отдельным платформам, связанные с установкой и подготовкой к работе PostgreSQL. Обязательно изучите ещё инструкции по установке, в частности <a class="xref" href="install-requirements.html" title="17.1. Требования">Раздел 17.1</a>. Также обратитесь к <a class="xref" href="regress.html" title="Глава 33. Регрессионные тесты">Главе 33</a>, где рассказывается, как прочитать результаты регрессионных тестов.</p><p>Если какие-то платформы здесь не упоминаются, значит каких-либо известных особенностей установки в них нет.</p><div class="sect2" id="INSTALLATION-NOTES-AIX"><div class="titlepage"><div><div><h3 class="title">17.7.1. AIX <a href="#INSTALLATION-NOTES-AIX" class="id_link">#</a></h3></div></div></div><a id="id-1.6.4.11.4.2" class="indexterm"></a><p>Для сборки <span class="productname">PostgreSQL</span> на платформе <span class="productname">AIX</span> можно использовать GCC или собственный компилятор IBM — <code class="command">xlc</code>.</p><p>Версии <span class="productname">AIX</span> ниже 7.1 больше не тестируются и не поддерживаются сообществом <span class="productname">PostgreSQL</span>.</p><div class="sect3" id="INSTALLATION-NOTES-AIX-MEM-MANAGEMENT"><div class="titlepage"><div><div><h4 class="title">17.7.1.1. Управление памятью <a href="#INSTALLATION-NOTES-AIX-MEM-MANAGEMENT" class="id_link">#</a></h4></div></div></div><p>Иногда управление памятью в AIX может работать несколько странно. В системе может быть свободно несколько гигабайт ОЗУ, но при запуске приложений всё равно возможны ошибки, связанные с адресным пространством или нехваткой памяти. В частности, необычные ошибки могут возникать при загрузке расширений. Например, при выполнении от имени владельца инсталляции PostgreSQL: </p><pre class="screen">
=# CREATE EXTENSION plperl;
ERROR:  could not load library "/opt/dbs/pgsql/lib/plperl.so": A memory address is not in the address space for the process.
</pre><p> (ОШИБКА: не удалось загрузить библиотеку "/opt/dbs/pgsql/lib/plperl.so": Адрес памяти находится не в адресном пространстве процесса.) При выполнении от имени не владельца, а члена группы-владельца инсталляции PostgreSQL: </p><pre class="screen">
=# CREATE EXTENSION plperl;
ERROR:  could not load library "/opt/dbs/pgsql/lib/plperl.so": Bad address
</pre><p> (ОШИБКА: не удалось загрузить библиотеку "/opt/dbs/pgsql/lib/plperl.so": Неверный адрес) Также сообщения о нехватке могут появляться в журнале PostgreSQL при попытке выделить блок памяти размером около 256 МиБ или больше.</p><p>Общая причина всех этих проблем связана с битностью и моделью памяти серверного процесса. По умолчанию все исполняемые файлы для AIX собираются как 32-битные, вне зависимости от того, какой тип оборудования или ядра используется. Такие 32-битные процессы ограничиваются общим пространством в 4 ГиБ, разделённым на сегменты по 256 МиБ, по одной из нескольких моделей. По умолчанию в куче можно выделить меньше 256 МиБ, так как она разделяет один сегмент со стеком.</p><p>В ситуации с показанным выше примером <code class="command">plperl</code> проверьте umask и разрешения, назначенные для двоичных файлов в вашей инсталляции PostgreSQL. Задействованные в данном примере двоичные файлы были 32-битными и установились с режимом 750 вместо 755. Из-за таких разрешений только владелец или член группы-владельца могли загрузить требуемую библиотеку. Так как она недоступна для чтения всем, загрузчик помещал этот объект в область кучи процесса, а не в сегменты разделяемых библиотек, где он должен находиться.</p><p>В <span class="quote">«<span class="quote">идеале</span>»</span> эту проблему можно решить, если использовать 64-битную сборку PostgreSQL, но это не всегда практично, так как с 32-битным процессором нельзя будет запустить 64-битный код (можно только собрать).</p><p>При желании использовать 32-битную версию сервера установите в <code class="symbol">LDR_CNTRL</code> значение <code class="literal">MAXDATA=0x<em class="replaceable"><code>n</code></em>0000000</code>, где 1 &lt;= n &lt;= 8, до запуска PostgreSQL, и попробуйте подобрать подходящее значение и параметры <code class="filename">postgresql.conf</code>. Переменная окружения <code class="symbol">LDR_CNTRL</code> говорит AIX, что вы хотите, чтобы сервер получил <code class="symbol">MAXDATA</code> байт для области кучи, в сегментах по 256 МиБ. Подобрав рабочее значение, можно воспользоваться <code class="command">ldedit</code> и модифицировать двоичные файлы, чтобы они использовали такой размер кучи по умолчанию. Тот же эффект можно получить, пересобрав PostgreSQL с указанием <code class="literal">configure LDFLAGS="-Wl,-bmaxdata:0x<em class="replaceable"><code>n</code></em>0000000"</code>.</p><p>Для 64-битной сборки определите переменную <code class="envar">OBJECT_MODE</code> со значением 64 и передайте <code class="command">configure</code> указания <code class="literal">CC="gcc -maix64"</code> и <code class="literal">LDFLAGS="-Wl,-bbigtoc"</code>. (Для <code class="command">xlc</code> параметры могут быть другими.) Если нужное значение <code class="envar">OBJECT_MODE</code> не будет экспортировано, при сборке могут произойти ошибки на стадии компоновки. Когда переменная <code class="envar">OBJECT_MODE</code> установлена, она говорит сборочным утилитам AIX, таким как <code class="command">ar</code>, <code class="command">as</code> и <code class="command">ld</code>, какие типы объектов обрабатывать по умолчанию.</p><p>По умолчанию система может чрезмерно выделять память в пространстве подкачки. Хотя нам не приходилось с этим сталкиваться, AIX уничтожает процессы при попытке обращения к чрезмерно выделенной памяти, когда её фактически не хватает. Наиболее близкое, что мы наблюдали, была ошибка порождения процесса из-за того, что система решала, что для него не хватает памяти. Как и многие другие компоненты AIX, механизмы распределения пространства подкачки и уничтожения процессов при нехватке памяти можно настроить на уровне системы или процесса, если возникают подобные проблемы.</p></div></div><div class="sect2" id="INSTALLATION-NOTES-CYGWIN"><div class="titlepage"><div><div><h3 class="title">17.7.2. Cygwin <a href="#INSTALLATION-NOTES-CYGWIN" class="id_link">#</a></h3></div></div></div><a id="id-1.6.4.11.5.2" class="indexterm"></a><p>PostgreSQL можно собрать с применением Cygwin, Linux-подобной среды для Windows, но сейчас этому методу предпочитается обычная сборка в Windows <span class="phrase">(см. <a class="xref" href="install-windows.html" title="Глава 18. Установка из исходного кода в Windows">Главу 18</a>)</span>, и запускать сервер в среде Cygwin более не рекомендуется.</p><p>Выполняя сборку, следуйте процедуре установки в стиле Unix (т. е., <code class="literal">./configure; make</code>; и т. д.) с учётом следующих особенностей Cygwin: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Настройте путь поиска так, чтобы каталог bin в Cygwin стоял перед каталогами утилит Windows. Это поможет избавиться от проблем при компиляции.</p></li><li class="listitem"><p>Команда <code class="command">adduser</code> не поддерживается; воспользуйтесь соответствующим средством управления пользователями для Windows. Либо просто пропустите этот шаг.</p></li><li class="listitem"><p>Команда <code class="command">su</code> не поддерживается; для эмуляции su в Windows воспользуйтесь ssh. Либо пропустите этот шаг.</p></li><li class="listitem"><p><span class="productname">OpenSSL</span> не поддерживается.</p></li><li class="listitem"><p>Запустите <code class="command">cygserver</code> для поддержки разделяемой памяти. Для этого введите команду <code class="literal">/usr/sbin/cygserver &amp;</code>. Эта программа должна работать всегда при запуске сервера PostgreSQL или инициализации кластера баз данных (<code class="command">initdb</code>). Возможно, вам придётся настроить конфигурацию <code class="command">cygserver</code> (например, увеличить <code class="symbol">SEMMNS</code>), чтобы PostgreSQL мог получить требуемые системные ресурсы.</p></li><li class="listitem"><p>Сборка может завершиться ошибкой в некоторых системах, где используется локаль, отличная от C. Чтобы исправить это, выберите локаль C, выполнив <code class="command">export LANG=C.utf8</code> до сборки, а затем восстановите предыдущее значение после установки PostgreSQL.</p></li><li class="listitem"><p>Параллельные регрессионные тесты (<code class="literal">make check</code>) могут выдавать ложные ошибки тестирования при переполнении очереди <code class="function">listen()</code>, из-за чего подключения могут не устанавливаться или зависать. Вы можете ограничить число подключений, определив переменную make <code class="varname">MAX_CONNECTIONS</code> так: </p><pre class="programlisting">make MAX_CONNECTIONS=5 check</pre><p> (В некоторых системах поддерживается до 10 одновременных подключений).</p></li></ul></div><p>Сервер PostgreSQL и <code class="command">cygserver</code> можно запустить в виде служб Windows NT. Как это сделать, рассказывается в описании <code class="filename">README</code>, включённом в двоичный пакет PostgreSQL для Cygwin. Оно устанавливается в каталог <code class="filename">/usr/share/doc/Cygwin</code>.</p></div><div class="sect2" id="INSTALLATION-NOTES-MACOS"><div class="titlepage"><div><div><h3 class="title">17.7.3. macOS <a href="#INSTALLATION-NOTES-MACOS" class="id_link">#</a></h3></div></div></div><a id="id-1.6.4.11.6.2" class="indexterm"></a><p>Чтобы собрать <span class="productname">PostgreSQL</span> из исходного кода в <span class="productname">macOS</span>, необходимо установить предоставляемые Apple инструменты командной строки для разработки, что можно сделать, выполнив: </p><pre class="programlisting">xcode-select --install</pre><p> (заметьте, что при этом в графическом интерфейсе появится окно подтверждения). Также вы можете установить Xcode, хотя это не требуется.</p><p>В последних версиях <span class="productname">macOS</span> необходимо включать путь <span class="quote">«<span class="quote">sysroot</span>»</span> во флаги include, позволяющие найти некоторые системные заголовочные файлы. Как результат, вывод скрипта <span class="application">configure</span> может меняться в зависимости от того, какая версия SDK использовалась в процессе <span class="application">configure</span>. Это не должно создавать никаких проблем в простых сценариях, но если вы попытаетесь, например, собрать расширение не на той машине, где был собран серверный код, то может потребоваться явно указать другой путь sysroot. В этом случае установите <code class="varname">PG_SYSROOT</code>, например, так: </p><pre class="programlisting">make PG_SYSROOT=<em class="replaceable"><code>/требуемый/путь</code></em> all</pre><p> Чтобы узнать правильный путь на вашей машине, выполните: </p><pre class="programlisting">xcrun --show-sdk-path</pre><p> Заметьте, что собирать расширения с версией sysroot, отличной от той, с которой собиралось ядро сервера, не рекомендуется; в худшем случае это приведёт к труднодиагностируемым несогласованностям ABI.</p><p>Также при конфигурировании вы можете задать sysroot, отличный от подразумеваемого по умолчанию, передав <code class="varname">PG_SYSROOT</code> скрипту <span class="application">configure</span>: </p><pre class="programlisting">./configure ... PG_SYSROOT=<em class="replaceable"><code>/требуемый/путь</code></em></pre><p> Это может быть полезно прежде всего при кросс-компиляции для какой-либо другой версии macOS. При этом не гарантируется, что полученные исполняемые файлы будут запускаться в текущей системе.</p><p>Чтобы полностью подавить параметры <code class="option">-isysroot</code>, выполните: </p><pre class="programlisting">./configure ... PG_SYSROOT=none</pre><p> (указать можно любой несуществующий путь). Это может быть полезно, если вы хотите воспользоваться сторонним компилятором, не Apple, но учтите, что такая сборка не тестируется и не поддерживается разработчиками PostgreSQL.</p><p>Функциональность <span class="quote">«<span class="quote">Защита целостности системы</span>»</span> (System Integrity Protection, SIP) в <span class="productname">macOS</span> нарушает работу <code class="literal">make check</code>, так как она не позволяет передавать нужное значение <code class="literal">DYLD_LIBRARY_PATH</code> тестируемым исполняемым файлам. Обойти эту проблему можно, выполнив <code class="literal">make install</code> перед <code class="literal">make check</code>. Однако большинство разработчиков PostgreSQL просто отключают SIP.</p></div><div class="sect2" id="INSTALLATION-NOTES-MINGW"><div class="titlepage"><div><div><h3 class="title">17.7.4. MinGW/Собственная сборка Windows <a href="#INSTALLATION-NOTES-MINGW" class="id_link">#</a></h3></div></div></div><a id="id-1.6.4.11.7.2" class="indexterm"></a><p>PostgreSQL для Windows можно собрать с использованием MinGW, Unix-подобной среды сборки для операционных систем Microsoft, либо используя набор средств разработки Microsoft <span class="productname">Visual C++</span>. При использовании MinGW применяется обычная система сборки, описанная в этой главе; сборка Visual C++ выполняется по-другому, как описано в <a class="xref" href="install-windows.html" title="Глава 18. Установка из исходного кода в Windows">Главе 18</a>.</p><p>PostgreSQL, портированный в Windows, будет работать в 32- или 64-битной версии Windows 2000 или новее. В предыдущих операционных системах нет достаточной инфраструктуры (но там можно использовать Cygwin). MinGW, Unix-подобные средства сборки, и MSYS, набор утилит Unix, требуемых для исполнения скриптов типа <code class="command">configure</code>, можно загрузить с сайта <a class="ulink" href="http://www.mingw.org/" target="_top">http://www.mingw.org/</a>. Эти дополнительные программы нужны только для сборки, для запуска полученных исполняемых файлов они не требуются.</p><p>Чтобы собрать 64-битную версию с использованием MinGW, установите набор 64-битных утилит с <a class="ulink" href="https://mingw-w64.org/" target="_top">https://mingw-w64.org/</a>, добавьте путь к его каталогу bin в <code class="envar">PATH</code> и запустите <code class="command">configure</code> с параметром <code class="command">--host=x86_64-w64-mingw32</code>.</p><p>Когда вы всё установите, запускать <span class="application">psql</span> предлагается из <code class="command">CMD.EXE</code>, так как в консоли MSYS есть проблемы с буферизацией.</p><div class="sect3" id="WINDOWS-CRASH-DUMPS"><div class="titlepage"><div><div><h4 class="title">17.7.4.1. Сбор аварийных дампов в Windows <a href="#WINDOWS-CRASH-DUMPS" class="id_link">#</a></h4></div></div></div><p>В случае аварии PostgreSQL в Windows он может сгенерировать минидамп памяти, который помогает выяснить причину аварии, подобно дампам памяти в Unix. Проанализировать эти дампы можно, используя <span class="productname">Windows Debugger Tools</span> (Средства отладки Windows) или <span class="productname">Visual Studio</span>. Чтобы в Windows получить дамп в случае аварии, создайте подкаталог <code class="filename">crashdumps</code> в каталоге данных кластера. Дампы будут записываться в этот каталог с уникальным именем, составленным из идентификатора процесса, давшего сбой, и времени сбоя.</p></div></div><div class="sect2" id="INSTALLATION-NOTES-SOLARIS"><div class="titlepage"><div><div><h3 class="title">17.7.5. Solaris <a href="#INSTALLATION-NOTES-SOLARIS" class="id_link">#</a></h3></div></div></div><a id="id-1.6.4.11.8.2" class="indexterm"></a><p>PostgreSQL хорошо поддерживается в Solaris. Чем новее операционная система, тем меньше затруднений будет.</p><div class="sect3" id="INSTALLATION-NOTES-SOLARIS-REQ-TOOLS"><div class="titlepage"><div><div><h4 class="title">17.7.5.1. Требуемые инструменты <a href="#INSTALLATION-NOTES-SOLARIS-REQ-TOOLS" class="id_link">#</a></h4></div></div></div><p>Вы можете выполнить сборку с GCC или с набором компиляторов Sun. Для лучшей оптимизации кода на архитектуре SPARC настоятельно рекомендуется использовать компилятор Sun. Если вы решили применить компилятор Sun, не выберите по ошибке <code class="filename">/usr/ucb/cc</code>; правильный путь — <code class="filename">/opt/SUNWspro/bin/cc</code>.</p><p>Sun Studio вы можете загрузить с сайта <a class="ulink" href="https://www.oracle.com/technetwork/server-storage/solarisstudio/downloads/" target="_top">https://www.oracle.com/technetwork/server-storage/solarisstudio/downloads/</a>. Средства GNU по большей части интегрированы в Solaris 10, либо представлены на сопутствующем CD. Если вам нужны пакеты для старых версий Solaris, вы можете найти их на сайте <a class="ulink" href="http://www.sunfreeware.com" target="_top">http://www.sunfreeware.com</a>. Если вы предпочитаете исходный код, обратитесь к <a class="ulink" href="https://www.gnu.org/prep/ftp" target="_top">https://www.gnu.org/prep/ftp</a>.</p></div><div class="sect3" id="INSTALLATION-NOTES-SOLARIS-CONFIGURE-COMPLAINS"><div class="titlepage"><div><div><h4 class="title">17.7.5.2. Процедура configure сообщает о сбое тестовой программы <a href="#INSTALLATION-NOTES-SOLARIS-CONFIGURE-COMPLAINS" class="id_link">#</a></h4></div></div></div><p>Если <code class="command">configure</code> сообщает о сбое тестовой программы, это может быть вызвано тем, что при связывании во время выполнения не удаётся найти некоторую библиотеку, вероятно, libz, libreadline или какую-то другую нестандартную, например, libssl. Чтобы указать правильное размещение библиотеки, задайте переменную окружения <code class="envar">LDFLAGS</code> в командной строке <code class="command">configure</code>, например так: </p><pre class="programlisting">configure ... LDFLAGS="-R /usr/sfw/lib:/opt/sfw/lib:/usr/local/lib"</pre><p> За дополнительными сведениями обратитесь к странице man <span class="citerefentry"><span class="refentrytitle">ld</span></span>.</p></div><div class="sect3" id="INSTALLATION-NOTES-SOLARIS-COMP-OPT-PERF"><div class="titlepage"><div><div><h4 class="title">17.7.5.3. Компиляция для максимальной производительности <a href="#INSTALLATION-NOTES-SOLARIS-COMP-OPT-PERF" class="id_link">#</a></h4></div></div></div><p>Для архитектуры SPARC настоятельно рекомендуется проводить компиляцию с использованием Sun Studio. Добавив флаг <code class="option">-xO5</code>, вы можете получить исполняемый код, который будет работать значительно быстрее. Но не добавляйте никакие флаги, влияющие на вычисления с плавающей точкой или обработку <code class="varname">errno</code> (например, <code class="option">-fast</code>).</p><p>Если у вас нет причины использовать 64-битные программы в архитектуре SPARC, собирайте 32-битную версию, так как 64-битные операции, а значит и 64-битные программы, выполняются медленнее 32-битных. С другой стороны, 32-битный код для процессоров семейства AMD64 не является «родным», поэтому на таких процессорах значительно медленнее работает 32-битный код.</p></div><div class="sect3" id="INSTALLATION-NOTES-SOLARIS-USING-DTRACE"><div class="titlepage"><div><div><h4 class="title">17.7.5.4. Применение DTrace для трассировки PostgreSQL <a href="#INSTALLATION-NOTES-SOLARIS-USING-DTRACE" class="id_link">#</a></h4></div></div></div><p>Да, вы можете использовать DTrace. За дополнительными сведениями обратитесь к <a class="xref" href="dynamic-trace.html" title="28.5. Динамическая трассировка">Разделу 28.5</a>.</p><p>Если компоновка исполняемого файла <code class="command">postgres</code> прерывается с таким сообщением об ошибке: </p><pre class="screen">
Undefined                       first referenced
 symbol                             in file
AbortTransaction                    utils/probes.o
CommitTransaction                   utils/probes.o
ld: fatal: Symbol referencing errors. No output written to postgres
collect2: ld returned 1 exit status
make: *** [postgres] Error 1
</pre><p> Это означает, что ваша инсталляция DTrace слишком стара и неспособна работать с пробами в статических функциях. Для использования DTrace нужна версия Solaris 10u4 или новее.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="supported-platforms.html" title="17.6. Поддерживаемые платформы">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="installation.html" title="Глава 17. Установка из исходного кода">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="install-windows.html" title="Глава 18. Установка из исходного кода в Windows">След.</a></td></tr><tr><td width="40%" align="left" valign="top">17.6. Поддерживаемые платформы </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> Глава 18. Установка из исходного кода в <span class="productname">Windows</span></td></tr></table></div></body></html>