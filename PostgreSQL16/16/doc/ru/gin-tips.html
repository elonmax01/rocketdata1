<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>70.5. Приёмы и советы по применению GIN</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="gin-implementation.html" title="70.4. Реализация" /><link rel="next" href="gin-limit.html" title="70.6. Ограничения" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">70.5. Приёмы и советы по применению GIN</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="gin-implementation.html" title="70.4. Реализация">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="gin.html" title="Глава 70. Индексы GIN">Наверх</a></td><th width="60%" align="center">Глава 70. Индексы GIN</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="gin-limit.html" title="70.6. Ограничения">След.</a></td></tr></table><hr /></div><div class="sect1" id="GIN-TIPS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">70.5. Приёмы и советы по применению GIN <a href="#GIN-TIPS" class="id_link">#</a></h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Создание или добавление</span></dt><dd><p>Добавление объектов в индекс <acronym class="acronym">GIN</acronym> может выполняться медленно, так как для каждого объекта скорее всего потребуется добавлять множество ключей. Поэтому при массовом добавлении данных в таблицу рекомендуется удалить индекс GIN и пересоздать его по окончании добавления.</p><p>Когда для <acronym class="acronym">GIN</acronym> включён режим <code class="literal">fastupdate</code> (за подробностями обратитесь к <a class="xref" href="gin-implementation.html#GIN-FAST-UPDATE" title="70.4.1. Методика быстрого обновления GIN">Подразделу 70.4.1</a>), издержки меньше, чем когда он отключён. Но при очень большом объёме изменений всё же лучше удалить и заново создать индекс.</p></dd><dt><span class="term"><a class="xref" href="runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM">maintenance_work_mem</a></span></dt><dd><p>Время построения индекса <acronym class="acronym">GIN</acronym> очень сильно зависит от параметра <code class="varname">maintenance_work_mem</code>; не стоит экономить на рабочей памяти при создании индекса.</p></dd><dt><span class="term"><a class="xref" href="runtime-config-client.html#GUC-GIN-PENDING-LIST-LIMIT">gin_pending_list_limit</a></span></dt><dd><p>В процессе последовательных добавлений в существующий индекс <acronym class="acronym">GIN</acronym> с включённым режимом <code class="literal">fastupdate</code>, система будет очищать список ожидающих индексации записей, когда его размер будет превышать <code class="varname">gin_pending_list_limit</code>. Во избежание значительных колебаний конечного времени ответа имеет смысл проводить очистку этого списка в фоновом режиме (то есть, применяя автоочистку). Избежать операций очистки на переднем плане можно, увеличив <code class="varname">gin_pending_list_limit</code> или проводя автоочистку более активно. Однако если вследствие увеличения порога операции очистки запустится очистка на переднем плане, она будет выполняться ещё дольше.</p><p>Значение <code class="varname">gin_pending_list_limit</code> можно переопределить для отдельных индексов GIN, изменив их параметры хранения, что позволяет задавать для каждого индекса GIN свой порог очистки. Например, можно увеличить порог только для часто обновляемых индексов GIN и оставить его низким для остальных.</p></dd><dt><span class="term"><a class="xref" href="runtime-config-client.html#GUC-GIN-FUZZY-SEARCH-LIMIT">gin_fuzzy_search_limit</a></span></dt><dd><p>Основной целью разработки индексов <acronym class="acronym">GIN</acronym> было обеспечить поддержку хорошо расширяемого полнотекстового поиска в <span class="productname">PostgreSQL</span>, а при полнотекстовом поиске нередко возникают ситуации, когда возвращается очень большой набор результатов. Однако чаще всего так происходит, когда запрос содержит очень часто встречающиеся слова, так что полученный результат всё равно оказывается бесполезным. Так как чтение множества записей с диска и последующая сортировка их может занять много времени, это неприемлемо в производственных условиях. (Заметьте, что поиск по индексу при этом выполняется очень быстро.)</p><p>Для управляемого выполнения таких запросов в <acronym class="acronym">GIN</acronym> введено настраиваемое мягкое ограничение сверху для числа возвращаемых строк: конфигурационный параметр <code class="varname">gin_fuzzy_search_limit</code>. По умолчанию он равен 0 (то есть ограничение отсутствует). Если он имеет ненулевое значение, возвращаемый набор строк будет случайно выбранным подмножеством всего набора результатов.</p><p><span class="quote">«<span class="quote">Мягким</span>»</span> оно называется потому, что фактическое число возвращаемых строк может несколько отличаться от заданного значения, в зависимости от запроса и качества системного генератора случайных чисел.</p><p>Из практики, со значениями в несколько тысяч (например, 5000 — 20000) получаются приемлемые результаты.</p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="gin-implementation.html" title="70.4. Реализация">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="gin.html" title="Глава 70. Индексы GIN">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="gin-limit.html" title="70.6. Ограничения">След.</a></td></tr><tr><td width="40%" align="left" valign="top">70.4. Реализация </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 70.6. Ограничения</td></tr></table></div></body></html>