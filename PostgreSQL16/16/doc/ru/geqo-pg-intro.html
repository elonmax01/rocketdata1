<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>62.3. Генетическая оптимизация запросов (GEQO) в PostgreSQL</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="geqo-intro2.html" title="62.2. Генетические алгоритмы" /><link rel="next" href="geqo-biblio.html" title="62.4. Дополнительные источники информации" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">62.3. Генетическая оптимизация запросов (<acronym class="acronym">GEQO</acronym>) в PostgreSQL</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="geqo-intro2.html" title="62.2. Генетические алгоритмы">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="geqo.html" title="Глава 62. Генетический оптимизатор запросов">Наверх</a></td><th width="60%" align="center">Глава 62. Генетический оптимизатор запросов</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="geqo-biblio.html" title="62.4. Дополнительные источники информации">След.</a></td></tr></table><hr /></div><div class="sect1" id="GEQO-PG-INTRO"><div class="titlepage"><div><div><h2 class="title" style="clear: both">62.3. Генетическая оптимизация запросов (<acronym class="acronym">GEQO</acronym>) в PostgreSQL <a href="#GEQO-PG-INTRO" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="geqo-pg-intro.html#GEQO-PG-INTRO-GEN-POSSIBLE-PLANS">62.3.1. Построение возможных планов с <acronym class="acronym">GEQO</acronym></a></span></dt><dt><span class="sect2"><a href="geqo-pg-intro.html#GEQO-FUTURE">62.3.2. Будущее развитие модуля <span class="productname">PostgreSQL</span> <acronym class="acronym">GEQO</acronym></a></span></dt></dl></div><p>Модуль <acronym class="acronym">GEQO</acronym> (Genetic Query Optimization, Генетическая оптимизация запросов) подходит к проблеме оптимизации запроса как к хорошо известной задаче коммивояжёра (<acronym class="acronym">TSP</acronym>, Traveling Salesman Problem). Возможные планы запроса кодируются числами в строковом виде. Каждая строка представляет порядок соединения одного отношения из запроса со следующим. Например, дерево соединения </p><pre class="literallayout">
   /\
  /\ 2
 /\ 3
4  1
</pre><p>  кодируется строкой целых чисел '4-1-3-2', которая означает: сначала соединить отношения '4' и '1', потом добавить '3', а затем '2', где 1, 2, 3, 4 — идентификаторы отношений внутри оптимизатора <span class="productname">PostgreSQL</span>.</p><p>Реализация <acronym class="acronym">GEQO</acronym> в <span class="productname">PostgreSQL</span> имеет следующие особые характеристики: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>Использование ГА с <em class="firstterm">зафиксированным состоянием</em> (когда заменяются наименее приспособленные особи популяции, а не всё поколение) способствует быстрой сходимости к улучшенным планам запроса. Это важно для обработки запроса за приемлемое время;</p></li><li class="listitem" style="list-style-type: disc"><p>Использование <em class="firstterm">скрещивания с обменом рёбер</em>, которое очень удачно минимизирует число потерянных рёбер при решении задачи коммивояжёра с применением <acronym class="acronym">ГА</acronym>;</p></li><li class="listitem" style="list-style-type: disc"><p>Мутация как генетический оператор считается устаревшей, так что для получения допустимых путей <acronym class="acronym">TSP</acronym> не требуются механизмы исправления.</p></li></ul></div><p>Части модуля <acronym class="acronym">GEQO</acronym> взяты из алгоритма Genitor, разработанного Д. Уитли.</p><p>В результате, модуль <acronym class="acronym">GEQO</acronym> позволяет оптимизатору запросов <span class="productname">PostgreSQL</span> эффективно выполнять запросы со множеством соединений, обходясь без полного перебора вариантов.</p><div class="sect2" id="GEQO-PG-INTRO-GEN-POSSIBLE-PLANS"><div class="titlepage"><div><div><h3 class="title">62.3.1. Построение возможных планов с <acronym class="acronym">GEQO</acronym> <a href="#GEQO-PG-INTRO-GEN-POSSIBLE-PLANS" class="id_link">#</a></h3></div></div></div><p>В процедуре планирования в <acronym class="acronym">GEQO</acronym> используется код стандартного планировщика, который строит планы сканирования отдельных отношений. Затем вырабатываются планы соединений с применением генетического подхода. Как было сказано выше, каждый план соединения представляется последовательностью чисел, определяющей порядок соединений базовых отношений. На начальной стадии код <acronym class="acronym">GEQO</acronym> просто случайным образом генерирует несколько возможных последовательностей. Затем для каждой рассматриваемой последовательности вызывается функция стандартного планировщика, оценивающая стоимость запроса в случае выбора этого порядка соединений. (Для каждого шага последовательности рассматриваются все три возможные стратегии соединения и все изначально выбранные планы сканирования отношений. Результирующей оценкой стоимости будет минимальная из всех возможных.) Последовательности соединений с наименьшей оценкой стоимости считаются <span class="quote">«<span class="quote">более приспособленными</span>»</span>, чем последовательности с большей оценкой. Проанализировав возможные последовательности, генетический алгоритм отбрасывает наименее приспособленные из них. Затем генерируются новые кандидаты путём объединения генов более приспособленных последовательностей — для этого выбираются случайные фрагменты известных последовательностей с низкой стоимостью, из которых складываются новые последовательности для рассмотрения. Этот процесс повторяется, пока не будет рассмотрено некоторое предопределённое количество последовательностей соединений; после этого для построения окончательного плана выбирается лучшая последовательность, найденная за всё время поиска.</p><p>Этот процесс по природе своей недетерминирован, вследствие случайного выбора при формировании начальной популяции и последующей <span class="quote">«<span class="quote">мутации</span>»</span> лучших кандидатов. Но во избежание неожиданных изменений выбранного плана, на каждом проходе алгоритм GEQO перезапускает свой генератор случайных чисел с текущим значением параметра <a class="xref" href="runtime-config-query.html#GUC-GEQO-SEED">geqo_seed</a>. Поэтому пока значение <code class="varname">geqo_seed</code> и другие параметры GEQO остаются неизменными, для определённого запроса (и других входных данных планировщика, в частности, статистики) будет строиться один и тот же план. Если вы хотите поэкспериментировать с разными путями соединений, попробуйте изменить <code class="varname">geqo_seed</code>.</p></div><div class="sect2" id="GEQO-FUTURE"><div class="titlepage"><div><div><h3 class="title">62.3.2. Будущее развитие модуля <span class="productname">PostgreSQL</span> <acronym class="acronym">GEQO</acronym> <a href="#GEQO-FUTURE" class="id_link">#</a></h3></div></div></div><p>Требуется провести дополнительную работу для выбора оптимальных параметров генетического алгоритма. В файле <code class="filename">src/backend/optimizer/geqo/geqo_main.c</code>, подпрограммах <code class="function">gimme_pool_size</code> и <code class="function">gimme_number_generations</code>, мы должны найти компромиссные значения параметров, удовлетворяющие двум несовместимым требованиям: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>Оптимальность плана запроса</p></li><li class="listitem"><p>Время вычисления</p></li></ul></div><p>В текущей реализации приспособленность каждой рассматриваемой последовательности соединений рассчитывается стандартным планировщиком, который каждый раз вычисляет избирательность соединения и стоимость заново. С учётом того, что различные кандидаты могут содержать общие подпоследовательности соединений, при этом будет повторяться большой объём работы. Таким образом, расчёт можно значительно ускорить, сохраняя оценки стоимости для внутренних соединений, но сложность состоит в том, чтобы уместить это состояние в разумные объёмы памяти.</p><p>На более общем уровне не вполне понятно, насколько уместно для оптимизации запросов использовать ГА, предназначенный для решения задачи коммивояжёра. В этой задаче стоимость, связанная с любой подстрокой (частью тура) не зависит от остального маршрута, но это определённо не так для оптимизации запросов. Таким образом, возникает вопрос, насколько эффективно скрещивание путём обмена рёбрами.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="geqo-intro2.html" title="62.2. Генетические алгоритмы">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="geqo.html" title="Глава 62. Генетический оптимизатор запросов">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="geqo-biblio.html" title="62.4. Дополнительные источники информации">След.</a></td></tr><tr><td width="40%" align="left" valign="top">62.2. Генетические алгоритмы </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 62.4. Дополнительные источники информации</td></tr></table></div></body></html>