<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>7.3. Списки выборки</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="queries-table-expressions.html" title="7.2. Табличные выражения" /><link rel="next" href="queries-union.html" title="7.4. Сочетание запросов (UNION, INTERSECT, EXCEPT)" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">7.3. Списки выборки</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="queries-table-expressions.html" title="7.2. Табличные выражения">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="queries.html" title="Глава 7. Запросы">Наверх</a></td><th width="60%" align="center">Глава 7. Запросы</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="queries-union.html" title="7.4. Сочетание запросов (UNION, INTERSECT, EXCEPT)">След.</a></td></tr></table><hr /></div><div class="sect1" id="QUERIES-SELECT-LISTS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.3. Списки выборки <a href="#QUERIES-SELECT-LISTS" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="queries-select-lists.html#QUERIES-SELECT-LIST-ITEMS">7.3.1. Элементы списка выборки</a></span></dt><dt><span class="sect2"><a href="queries-select-lists.html#QUERIES-COLUMN-LABELS">7.3.2. Метки столбцов</a></span></dt><dt><span class="sect2"><a href="queries-select-lists.html#QUERIES-DISTINCT">7.3.3. <code class="literal">DISTINCT</code></a></span></dt></dl></div><a id="id-1.5.6.7.2" class="indexterm"></a><p>Как говорилось в предыдущем разделе, табличное выражение в <code class="command">SELECT</code> создаёт промежуточную виртуальную таблицу, возможно объединяя таблицы, представления, группируя и исключая лишние строки и т. д. Полученная таблица передаётся для обработки в <em class="firstterm">список выборки</em>. Этот список выбирает, какие <span class="emphasis"><em>столбцы</em></span> промежуточной таблицы должны выводиться в результате и как именно.</p><div class="sect2" id="QUERIES-SELECT-LIST-ITEMS"><div class="titlepage"><div><div><h3 class="title">7.3.1. Элементы списка выборки <a href="#QUERIES-SELECT-LIST-ITEMS" class="id_link">#</a></h3></div></div></div><a id="id-1.5.6.7.4.2" class="indexterm"></a><p>Простейший список выборки образует элемент <code class="literal">*</code>, который выбирает все столбцы из полученного табличного выражения. Список выборки также может содержать список выражений значения через запятую (как определено в <a class="xref" href="sql-expressions.html" title="4.2. Выражения значения">Разделе 4.2</a>). Например, это может быть список имён столбцов: </p><pre class="programlisting">SELECT a, b, c FROM ...</pre><p> Имена столбцов <code class="literal">a</code>, <code class="literal">b</code> и <code class="literal">c</code> представляют либо фактические имена столбцов таблиц, перечисленных в предложении <code class="literal">FROM</code>, либо их псевдонимы, определённые как описано в <a class="xref" href="queries-table-expressions.html#QUERIES-TABLE-ALIASES" title="7.2.1.2. Псевдонимы таблиц и столбцов">Подразделе 7.2.1.2</a>. Пространство имён в списке выборки то же, что и в предложении <code class="literal">WHERE</code>, если не используется группировка. В противном случае оно совпадает с пространством имён предложения <code class="literal">HAVING</code>.</p><p>Если столбец с заданным именем есть в нескольких таблицах, необходимо также указать имя таблицы, например так: </p><pre class="programlisting">SELECT tbl1.a, tbl2.a, tbl1.b FROM ...</pre><p> Обращаясь к нескольким таблицам, бывает удобно получить сразу все столбцы одной из таблиц: </p><pre class="programlisting">SELECT tbl1.*, tbl2.a FROM ...</pre><p> Подробнее запись <em class="replaceable"><code>имя_таблицы</code></em><code class="literal">.*</code> описывается в <a class="xref" href="rowtypes.html#ROWTYPES-USAGE" title="8.16.5. Использование составных типов в запросах">Подразделе 8.16.5</a>.</p><p>Если в списке выборки используется обычное выражение значения, по сути при этом в возвращаемую таблицу добавляется новый виртуальный столбец. Выражение значения вычисляется один раз для каждой строки результата со значениями столбцов в данной строке. Хотя выражения в списке выборки не обязательно должны обращаться к столбцам табличного выражения из предложения <code class="literal">FROM</code>; они могут содержать, например и простые арифметические выражения.</p></div><div class="sect2" id="QUERIES-COLUMN-LABELS"><div class="titlepage"><div><div><h3 class="title">7.3.2. Метки столбцов <a href="#QUERIES-COLUMN-LABELS" class="id_link">#</a></h3></div></div></div><a id="id-1.5.6.7.5.2" class="indexterm"></a><p>Элементам в списке выборки можно назначить имена для последующей обработки, например, для указания в предложении <code class="literal">ORDER BY</code> или для вывода в клиентском приложении. Например: </p><pre class="programlisting">SELECT a AS value, b + c AS sum FROM ...</pre><p>Если выходное имя столбца не определено (с помощью <code class="literal">AS</code>), система назначает имя сама. Для простых ссылок на столбцы этим именем становится имя целевого столбца, а для вызовов функций это имя функции. Для сложных выражений система генерирует некоторое подходящее имя.</p><p>Слово <code class="literal">AS</code> обычно можно опустить, но в некоторых случаях, когда желаемое имя столбца совпадает с ключевым словом <span class="productname">PostgreSQL</span>, нужно написать <code class="literal">AS</code> или заключить имя столбца в кавычки во избежание неоднозначности. (В <a class="xref" href="sql-keywords-appendix.html" title="Приложение C. Ключевые слова SQL">Приложении C</a> перечислены ключевые слова, для которых нужно использовать <code class="literal">AS</code> в метке столбца.) Например, <code class="literal">FROM</code> — ключевое слово, поэтому такой вариант не будет работать: </p><pre class="programlisting">SELECT a from, b + c AS sum FROM ...</pre><p> а любой из этих сработает: </p><pre class="programlisting">SELECT a AS from, b + c AS sum FROM ...
SELECT a "from", b + c AS sum FROM ...</pre><p> Для предотвращения конфликта с ключевыми словами, которые могут появиться в будущем, рекомендуется всегда писать <code class="literal">AS</code> или заключать метки выходных столбцов в кавычки.</p><div class="note"><h3 class="title">Примечание</h3><p>Именование выходных столбцов отличается от того, что происходит в предложении <code class="literal">FROM</code> (см. <a class="xref" href="queries-table-expressions.html#QUERIES-TABLE-ALIASES" title="7.2.1.2. Псевдонимы таблиц и столбцов">Подраздел 7.2.1.2</a>). Один столбец можно переименовать дважды, но на выходе окажется имя, назначенное в списке выборки.</p></div></div><div class="sect2" id="QUERIES-DISTINCT"><div class="titlepage"><div><div><h3 class="title">7.3.3. <code class="literal">DISTINCT</code> <a href="#QUERIES-DISTINCT" class="id_link">#</a></h3></div></div></div><a id="id-1.5.6.7.6.2" class="indexterm"></a><a id="id-1.5.6.7.6.3" class="indexterm"></a><a id="id-1.5.6.7.6.4" class="indexterm"></a><p>После обработки списка выборки в результирующей таблице можно дополнительно исключить дублирующиеся строки. Для этого сразу после <code class="literal">SELECT</code> добавляется ключевое слово <code class="literal">DISTINCT</code>: </p><pre class="synopsis">
SELECT DISTINCT <em class="replaceable"><code>список_выборки</code></em> ...
</pre><p> (Чтобы явно включить поведение по умолчанию, когда возвращаются все строки, вместо <code class="literal">DISTINCT</code> можно указать ключевое слово <code class="literal">ALL</code>.)</p><a id="id-1.5.6.7.6.6" class="indexterm"></a><p>Две строки считаются разными, если они содержат различные значения минимум в одном столбце. При этом значения NULL полагаются равными.</p><p>Кроме того, можно явно определить, какие строки будут считаться различными, следующим образом: </p><pre class="synopsis">
SELECT DISTINCT ON (<em class="replaceable"><code>выражение</code></em> [<span class="optional">, <em class="replaceable"><code>выражение</code></em> ...</span>]) <em class="replaceable"><code>список_выборки</code></em> ...
</pre><p> Здесь <em class="replaceable"><code>выражение</code></em> — обычное выражение значения, вычисляемое для всех строк. Строки, для которых перечисленные выражения дают один результат, считаются дублирующимися и возвращается только первая строка из такого набора. Заметьте, что <span class="quote">«<span class="quote">первая строка</span>»</span> набора может быть любой, если только запрос не включает сортировку, гарантирующую однозначный порядок строк, поступающих в фильтр <code class="literal">DISTINCT</code>. (Обработка <code class="literal">DISTINCT ON</code> производится после сортировки <code class="literal">ORDER BY</code>.)</p><p>Предложение <code class="literal">DISTINCT ON</code> не описано в стандарте SQL и иногда его применение считается плохим стилем из-за возможной неопределённости в результатах. При разумном использовании <code class="literal">GROUP BY</code> и подзапросов во <code class="literal">FROM</code> можно обойтись без этой конструкции, но часто она бывает удобнее.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="queries-table-expressions.html" title="7.2. Табличные выражения">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="queries.html" title="Глава 7. Запросы">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="queries-union.html" title="7.4. Сочетание запросов (UNION, INTERSECT, EXCEPT)">След.</a></td></tr><tr><td width="40%" align="left" valign="top">7.2. Табличные выражения </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 7.4. Сочетание запросов (<code class="literal">UNION</code>, <code class="literal">INTERSECT</code>, <code class="literal">EXCEPT</code>)</td></tr></table></div></body></html>