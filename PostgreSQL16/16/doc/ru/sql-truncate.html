<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>TRUNCATE</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-start-transaction.html" title="START TRANSACTION" /><link rel="next" href="sql-unlisten.html" title="UNLISTEN" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">TRUNCATE</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-start-transaction.html" title="START TRANSACTION">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><th width="60%" align="center">Команды SQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-unlisten.html" title="UNLISTEN">След.</a></td></tr></table><hr /></div><div class="refentry" id="SQL-TRUNCATE"><div class="titlepage"></div><a id="id-1.9.3.181.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">TRUNCATE</span></h2><p>TRUNCATE — опустошить таблицу или набор таблиц</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">TRUNCATE [ TABLE ] [ ONLY ] <em class="replaceable"><code>имя</code></em> [ * ] [, ... ]
    [ RESTART IDENTITY | CONTINUE IDENTITY ] [ CASCADE | RESTRICT ]</pre></div><div class="refsect1" id="id-1.9.3.181.5"><h2>Описание</h2><p>Команда <code class="command">TRUNCATE</code> быстро удаляет все строки из набора таблиц. Она действует так же, как безусловная команда <code class="command">DELETE</code> для каждой таблицы, но гораздо быстрее, так как она фактически не сканирует таблицы. Более того, она немедленно высвобождает дисковое пространство, так что выполнять операцию <code class="command">VACUUM</code> после неё не требуется. Наиболее полезна она для больших таблиц.</p></div><div class="refsect1" id="id-1.9.3.181.6"><h2>Параметры</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>имя</code></em></span></dt><dd><p>Имя таблицы (возможно, дополненное схемой), подлежащей опустошению. Если перед именем таблицы указано <code class="literal">ONLY</code>, очищается только заданная таблица. Без <code class="literal">ONLY</code> очищается и заданная таблица, и все её потомки (если таковые есть). После имени таблицы можно также добавить необязательное указание <code class="literal">*</code>, чтобы явно обозначить, что блокировка затрагивает и все дочерние таблицы.</p></dd><dt><span class="term"><code class="literal">RESTART IDENTITY</code></span></dt><dd><p>Автоматически перезапускать последовательности, связанные со столбцами опустошаемой таблицы.</p></dd><dt><span class="term"><code class="literal">CONTINUE IDENTITY</code></span></dt><dd><p>Не изменять значения последовательностей. Это поведение по умолчанию.</p></dd><dt><span class="term"><code class="literal">CASCADE</code></span></dt><dd><p>Автоматически опустошать все таблицы, ссылающиеся по внешнему ключу на заданные таблицы, или на таблицы, затронутые в результате действия <code class="literal">CASCADE</code>.</p></dd><dt><span class="term"><code class="literal">RESTRICT</code></span></dt><dd><p>Отказать в опустошении любых таблиц, на которые по внешнему ключу ссылаются другие таблицы, не перечисленные в этой команде. Это поведение по умолчанию.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.3.181.7"><h2>Замечания</h2><p>Чтобы опустошить таблицу, необходимо иметь право <code class="literal">TRUNCATE</code> для этой таблицы.</p><p>Команда <code class="command">TRUNCATE</code> запрашивает блокировку <code class="literal">ACCESS EXCLUSIVE</code> для каждой таблицы, которую она обрабатывает. Когда указано <code class="literal">RESTART IDENTITY</code>, все последовательности, которые должны быть перезапущены, также блокируются исключительно. В случаях, когда требуется обеспечить параллельный доступ к таблице, следует использовать <code class="command">DELETE</code>.</p><p><code class="command">TRUNCATE</code> нельзя использовать с таблицей, на которую по внешнему ключу ссылаются другие таблицы, если только и эти таблицы не опустошаются этой же командой. Проверка допустимости очистки в таких случаях потребовала бы сканирования таблицы, а главная идея данной команды в том, чтобы не делать этого. Для автоматической обработки всех зависимых таблиц можно использовать указание <code class="literal">CASCADE</code> — но будьте очень осторожны с ним, иначе вы можете потерять данные, которые не собирались удалять! В частности, заметьте, что когда опустошаемая таблица является секцией, соседние секции эта операция не затрагивает, но затрагивает все таблицы, на которые ссылается целевая, или которые являются её секциями.</p><p>При выполнении <code class="command">TRUNCATE</code> не срабатывают никакие триггеры <code class="literal">ON DELETE</code>, которые могут быть настроены для таблиц. Однако при этом срабатывают триггеры <code class="literal">ON TRUNCATE</code>. Если триггеры <code class="literal">ON TRUNCATE</code> определены для любых из этих таблиц, то все триггеры <code class="literal">BEFORE TRUNCATE</code> срабатывают до того, как происходит опустошение, а все триггеры <code class="literal">AFTER TRUNCATE</code> срабатывают после того, как завершается опустошение последней таблицы и все последовательности сбрасываются. Триггеры срабатывают по порядку обработки таблиц (сначала для таблиц, перечисленных в команде, затем для тех, что затрагиваются каскадно).</p><p>Команда <code class="command">TRUNCATE</code> небезопасна с точки зрения MVCC. После опустошения таблицы она будет выглядеть пустой для параллельных транзакций, если они работают со снимком, полученным до опустошения. За подробностями обратитесь к <a class="xref" href="mvcc-caveats.html" title="13.6. Ограничения">Разделу 13.6</a>.</p><p><code class="command">TRUNCATE</code> является надёжной транзакционной операцией в отношении данных в таблицах: опустошение будет безопасно отменено, если окружающая транзакция не будет зафиксирована.</p><p>С указанием <code class="literal">RESTART IDENTITY</code> подразумеваемые операции <code class="command">ALTER SEQUENCE RESTART</code> также выполняются транзакционно; то есть, они будут отменены, если окружающая транзакция не будет зафиксирована. Учтите, что если до того, как транзакция отменится, будут выполнены какие-либо дополнительные операции с последовательностями, эффект этих операций также будет отменён, но не их влияние на значение <code class="function">currval()</code>; то есть после транзакции <code class="function">currval()</code> продолжит возвращать последнее значение последовательности, полученное внутри прерванной транзакции, хотя сама последовательность уже может быть несогласованной с ним. Подобным образом обычно ведёт себя <code class="function">currval()</code> после сбоя транзакции.</p><p>Команда <code class="command">TRUNCATE</code> может работать со сторонними таблицами, если это поддерживает обёртка сторонних данных, как например <a class="xref" href="postgres-fdw.html" title="F.38. postgres_fdw — обращение к данным, находящимся на внешних серверах PostgreSQL">postgres_fdw</a>.</p></div><div class="refsect1" id="id-1.9.3.181.8"><h2>Примеры</h2><p>Опустошение таблиц <code class="literal">bigtable</code> и <code class="literal">fattable</code>: </p><pre class="programlisting">TRUNCATE bigtable, fattable;</pre><p>Та же операция и сброс всех связанных генераторов последовательностей: </p><pre class="programlisting">TRUNCATE bigtable, fattable RESTART IDENTITY;</pre><p>Опустошение таблицы <code class="literal">othertable</code> и каскадная обработка всех таблиц, ссылающихся на <code class="literal">othertable</code> по ограничениям внешнего ключа: </p><pre class="programlisting">TRUNCATE othertable CASCADE;</pre></div><div class="refsect1" id="id-1.9.3.181.9"><h2>Совместимость</h2><p>Стандарт SQL:2008 включает команду <code class="command">TRUNCATE</code> с синтаксисом <code class="literal">TRUNCATE TABLE <em class="replaceable"><code>имя_таблицы</code></em></code>. Предложения <code class="literal">CONTINUE IDENTITY</code>/<code class="literal">RESTART IDENTITY</code> также описаны в стандарте, но с небольшими отличиями, хотя их назначение похоже. Поведение этой команды при параллельных операциях, согласно стандарту, отчасти определяются реализацией, так что приведённые выше замечания при необходимости следует учитывать и сопоставлять с другими реализациями.</p></div><div class="refsect1" id="id-1.9.3.181.10"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-delete.html" title="DELETE"><span class="refentrytitle">DELETE</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-start-transaction.html" title="START TRANSACTION">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-unlisten.html" title="UNLISTEN">След.</a></td></tr><tr><td width="40%" align="left" valign="top">START TRANSACTION </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> UNLISTEN</td></tr></table></div></body></html>