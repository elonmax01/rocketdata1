<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>21.10. Аутентификация LDAP</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="auth-peer.html" title="21.9. Аутентификация peer" /><link rel="next" href="auth-radius.html" title="21.11. Аутентификация RADIUS" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">21.10. Аутентификация LDAP</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="auth-peer.html" title="21.9. Аутентификация peer">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения">Наверх</a></td><th width="60%" align="center">Глава 21. Аутентификация клиентского приложения</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="auth-radius.html" title="21.11. Аутентификация RADIUS">След.</a></td></tr></table><hr /></div><div class="sect1" id="AUTH-LDAP"><div class="titlepage"><div><div><h2 class="title" style="clear: both">21.10. Аутентификация LDAP <a href="#AUTH-LDAP" class="id_link">#</a></h2></div></div></div><a id="id-1.6.8.17.2" class="indexterm"></a><p>Данный метод аутентификации работает сходным с методом <code class="literal">password</code> образом, за исключением того, что он использует LDAP как метод подтверждения пароля. LDAP используется только для подтверждения пары «имя пользователя/пароль». Поэтому пользователь должен уже существовать в базе данных до того, как для аутентификации будет использован LDAP.</p><p>Аутентификация LDAP может работать в двух режимах. Первый режим называется простое связывание. В ходе аутентификации сервер связывается с характерным именем, составленным следующим образом: <em class="replaceable"><code>prefix</code></em> <em class="replaceable"><code>username</code></em> <em class="replaceable"><code>suffix</code></em>. Обычно, параметр <em class="replaceable"><code>prefix</code></em> используется для указания <code class="literal">cn=</code> или <em class="replaceable"><code>DOMAIN</code></em><code class="literal">\</code> в среде Active Directory. <em class="replaceable"><code>suffix</code></em> используется для указания оставшейся части DN или в среде, отличной от Active Directory.</p><p>Во втором режиме, который мы называем поиск+связывание, сервер сначала связывается с каталогом LDAP с предопределённым именем пользователя и паролем, указанным в <em class="replaceable"><code>ldapbinddn</code></em> и <em class="replaceable"><code>ldapbindpasswd</code></em>, и выполняет поиск пользователя, пытающегося подключиться к базе данных. Если имя пользователя и пароль не определены, сервер пытается связаться с каталогом анонимно. Поиск выполняется в поддереве <em class="replaceable"><code>ldapbasedn</code></em>, при этом проверятся точное соответствие имени пользователя атрибуту <em class="replaceable"><code>ldapsearchattribute</code></em>. Как только при поиске находится пользователь, сервер отключается и заново связывается с каталогом уже как этот пользователь, с паролем, переданным клиентом, чтобы удостовериться, что учётная запись корректна. Этот же режим используется в схемах LDAP-аутентификации в другом программном обеспечении, например, в pam_ldap и mod_authnz_ldap в Apache. Данный вариант даёт больше гибкости в выборе расположения объектов пользователей, но при этом требует дважды подключаться к серверу LDAP.</p><p>В обоих режимах используются следующие параметры конфигурации: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ldapserver</code></span></dt><dd><p>Имена и IP-адреса LDAP-серверов для связи. Можно указать несколько серверов, разделяя их пробелами.</p></dd><dt><span class="term"><code class="literal">ldapport</code></span></dt><dd><p>Номер порта для связи с LDAP-сервером. Если порт не указан, используется установленный по умолчанию порт библиотеки LDAP.</p></dd><dt><span class="term"><code class="literal">ldapscheme</code></span></dt><dd><p>Значение <code class="literal">ldaps</code> выбирает протокол LDAPS. Это нестандартный способ использования LDAP поверх SSL, поддерживаемый некоторыми серверами LDAP. Альтернативную возможность предоставляет параметр <code class="literal">ldaptls</code>.</p></dd><dt><span class="term"><code class="literal">ldaptls</code></span></dt><dd><p>Значение 1 включает TLS-шифрование для защиты соединения PostgreSQL с LDAP-сервером. При этом используется операция <code class="literal">StartTLS</code>, описанная в <a class="ulink" href="https://datatracker.ietf.org/doc/html/rfc4513" target="_top">RFC 4513</a>. Альтернативную возможность предоставляет параметр <code class="literal">ldapscheme</code>.</p></dd></dl></div><p>Заметьте, что при использовании <code class="literal">ldapscheme</code> или <code class="literal">ldaptls</code> шифруется только трафик между сервером PostgreSQL и сервером LDAP. Соединение между сервером PostgreSQL и клиентом остаётся незашифрованным, если только и для него не включён SSL.</p><p>Следующие параметры используются только в режиме простого связывания: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ldapprefix</code></span></dt><dd><p>Эта строка подставляется перед именем пользователя во время формирования DN для связывания при аутентификации в режиме простого связывания.</p></dd><dt><span class="term"><code class="literal">ldapsuffix</code></span></dt><dd><p>Эта строка размещается после имени пользователя во время формирования DN для связывания, при аутентификации в режиме простого связывания.</p></dd></dl></div><p>Следующие параметры используются только в режиме поиск+связывание: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ldapbasedn</code></span></dt><dd><p>Корневая папка DN для начала поиска пользователя при аутентификации в режиме поиск+связывание.</p></dd><dt><span class="term"><code class="literal">ldapbinddn</code></span></dt><dd><p>DN пользователя для связи с каталогом при выполнении поиска в ходе аутентификации в режиме поиск+связывание.</p></dd><dt><span class="term"><code class="literal">ldapbindpasswd</code></span></dt><dd><p>Пароль пользователя для связывания с каталогом при выполнении поиска в ходе аутентификации в режиме поиск+связывание.</p></dd><dt><span class="term"><code class="literal">ldapsearchattribute</code></span></dt><dd><p>Атрибут для соотнесения с именем пользователя в ходе аутентификации поиск+связывание. Если атрибут не указан, будет использован атрибут <code class="literal">uid</code>.</p></dd><dt><span class="term"><code class="literal">ldapsearchfilter</code></span></dt><dd><p>Фильтр поиска, используемый для аутентификации в режиме поиск+связывание. Вхождения <code class="literal">$username</code> в нём будут заменяться именем пользователя. Это позволяет задавать более гибкие фильтры поиска, чем <code class="literal">ldapsearchattribute</code>.</p></dd><dt><span class="term"><code class="literal">ldapurl</code></span></dt><dd><p>Адрес LDAP по стандарту <a class="ulink" href="https://datatracker.ietf.org/doc/html/rfc4516" target="_top">RFC 4516</a>. Это альтернативный способ записи некоторых других параметров LDAP в более компактном и стандартном виде. Формат адреса таков: </p><pre class="synopsis">
ldap[s]://<em class="replaceable"><code>сервер</code></em>[:<em class="replaceable"><code>порт</code></em>]/<em class="replaceable"><code>basedn</code></em>[?[<em class="replaceable"><code>атрибут</code></em>][?[<em class="replaceable"><code>scope</code></em>][?[<em class="replaceable"><code>фильтр</code></em>]]]]
</pre><p> Здесь <em class="replaceable"><code>scope</code></em> принимает значение <code class="literal">base</code>, <code class="literal">one</code> или <code class="literal">sub</code> (обычно последнее). По умолчанию подразумевается <code class="literal">base</code>, что не очень полезно при таком применении. В качестве <em class="replaceable"><code>атрибута</code></em> может указываться один атрибут; в этом случае он используется как значение параметра <code class="literal">ldapsearchattribute</code>. Если <em class="replaceable"><code>атрибут</code></em> не указан, в качестве значения <code class="literal">ldapsearchfilter</code> может использоваться <em class="replaceable"><code>фильтр</code></em>.</p><p>Схема адреса <code class="literal">ldaps</code> выбирает для установления LDAP-подключений поверх SSL метод LDAPS, что равнозначно указанию <code class="literal">ldapscheme=ldaps</code>. Для применения шифрования LDAP с использованием операции <code class="literal">StartTLS</code> используйте обычную схему URL <code class="literal">ldap</code> и укажите параметр <code class="literal">ldaptls</code> в дополнение к <code class="literal">ldapurl</code>.</p><p>Для неанонимного связывания <code class="literal">ldapbinddn</code> и <code class="literal">ldapbindpasswd</code> должны быть указаны как раздельные параметры.</p><p>В настоящее время URL-адреса LDAP поддерживаются только с <span class="productname">OpenLDAP</span> и не поддерживаются в Windows.</p></dd></dl></div><p>Нельзя путать параметры конфигурации для режима простого связывания с параметрами для режима поиск+связывание, это ошибка.</p><p>В режиме поиск+связывание поиск может выполняться либо по одному атрибуту, указанному в <code class="literal">ldapsearchattribute</code>, либо по произвольному фильтру поиска, заданному в <code class="literal">ldapsearchfilter</code>. Указание <code class="literal">ldapsearchattribute=foo</code> равнозначно указанию <code class="literal">ldapsearchfilter="(foo=$username)"</code>. Если не указан ни один параметр, по умолчанию подразумевается <code class="literal">ldapsearchattribute=uid</code>.</p><p>Если <span class="productname">PostgreSQL</span> был скомпилирован с <span class="productname">OpenLDAP</span> в качестве клиентской библиотеки LDAP, параметр <code class="literal">ldapserver</code> может быть опущен. В этом случае за списком имён серверов и портов сервер обращается в DNS, к SRV-записи (по стандарту <a class="ulink" href="https://datatracker.ietf.org/doc/html/rfc2782" target="_top">RFC 2782</a>) с именем <code class="literal">_ldap._tcp.DOMAIN</code>, где <code class="literal">DOMAIN</code> извлекается из <code class="literal">ldapbasedn</code>.</p><p>Это пример конфигурации LDAP для простого связывания: </p><pre class="programlisting">host ... ldap ldapserver=ldap.example.net ldapprefix="cn=" ldapsuffix=", dc=example, dc=net"</pre><p> Когда запрашивается подключение к серверу базы данных в качестве пользователя базы данных <code class="literal">someuser</code>, PostgreSQL пытается связаться с LDAP-сервером, используя DN <code class="literal">cn=someuser, dc=example, dc=net</code> и пароль, предоставленный клиентом. Если это подключение удалось, то доступ к базе данных будет открыт.</p><p>Пример конфигурации для режима поиск+связывание: </p><pre class="programlisting">host ... ldap ldapserver=ldap.example.net ldapbasedn="dc=example, dc=net" ldapsearchattribute=uid</pre><p> Когда запрашивается подключение к серверу базы данных в качестве пользователя базы данных <code class="literal">someuser</code>, PostgreSQL пытается связаться с сервером LDAP анонимно (поскольку <code class="literal">ldapbinddn</code> не был указан), выполняет поиск для <code class="literal">(uid=someuser)</code> под указанной базой DN. Если запись найдена, проводится попытка связывание с использованием найденной информации и паролем, предоставленным клиентом. Если вторая попытка подключения проходит успешно, предоставляется доступ к базе данных.</p><p>Пример той же конфигурации для режима поиск+связывание, но записанной в виде URL: </p><pre class="programlisting">host ... ldap ldapurl="ldap://ldap.example.net/dc=example,dc=net?uid?sub"</pre><p> Такой URL-формат используется и другим программным обеспечением, поддерживающим аутентификацию по протоколу LDAP, поэтому распространять такую конфигурацию будет легче.</p><p>Пример конфигурации поиск+связывание, в котором <code class="literal">ldapsearchfilter</code> используется вместо <code class="literal">ldapsearchattribute</code> для прохождения аутентификации по идентификатору или почтовому адресу пользователя: </p><pre class="programlisting">host ... ldap ldapserver=ldap.example.net ldapbasedn="dc=example, dc=net" ldapsearchfilter="(|(uid=$username)(mail=$username))"</pre><p>Пример конфигурации поиск+связывание, в котором используется поиск SRV-записи в DNS для получения имени сервера и порта службы LDAP в домене <code class="literal">example.net</code>: </p><pre class="programlisting">host ... ldap ldapbasedn="dc=example,dc=net"</pre><div class="tip"><h3 class="title">Подсказка</h3><p>Поскольку LDAP часто применяет запятые и пробелы для разделения различных частей DN, необходимо использовать кавычки при определении значения параметров, как показано в наших примерах.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="auth-peer.html" title="21.9. Аутентификация peer">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="auth-radius.html" title="21.11. Аутентификация RADIUS">След.</a></td></tr><tr><td width="40%" align="left" valign="top">21.9. Аутентификация peer </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 21.11. Аутентификация RADIUS</td></tr></table></div></body></html>