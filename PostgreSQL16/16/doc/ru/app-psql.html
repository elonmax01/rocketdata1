<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>psql</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="app-pgverifybackup.html" title="pg_verifybackup" /><link rel="next" href="app-reindexdb.html" title="reindexdb" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center"><span class="application">psql</span></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="app-pgverifybackup.html" title="pg_verifybackup">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><th width="60%" align="center">Клиентские приложения PostgreSQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="app-reindexdb.html" title="reindexdb">След.</a></td></tr></table><hr /></div><div class="refentry" id="APP-PSQL"><div class="titlepage"></div><a id="id-1.9.4.20.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle"><span class="application">psql</span></span></h2><p><span class="application">psql</span> — интерактивный терминал <span class="productname">PostgreSQL</span></p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><div class="cmdsynopsis"><p id="id-1.9.4.20.4.1"><code class="command">psql</code> [<em class="replaceable"><code>параметр</code></em>...] [<em class="replaceable"><code>имя_бд</code></em>
    [<em class="replaceable"><code>имя_пользователя</code></em>]]</p></div></div><div class="refsect1" id="id-1.9.4.20.5"><h2>Описание</h2><p>Программа <span class="application">psql</span> — это терминальный клиент для работы с <span class="productname">PostgreSQL</span>. Она позволяет интерактивно вводить запросы, передавать их в <span class="productname">PostgreSQL</span> и видеть результаты. Также запросы могут быть получены из файла или из аргументов командной строки. Кроме того, <span class="application">psql</span> предоставляет ряд метакоманд и различные возможности, подобные тем, что имеются у командных оболочек, для облегчения написания скриптов и автоматизации широкого спектра задач.</p></div><div class="refsect1" id="R1-APP-PSQL-3"><h2>Параметры</h2><div class="variablelist"><dl class="variablelist"><dt id="APP-PSQL-OPTION-ECHO-ALL"><span class="term"><code class="option">-a</code><br /></span><span class="term"><code class="option">--echo-all</code></span> <a href="#APP-PSQL-OPTION-ECHO-ALL" class="id_link">#</a></dt><dd><p>Отправляет в стандартный вывод все непустые входные строки по мере их чтения. (Это не относится к строкам, считанным в интерактивном режиме.) Эквивалентно установке переменной <code class="varname">ECHO</code> в значение <code class="literal">all</code>.</p></dd><dt id="APP-PSQL-OPTION-NO-ALIGN"><span class="term"><code class="option">-A</code><br /></span><span class="term"><code class="option">--no-align</code></span> <a href="#APP-PSQL-OPTION-NO-ALIGN" class="id_link">#</a></dt><dd><p>Переключает на невыровненный режим вывода. (По умолчанию используется другой режим, <code class="literal">aligned</code>.) Равнозначно команде <code class="command">\pset format unaligned</code>.</p></dd><dt id="APP-PSQL-OPTION-ECHO-ERRORS"><span class="term"><code class="option">-b</code><br /></span><span class="term"><code class="option">--echo-errors</code></span> <a href="#APP-PSQL-OPTION-ECHO-ERRORS" class="id_link">#</a></dt><dd><p>Выводит все команды SQL с ошибками в стандартный канал ошибок. Равнозначно присваиванию переменной <code class="varname">ECHO</code> значения <code class="literal">errors</code>.</p></dd><dt id="APP-PSQL-OPTION-COMMAND"><span class="term"><code class="option">-c <em class="replaceable"><code>команда</code></em></code><br /></span><span class="term"><code class="option">--command=<em class="replaceable"><code>команда</code></em></code></span> <a href="#APP-PSQL-OPTION-COMMAND" class="id_link">#</a></dt><dd><p>Передаёт <span class="application">psql</span> <em class="replaceable"><code>команду</code></em> для выполнения. Этот ключ можно повторять и комбинировать в любом порядке с ключом <code class="option">-f</code>. Когда указывается <code class="option">-c</code> или <code class="option">-f</code>, <span class="application">psql</span> не читает команды со стандартного ввода; вместо этого она завершается сразу после обработки всех ключей <code class="option">-c</code> и <code class="option">-f</code> по порядку.</p><p>Заданная <em class="replaceable"><code>команда</code></em> должна быть либо командной строкой, которая полностью интерпретируется сервером (т. е. не использует специфические функции <span class="application">psql</span>), либо одиночной командой с обратной косой чертой. Таким образом, используя <code class="option">-c</code>, нельзя смешивать метакоманды <acronym class="acronym">SQL</acronym> и <span class="application">psql</span>. Но это можно сделать, передав несколько ключей <code class="option">-c</code> или передав строку в <span class="application">psql</span> через канал: </p><pre class="programlisting">psql -c '\x' -c 'SELECT * FROM foo;'</pre><p> или </p><pre class="programlisting">echo '\x \\ SELECT * FROM foo;' | psql</pre><p> (<code class="literal">\\</code> — разделитель метакоманд.)</p><p>Каждая строка <acronym class="acronym">SQL</acronym>-команд, заданная ключом <code class="option">-c</code>, передаётся на сервер как один запрос. Поэтому сервер выполняет её в одной транзакции, даже когда эта строка содержит несколько команд <acronym class="acronym">SQL</acronym>, если только в ней не содержатся явные команды <code class="command">BEGIN</code>/<code class="command">COMMIT</code>, разделяющие её на несколько транзакций. (Подробнее о том, как сервер обрабатывает строки, включающие несколько команд, рассказывается в <a class="xref" href="protocol-flow.html#PROTOCOL-FLOW-MULTI-STATEMENT" title="55.2.2.1. Несколько операторов в простом протоколе запросов">Подразделе 55.2.2.1</a>.)</p><p>Если вы не хотите, чтобы несколько команд выполнялись в одной транзакции, используйте несколько ключей <code class="option">-c</code> или передайте несколько команд на стандартный ввод <span class="application">psql</span>, применяя либо <span class="application">echo</span>, как показано выше, либо создаваемый прямо в оболочке текст, например: </p><pre class="programlisting">psql &lt;&lt;EOF
\x
SELECT * FROM foo;
EOF</pre></dd><dt id="APP-PSQL-OPTION-CSV"><span class="term"><code class="option">--csv</code></span> <a href="#APP-PSQL-OPTION-CSV" class="id_link">#</a></dt><dd><p>Переключает в режим вывода <acronym class="acronym">CSV</acronym> (Comma Separated Values, Значения, разделённые запятыми). Равнозначно команде <code class="command">\pset format csv</code>.</p></dd><dt id="APP-PSQL-OPTION-DBNAME"><span class="term"><code class="option">-d <em class="replaceable"><code>имя_бд</code></em></code><br /></span><span class="term"><code class="option">--dbname=<em class="replaceable"><code>имя_бд</code></em></code></span> <a href="#APP-PSQL-OPTION-DBNAME" class="id_link">#</a></dt><dd><p>Указывает имя базы данных для подключения. Равнозначно указанию <em class="replaceable"><code>имя_бд</code></em> в первом аргументе, не являющемся ключом, в командной строке. Вместо имени может задаваться <a class="link" href="libpq-connect.html#LIBPQ-CONNSTRING" title="34.1.1. Строки параметров подключения">строка подключения</a>. В этом случае параметры в строке подключения переопределяют одноимённые параметры, заданные в командной строке.</p></dd><dt id="APP-PSQL-OPTION-ECHO-QUERIES"><span class="term"><code class="option">-e</code><br /></span><span class="term"><code class="option">--echo-queries</code></span> <a href="#APP-PSQL-OPTION-ECHO-QUERIES" class="id_link">#</a></dt><dd><p>Посылает все команды SQL, отправленные на сервер, ещё и на стандартный вывод. Эквивалентно установке переменной <code class="varname">ECHO</code> в значение <code class="literal">queries</code>.</p></dd><dt id="APP-PSQL-OPTION-ECHO-HIDDEN"><span class="term"><code class="option">-E</code><br /></span><span class="term"><code class="option">--echo-hidden</code></span> <a href="#APP-PSQL-OPTION-ECHO-HIDDEN" class="id_link">#</a></dt><dd><p>Отображает фактические запросы, генерируемые <code class="command">\d</code> и другими командами, начинающимися с \. Это можно использовать для изучения внутренних операций в <span class="application">psql</span>. Эквивалентно установке переменной <code class="varname">ECHO_HIDDEN</code> значения <code class="literal">on</code>.</p></dd><dt id="APP-PSQL-OPTION-FILE"><span class="term"><code class="option">-f <em class="replaceable"><code>имя_файла</code></em></code><br /></span><span class="term"><code class="option">--file=<em class="replaceable"><code>имя_файла</code></em></code></span> <a href="#APP-PSQL-OPTION-FILE" class="id_link">#</a></dt><dd><p>Читает команды из файла <em class="replaceable"><code>имя_файла</code></em>, а не из стандартного ввода. Этот ключ можно повторять и комбинировать в любом порядке с ключом <code class="option">-c</code>. Если указан ключ <code class="option">-c</code> или <code class="option">-f</code>, программа <span class="application">psql</span> не читает команды со стандартного ввода; вместо этого она завершается после обработки всех ключей <code class="option">-c</code> и <code class="option">-f</code> по очереди. Не считая этого, данный ключ по большому счёту равнозначен метакоманде <code class="command">\i</code>.</p><p>Если <em class="replaceable"><code>имя_файла</code></em> задано символом <code class="literal">-</code> (минус), считывается стандартный ввод до признака конца файла или до метакоманды <code class="command">\q</code>. Это позволяет перемежать интерактивный ввод с вводом из файлов. Однако заметьте, что Readline в этом случае не применяется (так же, как и с ключом <code class="option">-n</code>).</p><p>Использование этого параметра немного отличается от <code class="literal">psql &lt; <em class="replaceable"><code>имя_файла</code></em></code>. В основном, оба варианта будут делать то, что вы ожидаете, но с <code class="literal">-f</code> доступны некоторые полезные свойства, такие как сообщения об ошибках с номерами строк. Также есть небольшая вероятность, что запуск в таком режиме будет быстрее. С другой стороны, вариант с перенаправлением ввода из командного интерпретатора (в теории) гарантирует получение точно такого же вывода, какой вы получили бы, если бы ввели всё вручную.</p></dd><dt id="APP-PSQL-OPTION-FIELD-SEPARATOR"><span class="term"><code class="option">-F <em class="replaceable"><code>разделитель</code></em></code><br /></span><span class="term"><code class="option">--field-separator=<em class="replaceable"><code>разделитель</code></em></code></span> <a href="#APP-PSQL-OPTION-FIELD-SEPARATOR" class="id_link">#</a></dt><dd><p>Использование <em class="replaceable"><code>разделитель</code></em> в качестве разделителя полей при невыровненном режиме вывода. Эквивалентно <code class="command">\pset fieldsep</code> или <code class="command">\f</code>.</p></dd><dt id="APP-PSQL-OPTION-FIELD-HOST"><span class="term"><code class="option">-h <em class="replaceable"><code>компьютер</code></em></code><br /></span><span class="term"><code class="option">--host=<em class="replaceable"><code>компьютер</code></em></code></span> <a href="#APP-PSQL-OPTION-FIELD-HOST" class="id_link">#</a></dt><dd><p>Указывает имя компьютера, на котором работает сервер. Если значение начинается с косой черты, оно определяет каталог Unix-сокета.</p></dd><dt id="APP-PSQL-OPTION-HTML"><span class="term"><code class="option">-H</code><br /></span><span class="term"><code class="option">--html</code></span> <a href="#APP-PSQL-OPTION-HTML" class="id_link">#</a></dt><dd><p>Переключает в режим вывода <acronym class="acronym">HTML</acronym>. Равнозначно команде <code class="command">\pset format html</code> или <code class="command">\H</code>.</p></dd><dt id="APP-PSQL-OPTION-LIST"><span class="term"><code class="option">-l</code><br /></span><span class="term"><code class="option">--list</code></span> <a href="#APP-PSQL-OPTION-LIST" class="id_link">#</a></dt><dd><p>Выводит список всех доступных баз данных и завершает работу. Другие параметры, не связанные с соединением, игнорируются. Это похоже на метакоманду <code class="command">\list</code>.</p><p>Когда используется этот аргумент, <span class="application">psql</span> будет подключаться к базе данных <code class="literal">postgres</code>, если только в командной строке не задана другая база данных (в параметре <code class="option">-d</code> или не через параметры, а, например, через запись службы, но не через переменную окружения).</p></dd><dt id="APP-PSQL-OPTION-LOG-FILE"><span class="term"><code class="option">-L <em class="replaceable"><code>имя_файла</code></em></code><br /></span><span class="term"><code class="option">--log-file=<em class="replaceable"><code>имя_файла</code></em></code></span> <a href="#APP-PSQL-OPTION-LOG-FILE" class="id_link">#</a></dt><dd><p>В дополнение к обычному выводу, записывает вывод результатов всех запросов в файл <em class="replaceable"><code>имя_файла</code></em>.</p></dd><dt id="APP-PSQL-OPTION-NO-READLINE"><span class="term"><code class="option">-n</code><br /></span><span class="term"><code class="option">--no-readline</code></span> <a href="#APP-PSQL-OPTION-NO-READLINE" class="id_link">#</a></dt><dd><p>Отключает использование <span class="application">Readline</span> для редактирования командной строки и использование истории команд (см. <a class="xref" href="app-psql.html#APP-PSQL-READLINE" title="Редактирование командной строки">Подраздел «Редактирование командной строки»</a> ниже).</p></dd><dt id="APP-PSQL-OPTION-OUTPUT"><span class="term"><code class="option">-o <em class="replaceable"><code>имя_файла</code></em></code><br /></span><span class="term"><code class="option">--output=<em class="replaceable"><code>имя_файла</code></em></code></span> <a href="#APP-PSQL-OPTION-OUTPUT" class="id_link">#</a></dt><dd><p>Записывает вывод результатов всех запросов в файл <em class="replaceable"><code>имя_файла</code></em>. Эквивалентно команде <code class="command">\o</code>.</p></dd><dt id="APP-PSQL-OPTION-PORT"><span class="term"><code class="option">-p <em class="replaceable"><code>порт</code></em></code><br /></span><span class="term"><code class="option">--port=<em class="replaceable"><code>порт</code></em></code></span> <a href="#APP-PSQL-OPTION-PORT" class="id_link">#</a></dt><dd><p>Указывает TCP-порт или расширение файла локального Unix-сокета, через который сервер принимает подключения. Значение по умолчанию определяется переменной среды <code class="envar">PGPORT</code>, если она установлена, либо числом, заданным при компиляции, обычно 5432.</p></dd><dt id="APP-PSQL-OPTION-PSET"><span class="term"><code class="option">-P <em class="replaceable"><code>присваивание</code></em></code><br /></span><span class="term"><code class="option">--pset=<em class="replaceable"><code>присваивание</code></em></code></span> <a href="#APP-PSQL-OPTION-PSET" class="id_link">#</a></dt><dd><p>Задаёт параметры печати, в стиле команды <code class="command">\pset</code>. Обратите внимание, что имя параметра и значение разделяются знаком равенства, а не пробела. Например, чтобы установить формат вывода в <span class="application">LaTeX</span>, нужно написать <code class="literal">-P format=latex</code>.</p></dd><dt id="APP-PSQL-OPTION-QUIET"><span class="term"><code class="option">-q</code><br /></span><span class="term"><code class="option">--quiet</code></span> <a href="#APP-PSQL-OPTION-QUIET" class="id_link">#</a></dt><dd><p>Указывает, что <span class="application">psql</span> должен работать без вывода дополнительных сообщений. По умолчанию, выводятся приветствия и различные информационные сообщения. Этого не произойдёт с использованием данного параметра. Полезно вместе с параметром <code class="option">-c</code>. Этот же эффект можно получить, установив для переменной <code class="varname">QUIET</code> значение <code class="literal">on</code>.</p></dd><dt id="APP-PSQL-OPTION-RECORD-SEPARATOR"><span class="term"><code class="option">-R <em class="replaceable"><code>разделитель</code></em></code><br /></span><span class="term"><code class="option">--record-separator=<em class="replaceable"><code>разделитель</code></em></code></span> <a href="#APP-PSQL-OPTION-RECORD-SEPARATOR" class="id_link">#</a></dt><dd><p>Использовать <em class="replaceable"><code>разделитель</code></em> как разделитель записей при невыровненном режиме вывода. Равнозначно команде <code class="command">\pset recordsep</code>.</p></dd><dt id="APP-PSQL-OPTION-SINGLE-STEP"><span class="term"><code class="option">-s</code><br /></span><span class="term"><code class="option">--single-step</code></span> <a href="#APP-PSQL-OPTION-SINGLE-STEP" class="id_link">#</a></dt><dd><p>Запуск в пошаговом режиме. Это означает, что пользователь будет подтверждать выполнение каждой команды, отправляемой на сервер, с возможностью отменить выполнение. Используется для отладки скриптов.</p></dd><dt id="APP-PSQL-OPTION-SINGLE-LINE"><span class="term"><code class="option">-S</code><br /></span><span class="term"><code class="option">--single-line</code></span> <a href="#APP-PSQL-OPTION-SINGLE-LINE" class="id_link">#</a></dt><dd><p>Запуск в однострочном режиме, при котором символ новой строки завершает SQL-команды, так же как это делает точка с запятой.</p><div class="note"><h3 class="title">Примечание</h3><p>Этот режим реализован для тех, кому он нужен, но это не обязательно означает, что и вам нужно его использовать. В частности, если смешивать в одной строке команды <acronym class="acronym">SQL</acronym> и метакоманды, порядок их выполнения может быть не всегда понятен для неопытного пользователя.</p></div></dd><dt id="APP-PSQL-OPTION-TUPLES-ONLY"><span class="term"><code class="option">-t</code><br /></span><span class="term"><code class="option">--tuples-only</code></span> <a href="#APP-PSQL-OPTION-TUPLES-ONLY" class="id_link">#</a></dt><dd><p>Отключает вывод имён столбцов и результирующей строки с количеством выбранных записей. Равнозначно команде <code class="command">\t</code> или <code class="command">\pset tuples_only</code>.</p></dd><dt id="APP-PSQL-OPTION-TABLE-ATTR"><span class="term"><code class="option">-T <em class="replaceable"><code>параметры_таблицы</code></em></code><br /></span><span class="term"><code class="option">--table-attr=<em class="replaceable"><code>параметры_таблицы</code></em></code></span> <a href="#APP-PSQL-OPTION-TABLE-ATTR" class="id_link">#</a></dt><dd><p>Задаёт атрибуты, которые будут вставлены в тег <acronym class="acronym">HTML</acronym> <code class="sgmltag-element">table</code>. За подробностями обратитесь к описанию <code class="command">\pset tableattr</code>.</p></dd><dt id="APP-PSQL-OPTION-USERNAME"><span class="term"><code class="option">-U <em class="replaceable"><code>имя_пользователя</code></em></code><br /></span><span class="term"><code class="option">--username=<em class="replaceable"><code>имя_пользователя</code></em></code></span> <a href="#APP-PSQL-OPTION-USERNAME" class="id_link">#</a></dt><dd><p>Использовать для подключения к базе данных <em class="replaceable"><code>имя_пользователя</code></em> вместо подразумеваемого по умолчанию. (Разумеется, это потребует соответствующего разрешения.)</p></dd><dt id="APP-PSQL-OPTION-VARIABLE"><span class="term"><code class="option">-v <em class="replaceable"><code>присваивание</code></em></code><br /></span><span class="term"><code class="option">--set=<em class="replaceable"><code>присваивание</code></em></code><br /></span><span class="term"><code class="option">--variable=<em class="replaceable"><code>присваивание</code></em></code></span> <a href="#APP-PSQL-OPTION-VARIABLE" class="id_link">#</a></dt><dd><p>Выполняет присваивание значения переменной, как метакоманда <code class="command">\set</code>. Обратите внимание, что необходимо разделить имя переменной и значение (при наличии) знаком равенства в командной строке. Чтобы сбросить переменную, оставьте имя переменной без знака равенства. Чтобы установить пустое значение, добавьте знак равенства, но опустите значение. Эти присваивания выполняются во время обработки командной строки, так что переменные, отражающие состояние соединения, будут перезаписаны позже.</p></dd><dt id="APP-PSQL-OPTION-VERSION"><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span> <a href="#APP-PSQL-OPTION-VERSION" class="id_link">#</a></dt><dd><p>Выводит версию <span class="application">psql</span> и завершает работу.</p></dd><dt id="APP-PSQL-OPTION-NO-PASSWORD"><span class="term"><code class="option">-w</code><br /></span><span class="term"><code class="option">--no-password</code></span> <a href="#APP-PSQL-OPTION-NO-PASSWORD" class="id_link">#</a></dt><dd><p>Не выдавать запрос на ввод пароля. Если сервер требует аутентификацию по паролю и пароль нельзя получить из других источников, например из файла <code class="filename">.pgpass</code>, попытка соединения не удастся. Этот параметр может быть полезен в пакетных заданиях и скриптах, где нет пользователя, который вводит пароль.</p><p>Обратите внимание, что этот параметр действует на протяжении всего сеанса и, таким образом, влияет на метакоманду <code class="command">\connect</code>, так же как и на первую попытку соединения.</p></dd><dt id="APP-PSQL-OPTION-PASSWORD"><span class="term"><code class="option">-W</code><br /></span><span class="term"><code class="option">--password</code></span> <a href="#APP-PSQL-OPTION-PASSWORD" class="id_link">#</a></dt><dd><p>Принудительно запрашивать пароль перед подключением к базе данных, даже если он не будет использоваться.</p><p>Если сервер требует аутентификацию по паролю и пароль нельзя получить из других источников, например из файла <code class="filename">.pgpass</code>, <span class="application">psql</span> запросит пароль в любом случае. Однако чтобы понять, что требуется пароль, <span class="application">psql</span> лишний раз подключится к серверу. Поэтому иногда имеет смысл ввести <code class="option">-W</code>, чтобы исключить эту ненужную попытку подключения.</p><p>Обратите внимание, что этот параметр действует на протяжении всего сеанса и, таким образом, влияет на метакоманду <code class="command">\connect</code>, так же как и на первую попытку соединения.</p></dd><dt id="APP-PSQL-OPTION-EXPANDED"><span class="term"><code class="option">-x</code><br /></span><span class="term"><code class="option">--expanded</code></span> <a href="#APP-PSQL-OPTION-EXPANDED" class="id_link">#</a></dt><dd><p>Включает режим развёрнутого вывода таблицы. Равнозначно команде <code class="command">\x</code> или <code class="command">\pset expanded</code>.</p></dd><dt id="APP-PSQL-OPTION-NO-PSQLRC"><span class="term"><code class="option">-X</code><br /></span><span class="term"><code class="option">--no-psqlrc</code></span> <a href="#APP-PSQL-OPTION-NO-PSQLRC" class="id_link">#</a></dt><dd><p>Не читать стартовые файлы (ни общесистемный файл <code class="filename">psqlrc</code>, ни пользовательский файл <code class="filename">~/.psqlrc</code>).</p></dd><dt id="APP-PSQL-OPTION-FIELD-SEPARATOR-ZERO"><span class="term"><code class="option">-z</code><br /></span><span class="term"><code class="option">--field-separator-zero</code></span> <a href="#APP-PSQL-OPTION-FIELD-SEPARATOR-ZERO" class="id_link">#</a></dt><dd><p>Установить нулевой байт в качестве разделителя полей для невыровненного режима вывода. Равнозначно команде <code class="command">\pset fieldsep_zero</code>.</p></dd><dt id="APP-PSQL-OPTION-RECORD-SEPARATOR-ZERO"><span class="term"><code class="option">-0</code><br /></span><span class="term"><code class="option">--record-separator-zero</code></span> <a href="#APP-PSQL-OPTION-RECORD-SEPARATOR-ZERO" class="id_link">#</a></dt><dd><p>Установить нулевой байт в качестве разделителя записей для невыровненного режима вывода. Это полезно при взаимодействии с другими программами, например, с <code class="literal">xargs -0</code>. Равнозначно команде <code class="command">\pset recordsep_zero</code>.</p></dd><dt id="APP-PSQL-OPTION-SINGLE-TRANSACTION"><span class="term"><code class="option">-1</code><br /></span><span class="term"><code class="option">--single-transaction</code></span> <a href="#APP-PSQL-OPTION-SINGLE-TRANSACTION" class="id_link">#</a></dt><dd><p>Этот параметр может применяться только в сочетании с одним или несколькими параметрами <code class="option">-c</code> и/или <code class="option">-f</code>. С ним <span class="application">psql</span> выполняет команду <code class="command">BEGIN</code> перед обработкой первого такого параметра и <code class="command">COMMIT</code> после последнего, заворачивая таким образом все команды в одну транзакцию. Если какая-либо из команд завершилась ошибкой и была установлена переменная <code class="varname">ON_ERROR_STOP</code>, вместо <code class="command">COMMIT</code> передаётся команда <code class="command">ROLLBACK</code>. Это гарантирует, что либо все команды завершатся успешно, либо никакие изменения не сохранятся.</p><p>Если в самих этих командах содержатся операторы <code class="command">BEGIN</code>, <code class="command">COMMIT</code> или <code class="command">ROLLBACK</code>, этот параметр не даст желаемого эффекта. Кроме того, если какая-либо отдельная команда не может выполняться внутри блока транзакции, с этим параметром вся транзакция прервётся с ошибкой.</p></dd><dt id="APP-PSQL-OPTION-HELP"><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help[=<em class="replaceable"><code>тема</code></em>]</code></span> <a href="#APP-PSQL-OPTION-HELP" class="id_link">#</a></dt><dd><p>Показать справку по <span class="application">psql</span> и завершиться. Необязательный параметр <em class="replaceable"><code>тема</code></em> (по умолчанию <code class="literal">options</code>) выбирает описание интересующей части <span class="application">psql</span>: <code class="literal">commands</code> описывает команды <span class="application">psql</span> с обратной косой чертой; <code class="literal">options</code> описывает параметры командной строки, которые можно передать <span class="application">psql</span>; а <code class="literal">variables</code> выдаёт справку по переменным конфигурации <span class="application">psql</span>.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.4.20.7"><h2>Код завершения</h2><p>При нормальном завершении <span class="application">psql</span> возвращает 0 в командную оболочку ОС, 1 — если произошла критическая ошибка в самом <span class="application">psql</span> (например, нехватка памяти, файл не найден), 2 — при неудачном соединении с сервером неинтерактивного сеанса, 3 — при ошибке в скрипте и установленной переменной <code class="varname">ON_ERROR_STOP</code>.</p></div><div class="refsect1" id="id-1.9.4.20.8"><h2>Использование</h2><div class="refsect2" id="R2-APP-PSQL-CONNECTING"><h3>Подключение к базе данных</h3><p><span class="application">psql</span> это клиент для <span class="productname">PostgreSQL</span>. Для подключения к базе данных нужно знать имя базы данных, имя сервера, номер порта сервера и имя пользователя БД, под которым вы хотите подключиться. Эти свойства можно задать через аргументы командной строки, а именно <code class="option">-d</code>, <code class="option">-h</code>, <code class="option">-p</code> и <code class="option">-U</code> соответственно. Если в командной строке есть аргумент, который не относится к параметрам <span class="application">psql</span>, то он используется в качестве имени базы данных (или имени пользователя БД, если база данных уже задана). Задавать все эти аргументы необязательно, у них есть разумные значения по умолчанию. Если опустить имя сервера, <span class="application">psql</span> будет подключаться через Unix-сокет к локальному серверу, либо подключаться к <code class="literal">localhost</code> по TCP/IP в Windows. Номер порта по умолчанию определяется во время компиляции. Поскольку сервер базы данных использует то же значение по умолчанию, чаще всего указывать номер порта не нужно. Имя пользователя по умолчанию совпадает с именем пользователя в операционной системе. После определения имени пользователя БД оно используется как имя базы данных по умолчанию. Заметьте, что просто так подключаться к любой базе данных под любым именем пользователя БД вы не сможете. Узнать о ваших правах можно у администратора баз данных.</p><p>Если значения по умолчанию не подходят, можно сэкономить на вводе параметров подключения, установив переменные среды <code class="envar">PGDATABASE</code>, <code class="envar">PGHOST</code>, <code class="envar">PGPORT</code> и/или <code class="envar">PGUSER</code>. (Другие переменные среды описаны в <a class="xref" href="libpq-envars.html" title="34.15. Переменные окружения">Разделе 34.15</a>.) Также удобно иметь файл <code class="filename">~/.pgpass</code>, чтобы не вводить пароли снова и снова. За дополнительными сведениями обратитесь к <a class="xref" href="libpq-pgpass.html" title="34.16. Файл паролей">Разделу 34.16</a>.</p><p>Альтернативный вариант указания параметров подключения — использование строки <em class="parameter"><code>conninfo</code></em> или <acronym class="acronym">URI</acronym> вместо имени базы данных. Этот механизм даёт широкие возможности для управления соединением. Например: </p><pre class="programlisting">$ <strong class="userinput"><code>psql "service=myservice sslmode=require"</code></strong>
$ <strong class="userinput"><code>psql postgresql://dbmaster:5433/mydb?sslmode=require</code></strong></pre><p> Этот способ также позволяет использовать <acronym class="acronym">LDAP</acronym> для получения параметров подключения, как описано в <a class="xref" href="libpq-ldap.html" title="34.18. Получение параметров соединения через LDAP">Разделе 34.18</a>. Более полно все имеющиеся параметры соединения описаны в <a class="xref" href="libpq-connect.html#LIBPQ-PARAMKEYWORDS" title="34.1.2. Ключевые слова-параметры">Подразделе 34.1.2</a>.</p><p>Если соединение не может быть установлено по любой причине (например, нет прав, сервер не работает и т. д.), <span class="application">psql</span> вернёт ошибку и прекратит работу.</p><p>Если и стандартный ввод, и стандартный вывод являются терминалом, то <span class="application">psql</span> установит кодировку клиента в <span class="quote">«<span class="quote">auto</span>»</span>, и подходящая клиентская кодировка будет определяться из локальных установок (переменная окружения <code class="envar">LC_CTYPE</code> в Unix). Если это работает не так, как ожидалось, кодировку клиента можно изменить, установив переменную окружения <code class="envar">PGCLIENTENCODING</code>.</p></div><div class="refsect2" id="R2-APP-PSQL-4"><h3>Ввод SQL-команд</h3><p>Как правило, приглашение <span class="application">psql</span> состоит из имени базы данных, к которой <span class="application">psql</span> в данный момент подключён, а затем строки <code class="literal">=&gt;</code>. Например: </p><pre class="programlisting">$ <strong class="userinput"><code>psql testdb</code></strong>
psql (16.3)
Type "help" for help.

testdb=&gt;</pre><p>В командной строке пользователь может вводить команды <acronym class="acronym">SQL</acronym>. Обычно введённые строки отправляются на сервер, когда встречается точка с запятой, завершающая команду. Конец строки не завершает команду. Это позволяет разбивать команды на несколько строк для лучшего понимания. Если команда была отправлена и выполнена без ошибок, то результат команды выводится на экран.</p><p>Если к базе данных, которая не приведена в соответствие <a class="link" href="ddl-schemas.html#DDL-SCHEMAS-PATTERNS" title="5.9.6. Шаблоны использования">шаблону безопасного использования схем</a>, имеют доступ недоверенные пользователи, начинайте сеанс с удаления доступных им для записи схем из пути поиска (<code class="varname">search_path</code>). Для этого можно добавить <code class="literal">options=-csearch_path=</code> в строку подключения или выполнить команду <code class="literal">SELECT pg_catalog.set_config('search_path', '', false)</code> перед другими командами SQL. Это касается не только <span class="application">psql</span>, но и любых других интерфейсов для выполнения произвольных SQL-команд.</p><p>При каждом выполнении команды <span class="application">psql</span> также проверяет асинхронные уведомления о событиях, генерируемые командами <a class="link" href="sql-listen.html" title="LISTEN"><code class="command">LISTEN</code></a> и <a class="link" href="sql-notify.html" title="NOTIFY"><code class="command">NOTIFY</code></a>.</p><p>Комментарии в стиле C передаются для обработки на сервер, в то время как комментарии в стандарте SQL <span class="application">psql</span> удаляет перед отправкой.</p></div><div class="refsect2" id="APP-PSQL-META-COMMANDS"><h3>Метакоманды</h3><p>Всё, что вводится в <span class="application">psql</span> не взятое в кавычки и начинающееся с обратной косой черты, является метакомандой <span class="application">psql</span> и обрабатывается самим <span class="application">psql</span>. Эти команды делают <span class="application">psql</span> полезным для задач администрирования и разработки скриптов.</p><p>Формат команды <span class="application">psql</span> следующий: обратная косая черта, сразу за ней команда, затем аргументы. Аргументы отделяются от команды и друг от друга любым количеством пробелов.</p><p>Чтобы включить пробел в значение аргумента, нужно заключить его в одинарные кавычки. Чтобы включить одинарную кавычку в значение аргумента, нужно написать две одинарные кавычки внутри текста в одинарных кавычках. Всё, что содержится в одинарных кавычках подлежит заменам, принятым в языке C: <code class="literal">\n</code> (новая строка), <code class="literal">\t</code> (табуляция), <code class="literal">\b</code> (backspace), <code class="literal">\r</code> (возврат каретки), <code class="literal">\f</code> (подача страницы), <code class="literal">\</code><em class="replaceable"><code>цифры</code></em> (восьмеричное число), и <code class="literal">\x</code><em class="replaceable"><code>цифры</code></em> (шестнадцатеричное число). Если внутри текста в одинарных кавычках встречается обратная косая перед любым другим символом, то она экранирует этот символ.</p><p>Если внутри аргумента не в кавычках встречается имя переменной <span class="application">psql</span> с предшествующим двоеточием (<code class="literal">:</code>), оно заменяется значением переменной, как описано в разделе <a class="xref" href="app-psql.html#APP-PSQL-INTERPOLATION" title="Интерполяция SQL">Интерполяция SQL</a> ниже. Также будут работать описанные там формы <code class="literal">:'<em class="replaceable"><code>имя_переменной</code></em>'</code> и <code class="literal">:"<em class="replaceable"><code>имя_переменной</code></em>"</code>. Конструкция <code class="literal">:{?<em class="replaceable"><code>имя_переменной</code></em>}</code> позволяет проверить, определена ли переменная. Она заменяется значением TRUE или FALSE. Экранирование обратной косой чертой защищает двоеточие от замены.</p><p>Текст аргумента, заключённый в обратные кавычки (<code class="literal">`</code>), считается командной строкой, которая передаётся в командную оболочку ОС. Вывод от этой команды (с удалёнными в конце символами новой строки) заменяет текст в обратных кавычках. В содержимом этого текста не обрабатываются никакие спецпоследовательности или особые знаки, за исключением того, что все вхождения <code class="literal">:<em class="replaceable"><code>имя_переменной</code></em></code>, где <em class="replaceable"><code>имя_переменной</code></em> — это имя переменной <span class="application">psql</span>, заменяются значением этой переменной. Также вхождения <code class="literal">:'<em class="replaceable"><code>имя_переменной</code></em>'</code> заменяются значением переменной, заключённым в апострофы с тем, что это было одним аргументом команды оболочки. (Последняя форма почти всегда более предпочтительна, если только вы не абсолютно точно знаете, чего ожидать в переменной.) Так как символы перевода строки и возврата каретки могут быть надёжно экранированы не на всех платформах, форма <code class="literal">:'<em class="replaceable"><code>имя_переменной</code></em>'</code> выводит сообщение об ошибке и подстановка значения переменной не производится, когда это значение содержит такие символы.</p><p>Некоторые команды принимают идентификатор <acronym class="acronym">SQL</acronym> (например, имя таблицы) в качестве аргумента. Такие аргументы следуют правилам синтаксиса <acronym class="acronym">SQL</acronym>: буквы, не взятые в кавычки, преобразуются в нижний регистр, буквы, взятые в двойные кавычки (<code class="literal">"</code>) предотвращают преобразование регистра и позволяют включать пробелы в идентификатор. Внутри двойных кавычек две двойные кавычки сокращаются до одной. Например, <code class="literal">FOO"BAR"BAZ</code> интерпретируется как <code class="literal">fooBARbaz</code>, а <code class="literal">"A weird"" name"</code> становится <code class="literal">A weird" name</code>.</p><p>Разбор аргументов останавливается в конце строки или когда встречается другая обратная косая черта, не внутри кавычек. Обратная косая не внутри кавычек рассматривается как начало новой метакоманды. Специальная последовательность <code class="literal">\\</code> (две обратных косых черты) обозначает окончание аргументов, далее продолжается разбор команд <acronym class="acronym">SQL</acronym>, если таковые имеются. Таким образом, команды <acronym class="acronym">SQL</acronym> и <span class="application">psql</span> можно свободно смешивать в одной строке. Но в любом случае аргументы метакоманды не могут выходить за пределы текущей строки.</p><p>Многие из метакоманд оперируют с <em class="firstterm">буфером текущего запроса</em>. Этот буфер содержит произвольный текст команд SQL, который был введён, но ещё не отправлен серверу для выполнения. В него будут входить и предыдущие строки, а также текст, расположенный в строке метакоманды перед ней.</p><p>Определены следующие метакоманды: </p><div class="variablelist"><dl class="variablelist"><dt id="APP-PSQL-META-COMMAND-A"><span class="term"><code class="literal">\a</code></span> <a href="#APP-PSQL-META-COMMAND-A" class="id_link">#</a></dt><dd><p>Если текущий режим вывода таблицы невыровненный, то он переключается на выровненный режим. Если текущий режим выровненный, то устанавливается невыровненный. Эта команда поддерживается для обратной совместимости. См. <code class="command">\pset</code> для более общего решения.</p></dd><dt id="APP-PSQL-META-COMMAND-BIND"><span class="term"><code class="literal">\bind</code> [ <em class="replaceable"><code>параметр</code></em> ] ...</span> <a href="#APP-PSQL-META-COMMAND-BIND" class="id_link">#</a></dt><dd><p>Задаёт значения параметров для следующего выполнения запроса, передаваемые в качестве местозаполнителей (<code class="literal">$1</code> и т. д.).</p><p>Пример: </p><pre class="programlisting">INSERT INTO tbl1 VALUES ($1, $2) \bind 'first value' 'second value' \g</pre><p>Эта метакоманда работает не только с <code class="literal">\g</code>, но и с другими командами выполнения запросов, например <code class="literal">\gx</code> и <code class="literal">\gset</code>.</p><p>С этой командой используется не простой протокол запросов, как в ходе обычной работы <span class="application">psql</span>, а расширенный протокол (см. <a class="xref" href="protocol-overview.html#PROTOCOL-QUERY-CONCEPTS" title="55.1.2. Обзор расширенного выполнения запросов">Подраздел 55.1.2</a>). Поэтому эту команду можно использовать для тестирования расширенного протокола запросов из <span class="application">psql</span>. (Расширенный протокол используется даже для запросов без параметров, и когда в этой команде параметры не передаются.) Команда влияет только на следующий выполняемый запрос, а дальнейшие запросы по умолчанию будут передаваться по простому протоколу.</p></dd><dt id="APP-PSQL-META-COMMAND-C-LC"><span class="term"><code class="literal">\c</code> или <code class="literal">\connect [ -reuse-previous=<em class="replaceable"><code>on|off</code></em> ] [ <em class="replaceable"><code>имя_бд</code></em> [ <em class="replaceable"><code>имя_пользователя</code></em> ] [ <em class="replaceable"><code>компьютер</code></em> ] [ <em class="replaceable"><code>порт</code></em> ] | <em class="replaceable"><code>строка_подключения</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-C-LC" class="id_link">#</a></dt><dd><p>Устанавливает новое подключение к серверу <span class="productname">PostgreSQL</span>. Параметры подключения можно указывать как позиционно (один или несколько по списку: база данных, пользователь, компьютер и порт), так и передавая аргумент <em class="replaceable"><code>строка_подключения</code></em> (подробнее о строках подключения рассказывается в <a class="xref" href="libpq-connect.html#LIBPQ-CONNSTRING" title="34.1.1. Строки параметров подключения">Подразделе 34.1.1</a>). Если аргументы отсутствуют, новое подключение устанавливается с теми же параметрами, что и предыдущее.</p><p>Указание в параметре <em class="replaceable"><code>имя_бд</code></em>, <em class="replaceable"><code>имя_пользователя</code></em>, <em class="replaceable"><code>компьютер</code></em> или <em class="replaceable"><code>порт</code></em> значения <code class="literal">-</code> равносильно опущению этого параметра.</p><p>Новое подключение может повторно использовать параметры предыдущего — не только имя базы данных, пользователя, компьютер и порт, но и, например, <em class="replaceable"><code>режим_ssl</code></em>. По умолчанию параметры используются повторно при позиционной записи, но не когда задана <em class="replaceable"><code>строка_подключения</code></em>. Это поведение может переопределяться первым аргументом, <code class="literal">-reuse-previous=on</code> или <code class="literal">-reuse-previous=off</code>. В случае повторного использования параметров любой параметр, явно не заданный в виде позиционного или в <em class="replaceable"><code>строке_подключения</code></em>, заимствуется из параметров текущего подключения. Исключение составляет параметр <em class="replaceable"><code>hostaddr</code></em> — если он был задан в предыдущем подключении, а в новом в позиционной записи задаётся другое значение <em class="replaceable"><code>host</code></em>, значение <em class="replaceable"><code>hostaddr</code></em> сбрасывается. Кроме того, пароль существующего подключения будет использоваться повторно, только если имя пользователя, узел и порт не меняются. Если какой-либо параметр не указан в этой команде и не используется повторно, действует принятое в <span class="application">libpq</span> значение по умолчанию.</p><p>Если новое подключение успешно установлено, предыдущее подключение закрывается. Если попытка подключения не удалась (неверное имя пользователя, доступ запрещён и т. д.), то предыдущее соединение останется активным, если <span class="application">psql</span> находится в интерактивном режиме. Но если скрипт выполняется неинтерактивно, предыдущее соединение закрывается и выдаётся ошибка. При этом скрипт может завершиться или не завершиться; в последнем случае все команды, обращающиеся к базе данных, будут неуспешными, пока не будет успешно выполнена ещё одна команда <code class="literal">\connect</code>. Различное поведение выбрано для удобства пользователя в качестве защиты от опечаток с одной стороны и в качестве меры безопасности, не позволяющей случайно запустить скрипты в неправильной базе, с другой. Заметьте, что когда команда <code class="literal">\connect</code> пытается повторно использовать параметры, она использует параметры последнего удачного подключения, а не какой-либо из последующих неудачных попыток. Однако в случае неудачи при неинтерактивном выполнении команды <code class="literal">\connect</code> никакие параметры не будут использоваться впоследствии, так как скрипт, скорее всего, рассчитывает на то, что должны повторно использоваться параметры именно этой команды <code class="literal">\connect</code>, а она не была успешной.</p><p>Примеры:</p><pre class="programlisting">=&gt; \c mydb myuser host.dom 6432
=&gt; \c service=foo
=&gt; \c "host=localhost port=5432 dbname=mydb connect_timeout=10 sslmode=disable"
=&gt; \c -reuse-previous=on sslmode=require    -- меняется только sslmode
=&gt; \c postgresql://tom@localhost/mydb?application_name=myapp</pre></dd><dt id="APP-PSQL-META-COMMAND-C-UC"><span class="term"><code class="literal">\C [ <em class="replaceable"><code>заголовок</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-C-UC" class="id_link">#</a></dt><dd><p>Задаёт заголовок, который будет выводиться для результатов любых запросов или отменяет установленный ранее заголовок. Эта команда эквивалентна <code class="literal">\pset title <em class="replaceable"><code>заголовок</code></em></code>. (Название этой команды происходит от <span class="quote">«<span class="quote">caption</span>»</span> (заголовок), так как изначально она применялась только для задания заголовков <acronym class="acronym">HTML</acronym>-таблиц.)</p></dd><dt id="APP-PSQL-META-COMMAND-CD"><span class="term"><code class="literal">\cd [ <em class="replaceable"><code>каталог</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-CD" class="id_link">#</a></dt><dd><p>Сменяет текущий рабочий каталог на <em class="replaceable"><code>каталог</code></em>. Без аргумента устанавливается домашний каталог текущего пользователя.</p><div class="tip"><h3 class="title">Подсказка</h3><p>для печати текущего рабочего каталога используйте <code class="literal">\! pwd</code>.</p></div></dd><dt id="APP-PSQL-META-COMMAND-CONNINFO"><span class="term"><code class="literal">\conninfo</code></span> <a href="#APP-PSQL-META-COMMAND-CONNINFO" class="id_link">#</a></dt><dd><p>Выводит информацию о текущем подключении к базе данных.</p></dd><dt id="APP-PSQL-META-COMMANDS-COPY"><span class="term"><code class="literal">\copy { <em class="replaceable"><code>таблица</code></em> [ ( <em class="replaceable"><code>список_столбцов</code></em> ) ] } <code class="literal">from</code> { <em class="replaceable"><code>'имя_файла'</code></em> | program <em class="replaceable"><code>'команда'</code></em> | stdin | pstdin } [ [ with ] ( <em class="replaceable"><code>параметр</code></em> [, ...] ) ] [ where <em class="replaceable"><code>условие</code></em> ]</code><br /></span><span class="term"><code class="literal">\copy { <em class="replaceable"><code>таблица</code></em> [ ( <em class="replaceable"><code>список_столбцов</code></em> ) ] | ( <em class="replaceable"><code>запрос</code></em> ) } <code class="literal">to</code> { <em class="replaceable"><code>'имя_файла'</code></em> | program <em class="replaceable"><code>'команда'</code></em> | stdout | pstdout } [ [ with ] ( <em class="replaceable"><code>параметр</code></em> [, ...] ) ]</code></span> <a href="#APP-PSQL-META-COMMANDS-COPY" class="id_link">#</a></dt><dd><p>Производит копирование данных с участием клиента. При этом выполняется <acronym class="acronym">SQL</acronym>-команда <a class="link" href="sql-copy.html" title="COPY"><code class="command">COPY</code></a>, но вместо чтения или записи в файл на сервере, <span class="application">psql</span> читает или записывает файл и пересылает данные между сервером и локальной файловой системой. Это означает, что для доступа к файлам используются привилегии локального пользователя, а не сервера, и не требуются привилегии суперпользователя SQL.</p><p>С указанием <code class="literal">program</code> <span class="application">psql</span> выполняет <em class="replaceable"><code>команду</code></em> и данные, поступающие из/в неё, передаются между сервером и клиентом. Это опять же означает, что для выполнения программ используются привилегии локального пользователя, а не сервера, и не требуются привилегии суперпользователя SQL.</p><p>При выполнении <code class="literal">\copy ... from stdin</code> строки с данными считываются из источника, выполнившего команду, и считываются до тех пор, пока не встретится <code class="literal">\.</code> или не будет достигнут конец файла. Этот параметр полезен для заполнения таблиц прямо в SQL-скриптах. При выполнении <code class="literal">\copy ... to stdout</code> вывод направляется в то же место, что и вывод <span class="application">psql</span> команд. Статус команды <code class="literal">COPY <em class="replaceable"><code>count</code></em></code> не отображается, чтобы не перепутать со строкой данных. Для чтения/записи стандартного ввода/вывода <span class="application">psql</span>, вне зависимости от источника текущей команды или параметра <code class="literal">\o</code>, используйте <code class="literal">from pstdin</code> или <code class="literal">to pstdout</code>.</p><p>Синтаксис команды похож на синтаксис <acronym class="acronym">SQL</acronym>-команды <a class="link" href="sql-copy.html" title="COPY"><code class="command">COPY</code></a>. Все параметры, кроме источника и получателя данных, задаются так же, как и в <code class="command">COPY</code>. Поэтому при обработке метакоманды <code class="command">\copy</code> применяются другие правила разбора. В отличие от большинства других метакоманд, для неё остаток строки всегда воспринимается как аргументы <code class="command">\copy</code>, и в этих аргументах не выполняется ни подстановка переменных, ни раскрытие обратных кавычек.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Альтернативный способ получить тот же результат, что и с <code class="literal">\copy ... to</code> — использовать <acronym class="acronym">SQL</acronym>-команду <code class="literal">COPY ... TO STDOUT</code> и завершить её командой <code class="literal">\g <em class="replaceable"><code>имя</code></em></code> или <code class="literal">\g |<em class="replaceable"><code>программа</code></em></code>. В отличие от <code class="literal">\copy</code>, этот подход позволяет разбивать команду на несколько строк, а также использовать интерполяцию переменных и раскрытие обратных кавычек (<code class="literal">`</code>).</p></div><div class="tip"><h3 class="title">Подсказка</h3><p>Эти операции не так эффективны, как <acronym class="acronym">SQL</acronym>-команда <code class="command">COPY</code>, в которой источником или получателем данных является файл или программа, потому что все данные перемещаются между клиентом и сервером. Для больших объёмов данных <acronym class="acronym">SQL</acronym>-команда может быть предпочтительнее. Кроме того, из-за этого метода сквозной передачи <code class="literal">\copy ... from</code> в режиме <acronym class="acronym">CSV</acronym> ошибочно обрабатывает единственное в строке значение данных <code class="literal">\.</code> в качестве маркера конца ввода.</p></div></dd><dt id="APP-PSQL-META-COMMAND-COPYRIGHT"><span class="term"><code class="literal">\copyright</code></span> <a href="#APP-PSQL-META-COMMAND-COPYRIGHT" class="id_link">#</a></dt><dd><p>Показывает информацию об авторских правах и условиях распространения <span class="productname">PostgreSQL</span>.</p></dd><dt id="APP-PSQL-META-COMMANDS-CROSSTABVIEW"><span class="term"><code class="literal">\crosstabview [ <em class="replaceable"><code>столбВ</code></em> [ <em class="replaceable"><code>столбГ</code></em> [ <em class="replaceable"><code>столбТ</code></em> [ <em class="replaceable"><code>столбсортГ</code></em> ] ] ] ]</code></span> <a href="#APP-PSQL-META-COMMANDS-CROSSTABVIEW" class="id_link">#</a></dt><dd><p>Выполняет содержимое буфера текущего запроса (как <code class="literal">\g</code>) и показывает результат в виде перекрёстной таблицы. Заданный запрос должен возвращать минимум три столбца. Столбец результата, заданный параметром <em class="replaceable"><code>столбВ</code></em>, будет образовывать вертикальные заголовки, а столбец, заданный параметром <em class="replaceable"><code>столбГ</code></em>, — горизонтальные. Заданный параметром <em class="replaceable"><code>столбТ</code></em> столбец будет поставлять данные для отображения внутри таблицы. Столбец, выбранный параметром <em class="replaceable"><code>столбсортГ</code></em>, будет необязательным столбцом сортировки горизонтальных заголовков.</p><p>Каждое указание столбца может представлять собой имя или номер столбца (начиная с 1). К именам применяются обычные принятые в SQL правила учёта регистра и кавычек. По умолчанию в качестве <em class="replaceable"><code>столбВ</code></em> подразумевается столбец 1, а в качестве <em class="replaceable"><code>столбГ</code></em> — столбец 2. Если <em class="replaceable"><code>столбВ</code></em> и <em class="replaceable"><code>столбГ</code></em> задаются явно, они должны различаться. Если <em class="replaceable"><code>столбТ</code></em> не задан, в результате запроса должно быть ровно три столбца, и в качестве <em class="replaceable"><code>столбТ</code></em> выбирается столбец, отличный от <em class="replaceable"><code>столбВ</code></em> и <em class="replaceable"><code>столбГ</code></em>.</p><p>Вертикальный заголовок, выводимый в самом левом столбце, содержит значения из столбца <em class="replaceable"><code>столбВ</code></em>, в том же порядке, в каком их возвращает запрос, но без дубликатов.</p><p>Горизонтальный заголовок, выводимый в первой строке, содержит значения из столбца <em class="replaceable"><code>столбГ</code></em>, без дубликатов. По умолчанию они располагаются в том порядке, в каком их возвращает запрос. Но если задан необязательный аргумент <em class="replaceable"><code>столбсортГ</code></em>, он определяет столбец, который должен содержать целые числа, и тогда значения из <em class="replaceable"><code>столбГ</code></em> будут располагаться в горизонтальном заголовке по порядку значений в <em class="replaceable"><code>столбсортГ</code></em>.</p><p>Внутри перекрёстной таблицы для каждого уникального значения <code class="literal">x</code> в <em class="replaceable"><code>столбГ</code></em> и каждого уникального значения <code class="literal">y</code> в <em class="replaceable"><code>столбВ</code></em>, ячейка, размещённая на пересечении <code class="literal">(x,y)</code> содержит значение <code class="literal">столбТ</code> в строке результата запроса, в которой значение <em class="replaceable"><code>столбГ</code></em> равно <code class="literal">x</code>, а значение <em class="replaceable"><code>столбВ</code></em> — <code class="literal">y</code>. Если такой строки не находится, ячейка остаётся пустой. Если же находится несколько таких строк, выдаётся ошибка.</p></dd><dt id="APP-PSQL-META-COMMAND-D"><span class="term"><code class="literal">\d[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-D" class="id_link">#</a></dt><dd><p>Для каждого отношения (таблицы, представления, материализованного представления, индекса, последовательности, внешней таблицы) или составного типа, соответствующих <em class="replaceable"><code>шаблону</code></em>, показывает все столбцы, их типы, табличное пространство (если оно изменено) и любые специальные атрибуты, такие как <code class="literal">NOT NULL</code> или значения по умолчанию. Также показываются связанные индексы, ограничения, правила и триггеры. Для сторонних таблиц также показывается связанный сторонний сервер. (<span class="quote">«<span class="quote">Соответствие шаблону</span>»</span> определяется ниже в <a class="xref" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска">Шаблоны поиска</a>.)</p><p>Для некоторых типов отношений <code class="literal">\d</code> показывает дополнительную информацию по каждому столбцу: значения столбца для последовательностей, индексируемые выражения для индексов и параметры обёртки сторонних данных для сторонних таблиц.</p><p>Вариант команды <code class="literal">\d+</code> похож на <code class="literal">\d</code>, но выводит больше информации: комментарии к столбцам таблицы, наличие в таблице OID, свойство <a class="link" href="sql-altertable.html#SQL-ALTERTABLE-REPLICA-IDENTITY">replica identity</a>, если оно было изменено, имя <a class="link" href="sql-create-access-method.html" title="CREATE ACCESS METHOD">метода доступа</a>, если для отношения определён метод доступа, а для представления показывается его определение.</p><p>По умолчанию отображаются только объекты, созданные пользователем. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>Если <code class="command">\d</code> используется без аргумента <em class="replaceable"><code>шаблон</code></em>, эта команда удобства ради воспринимается как <code class="command">\dtvmsE</code> и выдаёт список всех видимых таблиц, представлений, мат. представлений, последовательностей и сторонних таблиц.</p></div></dd><dt id="APP-PSQL-META-COMMAND-DA-LC"><span class="term"><code class="literal">\da[S] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DA-LC" class="id_link">#</a></dt><dd><p>Выводит список агрегатных функций вместе с типом возвращаемого значения и типами данных, которыми они оперируют. Если указан <em class="replaceable"><code>шаблон</code></em>, показываются только те агрегатные функции, имена которых соответствуют ему. По умолчанию показываются только объекты, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-DA-UC"><span class="term"><code class="literal">\dA[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DA-UC" class="id_link">#</a></dt><dd><p>Выводит список методов доступа. Если указан <em class="replaceable"><code>шаблон</code></em>, показываются только те методы доступа, имена которых соответствуют ему. При добавлении <code class="literal">+</code> к команде для каждого метода доступа показывается его описание и связанная функция-обработчик.</p></dd><dt id="APP-PSQL-META-COMMAND-DAC"><span class="term">
          <code class="literal">\dAc[+] [<a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон-методов-доступа</code></em></a> [<a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон-входных-типов</code></em></a>]]</code>
        </span> <a href="#APP-PSQL-META-COMMAND-DAC" class="id_link">#</a></dt><dd><p>Выводит список классов операторов (см. <a class="xref" href="xindex.html#XINDEX-OPCLASS" title="38.16.1. Методы индексов и классы операторов">Подраздел 38.16.1</a>). Если указан <em class="replaceable"><code>шаблон-методов-доступа</code></em>, показываются только классы, имена которых соответствует ему. Если указан <em class="replaceable"><code>шаблон-входных-типов</code></em>, показываются только классы операторов, связанные с входными типами, имена которых соответствуют шаблону. При добавлении <code class="literal">+</code> к команде для каждого класса операторов дополнительно будет выводиться его владелец и связанное с ним семейство операторов.</p></dd><dt id="APP-PSQL-META-COMMAND-DAF"><span class="term">
          <code class="literal">\dAf[+] [<a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон-методов-доступа</code></em></a> [<a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон-входных-типов</code></em></a>]]</code>
        </span> <a href="#APP-PSQL-META-COMMAND-DAF" class="id_link">#</a></dt><dd><p>Выводит список семейств операторов (см. <a class="xref" href="xindex.html#XINDEX-OPFAMILY" title="38.16.5. Семейства и классы операторов">Подраздел 38.16.5</a>). Если указан <em class="replaceable"><code>шаблон-методов-доступа</code></em>, показываются только семейства операторов, связанные с методами доступа, имена которых соответствуют шаблону. Если указан <em class="replaceable"><code>шаблон-входных-типов</code></em>, показываются только семейства операторов, связанные с входными типами, имена которых соответствуют шаблону. При добавлении <code class="literal">+</code> к команде для каждого семейства операторов дополнительно будет выводиться его владелец.</p></dd><dt id="APP-PSQL-META-COMMAND-DAO"><span class="term">
          <code class="literal">\dAo[+] [<a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон-методов-доступа</code></em></a> [<a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон-семейств-операторов</code></em></a>]]</code>
        </span> <a href="#APP-PSQL-META-COMMAND-DAO" class="id_link">#</a></dt><dd><p>Выводит список операторов, связанных с семействами операторов (см. <a class="xref" href="xindex.html#XINDEX-STRATEGIES" title="38.16.2. Стратегии методов индексов">Подраздел 38.16.2</a>). Если указан <em class="replaceable"><code>шаблон-методов-доступа</code></em>, показываются только те члены семейств операторов, которые связаны с методами доступа с соответствующими шаблону именами. Если указан <em class="replaceable"><code>шаблон-семейства-операторов</code></em>, показываются только члены тех семейств, имена которых соответствуют ему. При добавлении <code class="literal">+</code> к команде для каждого оператора дополнительно будет выводиться его семейство сортировки (если это оператор упорядочивания).</p></dd><dt id="APP-PSQL-META-COMMAND-DAP"><span class="term">
          <code class="literal">\dAp[+] [<a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон-методов-доступа</code></em></a> [<a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон-семейств-операторов</code></em></a>]]</code>
        </span> <a href="#APP-PSQL-META-COMMAND-DAP" class="id_link">#</a></dt><dd><p>Выводит список опорных функций, связанных с семействами операторов (см. <a class="xref" href="xindex.html#XINDEX-SUPPORT" title="38.16.3. Опорные процедуры метода индекса">Подраздел 38.16.3</a>). Если указан <em class="replaceable"><code>шаблон-методов-доступа</code></em>, показываются только те функции семейств операторов, которые связаны с методами доступа с соответствующими шаблону именами. Если указан <em class="replaceable"><code>шаблон-семейства-операторов</code></em>, показываются только функции семейств, имена которых соответствуют ему. При добавлении <code class="literal">+</code> к команде функции выводятся в развёрнутом виде, со списками фактических параметров.</p></dd><dt id="APP-PSQL-META-COMMAND-DB"><span class="term"><code class="literal">\db[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DB" class="id_link">#</a></dt><dd><p>Выводит список табличных пространств. Если указан <em class="replaceable"><code>шаблон</code></em>, показываются только те табличные пространства, имена которых соответствуют ему. При добавлении <code class="literal">+</code> к команде для каждого объекта дополнительно выводятся параметры, объём на диске, права доступа и описание.</p></dd><dt id="APP-PSQL-META-COMMAND-DC-LC"><span class="term"><code class="literal">\dc[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DC-LC" class="id_link">#</a></dt><dd><p>Выводит список преобразований между кодировками наборов символов. Если указан <em class="replaceable"><code>шаблон</code></em>, показываются только те преобразования кодировок, имена которых соответствуют ему. По умолчанию показываются только объекты, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>. При добавлении <code class="literal">+</code> к команде для каждого объекта дополнительно будет выводиться описание.</p></dd><dt id="APP-PSQL-META-COMMAND-DCONFIG"><span class="term"><code class="literal">\dconfig[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DCONFIG" class="id_link">#</a></dt><dd><p>Выводит список параметров конфигурации сервера и их значений. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те параметры, имена которых соответствуют ему. Без <em class="replaceable"><code>шаблона</code></em> выводятся только те параметры, для которых заданы значения, отличные от значений по умолчанию. (Чтобы увидеть все параметры, введите <code class="literal">\dconfig *</code>.) При добавлении <code class="literal">+</code> к команде каждый параметр отображается с типом данных, контекстом, в котором параметр может быть установлен, и правами доступа (если они отличаются от прав доступа по умолчанию).</p></dd><dt id="APP-PSQL-META-COMMAND-DC-UC"><span class="term"><code class="literal">\dC[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DC-UC" class="id_link">#</a></dt><dd><p>Выводит список приведений типов. Если указан <em class="replaceable"><code>шаблон</code></em>, показываются только те приведения типов, имена которых соответствуют ему. При добавлении <code class="literal">+</code> к команде для каждого объекта дополнительно будет выводиться описание.</p></dd><dt id="APP-PSQL-META-COMMAND-DD-LC"><span class="term"><code class="literal">\dd[S] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DD-LC" class="id_link">#</a></dt><dd><p>Показывает описания объектов следующих видов: <code class="literal">ограничение</code>, <code class="literal">класс операторов</code>, <code class="literal">семейство операторов</code>, <code class="literal">правило</code> и <code class="literal">триггер</code>. Описания остальных объектов можно посмотреть соответствующими метакомандами для этих типов объектов.</p><p><code class="literal">\dd</code> показывает описания для объектов, соответствующих <em class="replaceable"><code>шаблону</code></em>, или для доступных объектов указанных типов, если аргументы не заданы. Но в любом случае выводятся только те объекты, которые имеют описание. По умолчанию показываются только объекты, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>.</p><p>Описания объектов создаются <acronym class="acronym">SQL</acronym>-командой <a class="link" href="sql-comment.html" title="COMMENT"><code class="command">COMMENT</code></a>.</p></dd><dt id="APP-PSQL-META-COMMAND-DD-UC"><span class="term"><code class="literal">\dD[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DD-UC" class="id_link">#</a></dt><dd><p>Выводит список доменов. Если указан <em class="replaceable"><code>шаблон</code></em>, показываются только те домены, имена которых соответствуют ему. По умолчанию показываются только объекты, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>. При добавлении <code class="literal">+</code> к команде для каждого объекта дополнительно будут выводиться права доступа и описание.</p></dd><dt id="APP-PSQL-META-COMMAND-DDP"><span class="term"><code class="literal">\ddp [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DDP" class="id_link">#</a></dt><dd><p>Выводит список прав доступа по умолчанию. Выводится строка для каждой роли (и схемы, если применимо), для которой права доступа по умолчанию отличаются от встроенных. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся строки только для тех ролей и схем, имена которых соответствуют ему.</p><p>Права доступа по умолчанию устанавливаются командой <a class="link" href="sql-alterdefaultprivileges.html" title="ALTER DEFAULT PRIVILEGES"><code class="command">ALTER DEFAULT PRIVILEGES</code></a>. Смысл отображаемых прав объясняется в <a class="xref" href="ddl-priv.html" title="5.7. Права">Разделе 5.7</a>.</p></dd><dt id="APP-PSQL-META-COMMAND-DE"><span class="term"><code class="literal">\dE[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code><br /></span><span class="term"><code class="literal">\di[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code><br /></span><span class="term"><code class="literal">\dm[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code><br /></span><span class="term"><code class="literal">\ds[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code><br /></span><span class="term"><code class="literal">\dt[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code><br /></span><span class="term"><code class="literal">\dv[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DE" class="id_link">#</a></dt><dd><p>В этой группе команд буквы <code class="literal">E</code>, <code class="literal">i</code>, <code class="literal">m</code>, <code class="literal">s</code>, <code class="literal">t</code> и <code class="literal">v</code> обозначают соответственно: внешнюю таблицу, индекс, материализованное представление, последовательность, таблицу и представление. Можно указывать все или часть этих букв, в произвольном порядке, чтобы получить список объектов этих типов. Например, <code class="literal">\dit</code> выводит список таблиц и индексов. При добавлении <code class="literal">+</code> к имени команды для каждого объекта дополнительно будут выводиться состояние хранения (постоянный, временный, нежурналируемый), физический размер на диске и описание, при наличии. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только объекты, имена которых соответствуют ему. По умолчанию показываются только объекты, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-DES"><span class="term"><code class="literal">\des[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DES" class="id_link">#</a></dt><dd><p>Выводит список сторонних серверов (мнемоника: <span class="quote">«<span class="quote">external servers</span>»</span>). Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те серверы, имена которых соответствуют ему. Если используется форма <code class="literal">\des+</code>, то выводится полное описание каждого сервера, включая права доступа, тип, версию, параметры и описание.</p></dd><dt id="APP-PSQL-META-COMMAND-DET"><span class="term"><code class="literal">\det[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DET" class="id_link">#</a></dt><dd><p>Выводит список сторонних таблиц (мнемоника: <span class="quote">«<span class="quote">external tables</span>»</span>). Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те записи, имя таблицы или схемы которых соответствуют ему. Если используется форма <code class="literal">\det+</code>, то дополнительно выводятся общие параметры и описание сторонней таблицы.</p></dd><dt id="APP-PSQL-META-COMMAND-DEU"><span class="term"><code class="literal">\deu[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DEU" class="id_link">#</a></dt><dd><p>Выводит список сопоставлений пользователей (мнемоника: <span class="quote">«<span class="quote">external users</span>»</span>). Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только сопоставления, в которых имена пользователей соответствуют ему. Если используется форма <code class="literal">\deu+</code>, то выводится дополнительная информация о каждом сопоставлении пользователей.</p><div class="caution"><h3 class="title">Внимание</h3><p><code class="literal">\deu+</code> также может отображать имя и пароль удалённого пользователя, поэтому следует позаботиться о том, чтобы не раскрывать их.</p></div></dd><dt id="APP-PSQL-META-COMMAND-DEW"><span class="term"><code class="literal">\dew[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DEW" class="id_link">#</a></dt><dd><p>Выводит список обёрток сторонних данных (мнемоника: <span class="quote">«<span class="quote">external wrappers</span>»</span>). Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те обёртки сторонних данных, имена которых соответствуют ему. Если используется форма <code class="literal">\dew+</code>, то дополнительно выводятся права доступа, параметры и описание обёртки.</p></dd><dt id="APP-PSQL-META-COMMAND-DF-LC"><span class="term"><code class="literal">\df[anptwS+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> [ <em class="replaceable"><code>арг_шаблон</code></em> ... ] ]</code></span> <a href="#APP-PSQL-META-COMMAND-DF-LC" class="id_link">#</a></dt><dd><p>Выводит список функций с типами данных их результатов, аргументов и классификацией: <span class="quote">«<span class="quote">agg</span>»</span> (агрегатная), <span class="quote">«<span class="quote">normal</span>»</span>, (обычная), <span class="quote">«<span class="quote">procedure</span>»</span> (процедурная), <span class="quote">«<span class="quote">trigger</span>»</span> (триггерная) или <span class="quote">«<span class="quote">window</span>»</span> (оконная). Чтобы получить функции только определённого вида (видов), добавьте в команду соответствующие буквы <code class="literal">a</code>, <code class="literal">n</code>, <code class="literal">p</code>, <code class="literal">t</code> или <code class="literal">w</code>. Если задан <em class="replaceable"><code>шаблон</code></em>, показываются только те функции, имена которых соответствуют ему. Любые дополнительные аргументы задают шаблоны имён типов, которые сопоставляются с именами типов первого, второго и последующих аргументов функции. (У сопоставленных функций может быть больше аргументов, чем вы задали. Чтобы исключить это, запишите минус (<code class="literal">-</code>) в качестве последнего аргумента <em class="replaceable"><code>арг_шаблон</code></em>.) По умолчанию показываются только объекты, созданные пользователями; для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>. Если используется форма <code class="literal">\df+</code>, то дополнительно выводятся характеристики каждой функции: изменчивость, допустимость распараллеливания, владелец, классификация по безопасности, права доступа, язык, внутреннее имя (только для функций на C и внутренних функций) и описание. Исходный код отдельной функции можно посмотреть, воспользовавшись <code class="literal">\sf</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-DF-UC"><span class="term"><code class="literal">\dF[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DF-UC" class="id_link">#</a></dt><dd><p>Выводит список конфигураций текстового поиска. Если указан <em class="replaceable"><code>шаблон</code></em>, показываются только те конфигурации, имена которых соответствуют ему. Если используется форма <code class="literal">\dF+</code>, то выводится полное описание для каждой конфигурации, включая базовый синтаксический анализатор и используемые словари для каждого типа фрагментов.</p></dd><dt id="APP-PSQL-META-COMMAND-DFD"><span class="term"><code class="literal">\dFd[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DFD" class="id_link">#</a></dt><dd><p>Выводит список словарей текстового поиска. Если указан <em class="replaceable"><code>шаблон</code></em>, показываются только словари, имена которых соответствуют ему. Если используется форма <code class="literal">\dFd+</code>, то выводится дополнительная информация о каждом словаре, включая базовый шаблон текстового поиска и параметры инициализации.</p></dd><dt id="APP-PSQL-META-COMMAND-DFP"><span class="term"><code class="literal">\dFp[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DFP" class="id_link">#</a></dt><dd><p>Выводит список анализаторов текстового поиска. Если указан <em class="replaceable"><code>шаблон</code></em>, показываются только те анализаторы, имена которых соответствуют ему. Если используется форма <code class="literal">\dFp+</code>, то выводится полное описание для каждого анализатора, включая базовые функции и список типов фрагментов.</p></dd><dt id="APP-PSQL-META-COMMAND-DFT"><span class="term"><code class="literal">\dFt[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DFT" class="id_link">#</a></dt><dd><p>Выводит список шаблонов текстового поиска. Если указан <em class="replaceable"><code>шаблон</code></em>, показываются только шаблоны, имена которых соответствуют ему. Если используется форма <code class="literal">\dFt+</code>, то выводится дополнительная информация о каждом шаблоне, включая имена основных функций.</p></dd><dt id="APP-PSQL-META-COMMAND-DG"><span class="term"><code class="literal">\dg[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DG" class="id_link">#</a></dt><dd><p>Выводит список ролей базы данных. (Так как понятия <span class="quote">«<span class="quote">пользователи</span>»</span> и <span class="quote">«<span class="quote">группы</span>»</span> были объединены в <span class="quote">«<span class="quote">роли</span>»</span>, эта команда теперь эквивалентна <code class="literal">\du</code>.) По умолчанию выводятся только роли, созданные пользователями: чтобы увидеть и системные роли, добавьте модификатор <code class="literal">S</code>. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те роли, имена которых соответствуют ему. Если используется форма <code class="literal">\dg+</code>, то выводится дополнительная информация о каждой роли; в настоящее время это комментарий роли.</p></dd><dt id="APP-PSQL-META-COMMAND-DL-LC"><span class="term"><code class="literal">\dl[+]</code></span> <a href="#APP-PSQL-META-COMMAND-DL-LC" class="id_link">#</a></dt><dd><p>Псевдоним для <code class="command">\lo_list</code>, показывает список больших объектов. При добавлении <code class="literal">+</code> к команде для каждого большого объекта отображаются права доступа к нему, если они назначены.</p></dd><dt id="APP-PSQL-META-COMMAND-DL-UC"><span class="term"><code class="literal">\dL[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DL-UC" class="id_link">#</a></dt><dd><p>Выводит список процедурных языков. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те языки, имена которых соответствуют ему. По умолчанию показываются только языки, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>. При добавлении <code class="literal">+</code> к команде для каждого языка дополнительно будут выводиться: обработчик вызова, функция проверки, права доступа и является ли язык системным объектом.</p></dd><dt id="APP-PSQL-META-COMMAND-DN"><span class="term"><code class="literal">\dn[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DN" class="id_link">#</a></dt><dd><p>Выводит список схем (пространств имён). Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те схемы, имена которых соответствуют ему. По умолчанию показываются только объекты, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>. При добавлении <code class="literal">+</code> к команде для каждого объекта дополнительно будут выводиться права доступа и описание, при наличии.</p></dd><dt id="APP-PSQL-META-COMMAND-DO-LC"><span class="term"><code class="literal">\do[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> [ <em class="replaceable"><code>арг_шаблон</code></em> [ <em class="replaceable"><code>арг_шаблон</code></em> ] ] ]</code></span> <a href="#APP-PSQL-META-COMMAND-DO-LC" class="id_link">#</a></dt><dd><p>Выводит список операторов, их операндов и типы результата. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те операторы, имена которых соответствуют ему. Если указан один <em class="replaceable"><code>арг_шаблон</code></em>, будут выводиться только префиксные операторы, тип правого аргумента которых соответствуют этому шаблону. Если же указано два параметра <em class="replaceable"><code>арг_шаблон</code></em>, будут выводиться только бинарные операторы, типы аргументов которых соответствуют шаблонам. (Также можно записать <code class="literal">-</code> в качестве неиспользуемого аргумента унарного оператора.) По умолчанию показываются только объекты, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>. При добавлении <code class="literal">+</code> к команде для каждого оператора будет выводиться дополнительная информация; сейчас это имя функции, на которой основан оператор.</p></dd><dt id="APP-PSQL-META-COMMAND-DO-UC"><span class="term"><code class="literal">\dO[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DO-UC" class="id_link">#</a></dt><dd><p>Выводит список правил сортировки. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те правила, имена которых соответствуют ему. По умолчанию показываются только объекты, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>. При добавлении <code class="literal">+</code> к команде для каждого объекта дополнительно будет выводиться описание, при наличии. Обратите внимание, что отображаются только правила сортировки, применимые к кодировке текущей базы данных, поэтому результат команды может отличаться для различных баз данных этой же установки <span class="productname">PostgreSQL</span>.</p></dd><dt id="APP-PSQL-META-COMMAND-DP-LC"><span class="term"><code class="literal">\dp[S] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DP-LC" class="id_link">#</a></dt><dd><p>Выводит список таблиц, представлений и последовательностей с их правами доступа. Если указан <em class="replaceable"><code>шаблон</code></em>, отображаются только таблицы, представления и последовательности, имена которых соответствуют ему. По умолчанию показываются только объекты, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>.</p><p>Для установки прав доступа используются команды <a class="link" href="sql-grant.html" title="GRANT"><code class="command">GRANT</code></a> и <a class="link" href="sql-revoke.html" title="REVOKE"><code class="command">REVOKE</code></a>. Смысл отображаемых прав объясняется в <a class="xref" href="ddl-priv.html" title="5.7. Права">Разделе 5.7</a>.</p></dd><dt id="APP-PSQL-META-COMMAND-DP-UC"><span class="term"><code class="literal">\dP[itn+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DP-UC" class="id_link">#</a></dt><dd><p>Выводит список секционированных отношений. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те отношения, имена которых соответствуют ему. При добавлении к команде модификатора <code class="literal">t</code> (tables, таблицы) и <code class="literal">i</code> (indexes, индексы) список будет фильтроваться по типу отношения. По умолчанию выводятся и секционированные таблицы, и индексы.</p><p>При добавлении модификатора <code class="literal">n</code> (<span class="quote">«<span class="quote">nested</span>»</span>, вложенные) или указании шаблона выводятся также вложенные секционированные отношения и дополнительный столбец, показывающий родителя каждого секционированного отношения.</p><p>Если к команде добавляется <code class="literal">+</code>, также выводится суммарный размер всех секций каждого отношения и его описание. Если <code class="literal">+</code> дополняет модификатор <code class="literal">n</code>, будут показаны два размера: размер секций, непосредственно связанных с отношением, и общий размер всех секций, включая те, что связаны с отношением опосредованно.</p></dd><dt id="APP-PSQL-META-COMMAND-DRDS"><span class="term"><code class="literal">\drds [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон-ролей</code></em></a> [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон-баз</code></em></a> ] ]</code></span> <a href="#APP-PSQL-META-COMMAND-DRDS" class="id_link">#</a></dt><dd><p>Выводит список установленных параметров конфигурации. Эти параметры могут быть специфичными для роли, специфичными для базы данных, или обеих. Параметры <em class="replaceable"><code>шаблон-ролей</code></em> и <em class="replaceable"><code>шаблон-баз</code></em> используются для отбора определённых ролей и баз данных, соответственно. Если они опущены, или указано <code class="literal">*</code>, выводятся все параметры конфигурации, в том числе не относящиеся к ролям или базам данных.</p><p>Команды <a class="link" href="sql-alterrole.html" title="ALTER ROLE"><code class="command">ALTER ROLE</code></a> и <a class="link" href="sql-alterdatabase.html" title="ALTER DATABASE"><code class="command">ALTER DATABASE</code></a> используются для определения параметров конфигурации, специфичных для роли или базы данных.</p></dd><dt id="APP-PSQL-META-COMMAND-DRG"><span class="term"><code class="literal">\drg[S] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DRG" class="id_link">#</a></dt><dd><p>Выводит информацию о членстве в ролях с указанием назначенных атрибутов (<code class="literal">ADMIN</code>, <code class="literal">INHERIT</code> и/или <code class="literal">SET</code>) и праводателя. За информацией о членстве в ролях обратитесь к описанию команды <a class="link" href="sql-grant.html" title="GRANT"><code class="command">GRANT</code></a>.</p><p>По умолчанию выводится информация только о членстве в ролях, созданных пользователями: чтобы увидеть и системные роли, добавьте модификатор <code class="literal">S</code>. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те роли, имена которых соответствуют ему.</p></dd><dt id="APP-PSQL-META-COMMAND-DRP"><span class="term"><code class="literal">\dRp[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DRP" class="id_link">#</a></dt><dd><p>Выводит список реплицируемых публикаций. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те подписки, имена которых соответствуют ему. При добавлении <code class="literal">+</code> к команде для каждой публикации показываются также связанные с ней таблицы и схемы.</p></dd><dt id="APP-PSQL-META-COMMAND-DRS"><span class="term"><code class="literal">\dRs[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DRS" class="id_link">#</a></dt><dd><p>Выводит список подписок на репликацию. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те подписки, имена которых соответствуют ему. При добавлении <code class="literal">+</code> к команде выводятся дополнительные свойства подписок.</p></dd><dt id="APP-PSQL-META-COMMAND-DT"><span class="term"><code class="literal">\dT[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DT" class="id_link">#</a></dt><dd><p>Выводит список типов данных. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те типы, имена которых соответствуют ему. При добавлении <code class="literal">+</code> к команде для каждого типа данных дополнительно будет выводиться: внутреннее имя типа, размер, допустимые значения для типа <code class="type">enum</code> и права доступа. По умолчанию показываются только объекты, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-DU"><span class="term"><code class="literal">\du[S+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DU" class="id_link">#</a></dt><dd><p>Выводит список ролей базы данных. (Так как понятия <span class="quote">«<span class="quote">пользователи</span>»</span> и <span class="quote">«<span class="quote">группы</span>»</span> были объединены в <span class="quote">«<span class="quote">роли</span>»</span>, эта команда теперь равнозначна <code class="literal">\dg</code>.) По умолчанию выводятся только роли, созданные пользователями: чтобы увидеть и системные роли, добавьте модификатор <code class="literal">S</code>. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те роли, имена которых соответствуют ему. Если используется форма <code class="literal">\du+</code>, то выводится дополнительная информация о каждой роли; в настоящее время это комментарий роли.</p></dd><dt id="APP-PSQL-META-COMMAND-DX-LC"><span class="term"><code class="literal">\dx[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DX-LC" class="id_link">#</a></dt><dd><p>Выводит список установленных расширений. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только расширения, имена которых соответствуют ему. Если используется форма <code class="literal">\dx+</code>, то для каждого расширения выводятся все принадлежащие ему объекты.</p></dd><dt id="APP-PSQL-META-COMMAND-DX-UC"><span class="term"><code class="literal">\dX [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DX-UC" class="id_link">#</a></dt><dd><p>Выводит объекты расширенной статистики. Если указан <em class="replaceable"><code>шаблон</code></em>, отображаются только те объекты, имена которых соответствуют ему.</p><p>Состояние каждого вида расширенной статистики показывается в столбце с именем, отражающим её вид (например, Ndistinct). Состояние <code class="literal">defined</code> (определён) означает, что этот вид был запрошен при создании статистики; в противном случае отображается NULL. Чтобы узнать, производился ли анализ (<a class="link" href="sql-analyze.html" title="ANALYZE"><code class="command">ANALYZE</code></a>) статистики и доступна ли она для планировщика, обратитесь к представлению <code class="structname">pg_stats_ext</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-DY"><span class="term"><code class="literal">\dy[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-DY" class="id_link">#</a></dt><dd><p>Выводит список событийных триггеров. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только те событийные триггеры, имена которых соответствуют ему. При добавлении <code class="literal">+</code> к команде для каждого объекта дополнительно будет выводиться описание.</p></dd><dt id="APP-PSQL-META-COMMAND-EDIT"><span class="term"><code class="literal">\e</code> или <code class="literal">\edit</code> <code class="literal">[<span class="optional"><em class="replaceable"><code>имя_файла</code></em></span>] [<span class="optional"><em class="replaceable"><code>номер_строки</code></em></span>]</code></span> <a href="#APP-PSQL-META-COMMAND-EDIT" class="id_link">#</a></dt><dd><p>Если указано <em class="replaceable"><code>имя_файла</code></em>, файл открывается для редактирования; после выхода из редактора содержимое файла копируется в буфер текущего запроса. Если <em class="replaceable"><code>имя_файла</code></em> не задано, буфер текущего запроса копируется во временный файл, который затем редактируется тем же образом. Либо, если буфер текущего запроса пуст, во временный файл копируется последний выполненный запрос, и он затем так же редактируется.</p><p>Если после редактирования файла или предыдущего вопроса выйти из редактора без сохранения файла, буфер запросов будет очищен. В ином случае новое содержимое буфера запроса разбирается согласно обычным правилам <span class="application">psql</span>, при этом весь буфер обрабатывается как одна строка. Все законченные запросы немедленно выполняются; то есть, если буфер запроса содержит точку с запятой или заканчивается ей, всё его содержимое до этого знака выполняется и удаляется из буфера. Всё остальное содержимое буфера остаётся в нём и повторно выводится на экран. Вы можете ввести точку с запятой или <code class="literal">\g</code>, чтобы передать его, либо <code class="literal">\r</code>, чтобы сбросить, очистив буфер запроса.</p><p>Прочтение буфера как одной строки в основном отражается на метакомандах: всё, что находится в буфере после метакоманды, будет воспринято как аргументы метакоманды, даже если этот текст продолжается на нескольких строках. (Поэтому таким способом нельзя выполнять скрипты с метакомандами. Для таких скриптов используйте <code class="command">\i</code>.)</p><p>Если указан номер строки, <span class="application">psql</span> будет позиционировать курсор на указанную строку файла или буфера запроса. Обратите внимание, что если указан один аргумент и он числовой, <span class="application">psql</span> предполагает, что это номер строки, а не имя файла.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Как настроить редактор и изменить его поведение, рассказывается в разделе <a class="xref" href="app-psql.html#APP-PSQL-ENVIRONMENT" title="Переменные окружения">Переменные окружения</a>.</p></div></dd><dt id="APP-PSQL-META-COMMAND-ECHO"><span class="term"><code class="literal">\echo <em class="replaceable"><code>текст</code></em> [ ... ]</code></span> <a href="#APP-PSQL-META-COMMAND-ECHO" class="id_link">#</a></dt><dd><p>Выводит вычисленные аргументы в устройство стандартного вывода, разделяя их пробелами, с переводом строки в конце. Таким образом можно добавлять дополнительную информацию в вывод скриптов. Например: </p><pre class="programlisting">=&gt; <strong class="userinput"><code>\echo `date`</code></strong>
Tue Oct 26 21:40:57 CEST 1999</pre><p> Если в первом аргументе передаётся <code class="literal">-n</code> без кавычек, перевод строки в конце не добавляется (и этот первый аргумент не выводится).</p><div class="tip"><h3 class="title">Подсказка</h3><p>Если вы перенаправляете вывод запросов, используя <code class="command">\o</code>, возможно, вместо этой команды следует применить <code class="command">\qecho</code>. См. также описание <code class="command">\warn</code>.</p></div></dd><dt id="APP-PSQL-META-COMMAND-EF"><span class="term"><code class="literal">\ef [<span class="optional"><em class="replaceable"><code>описание_функции</code></em> [<span class="optional"><em class="replaceable"><code>номер_строки</code></em></span>]</span>]</code></span> <a href="#APP-PSQL-META-COMMAND-EF" class="id_link">#</a></dt><dd><p>Эта команда извлекает из базы определение заданной функции или процедуры в форме команды <code class="command">CREATE OR REPLACE FUNCTION</code> или <code class="command">CREATE OR REPLACE PROCEDURE</code> и открывает его для редактирования. Редактирование осуществляется таким же образом, как и при выполнении <code class="literal">\edit</code>. Если выйти из редактора без сохранения, тело команды сбрасывается. Иначе полученная из сохранённого файла команда немедленно выполняется, если вы добавили к ней точку с запятой. В противном случае она повторно выводится на экран; вы можете ввести точку с запятой или <code class="literal">\g</code>, чтобы передать её серверу, либо <code class="literal">\r</code>, чтобы сбросить.</p><p>Для функции может быть задано только имя или имя и аргументы, например <code class="literal">foo(integer, text)</code>. Типы аргументов необходимы, если существует более чем одна функция с тем же именем.</p><p>Если функция не указана, для редактирования открывается пустая заготовка <code class="command">CREATE FUNCTION</code>.</p><p>Если указан номер строки, <span class="application">psql</span> будет позиционировать курсор на указанную строку тела функции. (Обратите внимание, что тело функции обычно не начинается на первой строке файла).</p><p>В отличие от большинства других метакоманд весь остаток строки всегда воспринимается как аргументы <code class="command">\ef</code>, и в этих аргументах не выполняется ни подстановка переменных, ни раскрытие обратных кавычек.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Как настроить редактор и изменить его поведение, рассказывается в разделе <a class="xref" href="app-psql.html#APP-PSQL-ENVIRONMENT" title="Переменные окружения">Переменные окружения</a>.</p></div></dd><dt id="APP-PSQL-META-COMMAND-ENCODING"><span class="term"><code class="literal">\encoding [ <em class="replaceable"><code>кодировка</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-ENCODING" class="id_link">#</a></dt><dd><p>Устанавливает кодировку набора символов на клиенте. Без аргумента команда показывает текущую кодировку.</p></dd><dt id="APP-PSQL-META-COMMAND-ERRVERBOSE"><span class="term"><code class="literal">\errverbose</code></span> <a href="#APP-PSQL-META-COMMAND-ERRVERBOSE" class="id_link">#</a></dt><dd><p>Повторяет последнее серверное сообщение об ошибке с максимальным уровнем детализации, как если бы переменная <code class="varname">VERBOSITY</code> имела значение <code class="literal">verbose</code>, а <code class="varname">SHOW_CONTEXT</code> — <code class="literal">always</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-EV"><span class="term"><code class="literal">\ev [<span class="optional"><em class="replaceable"><code>имя_представления</code></em> [<span class="optional"><em class="replaceable"><code>номер_строки</code></em></span>]</span>]</code></span> <a href="#APP-PSQL-META-COMMAND-EV" class="id_link">#</a></dt><dd><p>Эта команда извлекает из базы определение заданного представления в форме команды <code class="command">CREATE OR REPLACE VIEW</code> и открывает его для редактирования. Редактирование осуществляется таким же образом, как и при выполнении <code class="literal">\edit</code>. Если выйти из редактора без сохранения, тело команды сбрасывается. Иначе полученная из сохранённого файла команда немедленно выполняется, если вы добавили к ней точку с запятой. В противном случае она повторно выводится на экран; вы можете ввести точку с запятой или <code class="literal">\g</code>, чтобы передать её серверу, либо <code class="literal">\r</code>, чтобы сбросить.</p><p>Если представление не указано, для редактирования открывается пустая заготовка <code class="command">CREATE VIEW</code>.</p><p>Если указан номер строки, <span class="application">psql</span> установит курсор на заданную строку в определении представления.</p><p>В отличие от большинства других метакоманд весь остаток строки всегда воспринимается как аргументы <code class="command">\ev</code>, и в этих аргументах не выполняется ни подстановка переменных, ни раскрытие обратных кавычек.</p></dd><dt id="APP-PSQL-META-COMMAND-F"><span class="term"><code class="literal">\f [ <em class="replaceable"><code>строка</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-F" class="id_link">#</a></dt><dd><p>Устанавливает разделитель полей для невыровненного режима вывода запросов. По умолчанию используется вертикальная черта (<code class="literal">|</code>). Равнозначно команде <code class="command">\pset fieldsep</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-G"><span class="term"><code class="literal">\g [ (<em class="replaceable"><code>параметр</code></em>=<em class="replaceable"><code>значение</code></em> [...]) ] [ <em class="replaceable"><code>имя_файла</code></em> ]</code><br /></span><span class="term"><code class="literal">\g [ (<em class="replaceable"><code>параметр</code></em>=<em class="replaceable"><code>значение</code></em> [...]) ] [ |<em class="replaceable"><code>команда</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-G" class="id_link">#</a></dt><dd><p>Передаёт содержимое буфера текущего запроса серверу для выполнения.</p><p>Если после <code class="literal">\g</code> идут скобки, внутри них содержится разделённый пробелами список определений параметров форматирования в виде <em class="replaceable"><code>параметр</code></em><code class="literal">=</code><em class="replaceable"><code>значение</code></em>. Эти определения воспринимаются так же, как и в команде <code class="literal">\pset</code> <em class="replaceable"><code>параметр</code></em> <em class="replaceable"><code>значение</code></em>, но устанавливаются только на время выполнения запроса. В этом списке пробелы не должны находится рядом со знаками <code class="literal">=</code>, но должны разделять определения разных параметров. Если <code class="literal">=</code><em class="replaceable"><code>значение</code></em> опускается, данный <em class="replaceable"><code>параметр</code></em> меняется так же, как и при выполнении <code class="literal">\pset</code> <em class="replaceable"><code>параметр</code></em> без явно заданного <em class="replaceable"><code>значения</code></em>.</p><p>Если в аргументе передаётся <em class="replaceable"><code>имя_файла</code></em> или <code class="literal">|</code><em class="replaceable"><code>команда</code></em>, вывод запроса записывается в указанный файл или передаётся через поток заданной команде оболочки, а не отображается как обычно. Вывод направляется в файл или команду, только если запрос успешно вернул 0 или более строк, но не когда запрос завершился неудачно или выполнялась команда, не возвращающая данные.</p><p>Если буфер текущего запроса пуст, вместо этого повторно выполняется предыдущий запрос. За исключением этой особенности метакоманда <code class="literal">\g</code> без аргументов по сути равнозначна точке с запятой. Метакоманда <code class="literal">\g</code> с аргументами является <span class="quote">«<span class="quote">одноразовой</span>»</span> альтернативой команде <code class="command">\o</code>, и при этом в ней на время выполнения можно задать параметры форматирования вывода, которые обычно устанавливаются командой <code class="literal">\pset</code>.</p><p>Когда последний аргумент начинается с <code class="literal">|</code>, весь остаток строки воспринимается как <em class="replaceable"><code>команда</code></em>, подлежащая выполнению, в которой не производится ни подстановка переменных, ни раскрытие обратных кавычек. Это продолжение строки просто передаётся оболочке в буквальном виде.</p></dd><dt id="APP-PSQL-META-COMMAND-GDESC"><span class="term"><code class="literal">\gdesc</code></span> <a href="#APP-PSQL-META-COMMAND-GDESC" class="id_link">#</a></dt><dd><p>Показывает описание (то есть имена и типы данных столбцов) результата текущего запроса в буфере. Сам запрос при этом не выполняется; но если он содержит какие-либо синтаксические ошибки, они выдаются обычным образом.</p><p>Если буфер текущего запроса пуст, будет повторно описан последний переданный запрос.</p></dd><dt id="APP-PSQL-META-COMMAND-GETENV"><span class="term"><code class="literal">\getenv <em class="replaceable"><code>переменная_psql</code></em> <em class="replaceable"><code>переменная_среды</code></em></code></span> <a href="#APP-PSQL-META-COMMAND-GETENV" class="id_link">#</a></dt><dd><p>Получает значение <em class="replaceable"><code>переменной_среды</code></em> и присваивает его <em class="replaceable"><code>переменной_psql</code></em>. Если <em class="replaceable"><code>переменная_среды</code></em> не определена в среде процесса <span class="application">psql</span>, <em class="replaceable"><code>переменная_psql</code></em> не изменяется. Пример: </p><pre class="programlisting">=&gt; <strong class="userinput"><code>\getenv home HOME</code></strong>
=&gt; <strong class="userinput"><code>\echo :home</code></strong>
/home/postgres</pre></dd><dt id="APP-PSQL-META-COMMAND-GEXEC"><span class="term"><code class="literal">\gexec</code></span> <a href="#APP-PSQL-META-COMMAND-GEXEC" class="id_link">#</a></dt><dd><p>Отправляет буфер текущего запроса на сервер, а затем обрабатывает содержимое каждого столбца каждой строки результата запроса (если он непустой) как SQL-оператор, то есть исполняет его. Например, следующая команда создаст индексы по каждому столбцу <code class="structname">my_table</code>: </p><pre class="programlisting">=&gt; <strong class="userinput"><code>SELECT format('create index on my_table(%I)', attname)</code></strong>
-&gt; <strong class="userinput"><code>FROM pg_attribute</code></strong>
-&gt; <strong class="userinput"><code>WHERE attrelid = 'my_table'::regclass AND attnum &gt; 0</code></strong>
-&gt; <strong class="userinput"><code>ORDER BY attnum</code></strong>
-&gt; <strong class="userinput"><code>\gexec</code></strong>
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX</pre><p>Генерируемые запросы выполняются в том порядке, в каком возвращаются строки, слева направо, если возвращается несколько столбцов. Поля NULL игнорируются. Эти запросы передаются для обработки на сервер буквально, так что это не могут быть метакоманды <span class="application">psql</span> или запросы, использующие переменные <span class="application">psql</span>. В случае сбоя в одном из запросов, выполнение оставшихся запросов продолжается, если только не установлена переменная <code class="varname">ON_ERROR_STOP</code>. На выполнение каждого запроса оказывает влияние параметр <code class="varname">ECHO</code>. (Применяя команду <code class="command">\gexec</code>, рекомендуется устанавливать в <code class="varname">ECHO</code> режим <code class="literal">all</code> или <code class="literal">queries</code>.) Такие расширенные средства, как протоколирование запросов, пошаговый режим, замер времени и т. п., так же действуют при выполнении каждого генерируемого запроса.</p><p>Если буфер текущего запроса пуст, будет повторно выполнен последний переданный запрос.</p></dd><dt id="APP-PSQL-META-COMMAND-GSET"><span class="term"><code class="literal">\gset [ <em class="replaceable"><code>префикс</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-GSET" class="id_link">#</a></dt><dd><p>Отправляет буфер текущего запроса на сервер для выполнения и сохраняет результат запроса в переменных <span class="application">psql</span> (см. раздел <a class="xref" href="app-psql.html#APP-PSQL-VARIABLES" title="Переменные">Переменные</a> ниже). Выполняемый запрос должен возвращать ровно одну строку. Каждый столбец строки результата сохраняется в отдельной переменной, которая называется так же, как и столбец. Например: </p><pre class="programlisting">=&gt; <strong class="userinput"><code>SELECT 'hello' AS var1, 10 AS var2</code></strong>
-&gt; <strong class="userinput"><code>\gset</code></strong>
=&gt; <strong class="userinput"><code>\echo :var1 :var2</code></strong>
hello 10</pre><p>Если указан <em class="replaceable"><code>префикс</code></em>, то он добавляется в начале к именам переменных: </p><pre class="programlisting">=&gt; <strong class="userinput"><code>SELECT 'hello' AS var1, 10 AS var2</code></strong>
-&gt; <strong class="userinput"><code>\gset result_</code></strong>
=&gt; <strong class="userinput"><code>\echo :result_var1 :result_var2</code></strong>
hello 10</pre><p>Если значение столбца NULL, то вместо присваивания значения соответствующая переменная удаляется.</p><p>Если запрос завершается ошибкой или не возвращает одну строку, то никакие переменные не меняются.</p><p>Если буфер текущего запроса пуст, будет повторно выполнен последний переданный запрос.</p></dd><dt id="APP-PSQL-META-COMMAND-GX"><span class="term"><code class="literal">\gx [ (<em class="replaceable"><code>параметр</code></em>=<em class="replaceable"><code>значение</code></em> [...]) ] [ <em class="replaceable"><code>имя_файла</code></em> ]</code><br /></span><span class="term"><code class="literal">\gx [ (<em class="replaceable"><code>параметр</code></em>=<em class="replaceable"><code>значение</code></em> [...]) ] [ |<em class="replaceable"><code>команда</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-GX" class="id_link">#</a></dt><dd><p>Метакоманда <code class="literal">\gx</code> равнозначна <code class="literal">\g</code> за исключением того, что она принудительно включает расширенный режим вывода для текущего запроса, так же как делает указание <code class="literal">expanded=on</code> в списке параметров <code class="literal">\pset</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-HELP"><span class="term"><code class="literal">\h</code> или <code class="literal">\help</code> <code class="literal">[ <em class="replaceable"><code>команда</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-HELP" class="id_link">#</a></dt><dd><p>Выводит подсказку по синтаксису указанной команды <acronym class="acronym">SQL</acronym>. Если <em class="replaceable"><code>команда</code></em> не указана, то <span class="application">psql</span> выводит список всех команд, для которых доступна справка. Если в качестве command указана звёздочка (<code class="literal">*</code>), то выводится справка по всем командам <acronym class="acronym">SQL</acronym>.</p><p>В отличие от большинства других метакоманд весь остаток строки всегда воспринимается как аргументы <code class="command">\help</code>, и в этих аргументах не выполняется ни подстановка переменных, ни раскрытие обратных кавычек.</p><div class="note"><h3 class="title">Примечание</h3><p>Для упрощения ввода команды, состоящие из нескольких слов, можно не заключать в кавычки. Таким образом, можно просто писать <strong class="userinput"><code>\help alter table</code></strong>.</p></div></dd><dt id="APP-PSQL-META-COMMAND-HTML"><span class="term"><code class="literal">\H</code> или <code class="literal">\html</code></span> <a href="#APP-PSQL-META-COMMAND-HTML" class="id_link">#</a></dt><dd><p>Включает вывод запросов в формате <acronym class="acronym">HTML</acronym>. Если формат <acronym class="acronym">HTML</acronym> уже включён, происходит переключение обратно на выровненный формат. Эта команда используется для совместимости и удобства, но в описании <code class="command">\pset</code> вы можете узнать о других вариантах вывода.</p></dd><dt id="APP-PSQL-META-COMMAND-INCLUDE"><span class="term"><code class="literal">\i</code> или <code class="literal">\include</code> <em class="replaceable"><code>имя_файла</code></em></span> <a href="#APP-PSQL-META-COMMAND-INCLUDE" class="id_link">#</a></dt><dd><p>Читает ввод из файла <em class="replaceable"><code>имя_файла</code></em> и выполняет его, как будто он был набран на клавиатуре.</p><p>Если <em class="replaceable"><code>имя_файла</code></em> задано как <code class="literal">-</code> (минус), читается стандартный ввод до признака конца файла или до метакоманды <code class="command">\q</code>. Это может быть полезно для совмещения интерактивного ввода со вводом команд из файлов. Заметьте, что при этом поведение Readline будет применяться, только если оно активно на внешнем уровне.</p><div class="note"><h3 class="title">Примечание</h3><p>Если вы хотите видеть строки файла на экране по мере их чтения, необходимо установить для переменной <code class="varname">ECHO</code> значение <code class="literal">all</code>.</p></div></dd><dt id="PSQL-METACOMMAND-IF"><span class="term"><code class="literal">\if</code> <em class="replaceable"><code>выражение</code></em><br /></span><span class="term"><code class="literal">\elif</code> <em class="replaceable"><code>выражение</code></em><br /></span><span class="term"><code class="literal">\else</code><br /></span><span class="term"><code class="literal">\endif</code></span> <a href="#PSQL-METACOMMAND-IF" class="id_link">#</a></dt><dd><p>Эта группа команд реализует вложенные условные блоки. Условный блок должен начинаться командой <code class="command">\if</code> и заканчиваться <code class="command">\endif</code>. Между ними может быть любое количество предложений <code class="command">\elif</code>, которые могут быть дополнительно завершаться одним предложением <code class="command">\else</code>. Между командами, формирующими блок условия, могут размещаться (и обычно размещаются) обычные запросы и другие типы команд в обратных кавычках.</p><p>Команды <code class="command">\if</code> и <code class="command">\elif</code> считывают свои аргументы и вычисляют их как логические выражения. Если выражение выдаёт <code class="literal">true</code>, обработка продолжается как обычно; в противном случае входные строки пропускаются до достижения соответствующих команд <code class="command">\elif</code>, <code class="command">\else</code> или <code class="command">\endif</code>. Как только проверка <code class="command">\if</code> или <code class="command">\elif</code> оказывается успешной, аргументы последующих команд <code class="command">\elif</code> в том же блоке не вычисляются, а считаются ложными. Строки, следующие за <code class="command">\else</code>, обрабатываются только если ни одна из предыдущих проверок <code class="command">\if</code> или <code class="command">\elif</code> не была успешной.</p><p>В аргументе <em class="replaceable"><code>выражение</code></em> команд <code class="command">\if</code> и <code class="command">\elif</code> производится подстановка переменных и раскрытие кавычек, как и в аргументе любой другой команды с обратной косой чертой. После этого полученное значение оценивается как значение переменной да/нет. Так что допустимым значением будет любое однозначное вхождение без учёта регистра одной из строк (или подстрок): <code class="literal">true</code>, <code class="literal">false</code>, <code class="literal">1</code>, <code class="literal">0</code>, <code class="literal">on</code>, <code class="literal">off</code>, <code class="literal">yes</code>, <code class="literal">no</code>. Например, строки <code class="literal">t</code>, <code class="literal">T</code> и <code class="literal">tR</code> все будут восприниматься как <code class="literal">true</code>.</p><p>Если выражения не приводятся к значениям true или false, будет выдано предупреждение, а их результат будет считаться ложным.</p><p>Пропускаемые строки разбираются как обычно (в них выявляются запросы и команды с обратной косой чертой), но не передаются серверу, а команды с обратной косой чертой, отличные от условных (<code class="command">\if</code>, <code class="command">\elif</code>, <code class="command">\else</code>, <code class="command">\endif</code>), просто игнорируются. В командах условий проверяется только правильность вложенности. Ссылки на переменные в пропускаемых строках не разворачиваются, как не выполняется и раскрытие обратных кавычек.</p><p>Все команды с обратной косой чертой в одном условном блоке должны содержаться в одном исходном файле. Если до того, как будут закрыты все локальные блоки <code class="command">\if</code>, в основном файле команд будет достигнут конец файла или встретится включение другого файла (команда <code class="command">\include</code>), <span class="application">psql</span> выдаст ошибку.</p><p>Например:</p><pre class="programlisting">-- проверка существования двух отдельных записей в базе данных и сохранение
-- результатов в двух разных переменных psql
SELECT
    EXISTS(SELECT 1 FROM customer WHERE customer_id = 123) as is_customer,
    EXISTS(SELECT 1 FROM employee WHERE employee_id = 456) as is_employee
\gset
\if :is_customer
    SELECT * FROM customer WHERE customer_id = 123;
\elif :is_employee
    \echo 'is not a customer but is an employee'
    SELECT * FROM employee WHERE employee_id = 456;
\else
    \if yes
        \echo 'not a customer or employee'
    \else
        \echo 'this will never print'
    \endif
\endif</pre></dd><dt id="APP-PSQL-META-COMMAND-INCLUDE-RELATIVE"><span class="term"><code class="literal">\ir</code> или <code class="literal">\include_relative</code> <em class="replaceable"><code>имя_файла</code></em></span> <a href="#APP-PSQL-META-COMMAND-INCLUDE-RELATIVE" class="id_link">#</a></dt><dd><p>Команда <code class="literal">\ir</code> похожа на <code class="literal">\i</code>, но по-разному интерпретирует относительные имена файлов. При выполнении в интерактивном режиме две команды ведут себя одинаково. Однако при вызове из скрипта <code class="literal">\ir</code> интерпретирует имена файлов относительно каталога, в котором расположен скрипт, а не текущего рабочего каталога.</p></dd><dt id="APP-PSQL-META-COMMAND-LIST"><span class="term"><code class="literal">\l[+]</code> или <code class="literal">\list[+] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-LIST" class="id_link">#</a></dt><dd><p>Выводит список баз данных на сервере и показывает их имена, владельцев, кодировку набора символов и права доступа. Если указан <em class="replaceable"><code>шаблон</code></em>, выводятся только базы данных, имена которых соответствуют ему. При добавлении <code class="literal">+</code> к команде также отображаются: размер базы данных, табличное пространство по умолчанию и описание. (Информация о размере доступна только для баз данных, к которым текущий пользователь может подключиться.)</p></dd><dt id="APP-PSQL-META-COMMAND-LO-EXPORT"><span class="term"><code class="literal">\lo_export <em class="replaceable"><code>oid_БО</code></em> <em class="replaceable"><code>имя_файла</code></em></code></span> <a href="#APP-PSQL-META-COMMAND-LO-EXPORT" class="id_link">#</a></dt><dd><p>Читает большой объект с заданным <em class="replaceable"><code>oid_БО</code></em> из базы данных и записывает его в файл <em class="replaceable"><code>имя_файла</code></em>. Обратите внимание, что это несколько отличается от серверной функции <code class="function">lo_export</code>, действующей с правами пользователя, от имени которого работает сервер базы данных, и в файловой системе сервера.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Используйте <code class="command">\lo_list</code> для получения <acronym class="acronym">OID</acronym> больших объектов.</p></div></dd><dt id="APP-PSQL-META-COMMAND-LO-IMPORT"><span class="term"><code class="literal">\lo_import <em class="replaceable"><code>имя_файла</code></em> [ <em class="replaceable"><code>комментарий</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-LO-IMPORT" class="id_link">#</a></dt><dd><p>Сохраняет файл в большом объекте <span class="productname">PostgreSQL</span>. При этом с объектом может быть связан указанный комментарий. Пример: </p><pre class="programlisting">foo=&gt; <strong class="userinput"><code>\lo_import '/home/peter/pictures/photo.xcf' 'a picture of me'</code></strong>
lo_import 152801</pre><p> Ответ указывает на то, что большой объект получил OID 152801, который может быть использован для доступа к вновь созданному объекту в будущем. Для удобства чтения рекомендуется всегда связывать объекты с понятными комментариями. OID и комментарии можно посмотреть с помощью команды <code class="command">\lo_list</code>.</p><p>Обратите внимание, что это немного отличается от функции сервера <code class="function">lo_import</code>, так как действует от имени локального пользователя в локальной файловой системе, а не пользователя сервера в файловой системе сервера.</p></dd><dt id="APP-PSQL-META-COMMAND-LO-LIST"><span class="term"><code class="literal">\lo_list[+]</code></span> <a href="#APP-PSQL-META-COMMAND-LO-LIST" class="id_link">#</a></dt><dd><p>Показывает список всех больших объектов <span class="productname">PostgreSQL</span>, хранящихся в базе данных, вместе с предоставленными комментариями. При добавлении <code class="literal">+</code> к команде для каждого большого объекта отображаются права доступа к нему, если они назначены.</p></dd><dt id="APP-PSQL-META-COMMAND-LO-UNLINK"><span class="term"><code class="literal">\lo_unlink <em class="replaceable"><code>oid_БО</code></em></code></span> <a href="#APP-PSQL-META-COMMAND-LO-UNLINK" class="id_link">#</a></dt><dd><p>Удаляет большой объект с <em class="replaceable"><code>oid_БО</code></em> из базы данных.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Используйте <code class="command">\lo_list</code> для получения <acronym class="acronym">OID</acronym> больших объектов.</p></div></dd><dt id="APP-PSQL-META-COMMAND-OUT"><span class="term"><code class="literal">\o</code> или <code class="literal">\out [ <em class="replaceable"><code>имя_файла</code></em> ]</code><br /></span><span class="term"><code class="literal">\o</code> или <code class="literal">\out [ |<em class="replaceable"><code>команда</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-OUT" class="id_link">#</a></dt><dd><p>Результаты запросов будут сохраняться в файле <em class="replaceable"><code>имя_файла</code></em> или перенаправляться команде оболочки (заданной аргументом <em class="replaceable"><code>команда</code></em>). Если аргумент не указан, результаты запросов перенаправляются на стандартный вывод.</p><p>Если аргумент начинается с <code class="literal">|</code>, весь остаток строки воспринимается как <em class="replaceable"><code>команда</code></em>, подлежащая выполнению, в которой не производится ни подстановка переменных, ни раскрытие обратных кавычек. Это продолжение строки просто передаётся оболочке в буквальном виде.</p><p><span class="quote">«<span class="quote">Результаты запросов</span>»</span> включают в себя все таблицы, ответы команд, уведомления, полученные от сервера баз данных, а также вывод от метакоманд, обращающихся к базе (таких как <code class="command">\d</code>), но не сообщения об ошибках.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Чтобы вставить текст между результатами запросов, используйте <code class="command">\qecho</code>.</p></div></dd><dt id="APP-PSQL-META-COMMAND-PRINT"><span class="term"><code class="literal">\p</code> или <code class="literal">\print</code></span> <a href="#APP-PSQL-META-COMMAND-PRINT" class="id_link">#</a></dt><dd><p>Печатает содержимое буфера текущего запроса в стандартный вывод. Если этот буфер пуст, будет напечатан последний выполненный запрос.</p></dd><dt id="APP-PSQL-META-COMMAND-PASSWORD"><span class="term"><code class="literal">\password [ <em class="replaceable"><code>имя_пользователя</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-PASSWORD" class="id_link">#</a></dt><dd><p>Изменяет пароль указанного пользователя (по умолчанию, текущего пользователя). Эта команда запрашивает новый пароль, шифрует и отправляет его на сервер в виде команды <code class="command">ALTER ROLE</code>. Это гарантирует, что новый пароль не отображается в открытом виде в истории команд, журнале сервера или в другом месте.</p></dd><dt id="APP-PSQL-META-COMMAND-PROMPT"><span class="term"><code class="literal">\prompt [ <em class="replaceable"><code>текст</code></em> ] <em class="replaceable"><code>имя</code></em></code></span> <a href="#APP-PSQL-META-COMMAND-PROMPT" class="id_link">#</a></dt><dd><p>Предлагает пользователю ввести значение, которое будет присвоено переменной <em class="replaceable"><code>имя</code></em>. Дополнительно можно указать <em class="replaceable"><code>текст</code></em> подсказки. (Если подсказка состоит из нескольких слов, то её текст нужно взять в одинарные кавычки).</p><p>По умолчанию, <code class="literal">\prompt</code> использует терминал для ввода и вывода. Однако если используется параметр командной строки <code class="option">-f</code>, <code class="literal">\prompt</code> использует стандартный ввод и стандартный вывод.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET"><span class="term"><code class="literal">\pset [ <em class="replaceable"><code>параметр</code></em> [ <em class="replaceable"><code>значение</code></em> ] ]</code></span> <a href="#APP-PSQL-META-COMMAND-PSET" class="id_link">#</a></dt><dd><p>Эта команда устанавливает параметры, влияющие на вывод результатов запросов. Указание <em class="replaceable"><code>параметр</code></em> определяет, какой параметр требуется установить. Семантика <em class="replaceable"><code>значения</code></em> зависит от выбранного параметра. Для некоторых параметров отсутствие <em class="replaceable"><code>значения</code></em> означает переключение значения, либо сброс значения, как описано ниже в разделе конкретного параметра. Если такое поведение не упоминается, то пропуск <em class="replaceable"><code>значения</code></em> приводит к отображению текущего значения параметра.</p><p><code class="command">\pset</code> без аргументов выводит текущий статус всех параметров команды.</p><p>Имеются следующие параметры: </p><div class="variablelist"><dl class="variablelist"><dt id="APP-PSQL-META-COMMAND-PSET-BORDER"><span class="term"><code class="literal">border</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-BORDER" class="id_link">#</a></dt><dd><p>Здесь <em class="replaceable"><code>значение</code></em> должно быть числом. В целом, чем больше это число, тем больше границ и линий будет в таблицах, но детали зависят от формата. В формате <acronym class="acronym">HTML</acronym> заданное значение напрямую отображается в атрибут <code class="literal">border=...</code>. Для большинства других форматов имеют смысл только значения 0 (нет границы), 1 (внутренние разделительные линии) и 2 (граница таблицы), а значения больше 2 воспринимаются как <code class="literal">border = 2</code>. Форматы <code class="literal">latex</code> и <code class="literal">latex-longtable</code> дополнительно поддерживают значение 3, добавляющее разделительные линии между строками данных.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-COLUMNS"><span class="term"><code class="literal">columns</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-COLUMNS" class="id_link">#</a></dt><dd><p>Устанавливает максимальную ширину для формата <code class="literal">wrapped</code>, а также ограничение по ширине, свыше которого будет требоваться постраничник или произойдёт переключение в вертикальное отображение при режиме <code class="literal">expanded auto</code>. При значении 0 (по умолчанию) максимальная ширина управляется переменной среды <code class="envar">COLUMNS</code> или шириной экрана, если <code class="envar">COLUMNS</code> не установлена. Кроме того, если <code class="literal">columns</code> равно нулю, то формат <code class="literal">wrapped</code> влияет только на вывод на экран. Если <code class="literal">columns</code> не равно 0, то это также влияет на вывод в файл или в другую команду через канал.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-CSV-FIELDSEP"><span class="term"><code class="literal">csv_fieldsep</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-CSV-FIELDSEP" class="id_link">#</a></dt><dd><p>Устанавливает разделитель полей для формата вывода <acronym class="acronym">CSV</acronym>. Если символ-разделитель оказывается внутри значения поля, оно выводится в двойных кавычках согласно стандартным правилам <acronym class="acronym">CSV</acronym>. По умолчанию разделителем является запятая.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-EXPANDED"><span class="term"><code class="literal">expanded</code> (или <code class="literal">x</code>)</span> <a href="#APP-PSQL-META-COMMAND-PSET-EXPANDED" class="id_link">#</a></dt><dd><p>Указанное <em class="replaceable"><code>значение</code></em> допускает варианты <code class="literal">on</code> или <code class="literal">off</code>, которые включают или отключают развёрнутый режим, либо <code class="literal">auto</code>. Если <em class="replaceable"><code>значение</code></em> опущено, команда включает/отключает режим. Когда развёрнутый режим включён, результаты запроса выводятся в две колонки: имя столбца в левой, данные в правой. Этот режим полезен, если данные не помещаются на экране в обычном <span class="quote">«<span class="quote">горизонтальном</span>»</span> режиме. При выборе <code class="literal">auto</code> развёрнутый режим используется, когда результат запроса содержит несколько столбцов и по ширине не умещается на экране; в противном случае используется обычный режим. Режим <code class="literal">auto</code> распространяется только на форматы <code class="literal">aligned</code> и <code class="literal">wrapped</code>. С другими форматами он всегда равнозначен отключённому состоянию.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-FIELDSEP"><span class="term"><code class="literal">fieldsep</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-FIELDSEP" class="id_link">#</a></dt><dd><p>Устанавливает разделитель полей для невыровненного режима вывода запросов. Таким образом, можно формировать вывод, в котором значения будут разделены, например, табуляцией. Это может быть предпочтительным для использования в других программах. Для установки символа табуляции в качестве разделителя полей введите <code class="literal">\pset fieldsep '\t'</code>. По умолчанию используется вертикальная черта (<code class="literal">'|'</code>).</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-FIELDSEP-ZERO"><span class="term"><code class="literal">fieldsep_zero</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-FIELDSEP-ZERO" class="id_link">#</a></dt><dd><p>Устанавливает разделитель полей для невыровненного режима вывода в нулевой байт.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-FOOTER"><span class="term"><code class="literal">footer</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-FOOTER" class="id_link">#</a></dt><dd><p>Возможны два варианта <em class="replaceable"><code>значения</code></em>: <code class="literal">on</code> или <code class="literal">off</code>, которые включают или отключают вывод результирующей строки с количеством выбранных записей <code class="literal">(<em class="replaceable"><code>n</code></em> строк)</code>. Если <em class="replaceable"><code>значение</code></em> не указано, то команда переключает текущее значение в <code class="literal">on</code> или <code class="literal">off</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-FORMAT"><span class="term"><code class="literal">format</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-FORMAT" class="id_link">#</a></dt><dd><p>Устанавливает один из следующих форматов вывода: <code class="literal">aligned</code>, <code class="literal">asciidoc</code>, <code class="literal">csv</code>, <code class="literal">html</code>, <code class="literal">latex</code>, <code class="literal">latex-longtable</code>, <code class="literal">troff-ms</code>, <code class="literal">unaligned</code> или <code class="literal">wrapped</code>. Допускается сокращение слова до уникального значения.</p><p>Формат <code class="literal">aligned</code> это стандартный, удобочитаемый, хорошо отформатированный текстовый вывод. Используется по умолчанию.</p><p>В формате <code class="literal">unaligned</code> все столбцы выводятся в одной строке и отделяются друг от друга активным разделителем полей. Это полезно для получения вывода, который будут читать другие программы, например для вывода данных с разделителем Tab или через запятую. При этом, если разделитель окажется в содержимом столбца, этот символ будет выведен как есть; в таких случаях полезнее будет формат <acronym class="acronym">CSV</acronym>.</p><p>В формате <code class="literal">csv</code> <a id="id-1.9.4.20.8.4.10.1.78.2.3.1.8.2.4.2" class="indexterm"></a> значения столбцов выводятся через запятую и могут заключаться в кавычки по правилам, описанным в <a class="ulink" href="https://datatracker.ietf.org/doc/html/rfc4180" target="_top">RFC 4180</a>. Вывод этого формата совместим с форматом CSV серверной команды <code class="command">COPY</code>. Первой выводится строка с именами столбцов, если только не включён режим <code class="literal">tuples_only</code>. Верхний и нижний колонтитулы не выводятся. Строки разделяются символами конца строки, зависящими от ОС; обычно это символ новой строки (<code class="literal">\n</code>) в Unix-подобных системах и комбинация символов перевода каретки и новой строки (<code class="literal">\r\n</code>) в Microsoft Windows. Отличный от запятой разделитель полей можно установить командой <code class="command">\pset csv_fieldsep</code>.</p><p>Формат <code class="literal">wrapped</code> похож на <code class="literal">aligned</code>, но переносит длинные значения столбцов на новые строки, чтобы общий вывод поместился в заданную ширину. Задание ширины вывода описано в параметре <code class="literal">columns</code>. Обратите внимание, что <span class="application">psql</span> не будет пытаться переносить на новые строки заголовки столбцов. Поэтому формат <code class="literal">wrapped</code> работает так же, как <code class="literal">aligned</code> если общая ширина, требуемая для всех заголовков столбцов, превышает установленную максимальную ширину.</p><p>Форматы <code class="literal">asciidoc</code>, <code class="literal">html</code>, <code class="literal">latex</code>, <code class="literal">latex-longtable</code> и <code class="literal">troff-ms</code> выводят таблицы, которые предназначены для включения в документы с помощью соответствующего языка разметки. Они не являются полноценными документами! Это может быть не критично для <acronym class="acronym">HTML</acronym>, но для <span class="application">LaTeX</span> обязателен документ-контейнер. Формат <code class="literal">latex</code> использует среду <span class="application">LaTeX</span> <code class="literal">tabular</code>, а формат <code class="literal">latex-longtable</code> требует наличия пакетов <code class="literal">longtable</code> и <code class="literal">booktabs</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-LINESTYLE"><span class="term"><code class="literal">linestyle</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-LINESTYLE" class="id_link">#</a></dt><dd><p>Задаёт стиль отрисовки линий границы: <code class="literal">ascii</code>, <code class="literal">old-ascii</code> или <code class="literal">unicode</code>. Допускается сокращение слова до уникального значения. (Это значит, что одной буквы будет достаточно.) Значение по умолчанию: <code class="literal">ascii</code>. Этот параметр действует только в форматах <code class="literal">aligned</code> и <code class="literal">wrapped</code>.</p><p>Стиль <code class="literal">ascii</code> использует обычные символы <acronym class="acronym">ASCII</acronym>. Символы новой строки в данных показываются с использованием символа <code class="literal">+</code> в правом поле. Когда при формате <code class="literal">wrapped</code> происходит перенос данных на новую строку (без символа новой строки), ставится точка (<code class="literal">.</code>) в правом поле первой строки и точка в левом поле следующей строки.</p><p>Стиль <code class="literal">old-ascii</code> использует обычные символы <acronym class="acronym">ASCII</acronym> в стиле <span class="productname">PostgreSQL</span> 8.4 и раньше. Символы новой строки в данных отображаются, используя символ <code class="literal">:</code> вместо левого разделителя полей. Когда происходит перенос данных на новую строку без символа новой строки, символ <code class="literal">;</code> используется вместо левого разделителя полей.</p><p>Стиль <code class="literal">unicode</code> использует символы Юникода для рисования линий. Символы новой строки в данных показываются с использованием символа возврата каретки в правом поле. Когда при формате <code class="literal">wrapped</code> происходит перенос данных на новую строку (без символа новой строки), ставится символ многоточия в правом поле первой строки и в левом поле следующей строки.</p><p>Когда значение <code class="literal">border</code> больше нуля, параметр <code class="literal">linestyle</code> также определяет символы, которыми будут рисоваться границы. Обычные символы <acronym class="acronym">ASCII</acronym> работают везде, но символы Юникода смотрятся лучше на терминалах, распознающих их.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-NULL"><span class="term"><code class="literal">null</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-NULL" class="id_link">#</a></dt><dd><p>Устанавливает строку, которая будет напечатана вместо значения null. По умолчанию не печатается ничего, что можно ошибочно принять за пустую строку. Например, можно было бы предпочесть <code class="literal">\pset null '(null)'</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-NUMERICLOCALE"><span class="term"><code class="literal">numericlocale</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-NUMERICLOCALE" class="id_link">#</a></dt><dd><p>Если задаётся <em class="replaceable"><code>значение</code></em>, возможны два варианта: <code class="literal">on</code> или <code class="literal">off</code>, которые включают или отключают отображение специфичного для локали символа, разделяющего группы цифр левее десятичной точки. Если <em class="replaceable"><code>значение</code></em> не указано, то команда переключает вывод чисел с локализованного на обычный и обратно.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-PAGER"><span class="term"><code class="literal">pager</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-PAGER" class="id_link">#</a></dt><dd><p>Управляет использованием постраничника для просмотра результатов запросов и справочной информации <span class="application">psql</span>. Если <code class="literal">pager</code> имеет значение <code class="literal">off</code>, программа постраничного просмотра (постраничник) не используется. Если <code class="literal">pager</code> имеет значение <code class="literal">on</code>, эта программа используется при необходимости, т. е. когда вывод на терминал не помещается на экране. Параметр <code class="literal">pager</code> также может иметь значение <code class="literal">always</code>, при этом постраничник будет использоваться всегда, независимо от того, помещается вывод на экран терминала или нет. Команда <code class="literal">\pset pager</code> без указания <em class="replaceable"><code>значения</code></em> переключает варианты <code class="literal">on</code> и <code class="literal">off</code>.</p><p>Если установлена переменная среды <code class="envar">PSQL_PAGER</code> или <code class="envar">PAGER</code>, вывод передаётся указанной программе. В противном случае используется платформозависимая программа по умолчанию (например, <code class="filename">more</code>).</p><p>Команда <code class="literal">\watch</code>, которая повторяет один и тот же запрос, для выбора постраничника вместо этого использует переменную среды <code class="envar">PSQL_WATCH_PAGER</code> (в системах Unix). Для такого вывода постраничник выбирается отдельно, потому что традиционные постраничники могут обрабатывать его некорректно, но вы можете передавать его программам, распознающим этот формат вывода <span class="application">psql</span> (например, <code class="filename">pspg --stream</code>).</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-PAGER-MIN-LINES"><span class="term"><code class="literal">pager_min_lines</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-PAGER-MIN-LINES" class="id_link">#</a></dt><dd><p>Если в <code class="literal">pager_min_lines</code> задаётся число, превышающее высоту страницы, программа постраничного вывода не будет вызываться, пока не наберётся заданное число строк для вывода. Значение по умолчанию — 0.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-RECORDSEP"><span class="term"><code class="literal">recordsep</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-RECORDSEP" class="id_link">#</a></dt><dd><p>Устанавливает разделитель записей (строк) для невыровненного режима вывода. По умолчанию используется символ новой строки.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-RECORDSEP-ZERO"><span class="term"><code class="literal">recordsep_zero</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-RECORDSEP-ZERO" class="id_link">#</a></dt><dd><p>Устанавливает разделитель записей для невыровненного режима вывода в нулевой байт.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-TABLEATTR"><span class="term"><code class="literal">tableattr</code> (или <code class="literal">T</code>)</span> <a href="#APP-PSQL-META-COMMAND-PSET-TABLEATTR" class="id_link">#</a></dt><dd><p>Устанавливает атрибуты, которые будут помещены в тег <code class="sgmltag-element">table</code>, при формате вывода <acronym class="acronym">HTML</acronym>. Например, это может быть <code class="literal">cellpadding</code> или <code class="literal">border</code>. Заметьте, что, вероятно, не нужно здесь задавать <code class="literal">border</code>, так как для этого уже есть <code class="literal">\pset border</code>. Если <em class="replaceable"><code>значение</code></em> не задано, атрибуты таблицы удаляются.</p><p>В формате <code class="literal">latex-longtable</code> этот параметр контролирует пропорциональную ширину каждого столбца, данные которого выровнены по левому краю. Он указывается как список разделённых пробелами значений, например <code class="literal">'0.2 0.2 0.6'</code>. Для столбцов, которым не хватает значений, используется последнее из заданных.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-TITLE"><span class="term"><code class="literal">title</code> (или <code class="literal">C</code>)</span> <a href="#APP-PSQL-META-COMMAND-PSET-TITLE" class="id_link">#</a></dt><dd><p>Устанавливает заголовок таблицы для любых впоследствии выводимых таблиц. Это можно использовать для задания описательных тегов при формировании вывода. Если <em class="replaceable"><code>значение</code></em> не задано, заголовок таблицы удаляется.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-TUPLES-ONLY"><span class="term"><code class="literal">tuples_only</code> (или <code class="literal">t</code>)</span> <a href="#APP-PSQL-META-COMMAND-PSET-TUPLES-ONLY" class="id_link">#</a></dt><dd><p>Возможны два варианта <em class="replaceable"><code>значения</code></em>: <code class="literal">on</code> или <code class="literal">off</code>, которые включают или отключают режим вывода только кортежей. Если <em class="replaceable"><code>значение</code></em> не указано, то команда переключает с режима вывода только кортежей на обычный режим и обратно. Обычный вывод включает в себя дополнительную информацию, такую как заголовки столбцов и различные колонтитулы. В режиме вывода только кортежей отображаются только фактические табличные данные.</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-UNICODE-BORDER-LINESTYLE"><span class="term"><code class="literal">unicode_border_linestyle</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-UNICODE-BORDER-LINESTYLE" class="id_link">#</a></dt><dd><p>Устанавливает стиль рисования границ для стиля линий <code class="literal">unicode</code>: <code class="literal">single</code> (одинарный) или <code class="literal">double</code> (двойной).</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-UNICODE-COLUMN-LINESTYLE"><span class="term"><code class="literal">unicode_column_linestyle</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-UNICODE-COLUMN-LINESTYLE" class="id_link">#</a></dt><dd><p>Устанавливает стиль рисования колонок для стиля линий <code class="literal">unicode</code>: <code class="literal">single</code> (одинарный) или <code class="literal">double</code> (двойной).</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-UNICODE-HEADER-LINESTYLE"><span class="term"><code class="literal">unicode_header_linestyle</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-UNICODE-HEADER-LINESTYLE" class="id_link">#</a></dt><dd><p>Устанавливает стиль рисования заголовка для стиля линий <code class="literal">unicode</code>: <code class="literal">single</code> (одинарный) или <code class="literal">double</code> (двойной).</p></dd><dt id="APP-PSQL-META-COMMAND-PSET-XHEADER-WIDTH"><span class="term"><code class="literal">xheader_width</code></span> <a href="#APP-PSQL-META-COMMAND-PSET-XHEADER-WIDTH" class="id_link">#</a></dt><dd><p>Устанавливает максимальную ширину заголовка для расширенного режима вывода. Допустимые значения: <code class="literal">full</code> (значение по умолчанию), <code class="literal">column</code>, <code class="literal">page</code> или <em class="replaceable"><code>целое_число</code></em>.</p><p><code class="literal">full</code>: заголовок в расширенном режиме не обрезается, строка форматируется по самому широкому столбцу.</p><p><code class="literal">column</code>: строка заголовка обрезается до ширины первого столбца вывода.</p><p><code class="literal">page</code>: строка заголовка обрезается до ширины окна терминала.</p><p><em class="replaceable"><code>целое_число</code></em>: строка заголовка обрезается по указанной максимальной ширине.</p></dd></dl></div><p>Иллюстрацию того, как могут выглядеть различные форматы, можно увидеть в разделе <a class="xref" href="app-psql.html#APP-PSQL-EXAMPLES" title="Примеры">Примеры</a> ниже.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Для некоторых параметров <code class="command">\pset</code> есть короткие команды. См. <code class="command">\a</code>, <code class="command">\C</code>, <code class="command">\f</code>, <code class="command">\H</code>, <code class="command">\t</code>, <code class="command">\T</code> и <code class="command">\x</code>.</p></div></dd><dt id="APP-PSQL-META-COMMAND-QUIT"><span class="term"><code class="literal">\q</code> или <code class="literal">\quit</code></span> <a href="#APP-PSQL-META-COMMAND-QUIT" class="id_link">#</a></dt><dd><p>Выход из <span class="application">psql</span>. При использовании в скрипте прекращается только выполнение этого скрипта.</p></dd><dt id="APP-PSQL-META-COMMAND-QECHO"><span class="term"><code class="literal">\qecho <em class="replaceable"><code>текст</code></em> [ ... ]</code></span> <a href="#APP-PSQL-META-COMMAND-QECHO" class="id_link">#</a></dt><dd><p>Эта команда идентична <code class="command">\echo</code> за исключением того, что вывод будет записываться в канал вывода запросов, установленный <code class="command">\o</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-RESET"><span class="term"><code class="literal">\r</code> или <code class="literal">\reset</code></span> <a href="#APP-PSQL-META-COMMAND-RESET" class="id_link">#</a></dt><dd><p>Сбрасывает (очищает) буфер запроса.</p></dd><dt id="APP-PSQL-META-COMMAND-S"><span class="term"><code class="literal">\s [ <em class="replaceable"><code>имя_файла</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-S" class="id_link">#</a></dt><dd><p>Записывает историю команд <span class="application">psql</span> в файл <em class="replaceable"><code>имя_файла</code></em>. Если <em class="replaceable"><code>имя_файла</code></em> не указано, история команд выводится в стандартный вывод (с использованием постраничника, когда уместно). Этот параметр недоступен, если <span class="application">psql</span> был собран без поддержки <span class="application">Readline</span>.</p></dd><dt id="APP-PSQL-META-COMMAND-SET"><span class="term"><code class="literal">\set [ <em class="replaceable"><code>имя</code></em> [ <em class="replaceable"><code>значение</code></em> [ ... ] ] ]</code></span> <a href="#APP-PSQL-META-COMMAND-SET" class="id_link">#</a></dt><dd><p>Задаёт для переменной <span class="application">psql</span> <em class="replaceable"><code>имя</code></em> указанное <em class="replaceable"><code>значение</code></em> или, если указано несколько значений, все эти значения, соединённые вместе. Если присутствует только один аргумент, значением переменной становится пустая строка. Для сброса переменной используйте команду <code class="command">\unset</code>.</p><p><code class="command">\set</code> без аргументов выводит имена и значения всех <span class="application">psql</span> переменных, установленных в настоящее время.</p><p>Имена переменных могут содержать буквы, цифры и знаки подчёркивания. Подробнее см. раздел <a class="xref" href="app-psql.html#APP-PSQL-VARIABLES" title="Переменные">Переменные</a> ниже. Имена переменных чувствительны к регистру.</p><p>Некоторые переменные отличаются от остальных, тем что управляют поведением <span class="application">psql</span> или устанавливаются автоматически, отражая состояние соединения. Они описаны ниже, в разделе <a class="xref" href="app-psql.html#APP-PSQL-VARIABLES" title="Переменные">Переменные</a>.</p><div class="note"><h3 class="title">Примечание</h3><p>Эта команда не имеет отношения к <acronym class="acronym">SQL</acronym>-команде <a class="link" href="sql-set.html" title="SET"><code class="command">SET</code></a>.</p></div></dd><dt id="APP-PSQL-META-COMMAND-SETENV"><span class="term"><code class="literal">\setenv <em class="replaceable"><code>имя</code></em> [ <em class="replaceable"><code>значение</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-SETENV" class="id_link">#</a></dt><dd><p>Задаёт для переменной среды <em class="replaceable"><code>имя</code></em> <em class="replaceable"><code>значение</code></em> или, если <em class="replaceable"><code>значение</code></em> не задано, удаляет переменную среды. Пример: </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>\setenv PAGER less</code></strong>
testdb=&gt; <strong class="userinput"><code>\setenv LESS -imx4F</code></strong></pre></dd><dt id="APP-PSQL-META-COMMAND-SF"><span class="term"><code class="literal">\sf[+] <em class="replaceable"><code>описание_функции</code></em></code></span> <a href="#APP-PSQL-META-COMMAND-SF" class="id_link">#</a></dt><dd><p>Эта команда извлекает из базы и выводит определение заданной функции или процедуры в форме команды <code class="command">CREATE OR REPLACE FUNCTION</code> или <code class="command">CREATE OR REPLACE PROCEDURE</code>. Определение выдаётся в текущий канал вывода запроса, установленный <code class="command">\o</code>.</p><p>Для функции может быть задано только имя или имя и аргументы, например <code class="literal">foo(integer, text)</code>. Типы аргументов необходимы, если существует более чем одна функция с тем же именем.</p><p>При добавлении <code class="literal">+</code> к команде строки вывода нумеруются, первая строка тела функции получит номер 1.</p><p>В отличие от большинства других метакоманд весь остаток строки всегда воспринимается как аргументы <code class="command">\sf</code>, и в этих аргументах не выполняется ни подстановка переменных, ни раскрытие обратных кавычек.</p></dd><dt id="APP-PSQL-META-COMMAND-SV"><span class="term"><code class="literal">\sv[+] <em class="replaceable"><code>имя_представления</code></em></code></span> <a href="#APP-PSQL-META-COMMAND-SV" class="id_link">#</a></dt><dd><p>Извлекает из базы данных и выводит определение указанного представления в форме команды <code class="command">CREATE OR REPLACE VIEW</code>. Определение выводится в текущий канал вывода запросов, установленный <code class="command">\o</code>.</p><p>При добавлении <code class="literal">+</code> к команде строки вывода нумеруются, начиная с 1.</p><p>В отличие от большинства других метакоманд весь остаток строки всегда воспринимается как аргументы <code class="command">\sv</code>, и в этих аргументах не выполняется ни подстановка переменных, ни раскрытие обратных кавычек.</p></dd><dt id="APP-PSQL-META-COMMAND-T-LC"><span class="term"><code class="literal">\t</code></span> <a href="#APP-PSQL-META-COMMAND-T-LC" class="id_link">#</a></dt><dd><p>Включает/выключает отображение имён столбцов и результирующей строки с количеством выбранных записей для запросов. Эта команда эквивалентна <code class="literal">\pset tuples_only</code> и предоставлена для удобства.</p></dd><dt id="APP-PSQL-META-COMMAND-T-UC"><span class="term"><code class="literal">\T <em class="replaceable"><code>параметры_таблицы</code></em></code></span> <a href="#APP-PSQL-META-COMMAND-T-UC" class="id_link">#</a></dt><dd><p>Устанавливает атрибуты, которые будут помещены в тег <code class="sgmltag-element">table</code> при формате вывода <acronym class="acronym">HTML</acronym>. Эта команда эквивалентна <code class="literal">\pset tableattr <em class="replaceable"><code>параметры_таблицы</code></em></code>.</p></dd><dt id="APP-PSQL-META-COMMAND-TIMING"><span class="term"><code class="literal">\timing [ <em class="replaceable"><code>on</code></em> | <em class="replaceable"><code>off</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-TIMING" class="id_link">#</a></dt><dd><p>С параметром данная команда, в зависимости от него, включает/отключает отображение времени выполнения каждого SQL-оператора. Без параметра она меняет состояние отображения на противоположное. Время выводится в миллисекундах; интервалы больше 1 секунды выводятся в формате минуты:секунды, а при необходимости в вывод также добавляются часы и дни.</p></dd><dt id="APP-PSQL-META-COMMAND-UNSET"><span class="term"><code class="literal">\unset <em class="replaceable"><code>имя</code></em></code></span> <a href="#APP-PSQL-META-COMMAND-UNSET" class="id_link">#</a></dt><dd><p>Удаляет <span class="application">psql</span> переменную <em class="replaceable"><code>имя</code></em>.</p><p>Большинство переменных, управляющих поведением <span class="application">psql</span>, нельзя сбросить; команда <code class="literal">\unset</code> для них воспринимается как установка значений по умолчанию. См. раздел <a class="xref" href="app-psql.html#APP-PSQL-VARIABLES" title="Переменные">Переменные</a> ниже.</p></dd><dt id="APP-PSQL-META-COMMAND-WRITE"><span class="term"><code class="literal">\w</code> или <code class="literal">\write</code> <em class="replaceable"><code>имя_файла</code></em><br /></span><span class="term"><code class="literal">\w</code> или <code class="literal">\write</code> <code class="literal">|</code><em class="replaceable"><code>команда</code></em></span> <a href="#APP-PSQL-META-COMMAND-WRITE" class="id_link">#</a></dt><dd><p>Выводит буфер текущего запроса в файл <em class="replaceable"><code>имя_файла</code></em> или через канал в команду оболочки <em class="replaceable"><code>команда</code></em>. Если этот буфер пуст, будет выведен последний выполненный запрос.</p><p>Если аргумент начинается с <code class="literal">|</code>, весь остаток строки воспринимается как <em class="replaceable"><code>команда</code></em>, подлежащая выполнению, в которой не производится ни подстановка переменных, ни раскрытие обратных кавычек. Это продолжение строки просто передаётся оболочке в буквальном виде.</p></dd><dt id="APP-PSQL-META-COMMAND-WARN"><span class="term"><code class="literal">\warn <em class="replaceable"><code>текст</code></em> [ ... ]</code></span> <a href="#APP-PSQL-META-COMMAND-WARN" class="id_link">#</a></dt><dd><p>Эта команда идентична <code class="command">\echo</code> за исключением того, что её вывод выдаётся в канал вывода ошибок <span class="application">psql</span>, а не в канал стандартного вывода.</p></dd><dt id="APP-PSQL-META-COMMAND-WATCH"><span class="term"><code class="literal">\watch [ i[nterval]=<em class="replaceable"><code>секунды</code></em> ] [ c[ount]=<em class="replaceable"><code>количество_выполнений</code></em> ] [ <em class="replaceable"><code>секунды</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-WATCH" class="id_link">#</a></dt><dd><p>Эта команда выполняет текущий запрос в буфере (как <code class="literal">\g</code>) заданное количество раз, если не будет прервана или не возникнет ошибка. Аргумент задаёт количество секунд ожидания между выполнениями запроса (по умолчанию 2). Для обратной совместимости задавать <em class="replaceable"><code>секунды</code></em> можно с префиксом <code class="literal">interval=</code> или без него. Результат каждого запроса выводится с заголовком, включающим строку <code class="literal">\pset title</code> (если она задана), время запуска запроса и интервал задержки.</p><p>Если буфер текущего запроса пуст, будет повторно выполнен последний переданный запрос.</p></dd><dt id="APP-PSQL-META-COMMAND-X"><span class="term"><code class="literal">\x [ <em class="replaceable"><code>on</code></em> | <em class="replaceable"><code>off</code></em> | <em class="replaceable"><code>auto</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-X" class="id_link">#</a></dt><dd><p>Устанавливает или переключает режим развёрнутого вывода таблицы. Это эквивалентно <code class="literal">\pset expanded</code>.</p></dd><dt id="APP-PSQL-META-COMMAND-Z"><span class="term"><code class="literal">\z[S] [ <a class="link" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска"><em class="replaceable"><code>шаблон</code></em></a> ]</code></span> <a href="#APP-PSQL-META-COMMAND-Z" class="id_link">#</a></dt><dd><p>Выводит список таблиц, представлений и последовательностей с их правами доступа. Если указан <em class="replaceable"><code>шаблон</code></em>, отображаются только таблицы, представления и последовательности, имена которых соответствуют ему. По умолчанию показываются только объекты, созданные пользователями. Для включения системных объектов нужно задать шаблон или добавить модификатор <code class="literal">S</code>.</p><p>Это псевдоним для <code class="command">\dp</code> (<span class="quote">«<span class="quote">показать права доступа</span>»</span>).</p></dd><dt id="APP-PSQL-META-COMMAND-EXCLAMATION-MARK"><span class="term"><code class="literal">\! [ <em class="replaceable"><code>команда</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-EXCLAMATION-MARK" class="id_link">#</a></dt><dd><p>Без аргументов запускает подчинённую оболочку; когда эта оболочка завершается, <span class="application">psql</span> продолжает работу. Если добавлен аргумент, запускает команду оболочки <em class="replaceable"><code>команда</code></em>.</p><p>В отличие от большинства других метакоманд весь остаток строки всегда воспринимается как аргументы <code class="command">\!</code>, и в этих аргументах не выполняется ни подстановка переменных, ни раскрытие обратных кавычек. Этот текст просто передаётся оболочке в буквальном виде.</p></dd><dt id="APP-PSQL-META-COMMAND-QUESTION-MARK"><span class="term"><code class="literal">\? [ <em class="replaceable"><code>тема</code></em> ]</code></span> <a href="#APP-PSQL-META-COMMAND-QUESTION-MARK" class="id_link">#</a></dt><dd><p>Показывает справочную информацию. Необязательный параметр <em class="replaceable"><code>тема</code></em> (по умолчанию <code class="literal">commands</code>) выбирает описание интересующей части <span class="application">psql</span>: <code class="literal">commands</code> описывает команды <span class="application">psql</span> с обратной косой чертой; <code class="literal">options</code> описывает параметры командной строки, которые можно передать <span class="application">psql</span>; а <code class="literal">variables</code> выдаёт справку по переменным конфигурации <span class="application">psql</span>.</p></dd><dt id="APP-PSQL-META-COMMAND-SEMICOLON"><span class="term"><code class="literal">\;</code></span> <a href="#APP-PSQL-META-COMMAND-SEMICOLON" class="id_link">#</a></dt><dd><p>Точка с запятой после косой черты не является метакомандой в том смысле, что предыдущие; при её вводе в буфер просто добавляется точка с запятой без обработки.</p><p>Обычно <span class="application">psql</span> передаёт SQL-команду серверу, как только встречает завершающую команду точку с запятой, даже если текущая строка на этом не заканчивается. Так, например, при вводе </p><pre class="programlisting">select 1; select 2; select 3;</pre><p> на сервер по отдельности будут переданы три SQL-команды, и результат каждой команды будет выведен перед переходом к следующей. Однако если точка с запятой вводится как <code class="literal">\;</code>, команда не передаётся на обработку, так что команды до и после этих символов по сути объединяются и передаются серверу в одном запросе. Поэтому, например, при выполнении </p><pre class="programlisting">select 1\; select 2\; select 3;</pre><p> серверу передаются сразу три SQL-команды при достижении неэкранированной точки с запятой. Сервер выполняет такой запрос как одну транзакцию, если только в строку не включены явные команды <code class="command">BEGIN</code>/<code class="command">COMMIT</code>, которые разделят её на несколько транзакций. (Подробнее о том, как сервер обрабатывает строки, включающие несколько команд, рассказывается в <a class="xref" href="protocol-flow.html#PROTOCOL-FLOW-MULTI-STATEMENT" title="55.2.2.1. Несколько операторов в простом протоколе запросов">Подразделе 55.2.2.1</a>.)</p></dd></dl></div><div class="refsect3" id="APP-PSQL-PATTERNS"><h4>Шаблоны поиска</h4><a id="id-1.9.4.20.8.4.11.2" class="indexterm"></a><p>Различные <code class="literal">\d</code> команды принимают параметр <em class="replaceable"><code>шаблон</code></em> для указания имени (имён) объектов для отображения. В простейшем случае шаблон — это точное имя объекта. Символы внутри шаблона обычно приводятся к нижнему регистру, как и для имён SQL-объектов; к примеру <code class="literal">\dt FOO</code> выводит таблицу с именем <code class="literal">foo</code>. Как и для SQL имён, двойные кавычки вокруг шаблона предотвращают перевод в нижний регистр. Для включения символа двойной кавычки в шаблон используются два символа двойных кавычек подряд внутри шаблона в двойных кавычках. Опять же, это соответствует правилам для SQL-идентификаторов. Например <code class="literal">\dt "FOO""BAR"</code> будет выводить таблицу с именем <code class="literal">FOO"BAR</code> (но не <code class="literal">foo"bar</code>). В отличие от обычных правил для SQL-имён, можно взять в двойные кавычки только часть шаблона, например <code class="literal">\dt FOO"FOO"BAR</code> будет выводить таблицу с именем <code class="literal">fooFOObar</code>.</p><p>Если <em class="replaceable"><code>шаблон</code></em> вообще не указан, команды <code class="literal">\d</code> выводят все объекты, видимые с текущим путём поиска схем. Это эквивалентно указанию <code class="literal">*</code> в качестве шаблона. (Объект считается <em class="firstterm">видимым</em>, если схема, к которой он относится, находится в пути поиска, и объект с таким же типом и именем в пути поиска ещё не встречался. Это эквивалентно утверждению, что на объект можно ссылаться по имени, без явного указания схемы.) Чтобы увидеть все объекты в базе данных, независимо от видимости, используйте в качестве шаблона <code class="literal">*.*</code>.</p><p>Внутри шаблона <code class="literal">*</code> обозначает любое количество символов, включая отсутствие символов. <code class="literal">?</code> соответствует любому одному символу. (Это соответствует шаблонам имён файлов в Unix.) Например, <code class="literal">\dt int*</code> отображает все таблицы, имена которых начинаются на <code class="literal">int</code>. Однако внутри двойных кавычек <code class="literal">*</code> и <code class="literal">?</code> теряют своё специальное значение и становятся обычными символами.</p><p>Шаблон отношения, содержащий точку (<code class="literal">.</code>), интерпретируется как шаблон имени схемы, за которым следует шаблон имени объекта. Например, <code class="literal">\dt foo*.*bar*</code> отображает все таблицы, имена которых включают <code class="literal">bar</code>, и расположенные в схемах, имена которых начинаются с <code class="literal">foo</code>. Шаблону, не содержащему точку, могут соответствовать только объекты текущей схемы. Опять же, точка внутри двойных кавычек теряет своё специальное значение. Шаблон отношения, содержащий 2 точки (<code class="literal">.</code>), интерпретируется как имя БД, за которым следуют шаблон имени схемы и шаблон имени объекта. Компонент с именем БД не будет восприниматься как шаблон, в нём должно указываться имя текущей подключённой базы; в противном случае возникнет ошибка.</p><p>Шаблон схемы, содержащий точку (<code class="literal">.</code>), интерпретируется как имя БД, за которым следует шаблон имени схемы. Например, <code class="literal">\dn mydb.*foo*</code> отображает все схемы, имена которых включают <code class="literal">foo</code>. Компонент с именем БД не будет восприниматься как шаблон, в нём должно указываться имя текущей подключённой базы; в противном случае возникнет ошибка.</p><p>Опытные пользователи могут использовать возможности регулярных выражений, такие как классы символов. Например <code class="literal">[0-9]</code> соответствует любой цифре. Все специальные символы регулярных выражений работают как описано в <a class="xref" href="functions-matching.html#FUNCTIONS-POSIX-REGEXP" title="9.7.3. Регулярные выражения POSIX">Подразделе 9.7.3</a>, за исключением: <code class="literal">.</code> используется в качестве разделителя, как говорилось выше; <code class="literal">*</code> соответствует регулярному выражению <code class="literal">.*</code>; <code class="literal">?</code> соответствует <code class="literal">.</code>, а также символ <code class="literal">$</code>, который не имеет специального значения. При необходимости эти символы можно эмулировать указывая <code class="literal">?</code> для эмуляции <code class="literal">.</code>, <code class="literal">(<em class="replaceable"><code>R</code></em>+|)</code> для <code class="literal"><em class="replaceable"><code>R</code></em>*</code>, <code class="literal">(<em class="replaceable"><code>R</code></em>|)</code> для <code class="literal"><em class="replaceable"><code>R</code></em>?</code>. <code class="literal">$</code> не требуется, как символ регулярного выражения, потому что шаблон должен соответствовать имени целиком, в отличие от обычной интерпретации регулярных выражений (другими словами, <code class="literal">$</code> автоматически добавляется в шаблон). Используйте <code class="literal">*</code> в начале и/или в конце, если не хотите, чтобы шаблон закреплялся. Обратите внимание, что внутри двойных кавычек, все специальные символы регулярных выражений теряют своё специальное значение и соответствуют сами себе. Также, специальные символы регулярных выражений не действуют в шаблонах для имён операторов (т. е. в аргументе команды <code class="literal">\do</code>).</p></div></div><div class="refsect2" id="id-1.9.4.20.8.5"><h3>Расширенные возможности</h3><div class="refsect3" id="APP-PSQL-VARIABLES"><h4>Переменные</h4><p><span class="application">psql</span> предоставляет возможности подстановки переменных подобные тем, что используются в командных оболочках Unix. Переменные представляют собой пары имя/значение, где значением может быть любая строка любой длины. Имя должно состоять из букв (включая нелатинские буквы), цифр и знаков подчёркивания.</p><p>Чтобы установить переменную, используется метакоманда <span class="application">psql</span> <code class="command">\set</code>. Например: </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>\set foo bar</code></strong></pre><p> присваивает переменной <code class="literal">foo</code> значение <code class="literal">bar</code>. Чтобы получить значение переменной, нужно поставить двоеточие перед её именем, например: </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>\echo :foo</code></strong>
bar</pre><p> Это работает как в обычных SQL-командах, так и в метакомандах; подробности в разделе <a class="xref" href="app-psql.html#APP-PSQL-INTERPOLATION" title="Интерполяция SQL">Интерполяция SQL</a> ниже.</p><p>При вызове <code class="command">\set</code> без второго аргумента переменной присваивается пустая строка. Для сброса (то есть удаления) переменной используйте команду <code class="command">\unset</code>. Чтобы посмотреть значения всех переменных, вызовите <code class="command">\set</code> без аргументов.</p><div class="note"><h3 class="title">Примечание</h3><p>На аргументы <code class="command">\set</code> распространяются те же правила подстановки, что и для других команд. Таким образом можно создавать интересные ссылки, например <code class="literal">\set :foo 'something'</code>, получая <span class="quote">«<span class="quote">мягкие ссылки</span>»</span> в <span class="productname">Perl</span> или <span class="quote">«<span class="quote">переменные переменных</span>»</span> в <span class="productname"><acronym class="acronym">PHP</acronym></span>. К сожалению (или к счастью?), с этими конструкциями нельзя сделать ничего полезного. С другой стороны, <code class="literal">\set bar :foo</code> является прекрасным способом копирования переменной.</p></div><p>Некоторые переменные обрабатываются в <span class="application">psql</span> особым образом. Они представляют собой определённые параметры, которые могут быть изменены во время выполнения путём присваивания нового значения, а в некоторых переменных содержится изменяемое состояние <span class="application">psql</span>. По соглашению, имена специальных переменных состоят только из заглавных ASCII-букв (и, возможно, цифр и знаков подчёркивания). Для максимальной совместимости в будущем старайтесь не использовать такие имена для собственных переменных.</p><p>Переменные, управляющие поведением <span class="application">psql</span>, обычно нельзя сбросить или задать для них недопустимые значения. Команда <code class="literal">\unset</code> для них допускается, но воспринимается как установка значения по умолчанию. Команда <code class="literal">\set</code> без второго аргумента воспринимается как присваивание переменной значения <code class="literal">on</code>, для управляющих переменных, принимающих это значение, и не принимается для других. Также управляющие переменные, принимающие значения <code class="literal">on</code> и <code class="literal">off</code>, примут и другие общепринятые написания логических значений, например <code class="literal">true</code> и <code class="literal">false</code>.</p><p>Специальные переменные:</p><div class="variablelist"><dl class="variablelist"><dt id="APP-PSQL-VARIABLES-AUTOCOMMIT"><span class="term">
       <code class="varname">AUTOCOMMIT</code>
       <a id="id-1.9.4.20.8.5.2.9.1.1.2" class="indexterm"></a>
      </span> <a href="#APP-PSQL-VARIABLES-AUTOCOMMIT" class="id_link">#</a></dt><dd><p>При значении <code class="literal">on</code> (по умолчанию) после каждой успешно выполненной команды выполняется фиксация изменений. Чтобы отложить фиксацию изменений в этом режиме, нужно выполнить SQL-команду <code class="command">BEGIN</code> или <code class="command">START TRANSACTION</code>. При значении <code class="literal">off</code> или если переменная не определена, фиксация изменений не происходит до тех пор, пока явно не выполнена команда <code class="command">COMMIT</code> или <code class="command">END</code>. При значении <code class="literal">off</code> неявно выполняется <code class="command">BEGIN</code> непосредственно перед любой командой, за исключением случаев когда: команда уже в транзакционном блоке; перед самой командой <code class="command">BEGIN</code> или другой командой управления транзакциями; перед командой, которая не может выполняться внутри транзакционного блока (например <code class="command">VACUUM</code>).</p><div class="note"><h3 class="title">Примечание</h3><p>Если режим <code class="literal">autocommit</code> отключён, необходимо явно откатывать изменения в неуспешных транзакциях, выполняя команду <code class="command">ABORT</code> или <code class="command">ROLLBACK</code>. Также имейте в виду, что при выходе из сеанса без фиксации изменений несохранённые изменения будут потеряны.</p></div><div class="note"><h3 class="title">Примечание</h3><p>Включённый режим <code class="literal">autocommit</code> является традиционным для <span class="productname">PostgreSQL</span>, а выключенный режим ближе к спецификации SQL. Если вы предпочитаете отключить режим <code class="literal">autocommit</code>, это можно сделать в общесистемном файле <code class="filename">psqlrc</code> или в персональном файле <code class="filename">~/.psqlrc</code>.</p></div></dd><dt id="APP-PSQL-VARIABLES-COMP-KEYWORD-CASE"><span class="term"><code class="varname">COMP_KEYWORD_CASE</code></span> <a href="#APP-PSQL-VARIABLES-COMP-KEYWORD-CASE" class="id_link">#</a></dt><dd><p>Определяет, какой регистр букв будет использован при автоматическом завершении ключевых слов SQL. Если установлено в <code class="literal">lower</code> или <code class="literal">upper</code>, будет использоваться нижний или верхний регистр соответственно. Если установлено в <code class="literal">preserve-lower</code> или <code class="literal">preserve-upper</code> (по умолчанию), то завершаемое слово будет в том же регистре, что и уже введённое начало слова, но последующие слова, завершаемые полностью, будут в нижнем или верхнем регистре соответственно.</p></dd><dt id="APP-PSQL-VARIABLES-DBNAME"><span class="term"><code class="varname">DBNAME</code></span> <a href="#APP-PSQL-VARIABLES-DBNAME" class="id_link">#</a></dt><dd><p>Имя базы данных, к которой вы сейчас подключены. Устанавливается всякий раз при подключении к базе данных (в том числе при старте программы), но эту переменную можно изменить или сбросить.</p></dd><dt id="APP-PSQL-VARIABLES-ECHO"><span class="term"><code class="varname">ECHO</code></span> <a href="#APP-PSQL-VARIABLES-ECHO" class="id_link">#</a></dt><dd><p>Со значением <code class="literal">all</code> все непустые входящие строки выдаются в стандартный вывод по мере их чтения. (Это не относится к строкам, считываемым интерактивно.) Чтобы выбрать такое поведение при запуске программы, добавьте ключ <code class="option">-a</code>. Со значением <code class="literal">queries</code> <span class="application">psql</span> выдаёт каждый запрос, отправляемый серверу, в стандартный вывод. Этому значению соответствует ключ <code class="option">-e</code>. Со значением <code class="literal">errors</code> в стандартный канал ошибок выдаются только запросы, вызвавшие ошибки. Ему соответствует ключ <code class="option">-b</code>. Со значением <code class="literal">none</code> (по умолчанию), никакие запросы не выводятся.</p></dd><dt id="APP-PSQL-VARIABLES-ECHO-HIDDEN"><span class="term"><code class="varname">ECHO_HIDDEN</code></span> <a href="#APP-PSQL-VARIABLES-ECHO-HIDDEN" class="id_link">#</a></dt><dd><p>Если эта переменная имеет значение <code class="literal">on</code> и метакоманда обращается к базе данных, сначала выводится текст нижележащего запроса. Это помогает изучать внутреннее устройство <span class="productname">PostgreSQL</span> и реализовывать похожую функциональность в своих программах. (Чтобы включить такое поведение при запуске программы, воспользуйтесь ключом <code class="option">-E</code>.) Если вы зададите для этой переменной значение <code class="literal">noexec</code>, запросы будут просто показываться, но не будут отправляться на сервер и выполняться. Значение по умолчанию — <code class="literal">off</code>.</p></dd><dt id="APP-PSQL-VARIABLES-ENCODING"><span class="term"><code class="varname">ENCODING</code></span> <a href="#APP-PSQL-VARIABLES-ENCODING" class="id_link">#</a></dt><dd><p>Текущая кодировка символов на стороне клиента. Устанавливается всякий раз при подключении к базе данных (в том числе при старте программы) и при смене кодировки командой <code class="literal">\encoding</code>, но эту переменную можно изменить или сбросить.</p></dd><dt id="APP-PSQL-VARIABLES-ERROR"><span class="term"><code class="varname">ERROR</code></span> <a href="#APP-PSQL-VARIABLES-ERROR" class="id_link">#</a></dt><dd><p><code class="literal">true</code> в случае ошибки последнего SQL-запроса, <code class="literal">false</code>, если он был выполнен успешно. См. также <code class="varname">SQLSTATE</code>.</p></dd><dt id="APP-PSQL-VARIABLES-FETCH-COUNT"><span class="term"><code class="varname">FETCH_COUNT</code></span> <a href="#APP-PSQL-VARIABLES-FETCH-COUNT" class="id_link">#</a></dt><dd><p>Если значение этой переменной — целое число больше нуля, результаты запросов <code class="command">SELECT</code> извлекаются из базы данных и отображаются группами с заданным количеством строк, в отличие от поведения по умолчанию, когда перед отображением результирующий набор накапливается целиком. Это позволяет использовать ограниченный размер памяти независимо от размера выборки. При включении этой функциональности обычно используются значения от 100 до 1000. Имейте в виду, что запрос может завершиться ошибкой после отображения некоторого количества строк.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Хотя можно использовать любой формат вывода, формат по умолчанию <code class="literal">aligned</code> как правило выглядит хуже, потому что каждая группа по <code class="varname">FETCH_COUNT</code> строк форматируется отдельно, что может привести к разной ширине столбцов в разных группах. Остальные форматы вывода работают лучше.</p></div></dd><dt id="APP-PSQL-VARIABLES-HIDE-TABLEAM"><span class="term"><code class="varname">HIDE_TABLEAM</code></span> <a href="#APP-PSQL-VARIABLES-HIDE-TABLEAM" class="id_link">#</a></dt><dd><p>Если эта переменная равна <code class="literal">true</code>, информация о методах доступа таблицы не выводится. Это полезно прежде всего для регрессионных тестов.</p></dd><dt id="APP-PSQL-VARIABLES-HIDE-TOAST-COMPRESSION"><span class="term"><code class="varname">HIDE_TOAST_COMPRESSION</code></span> <a href="#APP-PSQL-VARIABLES-HIDE-TOAST-COMPRESSION" class="id_link">#</a></dt><dd><p>Если эта переменная равна <code class="literal">true</code>, информация о методах сжатия столбцов не выводится. Это полезно прежде всего для регрессионных тестов.</p></dd><dt id="APP-PSQL-VARIABLES-HISTCONTROL"><span class="term"><code class="varname">HISTCONTROL</code></span> <a href="#APP-PSQL-VARIABLES-HISTCONTROL" class="id_link">#</a></dt><dd><p>Если переменная имеет значение <code class="literal">ignorespace</code>, строки, начинающиеся с пробела, не сохраняются в истории. Если она имеет значение <code class="literal">ignoredups</code>, в историю не добавляются строки, которые в ней уже есть. Значение <code class="literal">ignoreboth</code> объединяет эти два варианта. Со значением <code class="literal">none</code> (по умолчанию) в истории сохраняются все строки, считываемые в интерактивном режиме.</p><div class="note"><h3 class="title">Примечание</h3><p>Эта функциональность была бессовестно списана с <span class="application">Bash</span>.</p></div></dd><dt id="APP-PSQL-VARIABLES-HISTFILE"><span class="term"><code class="varname">HISTFILE</code></span> <a href="#APP-PSQL-VARIABLES-HISTFILE" class="id_link">#</a></dt><dd><p>Имя файла, в котором будет сохраняться список истории команд. Если эта переменная не определена, имя файла берётся из переменной окружения <code class="envar">PSQL_HISTORY</code>. Если и она не задана, используется имя по умолчанию — <code class="filename">~/.psql_history</code> или <code class="filename">%APPDATA%\postgresql\psql_history</code> в Windows. Например, если установить: </p><pre class="programlisting">\set HISTFILE ~/.psql_history-:DBNAME</pre><p> в <code class="filename">~/.psqlrc</code>, <span class="application">psql</span> будет вести отдельный файл истории для каждой базы данных.</p><div class="note"><h3 class="title">Примечание</h3><p>Эта функциональность была бессовестно списана с <span class="application">Bash</span>.</p></div></dd><dt id="APP-PSQL-VARIABLES-HISTSIZE"><span class="term"><code class="varname">HISTSIZE</code></span> <a href="#APP-PSQL-VARIABLES-HISTSIZE" class="id_link">#</a></dt><dd><p>Максимальное число команд, которые будут сохраняться в истории команд (по умолчанию 500). Если задано отрицательное значение, ограничение не накладывается.</p><div class="note"><h3 class="title">Примечание</h3><p>Эта функциональность была бессовестно списана с <span class="application">Bash</span>.</p></div></dd><dt id="APP-PSQL-VARIABLES-HOST"><span class="term"><code class="varname">HOST</code></span> <a href="#APP-PSQL-VARIABLES-HOST" class="id_link">#</a></dt><dd><p>Имя компьютера, где работает сервер базы данных, к которому вы сейчас подключены. Устанавливается всякий раз при подключении к базе данных (в том числе при старте программы), но эту переменную можно изменить или сбросить.</p></dd><dt id="APP-PSQL-VARIABLES-IGNOREEOF"><span class="term"><code class="varname">IGNOREEOF</code></span> <a href="#APP-PSQL-VARIABLES-IGNOREEOF" class="id_link">#</a></dt><dd><p>Если равно 1 или меньше, символ конца файла (<acronym class="acronym">EOF</acronym>, обычно передаётся сочетанием клавиш <span class="keycap"><strong>Control</strong></span>+<span class="keycap"><strong>D</strong></span>) в интерактивном сеансе <span class="application">psql</span> завершит работу приложения. Если значение больше 1, оно определяет, сколько последовательных символов <acronym class="acronym">EOF</acronym> нужно ввести, чтобы завершить интерактивный сеанс. Если значение переменной не является числовым, оно воспринимается как 10. По умолчанию — 0.</p><div class="note"><h3 class="title">Примечание</h3><p>Эта функциональность была бессовестно списана с <span class="application">Bash</span>.</p></div></dd><dt id="APP-PSQL-VARIABLES-LASTOID"><span class="term"><code class="varname">LASTOID</code></span> <a href="#APP-PSQL-VARIABLES-LASTOID" class="id_link">#</a></dt><dd><p>Содержит значение последнего OID, полученного командой <code class="command">INSERT</code> или <code class="command">\lo_import</code>. Корректное значение переменной гарантируется до тех пор, пока не будет отображён результат следующей <acronym class="acronym">SQL</acronym>-команды. Серверы <span class="productname">PostgreSQL</span> с 12 версии не поддерживают системные столбцы OID, поэтому при обращении к таким серверам после <code class="command">INSERT</code> всегда будет выдаваться нулевой LASTOID.</p></dd><dt id="APP-PSQL-VARIABLES-LAST-ERROR-MESSAGE"><span class="term"><code class="varname">LAST_ERROR_MESSAGE</code><br /></span><span class="term"><code class="varname">LAST_ERROR_SQLSTATE</code></span> <a href="#APP-PSQL-VARIABLES-LAST-ERROR-MESSAGE" class="id_link">#</a></dt><dd><p>Основное сообщение об ошибке и связанный код SQLSTATE для последнего неудавшегося запроса в текущем сеансе <span class="application">psql</span> либо пустая строка и <code class="literal">00000</code>, если в текущем сеансе не происходили ошибки.</p></dd><dt id="APP-PSQL-VARIABLES-ON-ERROR-ROLLBACK"><span class="term">
       <code class="varname">ON_ERROR_ROLLBACK</code>
       <a id="id-1.9.4.20.8.5.2.9.18.1.2" class="indexterm"></a>
      </span> <a href="#APP-PSQL-VARIABLES-ON-ERROR-ROLLBACK" class="id_link">#</a></dt><dd><p>При значении <code class="literal">on</code>, если команда в блоке транзакции выдаёт ошибку, ошибка игнорируется и транзакция продолжается. Со значением <code class="literal">interactive</code> такие ошибки игнорируются только в интерактивных сеансах, но не в скриптах. Со значением <code class="literal">off</code> (по умолчанию) команда в блоке транзакции, выдающая ошибку, прерывает всю транзакцию. Для реализации режима отката транзакции за вас неявно выполняется команда <code class="command">SAVEPOINT</code> непосредственно перед каждой командой в блоке транзакции, а в случае ошибки команды происходит откат к этой точке сохранения.</p></dd><dt id="APP-PSQL-VARIABLES-ON-ERROR-STOP"><span class="term"><code class="varname">ON_ERROR_STOP</code></span> <a href="#APP-PSQL-VARIABLES-ON-ERROR-STOP" class="id_link">#</a></dt><dd><p>По умолчанию, после возникновения ошибки обработка команд продолжается. Если эта переменная установлена в значение <code class="literal">on</code>, обработка команд будет немедленно прекращена. В интерактивном режиме <span class="application">psql</span> вернётся в командную строку; иначе <span class="application">psql</span> прекратит работу с кодом возврата 3, чтобы отличить этот случай от критических ошибок, для которых используется код возврата 1. В любом случае выполнение всех запущенных скриптов (высокоуровневый скрипт и любые другие, которые он мог запустить) будет немедленно прекращено. Если высокоуровневая командная строка содержит несколько SQL-команд, выполнение завершится на текущей команде.</p></dd><dt id="APP-PSQL-VARIABLES-PORT"><span class="term"><code class="varname">PORT</code></span> <a href="#APP-PSQL-VARIABLES-PORT" class="id_link">#</a></dt><dd><p>Содержит порт сервера базы данных, к которому вы сейчас подключены. Устанавливается всякий раз при подключении к базе данных (в том числе при старте программы), но эту переменную можно изменить или сбросить.</p></dd><dt id="APP-PSQL-VARIABLES-PROMPT"><span class="term"><code class="varname">PROMPT1</code><br /></span><span class="term"><code class="varname">PROMPT2</code><br /></span><span class="term"><code class="varname">PROMPT3</code></span> <a href="#APP-PSQL-VARIABLES-PROMPT" class="id_link">#</a></dt><dd><p>Указывают, как должны выглядеть приглашения <span class="application">psql</span>. См. раздел <a class="xref" href="app-psql.html#APP-PSQL-PROMPTING" title="Настройка приглашений">Настройка приглашений</a> ниже.</p></dd><dt id="APP-PSQL-VARIABLES-QUIET"><span class="term"><code class="varname">QUIET</code></span> <a href="#APP-PSQL-VARIABLES-QUIET" class="id_link">#</a></dt><dd><p>Установка значения <code class="literal">on</code> эквивалента параметру командной строки <code class="option">-q</code>. Это, вероятно, не слишком полезно в интерактивном режиме.</p></dd><dt id="APP-PSQL-VARIABLES-ROW-COUNT"><span class="term"><code class="varname">ROW_COUNT</code></span> <a href="#APP-PSQL-VARIABLES-ROW-COUNT" class="id_link">#</a></dt><dd><p>Число строк, возвращённых или обработанных последним SQL-запросом, либо 0, если запрос завершился неудачно или не возвратил количество строк.</p></dd><dt id="APP-PSQL-VARIABLES-SERVER-VERSION-NAME"><span class="term"><code class="varname">SERVER_VERSION_NAME</code><br /></span><span class="term"><code class="varname">SERVER_VERSION_NUM</code></span> <a href="#APP-PSQL-VARIABLES-SERVER-VERSION-NAME" class="id_link">#</a></dt><dd><p>Номер версии сервера в виде строки, например <code class="literal">9.6.2</code>, <code class="literal">10.1</code> или <code class="literal">11beta1</code>, и в числовом виде, например, <code class="literal">90602</code> или <code class="literal">100001</code>. Они устанавливаются при каждом подключении к базе данных (в том числе при запуске программы), но их можно изменить или сбросить.</p></dd><dt id="APP-PSQL-VARIABLES-SHELL-ERROR"><span class="term"><code class="varname">SHELL_ERROR</code></span> <a href="#APP-PSQL-VARIABLES-SHELL-ERROR" class="id_link">#</a></dt><dd><p><code class="literal">true</code>, если последняя команда оболочки завершилась ошибкой, <code class="literal">false</code> — если она была выполнена успешно. Устанавливается для команд оболочки, вызываемых метакомандами <code class="literal">\!</code>, <code class="literal">\g</code>, <code class="literal">\o</code>, <code class="literal">\w</code> и <code class="literal">\copy</code>, а также командами в обратных кавычках (<code class="literal">`</code>). Обратите внимание, что для <code class="literal">\o</code> эта переменная обновляется, когда канал вывода закрывается следующей командой <code class="literal">\o</code>. См. также <code class="varname">SHELL_EXIT_CODE</code>.</p></dd><dt id="APP-PSQL-VARIABLES-SHELL-EXIT-CODE"><span class="term"><code class="varname">SHELL_EXIT_CODE</code></span> <a href="#APP-PSQL-VARIABLES-SHELL-EXIT-CODE" class="id_link">#</a></dt><dd><p>Код завершения, возвращаемый последней командой оболочки. 0–127 представляют собой коды завершения программы, 128–255 указывают на завершение работы по сигналу, -1 указывает, что невозможно запустить программу или получить код завершения. Устанавливается для команд оболочки, вызываемых метакомандами <code class="literal">\!</code>, <code class="literal">\g</code>, <code class="literal">\o</code>, <code class="literal">\w</code> и <code class="literal">\copy</code>, а также командами в обратных кавычках (<code class="literal">`</code>). Обратите внимание, что для <code class="literal">\o</code> эта переменная обновляется, когда канал вывода закрывается следующей командой <code class="literal">\o</code>. См. также <code class="varname">SHELL_ERROR</code>.</p></dd><dt id="APP-PSQL-VARIABLES-SHOW-ALL-RESULTS"><span class="term"><code class="varname">SHOW_ALL_RESULTS</code></span> <a href="#APP-PSQL-VARIABLES-SHOW-ALL-RESULTS" class="id_link">#</a></dt><dd><p>Когда эта переменная имеет значение <code class="literal">off</code> (выкл.), выводятся не все результаты объединённого (с использованием <code class="literal">\;</code>) запроса, а только последний. Это поведение реализовано для совместимости со старыми версиями <span class="application">psql</span>. По умолчанию <code class="literal">on</code> (вкл.).</p></dd><dt id="APP-PSQL-VARIABLES-SHOW-CONTEXT"><span class="term"><code class="varname">SHOW_CONTEXT</code></span> <a href="#APP-PSQL-VARIABLES-SHOW-CONTEXT" class="id_link">#</a></dt><dd><p>Этой переменной можно присвоить значения <code class="literal">never</code> (никогда), <code class="literal">errors</code> (ошибки) или <code class="literal">always</code> (всегда), определяющие, когда в сообщениях с сервера будут выводиться поля <code class="literal">КОНТЕКСТ</code>. По умолчанию выбран вариант <code class="literal">errors</code> (который означает, что контекст будет выводиться в сообщениях об ошибках, но не в предупреждениях и уведомлениях). Этот параметр не действует, когда установлен уровень <code class="varname">VERBOSITY</code> <code class="literal">terse</code> или <code class="literal">sqlstate</code>. (Когда вам потребуется подробная версия только что выданной ошибки, может быть полезна команда <code class="command">\errverbose</code>.)</p></dd><dt id="APP-PSQL-VARIABLES-SINGLELINE"><span class="term"><code class="varname">SINGLELINE</code></span> <a href="#APP-PSQL-VARIABLES-SINGLELINE" class="id_link">#</a></dt><dd><p>Установка значения <code class="literal">on</code> эквивалентна параметру командной строки <code class="option">-S</code>.</p></dd><dt id="APP-PSQL-VARIABLES-SINGLESTEP"><span class="term"><code class="varname">SINGLESTEP</code></span> <a href="#APP-PSQL-VARIABLES-SINGLESTEP" class="id_link">#</a></dt><dd><p>Эта переменная эквивалентна параметру командной строки <code class="option">-s</code>.</p></dd><dt id="APP-PSQL-VARIABLES-SQLSTATE"><span class="term"><code class="varname">SQLSTATE</code></span> <a href="#APP-PSQL-VARIABLES-SQLSTATE" class="id_link">#</a></dt><dd><p>Код ошибки (см. <a class="xref" href="errcodes-appendix.html" title="Приложение A. Коды ошибок PostgreSQL">Приложение A</a>), связанной с неудачным выполнением последнего SQL-запроса, либо <code class="literal">00000</code> в случае его успешного завершения.</p></dd><dt id="APP-PSQL-VARIABLES-USER"><span class="term"><code class="varname">USER</code></span> <a href="#APP-PSQL-VARIABLES-USER" class="id_link">#</a></dt><dd><p>Содержит имя пользователя базы данных, который сейчас подключён. Устанавливается всякий раз при подключении к базе данных (в том числе при старте программы), но эту переменную можно изменить или сбросить.</p></dd><dt id="APP-PSQL-VARIABLES-VERBOSITY"><span class="term"><code class="varname">VERBOSITY</code></span> <a href="#APP-PSQL-VARIABLES-VERBOSITY" class="id_link">#</a></dt><dd><p>Этой переменной можно присвоить значения <code class="literal">default</code>, <code class="literal">verbose</code>, <code class="literal">terse</code> или <code class="literal">sqlstate</code> для изменения уровня детализации в сообщениях об ошибках. (См. также команду <code class="command">\errverbose</code>, полезную, когда требуется подробная версия только что выданной ошибки.)</p></dd><dt id="APP-PSQL-VARIABLES-VERSION"><span class="term"><code class="varname">VERSION</code><br /></span><span class="term"><code class="varname">VERSION_NAME</code><br /></span><span class="term"><code class="varname">VERSION_NUM</code></span> <a href="#APP-PSQL-VARIABLES-VERSION" class="id_link">#</a></dt><dd><p>Эти переменные устанавливаются при запуске программы и отражают версию <span class="application">psql</span> соответственно в виде развёрнутой строки, краткой строки (например, <code class="literal">9.6.2</code>, <code class="literal">10.1</code> или <code class="literal">11beta1</code>) и числа (например, <code class="literal">90602</code> или <code class="literal">100001</code>). Их можно изменить или сбросить.</p></dd></dl></div></div><div class="refsect3" id="APP-PSQL-INTERPOLATION"><h4>Интерполяция <acronym class="acronym">SQL</acronym></h4><p>Ключевой особенностью переменных <span class="application">psql</span> является возможность подставлять (<span class="quote">«<span class="quote">интерполировать</span>»</span>) их в команды <acronym class="acronym">SQL</acronym>, так же как и в аргументы метакоманд. Кроме того, <span class="application">psql</span> предоставляет средства для корректного использования кавычек для значений переменных, которые используются как литералы или идентификаторы SQL. Чтобы подставить значение без кавычек, нужно добавить перед именем переменной двоеточие (<code class="literal">:</code>). Например: </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>\set foo 'my_table'</code></strong>
testdb=&gt; <strong class="userinput"><code>SELECT * FROM :foo;</code></strong></pre><p> будет запрашивать таблицу <code class="literal">my_table</code>. Обратите внимание, что это может быть небезопасным: значение переменной копируется буквально, поэтому оно может содержать непарные кавычки или даже метакоманды. При применении необходимо убедиться, что это имеет смысл.</p><p>Когда значение будет использоваться в качестве SQL литерала или идентификатора, безопаснее заключить его в кавычки. Если значение переменной используется как SQL литерал, то после двоеточия нужно написать имя переменной в одинарных кавычках. Если значение переменной используется как SQL идентификатор, то после двоеточия нужно написать имя переменной в двойных кавычках. Эти конструкции корректно работают с кавычками и другими специальными символами, которые могут содержаться в значении переменной. Предыдущий пример более безопасно выглядит так: </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>\set foo 'my_table'</code></strong>
testdb=&gt; <strong class="userinput"><code>SELECT * FROM :"foo";</code></strong></pre><p>Подстановка переменных не будет выполняться, если <acronym class="acronym">SQL</acronym> литералы или идентификаторы заключены в кавычки. Поэтому конструкция <code class="literal">':foo'</code> не превратится во взятое в кавычки значение переменной (и это было бы небезопасно, если бы работало, так как обработка кавычек внутри значения переменной была бы некорректной).</p><p>Один из примеров использования данного механизма — это копирование содержимого файла в столбец таблицы. Сначала загрузим содержимое файла в переменную, затем подставим значение переменной как строку в кавычках: </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>\set content `cat my_file.txt`</code></strong>
testdb=&gt; <strong class="userinput"><code>INSERT INTO my_table VALUES (:'content');</code></strong></pre><p> (Отметим, что это пока не будет работать, если <code class="filename">my_file.txt</code> содержит байт NUL. <span class="application">psql</span> не поддерживает NUL в значениях переменных.)</p><p>Так как двоеточие может легально присутствовать в SQL-командах, попытка подстановки (например для <code class="literal">:name</code>, <code class="literal">:'name'</code> или <code class="literal">:"name"</code>) не выполняется, если переменная не установлена. В любом случае можно экранировать двоеточие с помощью обратной косой черты, чтобы предотвратить подстановку.</p><p>Специальная конструкция <code class="literal">:{?<em class="replaceable"><code>имя</code></em>}</code> возвращает TRUE или FALSE в зависимости от того, существует ли переменная, и таким образом всегда подменяется значением, если только двоеточие не экранировано обратной косой чертой.</p><p>Использование двоеточия для переменных является стандартом <acronym class="acronym">SQL</acronym> для встраиваемых языков запросов, таких как <span class="application">ECPG</span>. Использование двоеточия для срезов массивов и приведения типов является расширениями <span class="productname">PostgreSQL</span>, что иногда может конфликтовать со стандартным использованием. Использование двоеточия и кавычек для экранирования значения переменной при подстановке в качестве SQL литерала или идентификатора — это расширение <span class="application">psql</span>.</p></div><div class="refsect3" id="APP-PSQL-PROMPTING"><h4>Настройка приглашений</h4><p>Приглашения, выдаваемые <span class="application">psql</span>, можно настроить по своему вкусу. Три переменные <code class="varname">PROMPT1</code>, <code class="varname">PROMPT2</code> и <code class="varname">PROMPT3</code> содержат строки и спецпоследовательности, задающие внешний вид приглашения. Приглашение 1 (<code class="varname">PROMPT1</code>) — это обычное приглашение, которое выдаётся, когда <span class="application">psql</span> ожидает ввода новой команды. Приглашение 2 (<code class="varname">PROMPT2</code>) выдаётся, когда при вводе команды ожидается дополнительные строки, например потому что команда не была завершена точкой с запятой или не закрыты кавычки. Приглашение 3 (<code class="varname">PROMPT3</code>) выдаётся при выполнении <acronym class="acronym">SQL</acronym>-команды <code class="command">COPY FROM STDIN</code>, когда в терминале нужно ввести значение новой строки.</p><p>Значения этих переменных выводятся буквально, за исключением случаев, когда в них встречается знак процента (<code class="literal">%</code>). В зависимости от следующего символа будет подставляться определённый текст. Существуют следующие подстановки: </p><div class="variablelist"><dl class="variablelist"><dt id="APP-PSQL-PROMPTING-M-UC"><span class="term"><code class="literal">%M</code></span> <a href="#APP-PSQL-PROMPTING-M-UC" class="id_link">#</a></dt><dd><p>Полное имя компьютера (с именем домена) сервера базы данных или <code class="literal">[local]</code>, если подключение выполнено через Unix-сокет, либо <code class="literal">[local:<em class="replaceable"><code>/каталог/имя</code></em>]</code>, если при компиляции был изменён путь Unix-сокета по умолчанию.</p></dd><dt id="APP-PSQL-PROMPTING-M-LC"><span class="term"><code class="literal">%m</code></span> <a href="#APP-PSQL-PROMPTING-M-LC" class="id_link">#</a></dt><dd><p>Имя компьютера, где работает сервер баз данных, усечённое до первой точки или <code class="literal">[local]</code>, если подключение выполнено через Unix-сокет.</p></dd><dt id="APP-PSQL-PROMPTING-GT"><span class="term"><code class="literal">%&gt;</code></span> <a href="#APP-PSQL-PROMPTING-GT" class="id_link">#</a></dt><dd><p>Номер порта, который прослушивает сервер базы данных.</p></dd><dt id="APP-PSQL-PROMPTING-N"><span class="term"><code class="literal">%n</code></span> <a href="#APP-PSQL-PROMPTING-N" class="id_link">#</a></dt><dd><p>Имя пользователя базы данных для текущего сеанса. (Это значение может меняться в течение сеанса в результате выполнения команды <code class="command">SET SESSION AUTHORIZATION</code>.)</p></dd><dt id="APP-PSQL-PROMPTING-SLASH"><span class="term"><code class="literal">%/</code></span> <a href="#APP-PSQL-PROMPTING-SLASH" class="id_link">#</a></dt><dd><p>Имя текущей базы данных.</p></dd><dt id="APP-PSQL-PROMPTING-TILDE"><span class="term"><code class="literal">%~</code></span> <a href="#APP-PSQL-PROMPTING-TILDE" class="id_link">#</a></dt><dd><p>Похоже на <code class="literal">%/</code>, но выводит тильду <code class="literal">~</code>, если текущая база данных совпадает с базой данных по умолчанию.</p></dd><dt id="APP-PSQL-PROMPTING-NUMBERSIGN"><span class="term"><code class="literal">%#</code></span> <a href="#APP-PSQL-PROMPTING-NUMBERSIGN" class="id_link">#</a></dt><dd><p>Если пользователь текущего сеанса является суперпользователем базы данных, то выводит <code class="literal">#</code>, иначе <code class="literal">&gt;</code>. (Это значение может меняться в течение сеанса в результате выполнения команды <code class="command">SET SESSION AUTHORIZATION</code>.)</p></dd><dt id="APP-PSQL-PROMPTING-P"><span class="term"><code class="literal">%p</code></span> <a href="#APP-PSQL-PROMPTING-P" class="id_link">#</a></dt><dd><p>PID обслуживающего процесса для текущего подключения.</p></dd><dt id="APP-PSQL-PROMPTING-R"><span class="term"><code class="literal">%R</code></span> <a href="#APP-PSQL-PROMPTING-R" class="id_link">#</a></dt><dd><p>В приглашении 1 это обычно символ <code class="literal">=</code>, но <code class="literal">@</code>, если сеанс находится в неактивной ветви блока условия, либо <code class="literal">^</code> в однострочном режиме либо <code class="literal">!</code>, если сеанс не подключён к базе данных (что возможно при ошибке <code class="command">\connect</code>). В приглашении 2 <code class="literal">%R</code> заменяется символом, показывающим, почему <span class="application">psql</span> ожидает дополнительный ввод: <code class="literal">-</code>, если команда просто ещё не была завершена, но <code class="literal">*</code>, если не завершён комментарий <code class="literal">/* ... */</code>; апостроф, если не завершена строка в апострофах; кавычки, если не завершён идентификатор в кавычках; знак доллара, если не завершена строка в долларах; либо <code class="literal">(</code>, если после открывающей скобки не хватает закрывающей. В приглашении 3 <code class="literal">%R</code> не выдаёт ничего.</p></dd><dt id="APP-PSQL-PROMPTING-X"><span class="term"><code class="literal">%x</code></span> <a href="#APP-PSQL-PROMPTING-X" class="id_link">#</a></dt><dd><p>Состояние транзакции: пустая строка, если не в транзакционном блоке; <code class="literal">*</code>, когда в транзакционном блоке; <code class="literal">!</code>, когда в транзакционном блоке, в котором произошла ошибка и <code class="literal">?</code>, когда состояние транзакции не определено (например, нет подключения к базе данных).</p></dd><dt id="APP-PSQL-PROMPTING-L"><span class="term"><code class="literal">%l</code></span> <a href="#APP-PSQL-PROMPTING-L" class="id_link">#</a></dt><dd><p>Номер строки в текущем операторе, начиная с <code class="literal">1</code>.</p></dd><dt id="APP-PSQL-PROMPTING-DIGITS"><span class="term"><code class="literal">%</code><em class="replaceable"><code>цифры</code></em></span> <a href="#APP-PSQL-PROMPTING-DIGITS" class="id_link">#</a></dt><dd><p>Подставляется символ с указанным восьмеричным кодом.</p></dd><dt id="APP-PSQL-PROMPTING-NAME"><span class="term"><code class="literal">%:</code><em class="replaceable"><code>имя</code></em><code class="literal">:</code></span> <a href="#APP-PSQL-PROMPTING-NAME" class="id_link">#</a></dt><dd><p>Значение переменной <span class="application">psql</span> <em class="replaceable"><code>имя</code></em>. За подробностями обратитесь к разделу <a class="xref" href="app-psql.html#APP-PSQL-VARIABLES" title="Переменные">Переменные</a> выше.</p></dd><dt id="APP-PSQL-PROMPTING-COMMAND"><span class="term"><code class="literal">%`</code><em class="replaceable"><code>команда</code></em><code class="literal">`</code></span> <a href="#APP-PSQL-PROMPTING-COMMAND" class="id_link">#</a></dt><dd><p>Подставляется вывод <em class="replaceable"><code>команды</code></em>, как и в обычной подстановке с обратными апострофами.</p></dd><dt id="APP-PSQL-PROMPTING-SQUARE-BRACKETS"><span class="term"><code class="literal">%[</code> ... <code class="literal">%]</code></span> <a href="#APP-PSQL-PROMPTING-SQUARE-BRACKETS" class="id_link">#</a></dt><dd><p>Приглашения могут содержать управляющие символы терминала, которые, например, изменяют цвет, фон и стиль текста приглашения или изменяют заголовок окна терминала. Для того, чтобы возможности редактирования <span class="application">Readline</span> работали правильно, непечатаемые символы нужно расположить между <code class="literal">%[</code> и <code class="literal">%]</code>, чтобы сделать невидимыми. Можно делать несколько таких включений в приглашение. Например: </p><pre class="programlisting">testdb=&gt; \set PROMPT1 '%[%033[1;33;40m%]%n@%/%R%[%033[0m%]%# '</pre><p> выдаст жирное (<code class="literal">1;</code>), желтое на черном (<code class="literal">33;40</code>) приглашение для VT100 совместимых цветных терминалов.</p></dd><dt id="APP-PSQL-PROMPTING-W"><span class="term"><code class="literal">%w</code></span> <a href="#APP-PSQL-PROMPTING-W" class="id_link">#</a></dt><dd><p>Пробелы, дающие тот же отступ, что и в выданном последним приглашении <code class="varname">PROMPT1</code>. Это значение можно использовать в <code class="varname">PROMPT2</code>, чтобы многострочные операторы были выровнены по первой строке, но при этом вторичного приглашения не было видно.</p></dd></dl></div><p> Чтобы вставить знак процента, нужно написать <code class="literal">%%</code>. По умолчанию для <code class="varname">PROMPT1</code> и <code class="varname">PROMPT2</code> используется значение <code class="literal">'%/%R%x%# '</code>, а для <code class="varname">PROMPT3</code> — <code class="literal">'&gt;&gt; '</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>Эта функциональность была бессовестно списана с <span class="application">tcsh</span>.</p></div></div><div class="refsect3" id="APP-PSQL-READLINE"><h4>Редактирование командной строки</h4><a id="id-1.9.4.20.8.5.5.2" class="indexterm"></a><a id="id-1.9.4.20.8.5.5.3" class="indexterm"></a><p>Программа <span class="application">psql</span> использует библиотеку <span class="application">Readline</span> или <span class="application">libedit</span>, если она доступна, для удобства редактирования текущей строки команд и для возврата к предыдущим. История команд автоматически сохраняется при выходе из <span class="application">psql</span> и загружается при запуске. Вызвать предыдущие строки из истории можно, нажимая клавишу <span class="quote">«<span class="quote">стрелка вверх</span>»</span> или Control-P.</p><p>Вы также можете использовать дополнение табуляцией для завершения частично введённых ключевых слов и имён объектов SQL во многих (но не во всех) контекстах. Например, если в начале команды ввести <code class="literal">ins</code> и нажать <code class="literal">TAB</code>, вы получите <code class="literal">insert into</code>. Если затем набрать несколько символов имени таблицы или схемы и нажать клавишу <code class="literal">TAB</code>, неоконченное имя будет дополнено либо будет предложен список возможных вариантов дополнения, если их несколько. (В зависимости от используемой библиотеки может потребоваться нажать <code class="literal">TAB</code> более одного раза, чтобы вызвать этот список.)</p><p>Чтобы дополнение табуляцией работало для имён объектов SQL, необходимо передавать серверу запросы для получения возможных вариантов. В некоторых контекстах это может мешать другим операциям. Например, выполнять после <code class="command">BEGIN</code> команду <code class="command">SET TRANSACTION ISOLATION LEVEL</code> будет поздно, если между ними вклинится запрос, выполняемый для дополнения табуляцией. Если вам вообще не нужно дополнение табуляцией, вы можете отключить его навсегда, добавив следующие строки в файл с именем <code class="filename">.inputrc</code> в вашем домашнем каталоге: </p><pre class="programlisting">$if psql
set disable-completion on
$endif</pre><p> (Это возможность <span class="application">Readline</span>, а не <span class="application">psql</span>. За подробностями обратитесь к документации <span class="application">Readline</span>.)</p><p>Чтобы отказаться от использования <span class="application">Readline</span> в текущем сеансе <span class="application">psql</span>, также можно воспользоваться параметром командной строки <code class="option">-n</code> (<code class="option">--no-readline</code>). Этот параметр отключает дополнение табуляцией, использование и запись истории команд, а также редактирование многострочных команд. Это может быть полезно, когда нужно скопировать и вставить текст, содержащий символы <code class="literal">TAB</code>.</p></div></div></div><div class="refsect1" id="APP-PSQL-ENVIRONMENT"><h2>Переменные окружения</h2><div class="variablelist"><dl class="variablelist"><dt id="APP-PSQL-ENVIRONMENT-COLUMNS"><span class="term"><code class="envar">COLUMNS</code></span> <a href="#APP-PSQL-ENVIRONMENT-COLUMNS" class="id_link">#</a></dt><dd><p>Если <code class="literal">\pset columns</code> равно нулю, управляет шириной формата вывода <code class="literal">wrapped</code>, а также определяет, нужно ли использовать постраничник и нужно ли переключаться в вертикальный формат в режиме <code class="literal">expanded auto</code>.</p></dd><dt id="APP-PSQL-ENVIRONMENT-PGDATABASE"><span class="term"><code class="envar">PGDATABASE</code><br /></span><span class="term"><code class="envar">PGHOST</code><br /></span><span class="term"><code class="envar">PGPORT</code><br /></span><span class="term"><code class="envar">PGUSER</code></span> <a href="#APP-PSQL-ENVIRONMENT-PGDATABASE" class="id_link">#</a></dt><dd><p>Параметры подключения по умолчанию (см. <a class="xref" href="libpq-envars.html" title="34.15. Переменные окружения">Раздел 34.15</a>).</p></dd><dt id="APP-PSQL-ENVIRONMENT-PG-COLOR"><span class="term"><code class="envar">PG_COLOR</code></span> <a href="#APP-PSQL-ENVIRONMENT-PG-COLOR" class="id_link">#</a></dt><dd><p>Выбирает вариант использования цвета в диагностических сообщениях. Возможные значения: <code class="literal">always</code> (всегда), <code class="literal">auto</code> (автоматически) и <code class="literal">never</code> (никогда).</p></dd><dt id="APP-PSQL-ENVIRONMENT-PSQL-EDITOR"><span class="term"><code class="envar">PSQL_EDITOR</code><br /></span><span class="term"><code class="envar">EDITOR</code><br /></span><span class="term"><code class="envar">VISUAL</code></span> <a href="#APP-PSQL-ENVIRONMENT-PSQL-EDITOR" class="id_link">#</a></dt><dd><p>Редактор, используемый командами <code class="command">\e</code>, <code class="command">\ef</code> и <code class="command">\ev</code>. Эти переменные рассматриваются в том же порядке; в силу вступает первое установленное значение. Если ни одна из переменных не установлена, по умолчанию в Unix-системах используется <code class="filename">vi</code>, а в Windows — <code class="filename">notepad.exe</code>.</p></dd><dt id="APP-PSQL-ENVIRONMENT-PSQL-EDITOR-LINENUMBER-ARG"><span class="term"><code class="envar">PSQL_EDITOR_LINENUMBER_ARG</code></span> <a href="#APP-PSQL-ENVIRONMENT-PSQL-EDITOR-LINENUMBER-ARG" class="id_link">#</a></dt><dd><p>Если в командах <code class="command">\e</code>, <code class="command">\ef</code> или <code class="command">\ev</code> указан номер строки, эта переменная задаёт аргумент командной строки, с которым номер строки может быть передан в редактор. Например, для редакторов <span class="productname">Emacs</span> и <span class="productname">vi</span> это знак плюс. Добавьте в конец значения пробел, если он требуется для отделения имени аргумента от номера строки. Примеры: </p><pre class="programlisting">PSQL_EDITOR_LINENUMBER_ARG='+'
PSQL_EDITOR_LINENUMBER_ARG='--line '</pre><p>Значение по умолчанию <code class="literal">+</code> в Unix-подобных системах (соответствует редактору по умолчанию <code class="filename">vi</code> и многим другим распространённым редакторам). На платформе Windows нет значения по умолчанию.</p></dd><dt id="APP-PSQL-ENVIRONMENT-PSQL-HISTORY"><span class="term"><code class="envar">PSQL_HISTORY</code></span> <a href="#APP-PSQL-ENVIRONMENT-PSQL-HISTORY" class="id_link">#</a></dt><dd><p>Альтернативное расположение файла с историей команд. Допускается использование тильды (<code class="literal">~</code>).</p></dd><dt id="APP-PSQL-ENVIRONMENT-PAGER"><span class="term"><code class="envar">PSQL_PAGER</code><br /></span><span class="term"><code class="envar">PAGER</code></span> <a href="#APP-PSQL-ENVIRONMENT-PAGER" class="id_link">#</a></dt><dd><p>Если результат запроса не помещается на экране, он пропускается через эту программу. Обычно это <code class="literal">more</code> или <code class="literal">less</code>. От использования постраничника можно отказаться, присвоив переменной <code class="envar">PSQL_PAGER</code> или <code class="envar">PAGER</code> пустую строку, либо изменив соответствующие параметры с помощью команды <code class="command">\pset</code>. Данные переменные просматриваются в этом же порядке; используется первая установленная. Если не установлена ни одна из переменных, в большинстве платформ используется <code class="literal">more</code>, а в Cygwin — <code class="literal">less</code>.</p></dd><dt id="APP-PSQL-ENVIRONMENT-PSQL-WATCH-PAGER"><span class="term"><code class="envar">PSQL_WATCH_PAGER</code></span> <a href="#APP-PSQL-ENVIRONMENT-PSQL-WATCH-PAGER" class="id_link">#</a></dt><dd><p>Когда команда <code class="command">\watch</code> повторяет один и тот же запрос, постраничник по умолчанию не используется. Это поведение можно изменить, указав в <code class="envar">PSQL_WATCH_PAGER</code> команду для вызова постраничника (в системах Unix). Постраничник <code class="literal">pspg</code> (не являющийся частью <span class="productname">PostgreSQL</span>, но имеющийся во многих дистрибутивах открытого программного обеспечения) может отображать вывод <code class="command">\watch</code>, если передать ему ключ <code class="literal">--stream</code>.</p></dd><dt id="APP-PSQL-ENVIRONMENT-PSQLRC"><span class="term"><code class="envar">PSQLRC</code></span> <a href="#APP-PSQL-ENVIRONMENT-PSQLRC" class="id_link">#</a></dt><dd><p>Альтернативное расположение пользовательского файла <code class="filename">.psqlrc</code>. Допускается использование тильды (<code class="literal">~</code>).</p></dd><dt id="APP-PSQL-ENVIRONMENT-SHELL"><span class="term"><code class="envar">SHELL</code></span> <a href="#APP-PSQL-ENVIRONMENT-SHELL" class="id_link">#</a></dt><dd><p>Команда операционной системы, выполняемая метакомандой <code class="command">\!</code>.</p></dd><dt id="APP-PSQL-ENVIRONMENT-TMPDIR"><span class="term"><code class="envar">TMPDIR</code></span> <a href="#APP-PSQL-ENVIRONMENT-TMPDIR" class="id_link">#</a></dt><dd><p>Каталог для хранения временных файлов. По умолчанию <code class="filename">/tmp</code>.</p></dd></dl></div><p>Эта утилита, как и большинство других утилит <span class="productname">PostgreSQL</span>, также использует переменные среды, поддерживаемые <span class="application">libpq</span> (см. <a class="xref" href="libpq-envars.html" title="34.15. Переменные окружения">Раздел 34.15</a>).</p></div><div class="refsect1" id="id-1.9.4.20.10"><h2>Файлы</h2><div class="variablelist"><dl class="variablelist"><dt id="APP-PSQL-FILES-PSQLRC"><span class="term"><code class="filename">psqlrc</code> и <code class="filename">~/.psqlrc</code></span> <a href="#APP-PSQL-FILES-PSQLRC" class="id_link">#</a></dt><dd><p>При запуске без параметра <code class="option">-X</code> программа <span class="application">psql</span> пытается считать и выполнить команды из общесистемного стартового файла (<code class="filename">psqlrc</code>), а затем из персонального стартового файла пользователя (<code class="filename">~/.psqlrc</code>), после подключения к базе данных, но перед получением обычных команд. Этими файлами можно воспользоваться для настройки клиента и/или сервера, как правило, с помощью команд <code class="command">\set</code> и <code class="command">SET</code>.</p><p>Общесистемный стартовый файл называется <code class="filename">psqlrc</code>, по умолчанию он будет искаться в каталоге установки <span class="quote">«<span class="quote">конфигурация системы</span>»</span>. Для того чтобы узнать этот каталог, надёжнее всего выполнить команду <code class="literal">pg_config --sysconfdir</code>. Обычно он расположен в <code class="filename">../etc/</code> относительно каталога, содержащего исполняемые файлы <span class="productname">PostgreSQL</span>. Путь к этому каталогу также можно задать явно в переменной окружения <code class="envar">PGSYSCONFDIR</code>.</p><p>Персональный стартовый файл пользователя называется <code class="filename">.psqlrc</code>, он будет искаться в домашнем каталоге вызывающего пользователя. В Windows путь к персональному стартовому файлу — <code class="filename">%APPDATA%\postgresql\psqlrc.conf</code>. В любом случае подразумеваемый по умолчанию путь можно переопределить, установив переменную окружения <code class="envar">PSQLRC</code>.</p><p>Оба стартовых файла, общесистемный и персональный, можно привязать к конкретной версии <span class="application">psql</span>, добавив минус и идентификатор основной или дополнительной версии <span class="productname">PostgreSQL</span> к имени файла, например: <code class="filename">~/.psqlrc-16</code> или <code class="filename">~/.psqlrc-16.3</code>. При совпадении нескольких указаний с текущей версией <span class="application">psql</span> приоритетнее будет файл с более полным указанием. Суффиксы версий при поиске файла добавляются после того, как описанным выше образом будет определён путь к файлу.</p></dd><dt id="APP-PSQL-FILES-PSQL-HISTORY"><span class="term"><code class="filename">.psql_history</code></span> <a href="#APP-PSQL-FILES-PSQL-HISTORY" class="id_link">#</a></dt><dd><p>История командной строки хранится в файле <code class="filename">~/.psql_history</code> или <code class="filename">%APPDATA%\postgresql\psql_history</code> на Windows.</p><p>Расположение файла истории можно задать явно через переменную <span class="application">psql</span> <code class="varname">HISTFILE</code> или через переменную окружения <code class="envar">PSQL_HISTORY</code>.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.4.20.11"><h2>Замечания</h2><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="application">psql</span> лучше всего работает с серверами той же или более старой основной версии. Сбой метакоманды наиболее вероятен, если версия сервера новее, чем версия <span class="application">psql</span>. Однако команды семейства <code class="literal">\d</code> должны работать с версиями сервера до 9.2, хотя и необязательно с серверами новее, чем сам <span class="application">psql</span>. Общая функциональность запуска SQL-команд и отображения результатов запросов также должна работать на серверах с более новой основной версией, но это не гарантируется во всех случаях.</p><p>Если вы хотите, применяя <span class="application">psql</span>, подключаться к нескольким серверам с различными основными версиями, рекомендуется использовать последнюю версию <span class="application">psql</span>. Также можно собрать копии <span class="application">psql</span> от каждой основной версии и использовать ту, которая соответствует версии сервера. Но на практике в этих дополнительных сложностях нет необходимости.</p></li><li class="listitem"><p>В <span class="productname">PostgreSQL</span> до версии 9.6 параметр <code class="option">-c</code> подразумевал <code class="option">-X</code> (<code class="option">--no-psqlrc</code>); теперь это не так.</p></li><li class="listitem"><p>В <span class="productname">PostgreSQL</span> до 8.4 программа <span class="application">psql</span> могла принять первый аргумент однобуквенной команды с обратной косой чертой сразу после команды, без промежуточного пробела. Теперь разделительный пробельный символ обязателен.</p></li></ul></div></div><div class="refsect1" id="id-1.9.4.20.12"><h2>Замечания для пользователей Windows</h2><p><span class="application">psql</span> создан как <span class="quote">«<span class="quote">консольное приложение</span>»</span>. Поскольку в Windows консольные окна используют кодировку символов отличную от той, что используется для остальной системы, нужно проявить особую осторожность при использовании 8-битных символов. Если <span class="application">psql</span> обнаружит проблемную кодовую страницу консоли, он предупредит вас при запуске. Чтобы изменить кодовую страницу консоли, необходимы две вещи: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Задать кодовую страницу, выполнив <strong class="userinput"><code>cmd.exe /c chcp 1251</code></strong>. (1251 это кодовая страница для России, замените на ваше значение.) При использовании Cygwin, эту команду можно записать в <code class="filename">/etc/profile</code>.</p></li><li class="listitem"><p>Установите консольный шрифт в <code class="literal">Lucida Console</code>, потому что растровый шрифт не работает с кодовой страницей ANSI.</p></li></ul></div></div><div class="refsect1" id="APP-PSQL-EXAMPLES"><h2>Примеры</h2><p>Первый пример показывает, что для ввода одной команды может потребоваться несколько строк. Обратите внимание, как меняется приглашение: </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>CREATE TABLE my_table (</code></strong>
testdb(&gt; <strong class="userinput"><code> first integer not null default 0,</code></strong>
testdb(&gt; <strong class="userinput"><code> second text)</code></strong>
testdb-&gt; <strong class="userinput"><code>;</code></strong>
CREATE TABLE</pre><p> Теперь посмотрим на определение таблицы: </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>\d my_table</code></strong>
             Таблица "public.my_table"
 Столбец |   Тип   | Правило сортировки | Допустимость NULL | По умолчанию
 first   | integer |                    | not null          |            0
 second  | text    |                    |                   |</pre><p> Теперь изменим приглашение на что-то более интересное: </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>\set PROMPT1 '%n@%m %~%R%# '</code></strong>
peter@localhost testdb=&gt;</pre><p> Предположим, что вы внесли данные в таблицу и хотите на них посмотреть: </p><pre class="programlisting">peter@localhost testdb=&gt; SELECT * FROM my_table;
 first | second
-------+--------
     1 | Один
     2 | Два
     3 | Три  
     4 | Четыре
(4 строки)</pre><p> Таблицу можно вывести разными способами при помощи команды <code class="command">\pset</code>: </p><pre class="programlisting">peter@localhost testdb=&gt; <strong class="userinput"><code>\pset border 2</code></strong>
Установлен стиль границ 2.
peter@localhost testdb=&gt; <strong class="userinput"><code>SELECT * FROM my_table;</code></strong>
+-------+--------+
| first | second |
+-------+--------+
|     1 | Один   |
|     2 | Два    |
|     3 | Три    |
|     4 | Четыре |
+-------+--------+
(4 строки)

peter@localhost testdb=&gt; <strong class="userinput"><code>\pset border 0</code></strong>
Установлен стиль границ 0.
peter@localhost testdb=&gt; <strong class="userinput"><code>SELECT * FROM my_table;</code></strong>
first second
----- ------
    1 один
    2 два
    3 три
    4 четыре
(4 строки)

peter@localhost testdb=&gt; <strong class="userinput"><code>\pset border 1</code></strong>
Установлен стиль границ 1.
peter@localhost testdb=&gt; <strong class="userinput"><code>\pset format csv</code></strong>
Формат вывода: csv.
peter@localhost testdb=&gt; <strong class="userinput"><code>\pset tuples_only</code></strong>
Режим вывода только кортежей включён.
peter@localhost testdb=&gt; <strong class="userinput"><code>SELECT second, first FROM my_table;</code></strong>
один,1
два,2
три,3
четыре,4
peter@localhost testdb=&gt; <strong class="userinput"><code>\pset format unaligned</code></strong>
Формат вывода: unaligned.
peter@localhost testdb=&gt; <strong class="userinput"><code>\pset fieldsep '\t'</code></strong>
Разделитель полей: "    ".
peter@localhost testdb=&gt; <strong class="userinput"><code>SELECT second, first FROM my_table;</code></strong>
один    1
два     2
три     3
четыре  4</pre><p> Также можно использовать короткие команды: </p><pre class="programlisting">peter@localhost testdb=&gt; <strong class="userinput"><code>\a \t \x</code></strong>
Формат вывода: aligned.
Режим вывода только кортежей выключен.
Расширенный вывод включён.
peter@localhost testdb=&gt; <strong class="userinput"><code>SELECT * FROM my_table;</code></strong>
-[ RECORD 1 ]-
first  | 1
second | Один
-[ RECORD 2 ]-
first  | 2
second | Два
-[ RECORD 3 ]-
first  | 3
second | Три  
-[ RECORD 4 ]-
first  | 4
second | Четыре</pre><p>Кроме того, эти параметры формата можно задать только для одного запроса, выполняя команду <code class="literal">\g</code>: </p><pre class="programlisting">peter@localhost testdb=&gt; <strong class="userinput"><code>SELECT * FROM my_table</code></strong>
peter@localhost testdb-&gt; <strong class="userinput"><code>\g (format=aligned tuples_only=off expanded=on)</code></strong>
-[ RECORD 1 ]-
first  | 1
second | Один
-[ RECORD 2 ]-
first  | 2
second | Два
-[ RECORD 3 ]-
first  | 3
second | Три
-[ RECORD 4 ]-
first  | 4
second | Четыре</pre><p>Пример использования команды <code class="command">\df</code> для получения только функций, имя которых соответствует шаблону <code class="literal">int*pl</code>, а второй аргумент имеет тип <code class="type">bigint</code>: </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>\df int*pl * bigint</code></strong>
                          Список функций
   Схема    |   Имя   | Тип данных результата | Типы данных аргументов | Тип
------------+---------+-----------------------+------------------------+------
 pg_catalog | int28pl | bigint                | smallint, bigint       | func
 pg_catalog | int48pl | bigint                | integer, bigint        | func
 pg_catalog | int8pl  | bigint                | bigint, bigint         | func
(3 строки)</pre><p>Когда это уместно, результаты запроса можно просмотреть в виде перекрёстной таблицы с помощью команды <code class="command">\crosstabview</code>: </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>SELECT first, second, first &gt; 2 AS gt2 FROM my_table;</code></strong>
 first | second | gt2
-------+--------+-----
     1 | one    | f
     2 | two    | f
     3 | three  | t
     4 | four   | t
(4 rows)

testdb=&gt; <strong class="userinput"><code>\crosstabview first second</code></strong>
 first | one | two | three | four
-------+-----+-----+-------+------
     1 | f   |     |       |
     2 |     | f   |       |
     3 |     |     | t     |
     4 |     |     |       | t
(4 rows)</pre><p> Второй пример показывает таблицу умножения, строки в которой отсортированы в обратном числовом порядке, а столбцы — независимо, по возрастанию числовых значений. </p><pre class="programlisting">testdb=&gt; <strong class="userinput"><code>SELECT t1.first as "A", t2.first+100 AS "B", t1.first*(t2.first+100) as "AxB",</code></strong>
testdb(&gt; <strong class="userinput"><code>row_number() over(order by t2.first) AS ord</code></strong>
testdb(&gt; <strong class="userinput"><code>FROM my_table t1 CROSS JOIN my_table t2 ORDER BY 1 DESC</code></strong>
testdb(&gt; <strong class="userinput"><code>\crosstabview "A" "B" "AxB" ord</code></strong>
 A | 101 | 102 | 103 | 104
---+-----+-----+-----+-----
 4 | 404 | 408 | 412 | 416
 3 | 303 | 306 | 309 | 312
 2 | 202 | 204 | 206 | 208
 1 | 101 | 102 | 103 | 104
(4 rows)</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="app-pgverifybackup.html" title="pg_verifybackup">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="app-reindexdb.html" title="reindexdb">След.</a></td></tr><tr><td width="40%" align="left" valign="top"><span class="application">pg_verifybackup</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> <span class="application">reindexdb</span></td></tr></table></div></body></html>