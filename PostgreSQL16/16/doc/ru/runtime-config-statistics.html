<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>20.9. Статистика времени выполнения</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="runtime-config-logging.html" title="20.8. Регистрация ошибок и протоколирование работы сервера" /><link rel="next" href="runtime-config-autovacuum.html" title="20.10. Автоматическая очистка" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">20.9. Статистика времени выполнения</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="runtime-config-logging.html" title="20.8. Регистрация ошибок и протоколирование работы сервера">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime-config.html" title="Глава 20. Настройка сервера">Наверх</a></td><th width="60%" align="center">Глава 20. Настройка сервера</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="runtime-config-autovacuum.html" title="20.10. Автоматическая очистка">След.</a></td></tr></table><hr /></div><div class="sect1" id="RUNTIME-CONFIG-STATISTICS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">20.9. Статистика времени выполнения <a href="#RUNTIME-CONFIG-STATISTICS" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="runtime-config-statistics.html#RUNTIME-CONFIG-CUMULATIVE-STATISTICS">20.9.1. Накопительная статистика по запросам и индексам</a></span></dt><dt><span class="sect2"><a href="runtime-config-statistics.html#RUNTIME-CONFIG-STATISTICS-MONITOR">20.9.2. Мониторинг статистики</a></span></dt></dl></div><div class="sect2" id="RUNTIME-CONFIG-CUMULATIVE-STATISTICS"><div class="titlepage"><div><div><h3 class="title">20.9.1. Накопительная статистика по запросам и индексам <a href="#RUNTIME-CONFIG-CUMULATIVE-STATISTICS" class="id_link">#</a></h3></div></div></div><p>Эти параметры управляют системой накопительной статистики на уровне сервера. Когда сбор статистики включён, собираемые данные можно просмотреть в семействе системных представлений <code class="structname">pg_stat</code> и <code class="structname">pg_statio</code>. За дополнительными сведениями обратитесь к <a class="xref" href="monitoring.html" title="Глава 28. Мониторинг работы СУБД">Главе 28</a>.</p><div class="variablelist"><dl class="variablelist"><dt id="GUC-TRACK-ACTIVITIES"><span class="term"><code class="varname">track_activities</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.2.3.1.1.3" class="indexterm"></a></span> <a href="#GUC-TRACK-ACTIVITIES" class="id_link">#</a></dt><dd><p>Включает сбор сведений о текущих командах, выполняющихся во всех сеансах (в частности, отслеживается идентификатор и время запуска команды). По умолчанию этот параметр включён. Заметьте, что даже когда сбор ведётся, собранная информация доступна не для всех пользователей, а только для суперпользователей и пользователей, включённых в роль <code class="literal">pg_read_all_stats</code>. Также пользователям доступна информация о командах в их сеансах (включая сеансы ролей, в которые эти пользователи включены). Поэтому это не должно повлечь риски, связанные с безопасностью. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p></dd><dt id="GUC-TRACK-ACTIVITY-QUERY-SIZE"><span class="term"><code class="varname">track_activity_query_size</code> (<code class="type">integer</code>) <a id="id-1.6.7.12.2.3.2.1.3" class="indexterm"></a></span> <a href="#GUC-TRACK-ACTIVITY-QUERY-SIZE" class="id_link">#</a></dt><dd><p>Задаёт объём памяти, резервируемой для хранения текста выполняемой в данной момент команды в каждом активном сеансе, для поля <code class="structname">pg_stat_activity</code>.<code class="structfield">query</code>. Если это значение задаётся без единиц измерения, оно считается заданным в байтах. Значение по умолчанию — 1024 байта. Задать этот параметр можно только при запуске сервера.</p></dd><dt id="GUC-TRACK-COUNTS"><span class="term"><code class="varname">track_counts</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.2.3.3.1.3" class="indexterm"></a></span> <a href="#GUC-TRACK-COUNTS" class="id_link">#</a></dt><dd><p>Включает сбор статистики активности в базе данных. Этот параметр по умолчанию включён, так как собранная информация требуется демону автоочистки. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p></dd><dt id="GUC-TRACK-IO-TIMING"><span class="term"><code class="varname">track_io_timing</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.2.3.4.1.3" class="indexterm"></a></span> <a href="#GUC-TRACK-IO-TIMING" class="id_link">#</a></dt><dd><p>Включает замер времени операций ввода/вывода. Этот параметр по умолчанию отключён, так как для данного замера требуется постоянно запрашивать текущее время у операционной системы, что может значительно замедлить работу на некоторых платформах. Для оценивания издержек замера времени на вашей платформе можно воспользоваться утилитой <a class="xref" href="pgtesttiming.html" title="pg_test_timing"><span class="refentrytitle"><span class="application">pg_test_timing</span></span></a>. Статистику ввода/вывода можно получить через представление <a class="link" href="monitoring-stats.html#MONITORING-PG-STAT-DATABASE-VIEW" title="28.2.16. pg_stat_database"><code class="structname">pg_stat_database</code></a>, в выводе <a class="xref" href="sql-explain.html" title="EXPLAIN"><span class="refentrytitle">EXPLAIN</span></a> (когда используется параметр <code class="literal">BUFFERS</code>), в выводе <a class="xref" href="sql-vacuum.html" title="VACUUM"><span class="refentrytitle">VACUUM</span></a> (когда используется параметр <code class="literal">VERBOSE</code>), от процесса автоочистки, выполняющего операции очистки и сбора статистики, когда установлен параметр <a class="xref" href="runtime-config-logging.html#GUC-LOG-AUTOVACUUM-MIN-DURATION">log_autovacuum_min_duration</a>, и через представление <a class="xref" href="pgstatstatements.html" title="F.32. pg_stat_statements — отслеживание статистики планирования и выполнения SQL-операторов">pg_stat_statements</a>. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p></dd><dt id="GUC-TRACK-WAL-IO-TIMING"><span class="term"><code class="varname">track_wal_io_timing</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.2.3.5.1.3" class="indexterm"></a></span> <a href="#GUC-TRACK-WAL-IO-TIMING" class="id_link">#</a></dt><dd><p>Включает замер времени операций ввода/вывода WAL. Этот параметр по умолчанию отключён, так как для данного замера требуется постоянно запрашивать текущее время у операционной системы, что может значительно замедлить работу на некоторых платформах. Для оценивания издержек замера времени на вашей платформе можно воспользоваться утилитой <span class="application">pg_test_timing</span>. Статистику ввода/вывода можно получить через представление <a class="link" href="monitoring-stats.html#MONITORING-PG-STAT-DATABASE-VIEW" title="28.2.16. pg_stat_database"><code class="structname">pg_stat_wal</code></a>. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p></dd><dt id="GUC-TRACK-FUNCTIONS"><span class="term"><code class="varname">track_functions</code> (<code class="type">enum</code>) <a id="id-1.6.7.12.2.3.6.1.3" class="indexterm"></a></span> <a href="#GUC-TRACK-FUNCTIONS" class="id_link">#</a></dt><dd><p>Включает подсчёт вызовов функций и времени их выполнения. Значение <code class="literal">pl</code> включает отслеживание только функций на процедурном языке, а <code class="literal">all</code> — также функций на языках SQL и C. Значение по умолчанию — <code class="literal">none</code>, то есть сбор статистики по функциям отключён. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>Функции на языке SQL, достаточно простые для <span class="quote">«<span class="quote">внедрения</span>»</span> в вызывающий запрос, отслеживаться не будут вне зависимости от этого параметра.</p></div></dd><dt id="GUC-STATS-FETCH-CONSISTENCY"><span class="term"><code class="varname">stats_fetch_consistency</code> (<code class="type">enum</code>) <a id="id-1.6.7.12.2.3.7.1.3" class="indexterm"></a></span> <a href="#GUC-STATS-FETCH-CONSISTENCY" class="id_link">#</a></dt><dd><p>Определяет поведение при многократном обращении к накопительной статистике в рамках транзакции. Когда задано значение <code class="literal">none</code>, счётчики при каждом обращении извлекаются из общей памяти. Когда задано значение <code class="literal">cache</code>, при первом обращении кешируется статистика по конкретному объекту; сбрасывается она при завершении транзакции или при вызове <code class="function">pg_stat_clear_snapshot()</code>. Когда задано значение <code class="literal">snapshot</code>, при первом обращении кешируется вся статистика, имеющаяся в текущей базе данных; сбрасывается она также при завершении транзакции или при вызове <code class="function">pg_stat_clear_snapshot()</code>. При изменении этого параметра в транзакции сбрасывается снимок статистики. Значение по умолчанию — <code class="literal">cache</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>Вариант <code class="literal">none</code> больше подходит для систем мониторинга. Он наиболее эффективен, если происходит только одно обращение к значениям. Вариант <code class="literal">cache</code> гарантирует, что при повторном обращении будут получены те же значения; это нужно для запросов, содержащих, например, замкнутые соединения. Вариант <code class="literal">snapshot</code> может быть полезен при интерактивном просмотре статистики, но с ним связаны дополнительные издержки, особенно если в базе много объектов.</p></div></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-STATISTICS-MONITOR"><div class="titlepage"><div><div><h3 class="title">20.9.2. Мониторинг статистики <a href="#RUNTIME-CONFIG-STATISTICS-MONITOR" class="id_link">#</a></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="GUC-COMPUTE-QUERY-ID"><span class="term"><code class="varname">compute_query_id</code> (<code class="type">enum</code>) <a id="id-1.6.7.12.3.2.1.1.3" class="indexterm"></a></span> <a href="#GUC-COMPUTE-QUERY-ID" class="id_link">#</a></dt><dd><p>Включает вычисление идентификатора запроса в ядре. Идентификаторы запроса могут отображаться в представлении <a class="link" href="monitoring-stats.html#MONITORING-PG-STAT-ACTIVITY-VIEW" title="28.2.3. pg_stat_activity"><code class="structname">pg_stat_activity</code></a> в выводе <code class="command">EXPLAIN</code> или записываться в журнал, при заданным соответствующим образом параметре <a class="xref" href="runtime-config-logging.html#GUC-LOG-LINE-PREFIX">log_line_prefix</a>. Идентификаторы запросов также должны вычисляться для расширения <a class="xref" href="pgstatstatements.html" title="F.32. pg_stat_statements — отслеживание статистики планирования и выполнения SQL-операторов">pg_stat_statements</a>. Обратите внимание, что в качестве альтернативы можно использовать внешний модуль, если метод вычисления идентификатора запроса в ядре является неприемлемым. Это вычисление в ядре нужно полностью отключить. Допустимые значения: <code class="literal">off</code> (всегда отключено); <code class="literal">on</code> (всегда включено); <code class="literal">auto</code>, которое позволяет таким модулям, как <a class="xref" href="pgstatstatements.html" title="F.32. pg_stat_statements — отслеживание статистики планирования и выполнения SQL-операторов">pg_stat_statements</a>, автоматически включить данное вычисление; <code class="literal">regress</code>, которое действует так же, как <code class="literal">auto</code>, но идентификатор запроса не показывается в выводе команды <code class="literal">EXPLAIN</code>, что облегчает автоматическое регрессионное тестирование. По умолчанию значение этого параметра — <code class="literal">auto</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>Чтобы для запроса гарантированно вычислялся и отображался только один идентификатор, вычисляющие его расширения должны выдавать ошибку, если идентификатор запроса уже был вычислен.</p></div></dd><dt id="GUC-LOG-STATEMENT-STATS"><span class="term"><code class="varname">log_statement_stats</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.3.2.2.1.3" class="indexterm"></a><br /></span><span class="term"><code class="varname">log_parser_stats</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.3.2.2.2.3" class="indexterm"></a><br /></span><span class="term"><code class="varname">log_planner_stats</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.3.2.2.3.3" class="indexterm"></a><br /></span><span class="term"><code class="varname">log_executor_stats</code> (<code class="type">boolean</code>) <a id="id-1.6.7.12.3.2.2.4.3" class="indexterm"></a></span> <a href="#GUC-LOG-STATEMENT-STATS" class="id_link">#</a></dt><dd><p>Эти параметры включают вывод статистики по производительности соответствующего модуля в протокол работы сервера. Это грубый инструмент профилирования, похожий на функцию <code class="function">getrusage()</code> в операционной системе. Параметр <code class="varname">log_statement_stats</code> включает вывод общей статистики по операторам, тогда как другие управляют статистикой по модулям (разбор, планирование, выполнение). Включить <code class="varname">log_statement_stats</code> одновременно с параметрами, управляющими модулями, нельзя. По умолчанию все эти параметры отключены. Изменить эти параметры могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p></dd></dl></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-logging.html" title="20.8. Регистрация ошибок и протоколирование работы сервера">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html" title="Глава 20. Настройка сервера">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-autovacuum.html" title="20.10. Автоматическая очистка">След.</a></td></tr><tr><td width="40%" align="left" valign="top">20.8. Регистрация ошибок и протоколирование работы сервера </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 20.10. Автоматическая очистка</td></tr></table></div></body></html>