<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Глава 75. Объявление и начальное содержимое системных каталогов</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="two-phase.html" title="74.4. Двухфазные транзакции" /><link rel="next" href="system-catalog-declarations.html" title="75.1. Правила объявления системных каталогов" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">Глава 75. Объявление и начальное содержимое системных каталогов</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="two-phase.html" title="74.4. Двухфазные транзакции">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="internals.html" title="Часть VII. Внутреннее устройство">Наверх</a></td><th width="60%" align="center">Часть VII. Внутреннее устройство</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="system-catalog-declarations.html" title="75.1. Правила объявления системных каталогов">След.</a></td></tr></table><hr /></div><div class="chapter" id="BKI"><div class="titlepage"><div><div><h2 class="title">Глава 75. Объявление и начальное содержимое системных каталогов</h2></div></div></div><div class="toc"><p><strong>Содержание</strong></p><dl class="toc"><dt><span class="sect1"><a href="system-catalog-declarations.html">75.1. Правила объявления системных каталогов</a></span></dt><dt><span class="sect1"><a href="system-catalog-initial-data.html">75.2. Исходные данные системных каталогов</a></span></dt><dd><dl><dt><span class="sect2"><a href="system-catalog-initial-data.html#SYSTEM-CATALOG-INITIAL-DATA-FORMAT">75.2.1. Формат файла данных</a></span></dt><dt><span class="sect2"><a href="system-catalog-initial-data.html#SYSTEM-CATALOG-OID-ASSIGNMENT">75.2.2. Назначение OID</a></span></dt><dt><span class="sect2"><a href="system-catalog-initial-data.html#SYSTEM-CATALOG-OID-REFERENCES">75.2.3. Поиск OID по ссылке</a></span></dt><dt><span class="sect2"><a href="system-catalog-initial-data.html#SYSTEM-CATALOG-AUTO-ARRAY-TYPES">75.2.4. Автоматическое создание типов массивов</a></span></dt><dt><span class="sect2"><a href="system-catalog-initial-data.html#SYSTEM-CATALOG-RECIPES">75.2.5. Рецепты по редактированию файлов данных</a></span></dt></dl></dd><dt><span class="sect1"><a href="bki-format.html">75.3. Формат файла <acronym class="acronym">BKI</acronym></a></span></dt><dt><span class="sect1"><a href="bki-commands.html">75.4. Команды <acronym class="acronym">BKI</acronym></a></span></dt><dt><span class="sect1"><a href="bki-structure.html">75.5. Структура файла <acronym class="acronym">BKI</acronym></a></span></dt><dt><span class="sect1"><a href="bki-example.html">75.6. Пример BKI</a></span></dt></dl></div><p>В <span class="productname">PostgreSQL</span> используется множество разных системных каталогов для учёта информации о существовании и свойствах объектов базы, например, таблиц и функций. Физически системный каталог не отличается от простой таблицы, но серверный код на C знает структуру и характеристики каждого каталога и может работать с ним на низком уровне. Поэтому, например, не стоит пытаться изменять структуру каталога «на лету»; это нарушит встроенные в код предположения о том, как располагаются строки в каталоге. Однако структура каталога может меняться при переходе с одной основной версии на другую.</p><p>Структуры каталогов объявляются в специально оформленных заголовочных файлах C в каталоге <code class="filename">src/include/catalog/</code> дерева исходного кода. В частности, для каждого каталога имеется заголовочный файл, названный по имени каталога (например, <code class="filename">pg_class.h</code> для <code class="structname">pg_class</code>) и определяющий набор столбцов в этом каталоге, а также другие основные свойства, например, его OID.</p><p>Со многими каталогами связаны исходные данные, которые должны быть загружены в них на стадии <span class="quote">«<span class="quote">начальной загрузки</span>»</span> <span class="application">initdb</span>, чтобы система оказалась в состоянии, когда она сможет выполнять команды SQL. (Например, <code class="filename">pg_class.h</code> должен содержать запись, ссылающуюся на этот же каталог, и перечисление всех остальных системных каталогов и индексов.) Эти исходные данные задаются в редактируемой форме в файлах, которые также находятся в каталоге <code class="filename">src/include/catalog/</code>. Например, в <code class="filename">pg_proc.dat</code> описываются все исходные строки, которые должны быть вставлены в каталог <code class="structname">pg_proc</code>.</p><p>Чтобы создать файлы каталогов и загрузить в них эти исходные данные, серверный процесс, работающий в режиме начальной загрузки, считывает файл <acronym class="acronym">BKI</acronym> (Backend Interface, Серверный интерфейс), содержащий команды и исходные данные. Файл <code class="filename">postgres.bki</code>, используемый в этом режиме, конструируется из вышеупомянутых заголовочных файлов и файлов данных при сборке дистрибутива <span class="productname">PostgreSQL</span> Perl-скриптом <code class="filename">genbki.pl</code>. Хотя <code class="filename">postgres.bki</code> привязан к определённому выпуску <span class="productname">PostgreSQL</span>, он является платформонезависимым и устанавливается в подкаталог <code class="filename">share</code> дерева инсталляции.</p><p>Скрипт <code class="filename">genbki.pl</code> также генерирует производный заголовочный файл для каждого каталога, например <code class="filename">pg_class_d.h</code> для каталога <code class="structname">pg_class</code>. Этот файл содержит автоматически генерируемые макроопределения и может содержать другие макросы, определения перечислений и т. п., которые могут быть полезны для клиентского кода, читающего определённый каталог.</p><p>Большинству разработчиков PostgreSQL нет необходимости иметь дело непосредственно с файлом <acronym class="acronym">BKI</acronym>, но для практически любой нетривиальной доработки потребуется модификация заголовочных файлов и/или файлов с исходными данными каталога. В продолжении этой главы рассказывается об этом, а также для полноты описывается формат файла <acronym class="acronym">BKI</acronym>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="two-phase.html" title="74.4. Двухфазные транзакции">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="internals.html" title="Часть VII. Внутреннее устройство">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="system-catalog-declarations.html" title="75.1. Правила объявления системных каталогов">След.</a></td></tr><tr><td width="40%" align="left" valign="top">74.4. Двухфазные транзакции </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 75.1. Правила объявления системных каталогов</td></tr></table></div></body></html>