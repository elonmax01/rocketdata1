<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>30.3. Журнал предзаписи (WAL)</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="checksums.html" title="30.2. Контрольные суммы данных" /><link rel="next" href="wal-async-commit.html" title="30.4. Асинхронное подтверждение транзакций" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">30.3. Журнал предзаписи (<acronym class="acronym">WAL</acronym>)</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="checksums.html" title="30.2. Контрольные суммы данных">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="wal.html" title="Глава 30. Надёжность и журнал предзаписи">Наверх</a></td><th width="60%" align="center">Глава 30. Надёжность и журнал предзаписи</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="wal-async-commit.html" title="30.4. Асинхронное подтверждение транзакций">След.</a></td></tr></table><hr /></div><div class="sect1" id="WAL-INTRO"><div class="titlepage"><div><div><h2 class="title" style="clear: both">30.3. Журнал предзаписи (<acronym class="acronym">WAL</acronym>) <a href="#WAL-INTRO" class="id_link">#</a></h2></div></div></div><a id="id-1.6.17.5.2" class="indexterm"></a><a id="id-1.6.17.5.3" class="indexterm"></a><p><em class="firstterm">Журнал предзаписи</em> (<acronym class="acronym">WAL</acronym>) — это стандартный метод обеспечения целостности данных. Детальное описание можно найти в большинстве книг (если не во всех) по обработке транзакций. Вкратце, основная идея <acronym class="acronym">WAL</acronym> состоит в том, что изменения в файлах с данными (где находятся таблицы и индексы) должны записываться только после того, как эти изменения были занесены в WAL, т. е. после того как записи WAL, описывающие данные изменения, будут сохранены на постоянное устройство хранения. Если следовать этой процедуре, то записывать страницы данных на диск после подтверждения каждой транзакции нет необходимости, потому что мы знаем, что если случится сбой, то у нас будет возможность восстановить базу данных с помощью журнала: любые изменения, которые не были применены к страницам с данными, могут быть воссозданы из записей WAL. (Это называется восстановлением с воспроизведением или REDO.)</p><div class="tip"><h3 class="title">Подсказка</h3><p>Поскольку <acronym class="acronym">WAL</acronym> восстанавливает содержимое файлов базы данных, журналируемая файловая система не является необходимой для надёжного хранения файлов с данными или файлов WAL. Фактически, журналирование может снизить производительность, особенно если журналирование заставляет сохранять <span class="emphasis"><em>данные</em></span> файловой системы на диск. К счастью, такое сохранение при журналировании часто можно отключить с помощью параметров монтирования файловой системы, например, <code class="literal">data=writeback</code> для файловой системы ext3 в Linux. С другой стороны, с журналируемыми файловыми системами увеличивается скорость загрузки после сбоя.</p></div><p>Результатом использования <acronym class="acronym">WAL</acronym> является значительное уменьшение количества запросов записи на диск, потому что для гарантии, что транзакция подтверждена, в записи на диск нуждается только файл WAL, а не каждый файл данных, изменённый в результате транзакции. Файл WAL записывается последовательно и таким образом затраты на синхронизацию WAL намного меньше, чем затраты на запись страниц с данными. Это особенно справедливо для серверов, которые обрабатывают много маленьких транзакций, изменяющих разные части хранилища данных. Таким образом, когда сервер обрабатывает множество мелких конкурентных транзакций, для подтверждения многих транзакций достаточно одного вызова <code class="function">fsync</code> на файл WAL.</p><p><acronym class="acronym">WAL</acronym> также делает возможным поддержку онлайнового резервного копирования и восстановления на определённый момент времени, как описывается в <a class="xref" href="continuous-archiving.html" title="26.3. Непрерывное архивирование и восстановление на момент времени (Point-in-Time Recovery, PITR)">Разделе 26.3</a>. С помощью архивирования данных WAL поддерживается возврат к любому моменту времени, который доступен в данных WAL: мы просто устанавливаем предыдущую физическую резервную копию базы данных и воспроизводим WAL до нужного момента времени. Более того, физическая резервная копия не должна быть мгновенным снимком состояния баз данных — если она была сделана некоторое время назад, воспроизведение WAL за этот период исправит все внутренние несоответствия.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="checksums.html" title="30.2. Контрольные суммы данных">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="wal.html" title="Глава 30. Надёжность и журнал предзаписи">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="wal-async-commit.html" title="30.4. Асинхронное подтверждение транзакций">След.</a></td></tr><tr><td width="40%" align="left" valign="top">30.2. Контрольные суммы данных </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 30.4. Асинхронное подтверждение транзакций</td></tr></table></div></body></html>