<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5.3. Генерируемые столбцы</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="ddl-default.html" title="5.2. Значения по умолчанию" /><link rel="next" href="ddl-constraints.html" title="5.4. Ограничения" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">5.3. Генерируемые столбцы</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="ddl-default.html" title="5.2. Значения по умолчанию">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="ddl.html" title="Глава 5. Определение данных">Наверх</a></td><th width="60%" align="center">Глава 5. Определение данных</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="ddl-constraints.html" title="5.4. Ограничения">След.</a></td></tr></table><hr /></div><div class="sect1" id="DDL-GENERATED-COLUMNS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.3. Генерируемые столбцы <a href="#DDL-GENERATED-COLUMNS" class="id_link">#</a></h2></div></div></div><a id="id-1.5.4.5.2" class="indexterm"></a><p>Генерируемый столбец является столбцом особого рода, который всегда вычисляется из других. Таким образом, для столбцов он является тем же, чем представление для таблицы. Есть два типа генерируемых столбцов: сохранённые и виртуальные. Сохранённый генерируемый столбец вычисляется при записи (добавлении или изменении) и занимает место в таблице так же, как и обычный столбец. Виртуальный генерируемый столбец не занимает места и вычисляется при чтении. Поэтому можно сказать, что виртуальный генерируемый столбец похож на представление, а сохранённый генерируемый столбец — на материализованное представление (за исключением того, что он всегда обновляется автоматически). В настоящее время в PostgreSQL реализованы только сохранённые генерируемые столбцы.</p><p>Чтобы создать генерируемый столбец, воспользуйтесь предложением <code class="literal">GENERATED ALWAYS AS</code> команды <code class="command">CREATE TABLE</code>, например: </p><pre class="programlisting">CREATE TABLE people (
    ...,
    height_cm numeric,
    height_in numeric <span class="emphasis"><strong>GENERATED ALWAYS AS (height_cm / 2.54) STORED</strong></span>
);</pre><p> Ключевое слово <code class="literal">STORED</code>, определяющее тип хранения генерируемого столбца, является обязательным. За подробностями обратитесь к <a class="xref" href="sql-createtable.html" title="CREATE TABLE"><span class="refentrytitle">CREATE TABLE</span></a>.</p><p>Произвести запись непосредственно в генерируемый столбец нельзя. Поэтому в командах <code class="command">INSERT</code> или <code class="command">UPDATE</code> нельзя задать значение для таких столбцов, хотя ключевое слово <code class="literal">DEFAULT</code> указать можно.</p><p>Примите к сведению следующие отличия генерируемых столбцов от столбцов со значением по умолчанию. Значение столбца по умолчанию вычисляется один раз, когда в таблицу впервые вставляется строка и никакое другое значение не задано; значение же генерируемого столбца может меняться при изменении строки и не может быть переопределено. Выражение значения по умолчанию не может обращаться к другим столбцам таблицы, а генерирующее выражение, напротив, обычно обращается к ним. В выражении значения по умолчанию могут вызываться изменчивые функции, например, <code class="literal">random()</code> или функции, зависящие от времени, а для генерируемых столбцов это не допускается.</p><p>С определением генерируемых столбцов и их содержащими таблицами связан ряд ограничений и особенностей: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>В генерирующем выражении могут использоваться только постоянные функции и не могут фигурировать подзапросы или ссылки на какие-либо значения, не относящиеся к данной строке.</p></li><li class="listitem"><p>Генерирующее выражение не может обращаться к другому генерируемому столбцу.</p></li><li class="listitem"><p>Генерирующее выражение не может обращаться к системным столбцам, за исключением <code class="varname">tableoid</code>.</p></li><li class="listitem"><p>Для генерируемого столбца нельзя задать значение по умолчанию или свойство идентификации.</p></li><li class="listitem"><p>Генерируемый столбец не может быть частью ключа секционирования.</p></li><li class="listitem"><p>Генерируемые столбцы могут содержаться в сторонних таблицах. За подробностями обратитесь к <a class="xref" href="sql-createforeigntable.html" title="CREATE FOREIGN TABLE"><span class="refentrytitle">CREATE FOREIGN TABLE</span></a>.</p></li><li class="listitem"><p>Применительно к наследованию и секционированию:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Если родительский столбец является генерируемым, его дочерний столбец также должен быть генерируемым; однако дочерний столбец может генерироваться другим выражением. Генерирующее выражение, которое фактически применяется во время вставки или изменения строки, связано с таблицей, в которой физически находится строка. (Это отличается от поведения столбцов со значением по умолчанию: для них применяется значение по умолчанию, которое связано с таблицей, указанной в запросе.)</p></li><li class="listitem"><p>Если родительский столбец не является генерируемым, его дочерний столбец также должен быть негенерируемым.</p></li><li class="listitem"><p>Для унаследованных таблиц, если в определении дочернего столбца нет предложения <code class="literal">GENERATED</code> в <code class="command">CREATE TABLE ... INHERITS</code>, то предложение <code class="literal">GENERATED</code> будет автоматически копироваться из родительского столбца. Для команды <code class="command">ALTER TABLE ... INHERIT</code> требуется, чтобы родительский и дочерний столбцы уже совпадали в отношении состояния генерации, но не требуется совпадения их генерирующих выражений.</p></li><li class="listitem"><p>Аналогично для секционированных таблиц, если в определении дочернего столбца нет предложения <code class="literal">GENERATED</code> в <code class="command">CREATE TABLE ... INHERITS</code>, то его предложение <code class="literal">GENERATED</code> будет автоматически копироваться у родительского столбца. Для команды <code class="command">ALTER TABLE ... ATTACH PARTITION</code> требуется, чтобы родительский и дочерний столбцы уже совпадали в отношении состояния генерации, но не требует совпадения их генерирующих выражений.</p></li><li class="listitem"><p>В случае множественного наследования, если один родительский столбец является генерируемым, все соответствующие ему столбцы в иерархии наследования также должны быть генерируемыми. Если генерирующее выражение не одинаковое для всех столбцов, то желаемое выражение для дочернего столбца должно быть указано явно.</p></li></ul></div></li></ul></div><p>Дополнительные замечания касаются использования генерируемых столбцов. </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Права доступа к генерируемым столбцам существуют отдельно от прав для нижележащих базовых столбцов. Поэтому их можно организовать так, чтобы определённый пользователь мог прочитать генерируемый столбец, но не нижележащие базовые столбцы.</p></li><li class="listitem"><p>Генерируемые столбцы, в соответствии с концепцией, пересчитываются после выполнения триггеров <code class="literal">BEFORE</code>. Вследствие этого, в генерируемых столбцах будут отражаться изменения, производимые триггером <code class="literal">BEFORE</code> в базовых столбцах, а обращаться в коде такого триггера к генерируемым столбцам, напротив, нельзя.</p></li></ul></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ddl-default.html" title="5.2. Значения по умолчанию">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="ddl.html" title="Глава 5. Определение данных">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="ddl-constraints.html" title="5.4. Ограничения">След.</a></td></tr><tr><td width="40%" align="left" valign="top">5.2. Значения по умолчанию </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 5.4. Ограничения</td></tr></table></div></body></html>