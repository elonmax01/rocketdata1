<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>12.9. Типы индексов, предпочитаемые для текстового поиска</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="textsearch-debugging.html" title="12.8. Тестирование и отладка текстового поиска" /><link rel="next" href="textsearch-psql.html" title="12.10. Поддержка psql" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">12.9. Типы индексов, предпочитаемые для текстового поиска</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="textsearch-debugging.html" title="12.8. Тестирование и отладка текстового поиска">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="textsearch.html" title="Глава 12. Полнотекстовый поиск">Наверх</a></td><th width="60%" align="center">Глава 12. Полнотекстовый поиск</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="textsearch-psql.html" title="12.10. Поддержка psql">След.</a></td></tr></table><hr /></div><div class="sect1" id="TEXTSEARCH-INDEXES"><div class="titlepage"><div><div><h2 class="title" style="clear: both">12.9. Типы индексов, предпочитаемые для текстового поиска <a href="#TEXTSEARCH-INDEXES" class="id_link">#</a></h2></div></div></div><a id="id-1.5.11.12.2" class="indexterm"></a><p>Для ускорения полнотекстового поиска можно использовать индексы двух видов: <a class="link" href="gin.html" title="Глава 70. Индексы GIN"><acronym class="acronym">GIN</acronym></a> и <a class="link" href="gist.html" title="Глава 68. Индексы GiST"><acronym class="acronym">GiST</acronym></a>. Заметьте, что эти индексы не требуются для поиска, но если по какому-то столбцу поиск выполняется регулярно, обычно желательно создать индекс.</p><p>Чтобы создать такой индекс, выполните одну из следующих команд: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
     <a id="id-1.5.11.12.4.1.1.1.1" class="indexterm"></a>

      <code class="literal">CREATE INDEX <em class="replaceable"><code>имя</code></em> ON <em class="replaceable"><code>таблица</code></em> USING GIN (<em class="replaceable"><code>столбец</code></em>);</code>
     </span></dt><dd><p>Создаёт индекс на базе GIN (Generalized Inverted Index, Обобщённый Инвертированный Индекс). <em class="replaceable"><code>Столбец</code></em> должен иметь тип <code class="type">tsvector</code>.</p></dd><dt><span class="term">
     <a id="id-1.5.11.12.4.1.2.1.1" class="indexterm"></a>

      <code class="literal">CREATE INDEX <em class="replaceable"><code>имя</code></em> ON <em class="replaceable"><code>таблица</code></em> USING GIST (<em class="replaceable"><code>столбец</code></em> [ { DEFAULT | tsvector_ops } (siglen = <em class="replaceable"><code>число</code></em>) ] );</code>
     </span></dt><dd><p>Создаёт индекс на базе GiST (Generalized Search Tree, Обобщённое дерево поиска). Здесь <em class="replaceable"><code>столбец</code></em> может иметь тип <code class="type">tsvector</code> или <code class="type">tsquery</code>. Необязательный числовой параметр <code class="literal">siglen</code> определяет длину сигнатуры в байтах (подробнее об этом ниже).</p></dd></dl></div><p>Более предпочтительными для текстового поиска являются индексы GIN. Будучи инвертированными индексами, они содержат записи для всех отдельных слов (лексем) с компактным списком мест их вхождений. При поиске нескольких слов можно найти первое, а затем воспользоваться индексом и исключить строки, в которых дополнительные слова отсутствуют. Индексы GIN хранят только слова (лексемы) из значений <code class="type">tsvector</code>, и теряют информацию об их весах. Таким образом для выполнения запроса с весами потребуется перепроверить строки в таблице.</p><p>Индекс GiST допускает <em class="firstterm">неточности</em>, то есть он допускает ложные попадания и поэтому их нужно исключать дополнительно, сверяя результат с фактическими данными таблицы. (<span class="productname">PostgreSQL</span> делает это автоматически.) Индексы GiST являются неточными, так как все документы в них представляются сигнатурой фиксированной длины. Длина сигнатуры в байтах определяется значением необязательного целочисленного параметра <code class="literal">siglen</code>. По умолчанию (когда параметр <code class="literal">siglen</code> отсутствует) равно 124 байтам, а максимальная длина сигнатуры равна 2024 байтам. Сигнатура формируется в результате представления присутствия каждого слова как одного бита в строке из n-бит, а затем логического объединения этих битовых строк. Если двум словам будет соответствовать одна битовая позиция, попадание оказывается ложным. Если для всех слов оказались установлены соответствующие биты (в случае фактического или ложного попадания), для проверки правильности предположения о совпадении слов необходимо прочитать строку таблицы. При увеличении размера сигнатуры поиск работает точнее (сканируется меньшая область в индексе и меньше страниц кучи), но сам индекс становится больше.</p><p>Индекс GiST может быть покрывающим, то есть использовать функциональность <code class="literal">INCLUDE</code>. В качестве дополнительных в него могут включаться столбцы, для типа данных которых не определён класс операторов GiST. Атрибуты, включаемые в индекс, сохраняются в нём без сжатия.</p><p>Неточность индекса приводит к снижению производительности из-за дополнительных обращений к записям таблицы, для которых предположение о совпадении оказывается ложным. Так как произвольный доступ к таблице обычно не бывает быстрым, это ограничивает применимость индексов GiST. Вероятность ложных попаданий зависит от ряда факторов, например от количества уникальных слов, так что его рекомендуется сокращать, применяя словари.</p><p>Заметьте, что построение индекса <acronym class="acronym">GIN</acronym> часто можно ускорить, увеличив <a class="xref" href="runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM">maintenance_work_mem</a>, тогда как время построения индекса <acronym class="acronym">GiST</acronym> не зависит от этого параметра.</p><p>Правильно используя индексы GIN и GiST и разделяя большие коллекции документов на секции, можно реализовать очень быстрый поиск с возможностью обновления «на лету». Секционировать данные можно как на уровне базы, с использованием наследования таблиц, так и распределив документы по разным серверам и затем собирая внешние результаты, например, средствами доступа к <a class="link" href="ddl-foreign-data.html" title="5.12. Сторонние данные">сторонним данным</a>. Последний вариант возможен благодаря тому, что функции ранжирования используют только локальную информацию.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="textsearch-debugging.html" title="12.8. Тестирование и отладка текстового поиска">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="textsearch.html" title="Глава 12. Полнотекстовый поиск">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="textsearch-psql.html" title="12.10. Поддержка psql">След.</a></td></tr><tr><td width="40%" align="left" valign="top">12.8. Тестирование и отладка текстового поиска </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 12.10. Поддержка <span class="application">psql</span></td></tr></table></div></body></html>