<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.30. pg_prewarm — предварительная загрузка данных отношений в кеш буферов</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="pgfreespacemap.html" title="F.29. pg_freespacemap — просмотр карты свободного пространства" /><link rel="next" href="pgrowlocks.html" title="F.31. pgrowlocks — отображение информации о блокировке строк таблицы" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.30. pg_prewarm — предварительная загрузка данных отношений в кеш буферов</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="pgfreespacemap.html" title="F.29. pg_freespacemap — просмотр карты свободного пространства">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><th width="60%" align="center">Приложение F. Дополнительно поставляемые модули и расширения</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="pgrowlocks.html" title="F.31. pgrowlocks — отображение информации о блокировке строк таблицы">След.</a></td></tr></table><hr /></div><div class="sect1" id="PGPREWARM"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.30. pg_prewarm — предварительная загрузка данных отношений в кеш буферов <a href="#PGPREWARM" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="pgprewarm.html#PGPREWARM-FUNCS">F.30.1. Функции</a></span></dt><dt><span class="sect2"><a href="pgprewarm.html#PGPREWARM-CONFIG-PARAMS">F.30.2. Параметры конфигурации</a></span></dt><dt><span class="sect2"><a href="pgprewarm.html#PGPREWARM-AUTHOR">F.30.3. Автор</a></span></dt></dl></div><a id="id-1.11.7.40.2" class="indexterm"></a><p>Модуль <code class="filename">pg_prewarm</code> предоставляет удобную возможность загружать данные отношений в кеш операционной системы или в кеш буферов <span class="productname">PostgreSQL</span>. Предварительную загрузку можно выполнить вручную, вызвав функцию <code class="filename">pg_prewarm</code>, или автоматически, добавив <code class="literal">pg_prewarm</code> в <a class="xref" href="runtime-config-client.html#GUC-SHARED-PRELOAD-LIBRARIES">shared_preload_libraries</a>. Во втором случае система запустит фоновый процесс, который будет периодически записывать содержимое разделяемых буферов в файл <code class="filename">autoprewarm.blocks</code> с тем, чтобы эти блоки подгружались в память при запуске сервера, используя два дополнительных фоновых процесса.</p><div class="sect2" id="PGPREWARM-FUNCS"><div class="titlepage"><div><div><h3 class="title">F.30.1. Функции <a href="#PGPREWARM-FUNCS" class="id_link">#</a></h3></div></div></div><pre class="synopsis">pg_prewarm(regclass, mode text default 'buffer', fork text default 'main',
           first_block int8 default null,
           last_block int8 default null) RETURNS int8</pre><p>Первый аргумент задаёт отношение, которое будет «разогрето». Во втором указывается метод «разогрева», из описанных ниже; в третьем задаётся целевой слой отношения, обычно <code class="literal">main</code>. В четвёртом аргументе можно передать номер первого разогреваемого блока (<code class="literal">NULL</code> принимается как синоним нуля), а в пятом — номер последнего блока (<code class="literal">NULL</code> означает последний блок отношения). Возвращает эта функция количество разогретых блоков.</p><p>Эта функция поддерживает три режима разогрева. В режиме <code class="literal">prefetch</code> выдаются асинхронные запросы предвыборки данных операционной системе, если они поддерживаются, либо происходит ошибка. В режиме <code class="literal">read</code> считывается заданный диапазон блоков; в отличие от <code class="literal">prefetch</code> это происходит синхронно и поддерживается во всех ОС и любыми сборками, но может быть медленнее. В режиме <code class="literal">buffer</code> запрошенный диапазон блоков считывается в кеш буферов базы данных.</p><p>Заметьте, что с любым из этих методов попытка разогреть больше блоков, чем может уместиться в кеше (в кеше ОС в режимах <code class="literal">prefetch</code> и <code class="literal">read</code>, либо в кеше <span class="productname">PostgreSQL</span> в режиме <code class="literal">buffer</code>) скорее всего приведёт к тому, что блоки с меньшими номерами будут вытеснены из кеша при чтении последующих блоков. Кроме того, разогретые данные никаким специальным образом не защищаются от вытеснения из кеша, так что возможна ситуация, когда из-за другой активности только что разогретые блоки будут вытеснены вскоре после чтения; с другой стороны при таком разогреве из кеша могут быть вытеснены другие данные. Поэтому разогрев обычно наиболее полезен при загрузке, когда кеши в основном пусты.</p><pre class="synopsis">autoprewarm_start_worker() RETURNS void</pre><p>Запустить основной рабочий процесс авторазогрева. Обычно он запускается автоматически, но эта функция полезна, если автоматический разогрев не был настроен при запуске сервера и вы хотите запустить этот процесс позже.</p><pre class="synopsis">autoprewarm_dump_now() RETURNS int8</pre><p>Обновить <code class="filename">autoprewarm.blocks</code> немедленно. Это может быть полезно, если рабочий процесс авторазогрева не работает, но вы хотите, чтобы авторазогрев был произведён при перезапуске. Эта функция возвращает число записей, внесённых в <code class="filename">autoprewarm.blocks</code>.</p></div><div class="sect2" id="PGPREWARM-CONFIG-PARAMS"><div class="titlepage"><div><div><h3 class="title">F.30.2. Параметры конфигурации <a href="#PGPREWARM-CONFIG-PARAMS" class="id_link">#</a></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="varname">pg_prewarm.autoprewarm</code> (<code class="type">boolean</code>) <a id="id-1.11.7.40.5.2.1.1.3" class="indexterm"></a></span></dt><dd><p>Указывает, должен ли сервер запускать рабочий процесс авторазогрева. По умолчанию он включён. Задать этот параметр можно только при запуске сервера.</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="varname">pg_prewarm.autoprewarm_interval</code> (<code class="type">integer</code>) <a id="id-1.11.7.40.5.3.1.1.3" class="indexterm"></a></span></dt><dd><p>Задаёт интервал между обновлениями файла <code class="literal">autoprewarm.blocks</code>. Значение по умолчанию — 300 сек. При значении, равном 0, файл будет сохраняться не периодически, а только при отключении сервера.</p></dd></dl></div><p>Эти параметры должны задаваться в <code class="filename">postgresql.conf</code>. Обычное использование выглядит так:</p><pre class="programlisting"># postgresql.conf
shared_preload_libraries = 'pg_prewarm'

pg_prewarm.autoprewarm = true
pg_prewarm.autoprewarm_interval = 300s</pre></div><div class="sect2" id="PGPREWARM-AUTHOR"><div class="titlepage"><div><div><h3 class="title">F.30.3. Автор <a href="#PGPREWARM-AUTHOR" class="id_link">#</a></h3></div></div></div><p>Роберт Хаас <code class="email">&lt;<a class="email" href="mailto:rhaas@postgresql.org">rhaas@postgresql.org</a>&gt;</code></p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pgfreespacemap.html" title="F.29. pg_freespacemap — просмотр карты свободного пространства">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="pgrowlocks.html" title="F.31. pgrowlocks — отображение информации о блокировке строк таблицы">След.</a></td></tr><tr><td width="40%" align="left" valign="top">F.29. pg_freespacemap — просмотр карты свободного пространства </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> F.31. pgrowlocks — отображение информации о блокировке строк таблицы</td></tr></table></div></body></html>