<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.39. seg — тип данных для отрезков или интервалов чисел с плавающей точкой</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="postgres-fdw.html" title="F.38. postgres_fdw — обращение к данным, находящимся на внешних серверах PostgreSQL" /><link rel="next" href="sepgsql.html" title="F.40. sepgsql — проверка безопасности на базе политик SELinux для мандатного управления доступом (MAC, Mandatory Access Control) с метками" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.39. seg — тип данных для отрезков или интервалов чисел с плавающей точкой</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="postgres-fdw.html" title="F.38. postgres_fdw — обращение к данным, находящимся на внешних серверах PostgreSQL">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><th width="60%" align="center">Приложение F. Дополнительно поставляемые модули и расширения</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sepgsql.html" title="F.40. sepgsql — проверка безопасности на базе политик SELinux для мандатного управления доступом (MAC, Mandatory Access Control) с метками">След.</a></td></tr></table><hr /></div><div class="sect1" id="SEG"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.39. seg — тип данных для отрезков или интервалов чисел с плавающей точкой <a href="#SEG" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="seg.html#SEG-RATIONALE">F.39.1. Обоснование</a></span></dt><dt><span class="sect2"><a href="seg.html#SEG-SYNTAX">F.39.2. Синтаксис</a></span></dt><dt><span class="sect2"><a href="seg.html#SEG-PRECISION">F.39.3. Точность</a></span></dt><dt><span class="sect2"><a href="seg.html#SEG-USAGE">F.39.4. Использование</a></span></dt><dt><span class="sect2"><a href="seg.html#SEG-NOTES">F.39.5. Замечания</a></span></dt><dt><span class="sect2"><a href="seg.html#SEG-CREDITS">F.39.6. Благодарности</a></span></dt></dl></div><a id="id-1.11.7.49.2" class="indexterm"></a><p>Этот модуль реализует тип данных <code class="type">seg</code> для представления отрезков или интервалов чисел с плавающей точкой. Тип <code class="type">seg</code> может выражать отсутствие уверенности в границах интервала, что позволяет применять его для представления лабораторных измерений.</p><p>Данный модуль считается <span class="quote">«<span class="quote">доверенным</span>»</span>, то есть его могут устанавливать обычные пользователи, имеющие право <code class="literal">CREATE</code> в текущей базе данных.</p><div class="sect2" id="SEG-RATIONALE"><div class="titlepage"><div><div><h3 class="title">F.39.1. Обоснование <a href="#SEG-RATIONALE" class="id_link">#</a></h3></div></div></div><p>Геометрия измерений обычно более сложна, чем точка в числовом континууме. Измерение обычно представляет собой отрезок этого континуума с нечёткими границами. Измеряемые показатели выражаются интервалами вследствие неопределённости и случайности, а также того, что измеряемое значение может отражать некоторое условие, например, диапазон температур стабильности протеина.</p><p>Руководствуясь только здравым смыслом, кажется более удобным хранить такие данные в виде интервалов, а не в виде двух отдельных чисел. На практике это оказывается даже эффективнее в большинстве приложений.</p><p>Более того, вследствие нечёткости границ использование традиционных числовых типов данных приводит к определённой потере информации. Рассмотрим такой пример: ваш инструмент выдаёт 6.50 и вы вводите это значение в базу данных. Что вы получите, прочитав это значение из базы? Смотрите: </p><pre class="screen">
test=&gt; select 6.50 :: float8 as "pH";
 pH
---
6.5
(1 row)
</pre><p> В мире измерений, 6.50 — не то же самое, что 6.5. И разница между этими измерениями иногда бывает критической. Экспериментаторы обычно записывают (и публикуют) цифры, которые заслуживают доверия. Запись 6.50 на самом деле представляет неточный интервал, содержащийся внутри большего и ещё более неточного интервала, 6.5, и единственное, что у них может быть общего, это их центральные точки. Поэтому мы определённо не хотим, чтобы такие разные элементы данных выглядели одинаково.</p><p>Вывод? Удобно иметь специальный тип данных, в котором можно сохранить границы интервала с произвольной переменной точностью. В данном случае точность переменная в том смысле, что для каждого элемента данных она может записываться индивидуально.</p><p>Проверьте это: </p><pre class="screen">
test=&gt; select '6.25 .. 6.50'::seg as "pH";
          pH
------------
6.25 .. 6.50
(1 row)
</pre></div><div class="sect2" id="SEG-SYNTAX"><div class="titlepage"><div><div><h3 class="title">F.39.2. Синтаксис <a href="#SEG-SYNTAX" class="id_link">#</a></h3></div></div></div><p>Внешнее представление интервала образуется одним или двумя числами с плавающей точкой, соединёнными оператором диапазона (<code class="literal">..</code> или <code class="literal">...</code>). Кроме того, интервал можно задать центральной точкой плюс/минус отклонение. Также этот тип позволяет сохранить дополнительные индикаторы достоверности (<code class="literal">&lt;</code>, <code class="literal">&gt;</code> или <code class="literal">~</code>). (Однако индикаторы достоверности игнорируются всеми встроенными операторами.) Допустимые представления показаны в <a class="xref" href="seg.html#SEG-REPR-TABLE" title="Таблица F.28. Внешнее представление seg">Таблице F.28</a>; некоторые примеры приведены в <a class="xref" href="seg.html#SEG-INPUT-EXAMPLES" title="Таблица F.29. Примеры допустимых вводимых значений seg">Таблице F.29</a>.</p><p>В <a class="xref" href="seg.html#SEG-REPR-TABLE" title="Таблица F.28. Внешнее представление seg">Таблице F.28</a> символы <em class="replaceable"><code>x</code></em>, <em class="replaceable"><code>y</code></em> и <em class="replaceable"><code>delta</code></em> обозначают числа с плавающей точкой. Перед значениями <em class="replaceable"><code>x</code></em> и <em class="replaceable"><code>y</code></em>, но не <em class="replaceable"><code>delta</code></em>, может быть добавлен индикатор достоверности.</p><div class="table" id="SEG-REPR-TABLE"><p class="title"><strong>Таблица F.28. Внешнее представление <code class="type">seg</code></strong></p><div class="table-contents"><table class="table" summary="Внешнее представление seg" border="1"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="literal"><em class="replaceable"><code>x</code></em></code></td><td>Одно значение (интервал нулевой длины)</td></tr><tr><td><code class="literal"><em class="replaceable"><code>x</code></em> .. <em class="replaceable"><code>y</code></em></code></td><td>Интервал от <em class="replaceable"><code>x</code></em> до <em class="replaceable"><code>y</code></em></td></tr><tr><td><code class="literal"><em class="replaceable"><code>x</code></em> (+-) <em class="replaceable"><code>delta</code></em></code></td><td>Интервал от <em class="replaceable"><code>x</code></em> - <em class="replaceable"><code>delta</code></em> до <em class="replaceable"><code>x</code></em> + <em class="replaceable"><code>delta</code></em></td></tr><tr><td><code class="literal"><em class="replaceable"><code>x</code></em> ..</code></td><td>Открытый интервал с нижней границей <em class="replaceable"><code>x</code></em></td></tr><tr><td><code class="literal">.. <em class="replaceable"><code>x</code></em></code></td><td>Открытый интервал с верхней границей <em class="replaceable"><code>x</code></em></td></tr></tbody></table></div></div><br class="table-break" /><div class="table" id="SEG-INPUT-EXAMPLES"><p class="title"><strong>Таблица F.29. Примеры допустимых вводимых значений <code class="type">seg</code></strong></p><div class="table-contents"><table class="table" summary="Примеры допустимых вводимых значений seg" border="1"><colgroup><col class="col1" /><col class="col2" /></colgroup><tbody><tr><td><code class="literal">5.0</code></td><td>Создаёт сегмент нулевой длины (или точку, если хотите)</td></tr><tr><td><code class="literal">~5.0</code></td><td>Создаёт сегмент нулевой длины и записывает <code class="literal">~</code> в данные. Знак <code class="literal">~</code> игнорируется при операциях с <code class="type">seg</code>, но сохраняется как комментарий.</td></tr><tr><td><code class="literal">&lt;5.0</code></td><td>Создаёт точку с координатой 5.0. Знак <code class="literal">&lt;</code> игнорируется, но сохраняется как комментарий.</td></tr><tr><td><code class="literal">&gt;5.0</code></td><td>Создаёт точку с координатой 5.0. Знак <code class="literal">&gt;</code> игнорируется, но сохраняется как комментарий.</td></tr><tr><td><code class="literal">5(+-)0.3</code></td><td>Создаёт интервал <code class="literal">4.7 .. 5.3</code>. Заметьте, что запись <code class="literal">(+-)</code> не сохраняется.</td></tr><tr><td><code class="literal">50 ..</code></td><td>Всё, что больше или равно 50</td></tr><tr><td><code class="literal">.. 0</code></td><td>Всё, что меньше или равно 0</td></tr><tr><td><code class="literal">1.5e-2 .. 2E-2</code></td><td>Создаёт интервал <code class="literal">0.015 .. 0.02</code></td></tr><tr><td><code class="literal">1 ... 2</code></td><td>То же, что и <code class="literal">1...2</code>, либо <code class="literal">1 .. 2</code>, либо <code class="literal">1..2</code> (пробелы вокруг оператора диапазона игнорируются)</td></tr></tbody></table></div></div><br class="table-break" /><p>Так как оператор <code class="literal">...</code> часто используется в источниках данных, он принимается в качестве альтернативного написания оператора <code class="literal">..</code>. К сожалению, это порождает неоднозначность при разборе: неясно, какая верхняя граница имеется в виду в записи <code class="literal">0...23</code> — <code class="literal">23</code> или <code class="literal">0.23</code>. Для разрешения этой неоднозначности во входных числах <code class="type">seg</code> перед десятичной точкой всегда должна быть минимум одна цифра.</p><p>В качестве меры предосторожности, <code class="type">seg</code> не принимает интервалы с нижней границей, превышающей верхнюю, например: <code class="literal">5 .. 2</code>.</p></div><div class="sect2" id="SEG-PRECISION"><div class="titlepage"><div><div><h3 class="title">F.39.3. Точность <a href="#SEG-PRECISION" class="id_link">#</a></h3></div></div></div><p>Значения <code class="type">seg</code> хранятся внутри как пары 32-битных чисел с плавающей точкой. Это значит, что числа с более чем 7 значащими цифрами будут усекаться.</p><p>Числа, содержащие 7 и меньше значащих цифр, сохраняют изначальную точность. То есть, если запрос возвращает 0.00, вы можете быть уверены, что конечные нули не являются артефактами форматирования: они отражают точность исходных данных. Количество ведущих нулей не влияет на точность: значение 0.0067 будет считаться имеющим только две значащих цифры.</p></div><div class="sect2" id="SEG-USAGE"><div class="titlepage"><div><div><h3 class="title">F.39.4. Использование <a href="#SEG-USAGE" class="id_link">#</a></h3></div></div></div><p>Модуль <code class="filename">seg</code> включает класс операторов индекса GiST для значений <code class="type">seg</code>. Операторы, поддерживаемые этим классом операторов, перечислены в <a class="xref" href="seg.html#SEG-GIST-OPERATORS" title="Таблица F.30. Операторы seg для GiST">Таблице F.30</a>.</p><div class="table" id="SEG-GIST-OPERATORS"><p class="title"><strong>Таблица F.30. Операторы seg для GiST</strong></p><div class="table-contents"><table class="table" summary="Операторы seg для GiST" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Оператор</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">seg</code> <code class="literal">&lt;&lt;</code> <code class="type">seg</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Первый <code class="type">seg</code> полностью находится левее второго? [a, b] &lt;&lt; [c, d] — true, если b &lt; c.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">seg</code> <code class="literal">&gt;&gt;</code> <code class="type">seg</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Первый <code class="type">seg</code> полностью находится правее второго? [a, b] &gt;&gt; [c, d] — true, если a &gt; d.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">seg</code> <code class="literal">&amp;&lt;</code> <code class="type">seg</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Первый <code class="type">seg</code> не простирается правее второго? [a, b] &amp;&lt; [c, d] — true, если b &lt;= d.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">seg</code> <code class="literal">&amp;&gt;</code> <code class="type">seg</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Первый <code class="type">seg</code> не простирается левее второго? [a, b] &amp;&gt; [c, d] — true, если a &gt;= c.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">seg</code> <code class="literal">=</code> <code class="type">seg</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Два отрезка <code class="type">seg</code> равны?</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">seg</code> <code class="literal">&amp;&amp;</code> <code class="type">seg</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Два отрезка <code class="type">seg</code> пересекаются?</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">seg</code> <code class="literal">@&gt;</code> <code class="type">seg</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Первый <code class="type">seg</code> содержит второй?</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">seg</code> <code class="literal">&lt;@</code> <code class="type">seg</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Первый <code class="type">seg</code> содержится во втором?</p></td></tr></tbody></table></div></div><br class="table-break" /><p>Также для типа <code class="type">seg</code> поддерживаются стандартные операторы сравнения, показанные в <a class="xref" href="functions-comparison.html#FUNCTIONS-COMPARISON-OP-TABLE" title="Таблица 9.1. Операторы сравнения">Таблица 9.1</a>. Эти операторы сначала сравнивают (a) с (c), и если они равны, сравнивают (b) с (d). Результат сравнения позволяет упорядочить значения образом, подходящим для большинства случаев, что полезно, если вы хотите применять ORDER BY с этим типом.</p></div><div class="sect2" id="SEG-NOTES"><div class="titlepage"><div><div><h3 class="title">F.39.5. Замечания <a href="#SEG-NOTES" class="id_link">#</a></h3></div></div></div><p>Примеры использования можно увидеть в регрессионном тесте <code class="filename">sql/seg.sql</code>.</p><p>Механизм, преобразующий <code class="literal">(+-)</code> в обычные диапазоны, не вполне точно определяет число значащих цифр для границ. Например, он добавляет дополнительную цифру к нижней границе, если результирующий интервал включает степень десяти: </p><pre class="screen">
postgres=&gt; select '10(+-)1'::seg as seg;
      seg
---------
9.0 .. 11             -- должно быть: 9 .. 11
</pre><p>Производительность индекса-R-дерева может значительно зависеть от начального порядка вводимых значений. Может быть очень полезно отсортировать входную таблицу по столбцу <code class="type">seg</code>; пример можно найти в скрипте <code class="filename">sort-segments.pl</code>.</p></div><div class="sect2" id="SEG-CREDITS"><div class="titlepage"><div><div><h3 class="title">F.39.6. Благодарности <a href="#SEG-CREDITS" class="id_link">#</a></h3></div></div></div><p>Первый автор: Джин Селков мл. <code class="email">&lt;<a class="email" href="mailto:selkovjr@mcs.anl.gov">selkovjr@mcs.anl.gov</a>&gt;</code>, Аргоннская национальная лаборатория, Отдел математики и компьютерных наук</p><p>Я очень благодарен в первую очередь профессору Джо Геллерштейну (<a class="ulink" href="https://dsf.berkeley.edu/jmh/" target="_top">https://dsf.berkeley.edu/jmh/</a>) за пояснение сути GiST (<a class="ulink" href="http://gist.cs.berkeley.edu/" target="_top">http://gist.cs.berkeley.edu/</a>). Я также признателен всем разработчикам Postgres в настоящем и прошлом за возможность создать свой собственный мир и спокойно жить в нём. Ещё я хотел бы выразить признательность Аргоннской лаборатории и Министерству энергетики США за годы постоянной поддержки моих исследований в области баз данных.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="postgres-fdw.html" title="F.38. postgres_fdw — обращение к данным, находящимся на внешних серверах PostgreSQL">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sepgsql.html" title="F.40. sepgsql — проверка безопасности на базе политик SELinux для мандатного управления доступом (MAC, Mandatory Access Control) с метками">След.</a></td></tr><tr><td width="40%" align="left" valign="top">F.38. postgres_fdw — обращение к данным, находящимся на внешних серверах <span class="productname">PostgreSQL</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> F.40. sepgsql — проверка безопасности на базе политик SELinux для мандатного управления доступом (MAC, Mandatory Access Control) с метками</td></tr></table></div></body></html>