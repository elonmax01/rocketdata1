<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE LANGUAGE</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-createindex.html" title="CREATE INDEX" /><link rel="next" href="sql-creatematerializedview.html" title="CREATE MATERIALIZED VIEW" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">CREATE LANGUAGE</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-createindex.html" title="CREATE INDEX">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><th width="60%" align="center">Команды SQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-creatematerializedview.html" title="CREATE MATERIALIZED VIEW">След.</a></td></tr></table><hr /></div><div class="refentry" id="SQL-CREATELANGUAGE"><div class="titlepage"></div><a id="id-1.9.3.70.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">CREATE LANGUAGE</span></h2><p>CREATE LANGUAGE — создать процедурный язык</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">CREATE [ OR REPLACE ] [ TRUSTED ] [ PROCEDURAL ] LANGUAGE <em class="replaceable"><code>имя</code></em>
    HANDLER <em class="replaceable"><code>обработчик_вызова</code></em> [ INLINE <em class="replaceable"><code>обработчик_внедрённого_кода</code></em> ] [ VALIDATOR <em class="replaceable"><code>функция_проверки</code></em> ]
CREATE [ OR REPLACE ] [ TRUSTED ] [ PROCEDURAL ] LANGUAGE <em class="replaceable"><code>имя</code></em></pre></div><div class="refsect1" id="SQL-CREATELANGUAGE-DESCRIPTION"><h2>Описание</h2><p><code class="command">CREATE LANGUAGE</code> регистрирует в базе данных <span class="productname">PostgreSQL</span> новый процедурный язык. Впоследствии на этом языке можно будет определять новые функции и процедуры.</p><p><code class="command">CREATE LANGUAGE</code> по сути связывает имя языка с функциями-обработчиками, исполняющими код, написанный на этом языке. За дополнительными сведениями о языковых обработчиках обратитесь к <a class="xref" href="plhandler.html" title="Глава 58. Написание обработчика процедурного языка">Главе 58</a>.</p><p><code class="command">CREATE OR REPLACE LANGUAGE</code> создаёт новый язык или заменяет определение существующего. Если язык существует, его параметры изменяются в соответствии с командой, но владелец языка и права доступа к нему не меняются. Все уже написанные на этом языке функции также считаются корректными.</p><p>Для того, чтобы зарегистрировать новый язык или изменить параметры существующего, необходимо быть суперпользователем <span class="productname">PostgreSQL</span>. Однако после того, как язык создан, владельцем его можно назначить обычного пользователя, который затем сможет удалить или переименовать его, изменить права доступа к нему, или назначить другого владельца. (Однако нельзя назначать обычного пользователя владельцем нижележащих функций на С — это даст ему возможность повысить свои привилегии.)</p><p>Форма <code class="command">CREATE LANGUAGE</code>, в которой не задаётся никакой обработчик, является устаревшей. Для обратной совместимости со старыми копиями в формате скрипта она воспринимается как <code class="command">CREATE EXTENSION</code> и будет работать, если язык упакован в расширение с тем же именем, как обычно и оформляются процедурные языки.</p></div><div class="refsect1" id="SQL-CREATELANGUAGE-PARAMETERS"><h2>Параметры</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">TRUSTED</code></span></dt><dd><p>Указание <code class="literal">TRUSTED</code> (доверенный) означает, что язык не даёт пользователю доступ к данным, к которым он не имел бы доступа без него. Если при регистрации языка это ключевое слово опущено, использовать этот язык для создания новых функций смогут только суперпользователи <span class="productname">PostgreSQL</span>.</p></dd><dt><span class="term"><code class="literal">PROCEDURAL</code></span></dt><dd><p>Это слово не несёт смысловой нагрузки.</p></dd><dt><span class="term"><em class="replaceable"><code>имя</code></em></span></dt><dd><p>Имя процедурного языка. Оно должно быть уникальным среди всех языков в базе данных.</p></dd><dt><span class="term"><code class="literal">HANDLER</code> <em class="replaceable"><code>обработчик_вызова</code></em></span></dt><dd><p>Здесь <em class="replaceable"><code>обработчик_вызова</code></em> — имя ранее зарегистрированной функции, которая будет вызываться для исполнения процедур (функций) на этом языке. Обработчик вызова для процедурного языка должен быть написан на компилируемом языке, например, на C, с соглашениями о вызовах версии 1 и зарегистрирован в <span class="productname">PostgreSQL</span> как функция без аргументов, возвращающая фиктивный тип <code class="type">language_handler</code>, который просто показывает, что эта функция — обработчик вызова.</p></dd><dt><span class="term"><code class="literal">INLINE</code> <em class="replaceable"><code>обработчик_внедрённого_кода</code></em></span></dt><dd><p>Здесь <em class="replaceable"><code>обработчик_внедрённого_кода</code></em> — имя ранее зарегистрированной функции, которая будет вызываться для выполнения анонимного блока кода (команды <a class="link" href="sql-do.html" title="DO"><code class="command">DO</code></a>) на этом языке. Если <em class="replaceable"><code>обработчик_внедрённого_кода</code></em> не определён, данный язык не будет поддерживать анонимные блоки кода. Этот обработчик должен принимать один аргумент типа <code class="type">internal</code>, содержащий внутреннее представление команды <code class="command">DO</code>, и обычно возвращает тип <code class="type">void</code>. Значение, возвращаемое этим обработчиком, игнорируется.</p></dd><dt><span class="term"><code class="literal">VALIDATOR</code> <em class="replaceable"><code>функция_проверки</code></em></span></dt><dd><p>Здесь <em class="replaceable"><code>функция_проверки</code></em> — имя ранее зарегистрированной функции, которая будет вызываться при создании новой функции на этом языке и проверять её. Если функция проверки не задана, функции на этом языке при создании проверяться не будут. Функция проверки должна принимать один аргумент типа <code class="type">oid</code> с идентификатором создаваемой функции и обычно возвращает <code class="type">void</code>.</p><p>Функция проверки обычно проверяет тело создаваемой функции на синтаксические ошибки, но может также проанализировать и другие характеристики функции, например, поддержку определённых типов аргументов этим языком. Значение, возвращаемое этой функцией, игнорируется, об ошибках она должна сигнализировать, вызывая <code class="function">ereport()</code>.</p></dd></dl></div></div><div class="refsect1" id="SQL-CREATELANGUAGE-NOTES"><h2>Замечания</h2><p>Для удаления процедурных языков следует использовать <a class="link" href="sql-droplanguage.html" title="DROP LANGUAGE"><code class="command">DROP LANGUAGE</code></a>.</p><p>В системном каталоге <code class="classname">pg_language</code> (см. <a class="xref" href="catalog-pg-language.html" title="53.29. pg_language">Раздел 53.29</a>) записывается информация о языках, установленных в данный момент. Список установленных языков также показывает команда <code class="command">\dL</code> в <span class="application">psql</span>.</p><p>Чтобы создавать функции на процедурном языке, пользователь должен иметь право <code class="literal">USAGE</code> для этого языка. По умолчанию для доверенных языков право <code class="literal">USAGE</code> даётся роли <code class="literal">PUBLIC</code> (т. е. всем), однако при желании его можно отозвать.</p><p>Процедурные языки являются локальными по отношению к базам данных. Тем не менее, язык можно установить в базу данных <code class="literal">template1</code>, в результате чего он будет автоматически доступен во всех базах данных, создаваемых из неё впоследствии.</p></div><div class="refsect1" id="SQL-CREATELANGUAGE-EXAMPLES"><h2>Примеры</h2><p>Минимальная процедура создания нового процедурного языка выглядит так: </p><pre class="programlisting">CREATE FUNCTION plsample_call_handler() RETURNS language_handler
    AS '$libdir/plsample'
    LANGUAGE C;
CREATE LANGUAGE plsample
    HANDLER plsample_call_handler;</pre><p> Обычно эти команды записываются в скрипте установки расширения, которое пользователи затем устанавливают так: </p><pre class="programlisting">CREATE EXTENSION plsample;</pre></div><div class="refsect1" id="SQL-CREATELANGUAGE-COMPAT"><h2>Совместимость</h2><p><code class="command">CREATE LANGUAGE</code> является расширением <span class="productname">PostgreSQL</span>.</p></div><div class="refsect1" id="id-1.9.3.70.10"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-alterlanguage.html" title="ALTER LANGUAGE"><span class="refentrytitle">ALTER LANGUAGE</span></a>, <a class="xref" href="sql-createfunction.html" title="CREATE FUNCTION"><span class="refentrytitle">CREATE FUNCTION</span></a>, <a class="xref" href="sql-droplanguage.html" title="DROP LANGUAGE"><span class="refentrytitle">DROP LANGUAGE</span></a>, <a class="xref" href="sql-grant.html" title="GRANT"><span class="refentrytitle">GRANT</span></a>, <a class="xref" href="sql-revoke.html" title="REVOKE"><span class="refentrytitle">REVOKE</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-createindex.html" title="CREATE INDEX">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-creatematerializedview.html" title="CREATE MATERIALIZED VIEW">След.</a></td></tr><tr><td width="40%" align="left" valign="top">CREATE INDEX </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> CREATE MATERIALIZED VIEW</td></tr></table></div></body></html>