<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.41. spi — особенности/примеры использования интерфейса программирования сервера</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sepgsql.html" title="F.40. sepgsql — проверка безопасности на базе политик SELinux для мандатного управления доступом (MAC, Mandatory Access Control) с метками" /><link rel="next" href="sslinfo.html" title="F.42. sslinfo — получение информации об SSL-сертификате клиента" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.41. spi — особенности/примеры использования интерфейса программирования сервера</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sepgsql.html" title="F.40. sepgsql — проверка безопасности на базе политик SELinux для мандатного управления доступом (MAC, Mandatory Access Control) с метками">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><th width="60%" align="center">Приложение F. Дополнительно поставляемые модули и расширения</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sslinfo.html" title="F.42. sslinfo — получение информации об SSL-сертификате клиента">След.</a></td></tr></table><hr /></div><div class="sect1" id="CONTRIB-SPI"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.41. spi — особенности/примеры использования интерфейса программирования сервера <a href="#CONTRIB-SPI" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="contrib-spi.html#CONTRIB-SPI-REFINT">F.41.1. refint — функции для реализации ссылочной целостности</a></span></dt><dt><span class="sect2"><a href="contrib-spi.html#CONTRIB-SPI-AUTOINC">F.41.2. autoinc — функции для автоувеличения полей</a></span></dt><dt><span class="sect2"><a href="contrib-spi.html#CONTRIB-SPI-INSERT-USERNAME">F.41.3. insert_username — функции для отслеживания пользователя, вносящего изменения</a></span></dt><dt><span class="sect2"><a href="contrib-spi.html#CONTRIB-SPI-MODDATETIME">F.41.4. moddatetime — функции для отслеживания времени последнего изменения</a></span></dt></dl></div><a id="id-1.11.7.51.2" class="indexterm"></a><p>Модуль <span class="application">spi</span> предоставляет несколько рабочих примеров использования <a class="link" href="spi.html" title="Глава 47. Интерфейс программирования сервера">Интерфейса программирования сервера</a> (Server Programming Interface, SPI) и триггеров. Хотя эти функции имеют некоторую ценность сами по себе, они ещё более полезны как заготовки, которые можно приспособить под собственные нужды. Эти функции достаточно общие, чтобы работать с любой таблицей, но вы должны явно указать имена таблицы и полей (как описано ниже) при создании триггера.</p><p>Каждая группа функций, описанная ниже, представлена в виде отдельно устанавливаемого расширения.</p><div class="sect2" id="CONTRIB-SPI-REFINT"><div class="titlepage"><div><div><h3 class="title">F.41.1. refint — функции для реализации ссылочной целостности <a href="#CONTRIB-SPI-REFINT" class="id_link">#</a></h3></div></div></div><p>Функции <code class="function">check_primary_key()</code> и <code class="function">check_foreign_key()</code> применяются для проверки ограничений внешних ключей. (Эта функциональность уже давно вытеснена встроенным механизмом внешних ключей, но этот модуль всё ещё полезен в качестве примера.)</p><p>Функция <code class="function">check_primary_key()</code> проверяет ссылающуюся таблицу. Чтобы воспользоваться ей, создайте триггер <code class="literal">BEFORE INSERT OR UPDATE</code> с этой функцией для таблицы, ссылающейся на другую. Укажите в аргументах триггера: имена столбцов ссылающейся таблицы, образующих внешний ключ, имя целевой таблицы и имена столбцов в ней, образующих первичный/уникальный ключ. Чтобы контролировать несколько внешних ключей, создайте триггер для каждой такой ссылки.</p><p>Функция <code class="function">check_foreign_key()</code> проверяет целевую таблицу. Чтобы использовать её, создайте триггер <code class="literal">BEFORE DELETE OR UPDATE</code> с этой функцией для таблицы, на которую ссылаются другие. Укажите в аргументах триггера: число ссылающихся таблиц, для которых функция должна выполнить проверки, действие в случае обнаружения ссылающегося ключа (<code class="literal">cascade</code> — удалить ссылающуюся строку, <code class="literal">restrict</code> — прервать транзакцию, <code class="literal">setnull</code> — установить в ссылающихся полях значения NULL), имена столбцов целевой таблицы, образующих первичный/уникальный ключ, а затем имена таблиц и столбцов (в количестве, задаваемом первым аргументом). Заметьте, что поля первичных/уникальных столбцов должны иметь пометку NOT NULL и по ним должен быть создан уникальный индекс.</p><p>Примеры приведены в <code class="filename">refint.example</code>.</p></div><div class="sect2" id="CONTRIB-SPI-AUTOINC"><div class="titlepage"><div><div><h3 class="title">F.41.2. autoinc — функции для автоувеличения полей <a href="#CONTRIB-SPI-AUTOINC" class="id_link">#</a></h3></div></div></div><p>Функция <code class="function">autoinc()</code> реализует код триггера, сохраняющего следующее значение последовательности в целочисленном поле. Это в некоторой степени пересекается со встроенной функциональностью столбца <span class="quote">«<span class="quote">serial</span>»</span>, но есть и отличия: <code class="function">autoinc()</code> препятствует попыткам вставить другое значение поля при добавлении строк и может увеличивать значение поля при изменениях.</p><p>Чтобы использовать её, создайте триггер <code class="literal">BEFORE INSERT</code> (или <code class="literal">BEFORE INSERT OR UPDATE</code>) с этой функцией. Передайте триггеру два аргумента: имя целочисленного столбца, который будет меняться, и имя объекта последовательности, который будет поставлять значения. (Вообще вы можете задать любое число пар таких имён, если хотите поддерживать несколько автоувеличивающихся столбцов.)</p><p>Пример приведён в <code class="filename">autoinc.example</code>.</p></div><div class="sect2" id="CONTRIB-SPI-INSERT-USERNAME"><div class="titlepage"><div><div><h3 class="title">F.41.3. insert_username — функции для отслеживания пользователя, вносящего изменения <a href="#CONTRIB-SPI-INSERT-USERNAME" class="id_link">#</a></h3></div></div></div><p>Функция <code class="function">insert_username()</code> реализует код триггера, сохраняющего имя текущего пользователя в текстовом поле. Это может быть полезно для отслеживания пользователя, изменившего конкретную строку таблицы последним.</p><p>Чтобы использовать её, создайте триггер <code class="literal">BEFORE INSERT</code> и/или <code class="literal">UPDATE</code> с этой функцией. Передайте триггеру один аргумент: имя целевого текстового столбца.</p><p>Пример приведён в <code class="filename">insert_username.example</code>.</p></div><div class="sect2" id="CONTRIB-SPI-MODDATETIME"><div class="titlepage"><div><div><h3 class="title">F.41.4. moddatetime — функции для отслеживания времени последнего изменения <a href="#CONTRIB-SPI-MODDATETIME" class="id_link">#</a></h3></div></div></div><p>Функция <code class="function">moddatetime()</code> реализует код триггера, сохраняющего текущее время в поле типа <code class="type">timestamp</code>. Это может быть полезно для отслеживания времени последней модификации конкретной строки таблицы.</p><p>Чтобы использовать её, создайте триггер <code class="literal">BEFORE UPDATE</code> с этой функцией. Передайте триггеру один аргумент: имя целевого столбца. Столбец должен иметь тип <code class="type">timestamp</code> или <code class="type">timestamp with time zone</code>.</p><p>Пример приведён в <code class="filename">moddatetime.example</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sepgsql.html" title="F.40. sepgsql — проверка безопасности на базе политик SELinux для мандатного управления доступом (MAC, Mandatory Access Control) с метками">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sslinfo.html" title="F.42. sslinfo — получение информации об SSL-сертификате клиента">След.</a></td></tr><tr><td width="40%" align="left" valign="top">F.40. sepgsql — проверка безопасности на базе политик SELinux для мандатного управления доступом (MAC, Mandatory Access Control) с метками </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> F.42. sslinfo — получение информации об SSL-сертификате клиента</td></tr></table></div></body></html>