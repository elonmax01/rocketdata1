<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>34.21. Сборка программ с libpq</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="libpq-threading.html" title="34.20. Поведение в многопоточных программах" /><link rel="next" href="libpq-example.html" title="34.22. Примеры программ" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">34.21. Сборка программ с <span class="application">libpq</span></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="libpq-threading.html" title="34.20. Поведение в многопоточных программах">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="libpq.html" title="Глава 34. libpq — библиотека для языка C">Наверх</a></td><th width="60%" align="center">Глава 34. <span class="application">libpq</span> — библиотека для языка C</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="libpq-example.html" title="34.22. Примеры программ">След.</a></td></tr></table><hr /></div><div class="sect1" id="LIBPQ-BUILD"><div class="titlepage"><div><div><h2 class="title" style="clear: both">34.21. Сборка программ с <span class="application">libpq</span> <a href="#LIBPQ-BUILD" class="id_link">#</a></h2></div></div></div><a id="id-1.7.3.28.2" class="indexterm"></a><p>Чтобы собрать (то есть, скомпилировать и скомпоновать) программу, использующую <span class="application">libpq</span>, вы должны проделать следующие действия: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Включите заголовочный файл <code class="filename">libpq-fe.h</code>: </p><pre class="programlisting">#include &lt;libpq-fe.h&gt;</pre><p> Если вы не сделаете этого, обычно вас ждут примерно такие сообщения об ошибках от компилятора: </p><pre class="screen">
foo.c: In function `main':
foo.c:34: `PGconn' undeclared (first use in this function)
foo.c:35: `PGresult' undeclared (first use in this function)
foo.c:54: `CONNECTION_BAD' undeclared (first use in this function)
foo.c:68: `PGRES_COMMAND_OK' undeclared (first use in this function)
foo.c:95: `PGRES_TUPLES_OK' undeclared (first use in this function)
</pre></li><li class="listitem"><p>Сообщите вашему компилятору каталог, в котором установлены заголовочные файлы <span class="productname">PostgreSQL</span>, передав ему параметр <code class="literal">-I<em class="replaceable"><code>каталог</code></em></code>. (В некоторых случаях компилятор сам может обращаться к нужному каталогу, так что этот параметр можно опустить.) Например, ваша команда компиляции может быть такой: </p><pre class="programlisting">cc -c -I/usr/local/pgsql/include testprog.c</pre><p> Если вы используете скрипты сборки Makefile, добавьте этот параметр в переменную <code class="varname">CPPFLAGS</code>: </p><pre class="programlisting">CPPFLAGS += -I/usr/local/pgsql/include</pre><p>Если существует возможность, что вашу программу будут компилировать другие пользователи, то путь к каталогу не следует жёстко задавать таким образом. Вместо этого вы можете воспользоваться утилитой <code class="command">pg_config</code><a id="id-1.7.3.28.3.2.2.2.2" class="indexterm"></a> и узнать, где в локальной системе находятся заголовочные файлы, следующим образом: </p><pre class="screen">
<code class="prompt">$</code> pg_config --includedir
<code class="computeroutput">/usr/local/include</code>
</pre><p>Если у вас установлена программа <code class="command">pkg-config</code><a id="id-1.7.3.28.3.2.2.3.2" class="indexterm"></a>, вместо этого вы можете выполнить: </p><pre class="screen">
<code class="prompt">$</code> pkg-config --cflags libpq
<code class="computeroutput">-I/usr/local/include</code>
</pre><p> Заметьте, что при этом перед путём сразу будет добавлен ключ <code class="option">-I</code>.</p><p>Если требуемый параметр не будет передан компилятору, вы получите примерно такое сообщение об ошибке: </p><pre class="screen">
testlibpq.c:8:22: libpq-fe.h: No such file or directory
</pre></li><li class="listitem"><p>При компоновке окончательной программы добавьте параметр <code class="literal">-lpq</code>, чтобы была подключена библиотека <span class="application">libpq</span>, а также параметр <code class="literal">-L<em class="replaceable"><code>каталог</code></em></code>, указывающий на каталог, в котором находится <span class="application">libpq</span>. (Опять же, компилятор будет просматривать определённые каталоги по умолчанию.) Для максимальной переносимости указывайте ключ <code class="option">-L</code> перед параметром <code class="option">-lpq</code>. Например: </p><pre class="programlisting">cc -o testprog testprog1.o testprog2.o -L/usr/local/pgsql/lib -lpq</pre><p>Каталог с библиотекой можно узнать, так же используя <code class="command">pg_config</code>: </p><pre class="screen">
<code class="prompt">$</code> pg_config --libdir
<code class="computeroutput">/usr/local/pgsql/lib</code>
</pre><p>Или с помощью той же программы <code class="command">pkg-config</code>: </p><pre class="screen">
<code class="prompt">$</code> pkg-config --libs libpq
<code class="computeroutput">-L/usr/local/pgsql/lib -lpq</code>
</pre><p> Заметьте, что и в этом случае выводится полностью сформированный параметр, а не только путь.</p><p>В случае проблем в этой области возможны примерно такие сообщения об ошибках: </p><pre class="screen">
testlibpq.o: In function `main':
testlibpq.o(.text+0x60): undefined reference to `PQsetdbLogin'
testlibpq.o(.text+0x71): undefined reference to `PQstatus'
testlibpq.o(.text+0xa4): undefined reference to `PQerrorMessage'
</pre><p> Они означают, что вы забыли добавить параметр <code class="option">-lpq</code>. </p><pre class="screen">
/usr/bin/ld: cannot find -lpq
</pre><p> Такая ошибка означает, что вы забыли добавить ключ <code class="option">-L</code> или не указали правильный каталог.</p></li></ul></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="libpq-threading.html" title="34.20. Поведение в многопоточных программах">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="libpq.html" title="Глава 34. libpq — библиотека для языка C">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="libpq-example.html" title="34.22. Примеры программ">След.</a></td></tr><tr><td width="40%" align="left" valign="top">34.20. Поведение в многопоточных программах </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 34.22. Примеры программ</td></tr></table></div></body></html>