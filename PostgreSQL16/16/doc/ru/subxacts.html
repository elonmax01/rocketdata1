<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>74.3. Подтранзакции</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="xact-locking.html" title="74.2. Транзакции и блокировки" /><link rel="next" href="two-phase.html" title="74.4. Двухфазные транзакции" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">74.3. Подтранзакции</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="xact-locking.html" title="74.2. Транзакции и блокировки">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="transactions.html" title="Глава 74. Обработка транзакций">Наверх</a></td><th width="60%" align="center">Глава 74. Обработка транзакций</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="two-phase.html" title="74.4. Двухфазные транзакции">След.</a></td></tr></table><hr /></div><div class="sect1" id="SUBXACTS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">74.3. Подтранзакции <a href="#SUBXACTS" class="id_link">#</a></h2></div></div></div><p>Подтранзакции запускаются внутри транзакций и позволяют разбивать более крупные транзакции на составляющие. Подтранзакции могут фиксироваться или прерываться, не влияя на родительские транзакции, которые, соответственно, могут продолжать выполняться. Такое решение позволяет обрабатывать ошибки проще и часто используется при разработке приложений. В английском языке слово подтранзакция зачастую сокращается до <em class="firstterm">subxact</em>.</p><p>Подтранзакции могут явным образом запускаться как при помощи команды <code class="command">SAVEPOINT</code>, так и другими способами, например посредством предложения <code class="literal">EXCEPTION</code> языка PL/pgSQL. Языки PL/Python и PL/Tcl также поддерживают явные подтранзакции. Подтранзакции можно также запускать в других подтранзакциях. Транзакция верхнего уровня и её дочерние подтранзакции формируют иерархию или дерево, поэтому по отношению к основной транзакции используется термин <span class="quote">«<span class="quote">транзакция верхнего уровня</span>»</span>.</p><p>Если подтранзакции присваивается невиртуальный идентификатор, его называют <span class="quote">«<span class="quote">subxid</span>»</span>. Подтранзакциям в режиме только чтения не присваиваются subxid, однако при первой попытке записи такой идентификатор будет присвоен. При этом всем родительским транзакциям подтранзакции, вплоть до транзакции верхнего уровня включительно, присваивается невиртуальный идентификатор. Значение xid родительской транзакции всегда будет меньше значений subxid подтранзакций.</p><p>Идентификатор непосредственного родителя каждой подтранзакции записывается в каталог <code class="filename">pg_subtrans</code>. Идентификаторы транзакций верхнего уровня не записываются, поскольку у них нет родителя. Также не записываются и идентификаторы подтранзакций в режиме только чтения.</p><p>При фиксации подтранзакции все зафиксированные дочерние подтранзакции с subxid также считаются зафиксированными в рамках этой подтранзакции. При прерывании подтранзакции все дочерние подтранзакции также считаются прерванными.</p><p>При фиксации транзакции верхнего уровня с xid зафиксированные подтранзакции записываются как зафиксированные в подкаталоге <code class="filename">pg_xact</code>. При прерывании транзакции верхнего уровня все её подтранзакции также прерываются, даже если они были зафиксированы.</p><p>Чем больше подтранзакций остаётся открытыми в каждой транзакции (в отношении которых не выполнен откат или освобождение), тем выше будут издержки, связанные с управлением транзакциями. До 64 открытых subxid кешируется в общей памяти для каждого сервера. После этого этапа издержки хранения для операций ввода/вывода существенно возрастают из-за дополнительных операций поиска записей о subxid в <code class="filename">pg_subtrans</code>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="xact-locking.html" title="74.2. Транзакции и блокировки">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="transactions.html" title="Глава 74. Обработка транзакций">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="two-phase.html" title="74.4. Двухфазные транзакции">След.</a></td></tr><tr><td width="40%" align="left" valign="top">74.2. Транзакции и блокировки </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 74.4. Двухфазные транзакции</td></tr></table></div></body></html>