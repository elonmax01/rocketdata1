<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>38.6. Перегрузка функций</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="xfunc-sql.html" title="38.5. Функции на языке запросов (SQL)" /><link rel="next" href="xfunc-volatility.html" title="38.7. Категории изменчивости функций" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">38.6. Перегрузка функций</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="xfunc-sql.html" title="38.5. Функции на языке запросов (SQL)">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="extend.html" title="Глава 38. Расширение SQL">Наверх</a></td><th width="60%" align="center">Глава 38. Расширение <acronym class="acronym">SQL</acronym></th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="xfunc-volatility.html" title="38.7. Категории изменчивости функций">След.</a></td></tr></table><hr /></div><div class="sect1" id="XFUNC-OVERLOAD"><div class="titlepage"><div><div><h2 class="title" style="clear: both">38.6. Перегрузка функций <a href="#XFUNC-OVERLOAD" class="id_link">#</a></h2></div></div></div><a id="id-1.8.3.9.2" class="indexterm"></a><p>Вы можете определить несколько функций с одним именем SQL, если эти функции будут принимать разные аргументы. Другими словами, имена функций можно <em class="firstterm">перегружать</em>. Независимо от того, используете вы эту возможность или нет, она требует предосторожности при вызове функций в базах данных, где одни пользователи не доверяют другим; см. <a class="xref" href="typeconv-func.html" title="10.3. Функции">Раздел 10.3</a>. Когда выполняется запрос, сервер определяет, какую именно функцию вызывать, по количеству и типам представленных аргументов. Перегрузка может быть полезна для имитации функций с переменным количеством аргументов, до какого-то конечного числа.</p><p>Создавая семейство перегруженных функций, необходимо не допускать неоднозначности. Например, если созданы функции: </p><pre class="programlisting">CREATE FUNCTION test(int, real) RETURNS ...
CREATE FUNCTION test(smallint, double precision) RETURNS ...</pre><p> не вполне понятно, какая функция будет вызвана с довольно простыми аргументами вроде <code class="literal">test(1, 1.5)</code>. Реализованные в данный момент правила разрешения типов описаны в <a class="xref" href="typeconv.html" title="Глава 10. Преобразование типов">Главе 10</a>, но разрабатывать систему, которая будет незаметно полагаться на такие особенности, неразумно.</p><p>Функции, принимающей один аргумент составного типа, обычно не следует давать имя, совпадающее с именем какого-либо атрибута (поля) этого типа. Вспомните, что запись <code class="literal"><em class="replaceable"><code>атрибут</code></em>(<em class="replaceable"><code>таблица</code></em>)</code> считается равнозначной <code class="literal"><em class="replaceable"><code>таблица</code></em>.<em class="replaceable"><code>атрибут</code></em></code>. В случае, когда возникает неоднозначность между функцией, принимающей составной тип, и атрибутом составного типа, всегда будет выбираться атрибут. Этот выбор можно переопределить, дополнив имя функции схемой (то есть, записав <code class="literal"><em class="replaceable"><code>схема</code></em>.<em class="replaceable"><code>функция</code></em>(<em class="replaceable"><code>таблица</code></em>)</code>), но лучше избежать этой проблемы, подобрав разные имена.</p><p>Другой тип конфликта возможен между обычными функциями и функциями с переменными параметрами. Например, можно создать функции <code class="literal">foo(numeric)</code> и <code class="literal">foo(VARIADIC numeric[])</code>. В этом случае будет непонятно, какая функция должна выбираться при передаче одного числового аргумента, например <code class="literal">foo(10.1)</code>. При разрешении этого конфликта предпочтение отдаётся функции, найденной первой по пути поиска, либо, если две функции находятся в одной схеме, выбирается функция с постоянными аргументами.</p><p>При перегрузке функций на языке C есть дополнительное ограничение: имя уровня C каждой функции в семействе перегруженных функций должно отличаться от имён уровня C всех других функций, как внутренних, так и загружаемых динамически. Если это правило нарушается, поведение зависит от среды. Вы можете получить ошибку компоновщика во время выполнения, либо будет вызвана не та функция (обычно внутренняя). Альтернативная форма предложения <code class="literal">AS</code> для SQL-команды <code class="command">CREATE FUNCTION</code> позволяет отвязать имя SQL-функции от имени, определённого в исходном коде на C. Например: </p><pre class="programlisting">CREATE FUNCTION test(int) RETURNS int
    AS '<em class="replaceable"><code>имя_файла</code></em>', 'test_1arg'
    LANGUAGE C;
CREATE FUNCTION test(int, int) RETURNS int
    AS '<em class="replaceable"><code>имя_файла</code></em>', 'test_2arg'
    LANGUAGE C;</pre><p> Имена функций на C здесь следуют одному из множества возможных соглашений.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="xfunc-sql.html" title="38.5. Функции на языке запросов (SQL)">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="extend.html" title="Глава 38. Расширение SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="xfunc-volatility.html" title="38.7. Категории изменчивости функций">След.</a></td></tr><tr><td width="40%" align="left" valign="top">38.5. Функции на языке запросов (<acronym class="acronym">SQL</acronym>) </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 38.7. Категории изменчивости функций</td></tr></table></div></body></html>