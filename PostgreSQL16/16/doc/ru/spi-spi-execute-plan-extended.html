<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>SPI_execute_plan_extended</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="spi-spi-execute-plan.html" title="SPI_execute_plan" /><link rel="next" href="spi-spi-execute-plan-with-paramlist.html" title="SPI_execute_plan_with_paramlist" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">SPI_execute_plan_extended</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="spi-spi-execute-plan.html" title="SPI_execute_plan">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="spi-interface.html" title="47.1. Интерфейсные функции">Наверх</a></td><th width="60%" align="center">47.1. Интерфейсные функции</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="spi-spi-execute-plan-with-paramlist.html" title="SPI_execute_plan_with_paramlist">След.</a></td></tr></table><hr /></div><div class="refentry" id="SPI-SPI-EXECUTE-PLAN-EXTENDED"><div class="titlepage"></div><a id="id-1.8.12.8.16.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">SPI_execute_plan_extended</span></h2><p>SPI_execute_plan_extended — выполнить оператор, подготовленный функцией <code class="function">SPI_prepare</code></p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">int SPI_execute_plan_extended(SPIPlanPtr <em class="parameter"><code>plan</code></em>,
                              const SPIExecuteOptions * <em class="parameter"><code>options</code></em>)</pre></div><div class="refsect1" id="id-1.8.12.8.16.5"><h2>Описание</h2><p><code class="function">SPI_execute_plan_extended</code> выполняет оператор, подготовленный функцией <code class="function">SPI_prepare</code> или родственными ей. Данная функция равнозначна <code class="function">SPI_execute_plan</code>, не считая того, что по-другому представляется информация о значениях параметров, передаваемых запросу. Также ей могут передаваться дополнительные параметры для управления выполнением запроса.</p><p>Значения параметров запроса передаются в структуре <code class="literal">ParamListInfo</code>; это удобно, когда имеющиеся значения уже представлены в этом формате. Через функции-обработчики, устанавливаемые в <code class="literal">ParamListInfo</code>, можно также передавать динамические наборы параметров.</p><p>Кроме того, кортежи результата могут не только накапливаться в структуре <code class="varname">SPI_tuptable</code>, но и передаваться заданному вызывающим кодом объекту <code class="literal">DestReceiver</code> по мере формирования очередного кортежа исполнителем. Особенно полезно использовать этот объект в запросах, которые могут выдать множество кортежей, поскольку данные будут обрабатываться <span class="quote">«<span class="quote">на лету</span>»</span>, а не накапливаться в памяти.</p></div><div class="refsect1" id="id-1.8.12.8.16.6"><h2>Аргументы</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">SPIPlanPtr <em class="parameter"><code>plan</code></em></code></span></dt><dd><p>подготовленный оператор (возвращаемый функцией <code class="function">SPI_prepare</code>)</p></dd><dt><span class="term"><code class="literal">const SPIExecuteOptions * <em class="parameter"><code>options</code></em></code></span></dt><dd><p>структура, содержащая необязательные аргументы</p></dd></dl></div><p>Структуру <em class="parameter"><code>options</code></em> всегда следует сначала полностью заполнять нулями, а затем уже задавать необходимые значения. Это гарантирует совместимость с будущими изменениями в коде: при добавлении в эту структуру любых новых полей нулевое значение будет определять старое поведение. Сейчас в <em class="parameter"><code>options</code></em> есть такие поля:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ParamListInfo <em class="parameter"><code>params</code></em></code></span></dt><dd><p>структура данных, содержащая типы и значения параметров запроса; NULL, если их нет</p></dd><dt><span class="term"><code class="literal">bool <em class="parameter"><code>read_only</code></em></code></span></dt><dd><p><code class="literal">true</code> для режима выполнения «только чтение»</p></dd><dt><span class="term"><code class="literal">bool <em class="parameter"><code>allow_nonatomic</code></em></code></span></dt><dd><p><code class="literal">true</code> для неатомарного выполнения операторов CALL и DO</p></dd><dt><span class="term"><code class="literal">bool <em class="parameter"><code>must_return_tuples</code></em></code></span></dt><dd><p>если <code class="literal">true</code>, вызывает ошибку для типов запросов, не возвращающих кортежи (за исключением случая, когда возвращаются нулевые кортежи)</p></dd><dt><span class="term"><code class="literal">uint64 <em class="parameter"><code>tcount</code></em></code></span></dt><dd><p>максимальное число строк, которое должно быть возвращено; с <code class="literal">0</code> ограничения нет</p></dd><dt><span class="term"><code class="literal">DestReceiver * <em class="parameter"><code>dest</code></em></code></span></dt><dd><p>объект <code class="literal">DestReceiver</code>, получающий все кортежи, которые выдаёт запрос; если NULL, результирующие кортежи накапливаются в <code class="varname">SPI_tuptable</code>, как при выполнении <code class="function">SPI_execute_plan</code></p></dd><dt><span class="term"><code class="literal">ResourceOwner <em class="parameter"><code>owner</code></em></code></span></dt><dd><p>Владелец ресурса, который будет содержать счётчик ссылок на план во время его выполнения. Если NULL, используется текущий владелец ресурса. Параметр игнорируется для несохранённых планов, поскольку SPI не получает счётчики ссылок на них.</p></dd></dl></div></div><div class="refsect1" id="id-1.8.12.8.16.7"><h2>Возвращаемое значение</h2><p>Возвращаемые значения те же, что и у <code class="function">SPI_execute_plan</code>.</p><p>Если <em class="parameter"><code>options-&gt;dest</code></em> имеет значение NULL, <code class="varname">SPI_processed</code> и <code class="varname">SPI_tuptable</code> устанавливаются как при выполнении <code class="function">SPI_execute_plan</code>. Если <em class="parameter"><code>options-&gt;dest</code></em> — не NULL, то <code class="varname">SPI_processed</code> принимает нулевое значение, а <code class="varname">SPI_tuptable</code> — NULL. Если необходимо подсчитать число кортежей, это нужно сделать в коде объекта <code class="literal">DestReceiver</code>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="spi-spi-execute-plan.html" title="SPI_execute_plan">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="spi-interface.html" title="47.1. Интерфейсные функции">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="spi-spi-execute-plan-with-paramlist.html" title="SPI_execute_plan_with_paramlist">След.</a></td></tr><tr><td width="40%" align="left" valign="top">SPI_execute_plan </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> SPI_execute_plan_with_paramlist</td></tr></table></div></body></html>