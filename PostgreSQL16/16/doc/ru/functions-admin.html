<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>9.27. Функции для системного администрирования</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="functions-info.html" title="9.26. Системные информационные функции и операторы" /><link rel="next" href="functions-trigger.html" title="9.28. Триггерные функции" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">9.27. Функции для системного администрирования</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="functions-info.html" title="9.26. Системные информационные функции и операторы">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="functions.html" title="Глава 9. Функции и операторы">Наверх</a></td><th width="60%" align="center">Глава 9. Функции и операторы</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="functions-trigger.html" title="9.28. Триггерные функции">След.</a></td></tr></table><hr /></div><div class="sect1" id="FUNCTIONS-ADMIN"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.27. Функции для системного администрирования <a href="#FUNCTIONS-ADMIN" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-SET">9.27.1. Функции для управления конфигурацией</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-SIGNAL">9.27.2. Функции для передачи сигналов серверу</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-BACKUP">9.27.3. Функции управления резервным копированием</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-RECOVERY-CONTROL">9.27.4. Функции управления восстановлением</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-SNAPSHOT-SYNCHRONIZATION">9.27.5. Функции синхронизации снимков</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-REPLICATION">9.27.6. Функции управления репликацией</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-DBOBJECT">9.27.7. Функции управления объектами баз данных</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-INDEX">9.27.8. Функции обслуживания индексов</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-GENFILE">9.27.9. Функции для работы с обычными файлами</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADVISORY-LOCKS">9.27.10. Функции управления рекомендательными блокировками</a></span></dt></dl></div><p>Функции, описанные в этом разделе, предназначены для контроля и управления сервером <span class="productname">PostgreSQL</span>.</p><div class="sect2" id="FUNCTIONS-ADMIN-SET"><div class="titlepage"><div><div><h3 class="title">9.27.1. Функции для управления конфигурацией <a href="#FUNCTIONS-ADMIN-SET" class="id_link">#</a></h3></div></div></div><a id="id-1.5.8.33.3.2" class="indexterm"></a><a id="id-1.5.8.33.3.3" class="indexterm"></a><a id="id-1.5.8.33.3.4" class="indexterm"></a><p>В <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-SET-TABLE" title="Таблица 9.89. Функции для управления конфигурацией">Таблице 9.89</a> показаны функции, позволяющие получить и изменить значения параметров конфигурации выполнения.</p><div class="table" id="FUNCTIONS-ADMIN-SET-TABLE"><p class="title"><strong>Таблица 9.89. Функции для управления конфигурацией</strong></p><div class="table-contents"><table class="table" summary="Функции для управления конфигурацией" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p>
       <p>Пример(ы)</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.3.6.2.2.1.1.1.1" class="indexterm"></a> <code class="function">current_setting</code> ( <em class="parameter"><code>setting_name</code></em> <code class="type">text</code> [<span class="optional">, <em class="parameter"><code>missing_ok</code></em> <code class="type">boolean</code></span>] ) → <code class="returnvalue">text</code></p>
       <p>Выдаёт текущее значение параметра <em class="parameter"><code>setting_name</code></em>. Если такого параметра нет, <code class="function">current_setting</code> выдаёт ошибку, если только дополнительно не передан параметр <em class="parameter"><code>missing_ok</code></em> со значением <code class="literal">true</code> (в этом случае выдаётся NULL). Эта функция соответствует <acronym class="acronym">SQL</acronym>-команде <a class="xref" href="sql-show.html" title="SHOW"><span class="refentrytitle">SHOW</span></a>.</p>
       <p>
        <code class="literal">current_setting('datestyle')</code>
        → <code class="returnvalue">ISO, MDY</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.3.6.2.2.2.1.1.1" class="indexterm"></a> <code class="function">set_config</code> ( <em class="parameter"><code>setting_name</code></em> <code class="type">text</code>, <em class="parameter"><code>new_value</code></em> <code class="type">text</code>, <em class="parameter"><code>is_local</code></em> <code class="type">boolean</code> ) → <code class="returnvalue">text</code></p>
       <p>Устанавливает для параметра <em class="parameter"><code>setting_name</code></em> значение <em class="parameter"><code>new_value</code></em> и возвращает это значение. Если параметр <em class="parameter"><code>is_local</code></em> равен <code class="literal">true</code>, новое значение будет действовать только в рамках текущей транзакции. Чтобы это значение действовало на протяжении текущего сеанса, присвойте этому параметру <code class="literal">false</code>. Эта функция соответствует SQL-команде <a class="xref" href="sql-set.html" title="SET"><span class="refentrytitle">SET</span></a>.</p>
       <p>
        <code class="literal">set_config('log_statement_stats', 'off', false)</code>
        → <code class="returnvalue">off</code>
       </p></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="FUNCTIONS-ADMIN-SIGNAL"><div class="titlepage"><div><div><h3 class="title">9.27.2. Функции для передачи сигналов серверу <a href="#FUNCTIONS-ADMIN-SIGNAL" class="id_link">#</a></h3></div></div></div><a id="id-1.5.8.33.4.2" class="indexterm"></a><p>Функции, перечисленные в <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-SIGNAL-TABLE" title="Таблица 9.90. Функции для передачи сигналов серверу">Таблице 9.90</a>, позволяют передавать управляющие сигналы другим серверным процессам. Вызывать эти функции по умолчанию разрешено только суперпользователям, но доступ к ним можно дать и другим пользователям командой <code class="command">GRANT</code>, кроме явно отмеченных исключений.</p><p>Все эти функции возвращают <code class="literal">true</code>, если сигнал успешно отправлен, и <code class="literal">false</code>, если отправить сигнал не удалось.</p><div class="table" id="FUNCTIONS-ADMIN-SIGNAL-TABLE"><p class="title"><strong>Таблица 9.90. Функции для передачи сигналов серверу</strong></p><div class="table-contents"><table class="table" summary="Функции для передачи сигналов серверу" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.4.5.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_cancel_backend</code> ( <em class="parameter"><code>pid</code></em> <code class="type">integer</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Отменяет текущий запрос в сеансе, который обслуживается процессом с заданным PID. Это действие разрешается и ролям, являющимся членами роли, запрос которой отменяется, и ролям с правами роли <code class="literal">pg_signal_backend</code>; однако только суперпользователям разрешено отменять запросы других суперпользователей.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.4.5.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_log_backend_memory_contexts</code> ( <em class="parameter"><code>pid</code></em> <code class="type">integer</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Запрашивает вывод в журнал информации о контекстах памяти обслуживающего процесса с указанным PID. Эта функция может отправлять запрос обслуживающим и вспомогательным процессам, кроме процесса протоколирования. Запрошенная информация будет выведена в сообщениях уровня <code class="literal">LOG</code>, которые появятся в журнале сервера в зависимости от заданной конфигурации журнала (за дополнительными сведениями обратитесь к <a class="xref" href="runtime-config-logging.html" title="20.8. Регистрация ошибок и протоколирование работы сервера">Разделу 20.8</a>), но не будут передаваться клиенту независимо от <a class="xref" href="runtime-config-client.html#GUC-CLIENT-MIN-MESSAGES">client_min_messages</a>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.4.5.2.2.3.1.1.1" class="indexterm"></a> <code class="function">pg_reload_conf</code> () → <code class="returnvalue">boolean</code></p>
       <p>Даёт всем процессам сервера <span class="productname">PostgreSQL</span> команду перезагрузить файлы конфигурации. (Для этого посылается сигнал <span class="systemitem">SIGHUP</span> главному процессу, который, в свой очередь, посылает <span class="systemitem">SIGHUP</span> всем своим дочерним процессам.) Вы можете прочитать представления <a class="link" href="view-pg-file-settings.html" title="54.7. pg_file_settings"><code class="structname">pg_file_settings</code></a>, <a class="link" href="view-pg-hba-file-rules.html" title="54.9. pg_hba_file_rules"><code class="structname">pg_hba_file_rules</code></a> и <a class="link" href="view-pg-ident-file-mappings.html" title="54.10. pg_ident_file_mappings"><code class="structname">pg_ident_file_mappings</code></a>, чтобы проверить файлы конфигурации на предмет возможных ошибок перед перезагрузкой.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.4.5.2.2.4.1.1.1" class="indexterm"></a> <code class="function">pg_rotate_logfile</code> () → <code class="returnvalue">boolean</code></p>
       <p>Указывает менеджеру журнала сообщений немедленно переключиться на новый файл. Это имеет смысл, только когда работает встроенный сборщик сообщений, так как без него подпроцесс менеджера журнала не запускается.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.4.5.2.2.5.1.1.1" class="indexterm"></a> <code class="function">pg_terminate_backend</code> ( <em class="parameter"><code>pid</code></em> <code class="type">integer</code>, <em class="parameter"><code>timeout</code></em> <code class="type">bigint</code> <code class="literal">DEFAULT</code> <code class="literal">0</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Завершает сеанс, который обслуживается процессом с заданным PID. Это действие разрешается и ролям, являющимся членами роли, процесс которой прерывается, и ролям с правами роли <code class="literal">pg_signal_backend</code>; однако только суперпользователям разрешено прерывать обслуживающие процессы других суперпользователей.</p>
       <p>Если параметр <em class="parameter"><code>timeout</code></em> не задан или равен нулю, данная функция возвращает <code class="literal">true</code> независимо от того, действительно ли завершается процесс; то есть результат показывает только, что сигнал был отправлен успешно. Если параметр <em class="parameter"><code>timeout</code></em> задан (в миллисекундах) и больше нуля, функция ожидает, пока процесс не будет фактически завершён или пока не пройдёт заданное время. Если процесс завершён, функция возвращает <code class="literal">true</code>. В случае тайм-аута выдаётся предупреждение и возвращается <code class="literal">false</code>.</p></td></tr></tbody></table></div></div><br class="table-break" /><p><code class="function">pg_cancel_backend</code> и <code class="function">pg_terminate_backend</code> передают сигналы (<span class="systemitem">SIGINT</span> и <span class="systemitem">SIGTERM</span>, соответственно) серверному процессу с заданным кодом PID. Код активного процесса можно получить из столбца <code class="structfield">pid</code> представления <code class="structname">pg_stat_activity</code> или просмотрев на сервере процессы с именем <code class="command">postgres</code> (используя <span class="application">ps</span> в Unix или <span class="application">Диспетчер задач</span> в <span class="productname">Windows</span>). Роль пользователя активного процесса можно узнать в столбце <code class="structfield">usename</code> представления <code class="structname">pg_stat_activity</code>.</p><p><code class="function">pg_log_backend_memory_contexts</code> может использоваться для получения в журнале сервера информации о контекстах памяти. Например: </p><pre class="programlisting">postgres=# SELECT pg_log_backend_memory_contexts(pg_backend_pid());
 pg_log_backend_memory_contexts
--------------------------------
 t
(1 row)</pre><p> Для каждого контекста памяти будет выводиться одно сообщение. Например: </p><pre class="screen">
LOG:  logging memory contexts of PID 10377
STATEMENT:  SELECT pg_log_backend_memory_contexts(pg_backend_pid());
LOG:  level: 0; TopMemoryContext: 80800 total in 6 blocks; 14432 free (5 chunks); 66368 used
LOG:  level: 1; pgstat TabStatusArray lookup hash table: 8192 total in 1 blocks; 1408 free (0 chunks); 6784 used
LOG:  level: 1; TopTransactionContext: 8192 total in 1 blocks; 7720 free (1 chunks); 472 used
LOG:  level: 1; RowDescriptionContext: 8192 total in 1 blocks; 6880 free (0 chunks); 1312 used
LOG:  level: 1; MessageContext: 16384 total in 2 blocks; 5152 free (0 chunks); 11232 used
LOG:  level: 1; Operator class cache: 8192 total in 1 blocks; 512 free (0 chunks); 7680 used
LOG:  level: 1; smgr relation table: 16384 total in 2 blocks; 4544 free (3 chunks); 11840 used
LOG:  level: 1; TransactionAbortContext: 32768 total in 1 blocks; 32504 free (0 chunks); 264 used
...
LOG:  level: 1; ErrorContext: 8192 total in 1 blocks; 7928 free (3 chunks); 264 used
LOG:  Grand total: 1651920 bytes in 201 blocks; 622360 free (88 chunks); 1029560 used
</pre><p> Если у одного родителя более 100 дочерних контекстов, в журнале описываются первые 100 дочерних контекстов, а по остальным выдаётся краткая сводка. Обратите внимание, что частые вызовы этой функции могут создавать значительную нагрузку, так как она может записывать в журнал массу сообщений.</p></div><div class="sect2" id="FUNCTIONS-ADMIN-BACKUP"><div class="titlepage"><div><div><h3 class="title">9.27.3. Функции управления резервным копированием <a href="#FUNCTIONS-ADMIN-BACKUP" class="id_link">#</a></h3></div></div></div><a id="id-1.5.8.33.5.2" class="indexterm"></a><p>Функции, перечисленные в <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-BACKUP-TABLE" title="Таблица 9.91. Функции управления резервным копированием">Таблице 9.91</a>, предназначены для выполнения резервного копирования «на ходу». Эти функции нельзя выполнять во время восстановления (за исключением <code class="function">pg_backup_start</code>, <code class="function">pg_backup_stop</code> и <code class="function">pg_wal_lsn_diff</code>).</p><p>Подробнее практическое применение этих функций описывается в <a class="xref" href="continuous-archiving.html" title="26.3. Непрерывное архивирование и восстановление на момент времени (Point-in-Time Recovery, PITR)">Разделе 26.3</a>.</p><div class="table" id="FUNCTIONS-ADMIN-BACKUP-TABLE"><p class="title"><strong>Таблица 9.91. Функции управления резервным копированием</strong></p><div class="table-contents"><table class="table" summary="Функции управления резервным копированием" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.5.5.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_create_restore_point</code> ( <em class="parameter"><code>name</code></em> <code class="type">text</code> ) → <code class="returnvalue">pg_lsn</code></p>
       <p>Создаёт в журнале предзаписи именованный маркер, который можно использовать как цель при восстановлении, и возвращает соответствующую ему позицию в журнале. Полученное имя затем можно указать в параметре <a class="xref" href="runtime-config-wal.html#GUC-RECOVERY-TARGET-NAME">recovery_target_name</a>, определив тем самым точку, до которой будет выполняться восстановление. Учтите, что если будет создано несколько точек восстановления с одним именем, восстановление остановится на первой точке с этим именем.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.5.5.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_current_wal_flush_lsn</code> () → <code class="returnvalue">pg_lsn</code></p>
       <p>Выдаёт текущую позицию сброса данных в журнале предзаписи (см. примечания ниже).</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.5.5.2.2.3.1.1.1" class="indexterm"></a> <code class="function">pg_current_wal_insert_lsn</code> () → <code class="returnvalue">pg_lsn</code></p>
       <p>Выдаёт текущую позицию добавления в журнале предзаписи (см. примечания ниже).</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.5.5.2.2.4.1.1.1" class="indexterm"></a> <code class="function">pg_current_wal_lsn</code> () → <code class="returnvalue">pg_lsn</code></p>
       <p>Выдаёт текущую позицию записи в журнале предзаписи (см. примечания ниже).</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.5.5.2.2.5.1.1.1" class="indexterm"></a> <code class="function">pg_backup_start</code> ( <em class="parameter"><code>label</code></em> <code class="type">text</code> [<span class="optional">, <em class="parameter"><code>fast</code></em> <code class="type">boolean</code></span>] ) → <code class="returnvalue">pg_lsn</code></p>
       <p>Подготавливает сервер к резервному копированию «на лету». Единственный обязательный параметр задаёт произвольную пользовательскую метку резервной копии. (Обычно это имя, которое получит файл резервной копии.) Если необязательный второй параметр задан и имеет значение <code class="literal">true</code>, функция <code class="function">pg_backup_start</code> должна выполниться максимально быстро. Это означает, что принудительно будет выполнена контрольная точка, вследствие чего кратковременно увеличится нагрузка на ввод/вывод и параллельно выполняемые запросы могут замедлиться.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.5.5.2.2.6.1.1.1" class="indexterm"></a> <code class="function">pg_backup_stop</code> ( [<span class="optional"><em class="parameter"><code>wait_for_archive</code></em> <code class="type">boolean</code></span>] ) → <code class="returnvalue">record</code> ( <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>labelfile</code></em> <code class="type">text</code>, <em class="parameter"><code>spcmapfile</code></em> <code class="type">text</code> )</p>
       <p>Завершает выполнение резервного копирования. В результате возвращается ожидаемое содержимое файла метки резервной копии и файла карты табличных пространств, которое нужно сохранить в файлы в архиве (не в каталоге данных). Эти файлы нельзя записывать в каталог работающей базы данных (в противном случае PostgreSQL не сможет перезапуститься, если произойдёт сбой).</p>
       <p>У этой функции есть также необязательный параметр типа <code class="type">boolean</code>. Если он равен false, <code class="function">pg_backup_stop</code> завершится сразу после окончания резервного копирования, не дожидаясь архивации WAL. Это поведение полезно только для программ резервного копирования, которые осуществляют архивацию WAL независимо. Если же WAL не будет заархивирован вовсе, резервная копия может оказаться неполной, и, как следствие, непригодной для восстановления. Когда он равен true (по умолчанию), <code class="function">pg_backup_stop</code> будет ждать выполнения архивации WAL, если архивирование включено. Для резервного сервера это означает, что ожидание возможно только при условии <code class="varname">archive_mode = always</code>. Если активность записи на ведущем сервере невысока, может иметь смысл выполнить на нём <code class="function">pg_switch_wal</code> для немедленного переключения сегмента.</p>
       <p>При выполнении на ведущем эта функция также создаёт файл истории резервного копирования в области архива журнала предзаписи. В этом файле для данной резервной копии сохраняется метка, заданная при вызове <code class="function">pg_backup_start</code>, начальная и конечная позиция в журнале предзаписи, а также время начала и окончания копирования. После записи конечной позиции текущая позиция автоматически перемещается к следующему файлу журнала предзаписи, чтобы файл конечной позиции можно было немедленно архивировать для завершения резервного копирования.</p>
       <p>В результате эта функция выдаёт единственную запись. Столбец <em class="parameter"><code>lsn</code></em> в ней содержит позицию завершения копирования в журнале предзаписи (её также можно игнорировать). Во втором столбце передаётся содержимое файла метки резервной копии, а в третьем — содержимое файла карты табличных пространств. Эту информацию нужно сохранить в составе резервной копии, она потребуется в процессе восстановления.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.5.5.2.2.7.1.1.1" class="indexterm"></a> <code class="function">pg_switch_wal</code> () → <code class="returnvalue">pg_lsn</code></p>
       <p>Производит принудительное переключение журнала предзаписи на новый файл, что позволяет архивировать текущий (в предположении, что выполняется непрерывная архивация). Результат функции — конечная позиция в только что законченном файле журнала предзаписи + 1. Если с момента последнего переключения файлов не было активности, отражающейся в журнале предзаписи, <code class="function">pg_switch_wal</code> не делает ничего и возвращает начальную позицию в файле журнала предзаписи, используемом в данный момент.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.5.5.2.2.8.1.1.1" class="indexterm"></a> <code class="function">pg_walfile_name</code> ( <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code> ) → <code class="returnvalue">text</code></p>
       <p>Выдаёт для заданной позиции в журнале предзаписи имя соответствующего файла WAL.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.5.5.2.2.9.1.1.1" class="indexterm"></a> <code class="function">pg_walfile_name_offset</code> ( <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code> ) → <code class="returnvalue">record</code> ( <em class="parameter"><code>file_name</code></em> <code class="type">text</code>, <em class="parameter"><code>file_offset</code></em> <code class="type">integer</code> )</p>
       <p>Выдаёт для заданной позиции в журнале предзаписи имя соответствующего файла и байтовое смещение в нём.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.5.5.2.2.10.1.1.1" class="indexterm"></a> <code class="function">pg_split_walfile_name</code> ( <em class="parameter"><code>file_name</code></em> <code class="type">text</code> ) → <code class="returnvalue">record</code> ( <em class="parameter"><code>segment_number</code></em> <code class="type">numeric</code>, <em class="parameter"><code>timeline_id</code></em> <code class="type">bigint</code> )</p>
       <p>Извлекает последовательный номер и идентификатор линии времени из имени файла WAL.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.5.5.2.2.11.1.1.1" class="indexterm"></a> <code class="function">pg_wal_lsn_diff</code> ( <em class="parameter"><code>lsn1</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>lsn2</code></em> <code class="type">pg_lsn</code> ) → <code class="returnvalue">numeric</code></p>
       <p>Вычисляет разницу в байтах (<em class="parameter"><code>lsn1</code></em> - <em class="parameter"><code>lsn2</code></em>) между двумя позициями в журнале предзаписи. Полученный результат можно использовать с <code class="structname">pg_stat_replication</code> или с некоторыми функциями, перечисленными в <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-BACKUP-TABLE" title="Таблица 9.91. Функции управления резервным копированием">Таблица 9.91</a>, для определения задержки репликации.</p></td></tr></tbody></table></div></div><br class="table-break" /><p><code class="function">pg_current_wal_lsn</code> выводит текущую позицию записи в журнале предзаписи в том же формате, что и вышеописанные функции. <code class="function">pg_current_wal_insert_lsn</code> подобным образом выводит текущую позицию добавления, а <code class="function">pg_current_wal_flush_lsn</code> — позицию сброса данных журнала. Позицией добавления называется <span class="quote">«<span class="quote">логический</span>»</span> конец журнала предзаписи в любой момент времени, тогда как позиция записи указывает на конец данных, фактически вынесённых из внутренних буферов сервера, а позиция сброса показывает, до какого места данные считаются сохранёнными в надёжном хранилище. Позиция записи отмечает конец данных, которые может видеть снаружи внешний процесс, и именно она представляет интерес при копировании частично заполненных файлов журнала. Позиция добавления и позиция сброса выводятся в основном для отладки серверной части. Все эти функции выполняются в режиме «только чтение» и не требуют прав суперпользователя.</p><p>Используя функцию <code class="function">pg_walfile_name_offset</code>, из значения <code class="type">pg_lsn</code> можно получить имя соответствующего ему файла журнала предзаписи и байтовое смещение в этом файле. Например: </p><pre class="programlisting">postgres=# SELECT * FROM pg_walfile_name_offset((pg_backup_stop()).lsn);
        file_name         | file_offset
--------------------------+-------------
 00000001000000000000000D |     4039624
(1 row)</pre><p> Родственная ей функция <code class="function">pg_walfile_name</code> извлекает только имя файла журнала предзаписи. Когда заданная позиция в журнале предзаписи находится ровно на границе файлов, обе эти функции возвращают имя предыдущего файла. Обычно это поведение предпочтительно при архивировании журнала предзаписи, так как именно предыдущий файл является последним подлежащим архивации.</p><p><code class="function">pg_split_walfile_name</code> полезна для вычисления <acronym class="acronym">LSN</acronym> на основе смещения файла и имени файла WAL, например: </p><pre class="programlisting">postgres=# \set file_name '000000010000000100C000AB'
postgres=# \set offset 256
postgres=# SELECT '0/0'::pg_lsn + pd.segment_number * ps.setting::int + :offset AS lsn
  FROM pg_split_walfile_name(:'file_name') pd,
       pg_show_all_settings() ps
  WHERE ps.name = 'wal_segment_size';
      lsn
---------------
 C001/AB000100
(1 row)</pre></div><div class="sect2" id="FUNCTIONS-RECOVERY-CONTROL"><div class="titlepage"><div><div><h3 class="title">9.27.4. Функции управления восстановлением <a href="#FUNCTIONS-RECOVERY-CONTROL" class="id_link">#</a></h3></div></div></div><p>Функции, показанные в <a class="xref" href="functions-admin.html#FUNCTIONS-RECOVERY-INFO-TABLE" title="Таблица 9.92. Функции для получения информации о восстановлении">Таблице 9.92</a>, предоставляют сведения о текущем состоянии ведомого сервера. Эти функции могут выполняться как во время восстановления, так и в обычном режиме работы.</p><div class="table" id="FUNCTIONS-RECOVERY-INFO-TABLE"><p class="title"><strong>Таблица 9.92. Функции для получения информации о восстановлении</strong></p><div class="table-contents"><table class="table" summary="Функции для получения информации о восстановлении" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.6.3.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_is_in_recovery</code> () → <code class="returnvalue">boolean</code></p>
       <p>Возвращает true, если в данный момент выполняется процедура восстановления.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.6.3.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_last_wal_receive_lsn</code> () → <code class="returnvalue">pg_lsn</code></p>
       <p>Выдаёт позицию последней записи в журнале предзаписи, которая была получена и записана на диск в процессе потоковой репликации. Пока выполняется потоковая репликация, эта позиция постоянно увеличивается. По окончании восстановления она остаётся на записи WAL, полученной и записанной на диск последней. Если потоковая репликация отключена или ещё не запускалась, функция возвращает <code class="literal">NULL</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.6.3.2.2.3.1.1.1" class="indexterm"></a> <code class="function">pg_last_wal_replay_lsn</code> () → <code class="returnvalue">pg_lsn</code></p>
       <p>Выдаёт позицию последней записи в журнале предзаписи, которая была воспроизведёна при восстановлении. В процессе восстановления эта позиция постоянно увеличивается. По окончании этого процесса она остаётся на записи WAL, которая была восстановлена последней. Если сервер при запуске не выполнял процедуру восстановления, эта функция выдаёт <code class="literal">NULL</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.6.3.2.2.4.1.1.1" class="indexterm"></a> <code class="function">pg_last_xact_replay_timestamp</code> () → <code class="returnvalue">timestamp with time zone</code></p>
       <p>Выдаёт отметку времени последней транзакции, воспроизведённой при восстановлении. Это время, когда на главном сервере произошла фиксация или откат записи WAL для этой транзакции. Если в процессе восстановления не была воспроизведена ни одна транзакция, эта функция выдаёт <code class="literal">NULL</code>. В противном случае возвращаемое значение постоянно увеличивается в процессе восстановления. По окончании восстановления в нём остаётся время транзакции, которая была восстановлена последней. Если сервер при запуске не выполнял процедуру восстановления, эта функция выдаёт <code class="literal">NULL</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.6.3.2.2.5.1.1.1" class="indexterm"></a> <code class="function">pg_get_wal_resource_managers</code> () → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>rm_id</code></em> <code class="type">integer</code>, <em class="parameter"><code>rm_name</code></em> <code class="type">text</code>, <em class="parameter"><code>rm_builtin</code></em> <code class="type">boolean</code> )</p>
       <p>Выдаёт загруженные на данный момент менеджеры ресурсов WAL в системе. Столбец <em class="parameter"><code>rm_builtin</code></em> показывает, является ли данный менеджер ресурсов встроенным или пользовательским, то есть создаваемым расширением.</p></td></tr></tbody></table></div></div><br class="table-break" /><p>Функции, перечисленные в <a class="xref" href="functions-admin.html#FUNCTIONS-RECOVERY-CONTROL-TABLE" title="Таблица 9.93. Функции управления восстановлением">Таблице 9.93</a> управляют процессом восстановления. Вызывать их в другое время нельзя.</p><div class="table" id="FUNCTIONS-RECOVERY-CONTROL-TABLE"><p class="title"><strong>Таблица 9.93. Функции управления восстановлением</strong></p><div class="table-contents"><table class="table" summary="Функции управления восстановлением" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.6.5.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_is_wal_replay_paused</code> () → <code class="returnvalue">boolean</code></p>
       <p>Возвращает true, если запрошена приостановка восстановления.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.6.5.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_get_wal_replay_pause_state</code> () → <code class="returnvalue">text</code></p>
       <p>Возвращает состояние приостановки восстановления. Возвращаемые значения: <code class="literal">not paused</code> — приостановка не запрашивалась, <code class="literal">pause requested</code> — получен запрос на приостановку, но восстановление ещё не приостановлено, и <code class="literal">paused</code>, если восстановление действительно приостановлено.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.6.5.2.2.3.1.1.1" class="indexterm"></a> <code class="function">pg_promote</code> ( <em class="parameter"><code>wait</code></em> <code class="type">boolean</code> <code class="literal">DEFAULT</code> <code class="literal">true</code>, <em class="parameter"><code>wait_seconds</code></em> <code class="type">integer</code> <code class="literal">DEFAULT</code> <code class="literal">60</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Повышает статус ведомого сервера до ведущего. Если параметр <em class="parameter"><code>wait</code></em> равен <code class="literal">true</code> (по умолчанию), эта функция дожидается завершения операции повышения в течение <em class="parameter"><code>wait_seconds</code></em> секунд и возвращает <code class="literal">true</code> в случае успешного повышения или <code class="literal">false</code> в противном случае. Если параметр <em class="parameter"><code>wait</code></em> равен <code class="literal">false</code>, функция возвращает <code class="literal">true</code> сразу после передачи процессу postmaster сигнала <code class="literal">SIGUSR1</code>, инициирующего повышение.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.6.5.2.2.4.1.1.1" class="indexterm"></a> <code class="function">pg_wal_replay_pause</code> () → <code class="returnvalue">void</code></p>
       <p>Запрашивает приостановку восстановления. Запрос приостановки может быть выполнен не сразу. Если вы хотите убедиться, что восстановление действительно приостановлено, проверьте состояние приостановки восстановления с помощью функции <code class="function">pg_get_wal_replay_pause_state()</code>. Заметьте, что <code class="function">pg_get_wal_replay_paused</code> показывает только был ли сделан запрос. Когда восстановление приостановлено, запись изменений в базу не производится. В режиме «горячего резерва» все последующие запросы будут видеть один согласованный снимок базы данных, что исключает конфликты запросов до продолжения восстановления.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.6.5.2.2.5.1.1.1" class="indexterm"></a> <code class="function">pg_wal_replay_resume</code> () → <code class="returnvalue">void</code></p>
       <p>Возобновляет восстановление, если оно было приостановлено.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr></tbody></table></div></div><br class="table-break" /><p>Функции <code class="function">pg_wal_replay_pause</code> и <code class="function">pg_wal_replay_resume</code> нельзя выполнять в процессе повышения. Если повышение запрашивается, когда восстановление приостановлено, сервер выходит из состояния паузы и продолжает процедуру повышения.</p><p>Когда потоковая репликация отключена, пауза при восстановлении может длиться сколь угодно долго без каких-либо проблем. Если же потоковая репликация осуществляется, новые записи WAL продолжат поступать и заполнят весь диск рано или поздно, в зависимости от длительности паузы, интенсивности записи в WAL и объёма свободного пространства.</p></div><div class="sect2" id="FUNCTIONS-SNAPSHOT-SYNCHRONIZATION"><div class="titlepage"><div><div><h3 class="title">9.27.5. Функции синхронизации снимков <a href="#FUNCTIONS-SNAPSHOT-SYNCHRONIZATION" class="id_link">#</a></h3></div></div></div><p><span class="productname">PostgreSQL</span> позволяет синхронизировать снимки состояния между сеансами баз данных. <em class="firstterm">Снимок состояния</em> определяет, какие данные видны транзакции, работающей с этим снимком. Синхронизация снимков необходима, когда в двух или более сеансах нужно видеть одно и то же содержимое базы данных. Если в двух сеансах транзакции запускаются независимо, всегда есть вероятность, что некая третья транзакция будет зафиксирована между командами <code class="command">START TRANSACTION</code> для первых двух, и в результате в одном сеансе будет виден результат третьей, а в другом — нет.</p><p>Для решения этой проблемы <span class="productname">PostgreSQL</span> позволяет транзакции <em class="firstterm">экспортировать</em> снимок состояния, с которым она работает. Пока экспортирующая этот снимок транзакция выполняется, другие транзакции могут <em class="firstterm">импортировать</em> его и, таким образом, увидеть абсолютно то же состояние базы данных, что видит первая транзакция. Но учтите, что любые изменения, произведённые этими транзакциями, будут не видны для других, как это и должно быть с изменениями в незафиксированных транзакциях. Таким образом, транзакции синхронизируют только начальное состояние данных, а последующие производимые в них изменения изолируются как обычно.</p><p>Снимки состояния экспортируются с помощью функции <code class="function">pg_export_snapshot</code>, показанной в <a class="xref" href="functions-admin.html#FUNCTIONS-SNAPSHOT-SYNCHRONIZATION-TABLE" title="Таблица 9.94. Функции синхронизации снимков">Таблице 9.94</a>, и импортируются командой <a class="xref" href="sql-set-transaction.html" title="SET TRANSACTION"><span class="refentrytitle">SET TRANSACTION</span></a>.</p><div class="table" id="FUNCTIONS-SNAPSHOT-SYNCHRONIZATION-TABLE"><p class="title"><strong>Таблица 9.94. Функции синхронизации снимков</strong></p><div class="table-contents"><table class="table" summary="Функции синхронизации снимков" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.7.5.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_export_snapshot</code> () → <code class="returnvalue">text</code></p>
       <p>Сохраняет текущий снимок состояния транзакции и возвращает строку типа <code class="type">text</code> с идентификатором этого снимка. Эта строка должна передаваться внешними средствами клиентам, которые будут импортировать этот снимок. Снимок может быть импортирован только при условии, что экспортировавшая его транзакция ещё не завершена.</p>
       <p>Если необходимо, транзакция может экспортировать несколько снимков. Заметьте, что это имеет смысл только для транзакций уровня <code class="literal">READ COMMITTED</code>, так как транзакции уровня изоляции <code class="literal">REPEATABLE READ</code> и выше работают с одним снимком состояния на протяжении всего своего существования. После того как транзакция экспортировала снимок, её нельзя сделать подготовленной с помощью <a class="xref" href="sql-prepare-transaction.html" title="PREPARE TRANSACTION"><span class="refentrytitle">PREPARE TRANSACTION</span></a>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.7.5.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_log_standby_snapshot</code> () → <code class="returnvalue">pg_lsn</code></p>
       <p>Сделать снимок выполняющихся транзакций и записать его в WAL, не дожидаясь, пока процессы bgwriter или checkpointer запишут его. Это полезно для логического декодирования на резервном сервере, поскольку создание логического слота должно откладываться до тех пор, пока такая запись не будет воспроизведена на резервном сервере.</p></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="FUNCTIONS-REPLICATION"><div class="titlepage"><div><div><h3 class="title">9.27.6. Функции управления репликацией <a href="#FUNCTIONS-REPLICATION" class="id_link">#</a></h3></div></div></div><p>В <a class="xref" href="functions-admin.html#FUNCTIONS-REPLICATION-TABLE" title="Таблица 9.95. Функции управления репликацией">Таблице 9.95</a> показаны функции, предназначенные для управления механизмом репликации и взаимодействия с ним. Чтобы изучить этот механизм подробнее, обратитесь к <a class="xref" href="warm-standby.html#STREAMING-REPLICATION" title="27.2.5. Потоковая репликация">Подразделу 27.2.5</a>, <a class="xref" href="warm-standby.html#STREAMING-REPLICATION-SLOTS" title="27.2.6. Слоты репликации">Подразделу 27.2.6</a> и <a class="xref" href="replication-origins.html" title="Глава 50. Отслеживание прогресса репликации">Главе 50</a>. По умолчанию только суперпользователи имеют разрешение выполнять функции с источниками репликации, но его можно дать и другим, воспользовавшись командой <code class="literal">GRANT</code>. Использование данных функций для слотов репликации разрешено только суперпользователям и пользователям, имеющим право <code class="literal">REPLICATION</code>.</p><p>Многие из этих функций соответствуют командам в протоколе репликации; см. <a class="xref" href="protocol-replication.html" title="55.4. Протокол потоковой репликации">Раздел 55.4</a>.</p><p>Функции, описанные в <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-BACKUP" title="9.27.3. Функции управления резервным копированием">Подразделе 9.27.3</a>, <a class="xref" href="functions-admin.html#FUNCTIONS-RECOVERY-CONTROL" title="9.27.4. Функции управления восстановлением">Подразделе 9.27.4</a> и <a class="xref" href="functions-admin.html#FUNCTIONS-SNAPSHOT-SYNCHRONIZATION" title="9.27.5. Функции синхронизации снимков">Подразделе 9.27.5</a>, также имеют отношение к репликации.</p><div class="table" id="FUNCTIONS-REPLICATION-TABLE"><p class="title"><strong>Таблица 9.95. Функции управления репликацией</strong></p><div class="table-contents"><table class="table" summary="Функции управления репликацией" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_create_physical_replication_slot</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code> [<span class="optional">, <em class="parameter"><code>immediately_reserve</code></em> <code class="type">boolean</code>, <em class="parameter"><code>temporary</code></em> <code class="type">boolean</code></span>] ) → <code class="returnvalue">record</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code> )</p>
       <p>Создаёт новый физический слот репликации с именем <em class="parameter"><code>slot_name</code></em>. Необязательный второй параметр, когда он равен <code class="literal">true</code>, указывает, что <acronym class="acronym">LSN</acronym> для этого слота репликации должен быть зарезервирован немедленно; в противном случае <acronym class="acronym">LSN</acronym> резервируется при первом подключении клиента потоковой репликации. Передача изменений из физического слота возможна только по протоколу потоковой репликации — см. <a class="xref" href="protocol-replication.html" title="55.4. Протокол потоковой репликации">Раздел 55.4</a>. Необязательный третий параметр, <em class="parameter"><code>temporary</code></em>, когда он равен true, указывает, что этот слот не должен постоянно храниться на диске, так как он предназначен только для текущего сеанса. Временные слоты также освобождаются при любой ошибке. Эта функция соответствует команде протокола репликации <code class="literal">CREATE_REPLICATION_SLOT ... PHYSICAL</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_drop_replication_slot</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code> ) → <code class="returnvalue">void</code></p>
       <p>Удаляет физический или логический слот репликации с именем <em class="parameter"><code>slot_name</code></em>. Соответствует команде протокола репликации <code class="literal">DROP_REPLICATION_SLOT</code>. Для логических слотов эта функция должна вызываться при подключении к той же базе данных, в которой был создан слот.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.3.1.1.1" class="indexterm"></a> <code class="function">pg_create_logical_replication_slot</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>plugin</code></em> <code class="type">name</code> [<span class="optional">, <em class="parameter"><code>temporary</code></em> <code class="type">boolean</code>, <em class="parameter"><code>twophase</code></em> <code class="type">boolean</code></span>] ) → <code class="returnvalue">record</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code> )</p>
       <p>Создаёт новый логический (декодирующий) слот репликации с именем <em class="parameter"><code>slot_name</code></em>, используя модуль вывода <em class="parameter"><code>plugin</code></em>. Необязательный третий параметр, <em class="parameter"><code>temporary</code></em>, когда равен true, указывает, что этот слот не должен постоянно храниться на диске, так как предназначен только для текущего сеанса. Временные слоты также освобождаются при любой ошибке. Необязательный четвёртый параметр, <em class="parameter"><code>twophase</code></em>, когда равен true, указывает, что для данного слота включается декодирование подготовленных транзакций. Вызов этой функции равнозначен выполнению команды протокола репликации <code class="literal">CREATE_REPLICATION_SLOT ... LOGICAL</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.4.1.1.1" class="indexterm"></a> <code class="function">pg_copy_physical_replication_slot</code> ( <em class="parameter"><code>src_slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>dst_slot_name</code></em> <code class="type">name</code> [<span class="optional">, <em class="parameter"><code>temporary</code></em> <code class="type">boolean</code></span>] ) → <code class="returnvalue">record</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code> )</p>
       <p>Копирует существующий слот физической репликации с именем <em class="parameter"><code>src_slot_name</code></em> в слот с именем <em class="parameter"><code>dst_slot_name</code></em>. Скопированный слот физической репликации начинает резервировать WAL с того же последовательного номера <acronym class="acronym">LSN</acronym>, что и исходный слот. Параметр <em class="parameter"><code>temporary</code></em> является необязательным и позволяет указать, будет ли слот временным. Если параметр <em class="parameter"><code>temporary</code></em> опущен, сохраняется то же свойство, что имеет исходный слот.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.5.1.1.1" class="indexterm"></a> <code class="function">pg_copy_logical_replication_slot</code> ( <em class="parameter"><code>src_slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>dst_slot_name</code></em> <code class="type">name</code> [<span class="optional">, <em class="parameter"><code>temporary</code></em> <code class="type">boolean</code> [<span class="optional">, <em class="parameter"><code>plugin</code></em> <code class="type">name</code></span>]</span>] ) → <code class="returnvalue">record</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code> )</p>
       <p>Копирует существующий слот логической репликации с именем <em class="parameter"><code>src_slot_name</code></em> в слот с именем <em class="parameter"><code>dst_slot_name</code></em>, с возможностью смены модуля вывода и свойства временности. Скопированный логический слот начинает передачу с того же последовательного номера <acronym class="acronym">LSN</acronym>, что и исходный слот. Параметры <em class="parameter"><code>temporary</code></em> и <em class="parameter"><code>plugin</code></em> являются необязательными; если они опущены, сохраняются свойства исходного слота.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.6.1.1.1" class="indexterm"></a> <code class="function">pg_logical_slot_get_changes</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>upto_lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>upto_nchanges</code></em> <code class="type">integer</code>, <code class="literal">VARIADIC</code> <em class="parameter"><code>options</code></em> <code class="type">text[]</code> ) → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>xid</code></em> <code class="type">xid</code>, <em class="parameter"><code>data</code></em> <code class="type">text</code> )</p>
       <p>Возвращает изменения в слоте <em class="parameter"><code>slot_name</code></em> с позиции, до которой ранее были получены изменения. Если параметры <em class="parameter"><code>upto_lsn</code></em> и <em class="parameter"><code>upto_nchanges</code></em> равны NULL, логическое декодирование продолжится до конца журнала транзакций. Если <em class="parameter"><code>upto_lsn</code></em> не NULL, декодироваться будут только транзакции, зафиксированные до заданного LSN. Если <em class="parameter"><code>upto_nchanges</code></em> не NULL, декодирование остановится, когда число строк, полученных при декодировании, превысит заданное значение. Заметьте однако, что фактическое число возвращённых строк может быть больше, так как это ограничение проверяется только после добавления строк, декодированных для очередной транзакции.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.7.1.1.1" class="indexterm"></a> <code class="function">pg_logical_slot_peek_changes</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>upto_lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>upto_nchanges</code></em> <code class="type">integer</code>, <code class="literal">VARIADIC</code> <em class="parameter"><code>options</code></em> <code class="type">text[]</code> ) → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>xid</code></em> <code class="type">xid</code>, <em class="parameter"><code>data</code></em> <code class="type">text</code> )</p>
       <p>Работает так же, как функция <code class="function">pg_logical_slot_get_changes()</code>, но не забирает изменения; то есть, они будут получены снова при следующих вызовах.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.8.1.1.1" class="indexterm"></a> <code class="function">pg_logical_slot_get_binary_changes</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>upto_lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>upto_nchanges</code></em> <code class="type">integer</code>, <code class="literal">VARIADIC</code> <em class="parameter"><code>options</code></em> <code class="type">text[]</code> ) → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>xid</code></em> <code class="type">xid</code>, <em class="parameter"><code>data</code></em> <code class="type">bytea</code> )</p>
       <p>Работает так же, как функция <code class="function">pg_logical_slot_get_changes()</code>, но выдаёт изменения в типе <code class="type">bytea</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.9.1.1.1" class="indexterm"></a> <code class="function">pg_logical_slot_peek_binary_changes</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>upto_lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>upto_nchanges</code></em> <code class="type">integer</code>, <code class="literal">VARIADIC</code> <em class="parameter"><code>options</code></em> <code class="type">text[]</code> ) → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>xid</code></em> <code class="type">xid</code>, <em class="parameter"><code>data</code></em> <code class="type">bytea</code> )</p>
       <p>Работает аналогично функции <code class="function">pg_logical_slot_peek_changes()</code>, но выдаёт изменения в значении <code class="type">bytea</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.10.1.1.1" class="indexterm"></a> <code class="function">pg_replication_slot_advance</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>upto_lsn</code></em> <code class="type">pg_lsn</code> ) → <code class="returnvalue">record</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>end_lsn</code></em> <code class="type">pg_lsn</code> )</p>
       <p>Продвигает текущую подтверждённую позицию слота репликации с именем <em class="parameter"><code>slot_name</code></em>. Слот нельзя переместить назад, а также вперёд за текущую позицию добавления. Возвращает имя слота и позицию, до которой он фактически продвинулся. Информация об изменившемся положении слота, если он продвинулся, сохраняется только при ближайшей контрольной точке. Поэтому в случае прерывания работы слот может оказаться в предыдущем положении.</p></td></tr><tr><td id="PG-REPLICATION-ORIGIN-CREATE" class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.11.1.1.1" class="indexterm"></a> <code class="function">pg_replication_origin_create</code> ( <em class="parameter"><code>node_name</code></em> <code class="type">text</code> ) → <code class="returnvalue">oid</code></p>
       <p>Создаёт источник репликации с заданным внешним именем и возвращает назначенный ему внутренний идентификатор.</p></td></tr><tr><td id="PG-REPLICATION-ORIGIN-DROP" class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.12.1.1.1" class="indexterm"></a> <code class="function">pg_replication_origin_drop</code> ( <em class="parameter"><code>node_name</code></em> <code class="type">text</code> ) → <code class="returnvalue">void</code></p>
       <p>Удаляет ранее созданный источник репликации, в том числе связанную информацию о воспроизведении.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.13.1.1.1" class="indexterm"></a> <code class="function">pg_replication_origin_oid</code> ( <em class="parameter"><code>node_name</code></em> <code class="type">text</code> ) → <code class="returnvalue">oid</code></p>
       <p>Ищет источник репликации по имени и возвращает внутренний идентификатор. Если такой источник не находится, возвращает <code class="literal">NULL</code>.</p></td></tr><tr><td id="PG-REPLICATION-ORIGIN-SESSION-SETUP" class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.14.1.1.1" class="indexterm"></a> <code class="function">pg_replication_origin_session_setup</code> ( <em class="parameter"><code>node_name</code></em> <code class="type">text</code> ) → <code class="returnvalue">void</code></p>
       <p>Помечает текущий сеанс как воспроизводящий изменения из указанного источника, что позволяет отслеживать процесс воспроизведения. Может применяться, только если в текущий момент источник ещё не выбран. Для отмены этого действия вызовите <code class="function">pg_replication_origin_session_reset</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.15.1.1.1" class="indexterm"></a> <code class="function">pg_replication_origin_session_reset</code> () → <code class="returnvalue">void</code></p>
       <p>Отменяет действие <code class="function">pg_replication_origin_session_setup()</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.16.1.1.1" class="indexterm"></a> <code class="function">pg_replication_origin_session_is_setup</code> () → <code class="returnvalue">boolean</code></p>
       <p>Возвращает true, если в текущем сеансе выбран источник репликации.</p></td></tr><tr><td id="PG-REPLICATION-ORIGIN-SESSION-PROGRESS" class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.17.1.1.1" class="indexterm"></a> <code class="function">pg_replication_origin_session_progress</code> ( <em class="parameter"><code>flush</code></em> <code class="type">boolean</code> ) → <code class="returnvalue">pg_lsn</code></p>
       <p>Возвращает позицию воспроизведения для источника репликации, выбранного в текущем сеансе. Параметр <em class="parameter"><code>flush</code></em> определяет, будет ли гарантироваться сохранение локальной транзакции на диске.</p></td></tr><tr><td id="PG-REPLICATION-ORIGIN-XACT-SETUP" class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.18.1.1.1" class="indexterm"></a> <code class="function">pg_replication_origin_xact_setup</code> ( <em class="parameter"><code>origin_lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>origin_timestamp</code></em> <code class="type">timestamp with time zone</code> ) → <code class="returnvalue">void</code></p>
       <p>Помечает текущую транзакцию как воспроизводящую транзакцию, зафиксированную с указанным <acronym class="acronym">LSN</acronym> и временем. Может вызываться только после того, как источник репликации был выбран в результате вызова <code class="function">pg_replication_origin_session_setup()</code>.</p></td></tr><tr><td id="PG-REPLICATION-ORIGIN-XACT-RESET" class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.19.1.1.1" class="indexterm"></a> <code class="function">pg_replication_origin_xact_reset</code> () → <code class="returnvalue">void</code></p>
       <p>Отменяет действие <code class="function">pg_replication_origin_xact_setup()</code>.</p></td></tr><tr><td id="PG-REPLICATION-ORIGIN-ADVANCE" class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.20.1.1.1" class="indexterm"></a> <code class="function">pg_replication_origin_advance</code> ( <em class="parameter"><code>node_name</code></em> <code class="type">text</code>, <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code> ) → <code class="returnvalue">void</code></p>
       <p>Устанавливает положение репликации для заданного узла в указанную позицию. Это в основном полезно для установки начальной позиции или новой позиции после изменения конфигурации и подобных действий. Но учтите, что неосторожное использование этой функции может привести к несогласованности реплицированных данных.</p></td></tr><tr><td id="PG-REPLICATION-ORIGIN-PROGRESS" class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.21.1.1.1" class="indexterm"></a> <code class="function">pg_replication_origin_progress</code> ( <em class="parameter"><code>node_name</code></em> <code class="type">text</code>, <em class="parameter"><code>flush</code></em> <code class="type">boolean</code> ) → <code class="returnvalue">pg_lsn</code></p>
       <p>Выдаёт позицию воспроизведения для заданного источника репликации. Параметр <em class="parameter"><code>flush</code></em> определяет, будет ли гарантироваться сохранение локальной транзакции на диске.</p></td></tr><tr><td id="PG-LOGICAL-EMIT-MESSAGE" class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.8.5.2.2.22.1.1.1" class="indexterm"></a> <code class="function">pg_logical_emit_message</code> ( <em class="parameter"><code>transactional</code></em> <code class="type">boolean</code>, <em class="parameter"><code>prefix</code></em> <code class="type">text</code>, <em class="parameter"><code>content</code></em> <code class="type">text</code> ) → <code class="returnvalue">pg_lsn</code></p>
       <p class="func_signature"><code class="function">pg_logical_emit_message</code> ( <em class="parameter"><code>transactional</code></em> <code class="type">boolean</code>, <em class="parameter"><code>prefix</code></em> <code class="type">text</code>, <em class="parameter"><code>content</code></em> <code class="type">bytea</code> ) → <code class="returnvalue">pg_lsn</code></p>
       <p>Генерирует сообщение логического декодирования. Её можно использовать для передачи через WAL произвольных сообщений модулям логического декодирования. Параметр <em class="parameter"><code>transactional</code></em> определяет, должно ли сообщение относиться к текущей транзакции или оно должно записываться немедленно и декодироваться сразу, как только эта запись будет прочитана при логическом декодировании. Параметр <em class="parameter"><code>prefix</code></em> задаёт текстовый префикс, по которому модуль логического декодирования может легко распознать интересующие именно его сообщения. В параметре <em class="parameter"><code>content</code></em> передаётся содержимое сообщения, в текстовом или двоичном виде.</p></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="FUNCTIONS-ADMIN-DBOBJECT"><div class="titlepage"><div><div><h3 class="title">9.27.7. Функции управления объектами баз данных <a href="#FUNCTIONS-ADMIN-DBOBJECT" class="id_link">#</a></h3></div></div></div><p>Функции, показанные в <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-DBSIZE" title="Таблица 9.96. Функции получения размера объектов БД">Таблице 9.96</a>, вычисляют объём, который занимают на диске объекты базы данных, и помогают воспринять и проанализировать информацию об используемом объёме. Результаты типа <code class="literal">bignit</code> представляют значения в байтах. Если им передаётся OID, не соответствующий существующему объекту, эти функции возвращают <code class="literal">NULL</code>.</p><div class="table" id="FUNCTIONS-ADMIN-DBSIZE"><p class="title"><strong>Таблица 9.96. Функции получения размера объектов БД</strong></p><div class="table-contents"><table class="table" summary="Функции получения размера объектов БД" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.3.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_column_size</code> ( <code class="type">"any"</code> ) → <code class="returnvalue">integer</code></p>
       <p>Показывает, сколько байт занимает при хранении отдельное значение. Если эта функция применяется непосредственно к значению в столбце таблицы, в результате отражается эффект возможного сжатия.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.3.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_column_compression</code> ( <code class="type">"any"</code> ) → <code class="returnvalue">text</code></p>
       <p>Показывает алгоритм сжатия, который использовался для сжатия отдельного значения переменной длины. Возвращает <code class="literal">NULL</code>, если значение не сжато.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.3.2.2.3.1.1.1" class="indexterm"></a> <code class="function">pg_database_size</code> ( <code class="type">name</code> ) → <code class="returnvalue">bigint</code></p>
       <p class="func_signature"><code class="function">pg_database_size</code> ( <code class="type">oid</code> ) → <code class="returnvalue">bigint</code></p>
       <p>Вычисляет общий объём, который занимает на диске база данных с указанным именем или OID. Для использования этой функции необходимо иметь право <code class="literal">CONNECT</code> для заданной базы (оно даётся по умолчанию) или иметь права роли <code class="literal">pg_read_all_stats</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.3.2.2.4.1.1.1" class="indexterm"></a> <code class="function">pg_indexes_size</code> ( <code class="type">regclass</code> ) → <code class="returnvalue">bigint</code></p>
       <p>Вычисляет общий объём, который занимают на диске индексы, связанные с указанной таблицей.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.3.2.2.5.1.1.1" class="indexterm"></a> <code class="function">pg_relation_size</code> ( <em class="parameter"><code>relation</code></em> <code class="type">regclass</code> [<span class="optional">, <em class="parameter"><code>fork</code></em> <code class="type">text</code></span>] ) → <code class="returnvalue">bigint</code></p>
       <p>Вычисляет объём, который занимает на диске один <span class="quote">«<span class="quote">слой</span>»</span> заданного отношения. (Заметьте, что в большинстве случаев удобнее использовать более высокоуровневые функции <code class="function">pg_total_relation_size</code> и <code class="function">pg_table_size</code>, которые суммируют размер всех слоёв.) С одним аргументом она выдаёт размер основного слоя с данными отношения. Название другого интересующего слоя можно передать во втором аргументе: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">main</code> выдаёт размер основного слоя данных заданного отношения.</p></li><li class="listitem"><p><code class="literal">fsm</code> выдаёт размер карты свободного места (см. <a class="xref" href="storage-fsm.html" title="73.3. Карта свободного пространства">Раздел 73.3</a>), связанной с заданным отношением.</p></li><li class="listitem"><p><code class="literal">vm</code> выдаёт размер карты видимости (см. <a class="xref" href="storage-vm.html" title="73.4. Карта видимости">Раздел 73.4</a>), связанной с заданным отношением.</p></li><li class="listitem"><p><code class="literal">init</code> выдаёт размер слоя инициализации для заданного отношения, если он имеется.</p></li></ul></div></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.3.2.2.6.1.1.1" class="indexterm"></a> <code class="function">pg_size_bytes</code> ( <code class="type">text</code> ) → <code class="returnvalue">bigint</code></p>
       <p>Преобразует размер в понятном человеку формате (который выдаёт <code class="function">pg_size_pretty</code>) в число байт. Возможные единицы: <code class="literal">bytes</code>, <code class="literal">B</code>, <code class="literal">kB</code>, <code class="literal">MB</code>, <code class="literal">GB</code>, <code class="literal">TB</code> и <code class="literal">PB</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.3.2.2.7.1.1.1" class="indexterm"></a> <code class="function">pg_size_pretty</code> ( <code class="type">bigint</code> ) → <code class="returnvalue">text</code></p>
       <p class="func_signature"><code class="function">pg_size_pretty</code> ( <code class="type">numeric</code> ) → <code class="returnvalue">text</code></p>
       <p>Преобразует размер в байтах в более понятный человеку формат с единицами измерения размера (bytes, kB, MB, GB, TB или PB, в зависимости от значения). Заметьте, что эти единицы определяются как степени 2, а не 10, так что 1kB — это 1024 байта, 1MB — 1024<sup>2</sup> = 1048576 байт и т. д.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.3.2.2.8.1.1.1" class="indexterm"></a> <code class="function">pg_table_size</code> ( <code class="type">regclass</code> ) → <code class="returnvalue">bigint</code></p>
       <p>Вычисляет объём, который занимает на диске данная таблица, за исключением индексов (но включая её TOAST-таблицу (если она есть), карту свободного места и карту видимости).</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.3.2.2.9.1.1.1" class="indexterm"></a> <code class="function">pg_tablespace_size</code> ( <code class="type">name</code> ) → <code class="returnvalue">bigint</code></p>
       <p class="func_signature"><code class="function">pg_tablespace_size</code> ( <code class="type">oid</code> ) → <code class="returnvalue">bigint</code></p>
       <p>Вычисляет общий объём, который занимает на диске табличное пространство с заданным именем или OID. Для использования этой функции требуется иметь право <code class="literal">CREATE</code> для указанного табличного пространства или иметь права роли <code class="literal">pg_read_all_stats</code>, если только это не табличное пространство по умолчанию для текущей базы данных.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.3.2.2.10.1.1.1" class="indexterm"></a> <code class="function">pg_total_relation_size</code> ( <code class="type">regclass</code> ) → <code class="returnvalue">bigint</code></p>
       <p>Вычисляет общий объём, который занимает на диске заданная таблица, включая все её индексы и данные <acronym class="acronym">TOAST</acronym>. Результат этой функции равен значению <code class="function">pg_table_size</code> <code class="literal">+</code> <code class="function">pg_indexes_size</code>.</p></td></tr></tbody></table></div></div><br class="table-break" /><p>Вышеописанные функции, работающие с таблицами или индексами, принимают аргумент типа <code class="type">regclass</code>, который представляет собой просто OID таблицы или индекса в системном каталоге <code class="structname">pg_class</code>. Однако вам не нужно вручную вычислять OID, так как процедура ввода значения <code class="type">regclass</code> может сделать это за вас. За подробностями обратитесь к <a class="xref" href="datatype-oid.html" title="8.19. Идентификаторы объектов">Разделу 8.19</a>.</p><p>Функции, перечисленные в <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-DBLOCATION" title="Таблица 9.97. Функции определения расположения объектов">Таблице 9.97</a>, помогают определить, в каких файлах на диске хранятся объекты базы данных.</p><div class="table" id="FUNCTIONS-ADMIN-DBLOCATION"><p class="title"><strong>Таблица 9.97. Функции определения расположения объектов</strong></p><div class="table-contents"><table class="table" summary="Функции определения расположения объектов" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.6.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_relation_filenode</code> ( <em class="parameter"><code>relation</code></em> <code class="type">regclass</code> ) → <code class="returnvalue">oid</code></p>
       <p>Выдаёт номер <span class="quote">«<span class="quote">файлового узла</span>»</span>, связанного с заданным объектом. Файловым узлом называется основной компонент имени файла, используемого для хранения данных (подробнее это описано в <a class="xref" href="storage-file-layout.html" title="73.1. Размещение файлов базы данных">Разделе 73.1</a>). Для большинства отношений этот номер совпадает со значением <code class="structname">pg_class</code>.<code class="structfield">relfilenode</code>, но для некоторых системных каталогов <code class="structfield">relfilenode</code> равен 0, и нужно использовать эту функцию, чтобы узнать действительное значение. Если указанное отношение не хранится на диске, как например представление, данная функция возвращает NULL.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.6.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_relation_filepath</code> ( <em class="parameter"><code>relation</code></em> <code class="type">regclass</code> ) → <code class="returnvalue">text</code></p>
       <p>Выдаёт полный путь к файлу отношения (относительно каталога данных <code class="varname">PGDATA</code>).</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.6.2.2.3.1.1.1" class="indexterm"></a> <code class="function">pg_filenode_relation</code> ( <em class="parameter"><code>tablespace</code></em> <code class="type">oid</code>, <em class="parameter"><code>filenode</code></em> <code class="type">oid</code> ) → <code class="returnvalue">regclass</code></p>
       <p>Выдаёт OID отношения, которое хранится в табличном пространстве, заданном по OID, в указанном файловом узле. По сути эта функция является обратной к <code class="function">pg_relation_filepath</code>. Для табличного пространства по умолчанию можно передать нулевое значение OID. Если эта функция не находит в базе данных отношение по заданным значениям, она выдаёт <code class="literal">NULL</code>.</p></td></tr></tbody></table></div></div><br class="table-break" /><p>В <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-COLLATION" title="Таблица 9.98. Функции управления правилами сортировки">Таблица 9.98</a> перечислены функции, предназначенные для управления правилами сортировки.</p><div class="table" id="FUNCTIONS-ADMIN-COLLATION"><p class="title"><strong>Таблица 9.98. Функции управления правилами сортировки</strong></p><div class="table-contents"><table class="table" summary="Функции управления правилами сортировки" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.8.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_collation_actual_version</code> ( <code class="type">oid</code> ) → <code class="returnvalue">text</code></p>
       <p>Возвращает действующую версию объекта правила сортировки, которая в настоящее время установлена в операционной системе. Если она отличается от значения в <code class="structname">pg_collation</code>.<code class="structfield">collversion</code>, может потребоваться перестроить объекты, зависящие от данного правила сортировки. См. также <a class="xref" href="sql-altercollation.html" title="ALTER COLLATION"><span class="refentrytitle">ALTER COLLATION</span></a>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.8.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_database_collation_actual_version</code> ( <code class="type">oid</code> ) → <code class="returnvalue">text</code></p>
       <p>Возвращает действующую версию правила сортировки БД, установленную на данный момент в операционной системе. Если она отличается от значения в <code class="structname">pg_database</code>.<code class="structfield">datcollversion</code>, может потребоваться перестроить объекты, зависящие от данного правила сортировки. См. также <a class="xref" href="sql-alterdatabase.html" title="ALTER DATABASE"><span class="refentrytitle">ALTER DATABASE</span></a>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.8.2.2.3.1.1.1" class="indexterm"></a> <code class="function">pg_import_system_collations</code> ( <em class="parameter"><code>schema</code></em> <code class="type">regnamespace</code> ) → <code class="returnvalue">integer</code></p>
       <p>Добавляет правила сортировки в системный каталог <code class="structname">pg_collation</code>, анализируя все локали, которые она находит в операционной системе. Эту информацию использует <code class="command">initdb</code>; за подробностями обратитесь к <a class="xref" href="collation.html#COLLATION-MANAGING" title="24.2.2. Управление правилами сортировки">Подразделу 24.2.2</a>. Если позднее в систему устанавливаются дополнительные локали, эту функцию можно запустить снова, чтобы добавились правила сортировки для новых локалей. Локали, для которых обнаруживаются существующие записи в <code class="structname">pg_collation</code>, будут пропущены. (Объекты правил сортировки для локалей, которые перестают существовать в операционной системе, никогда не удаляются этой функцией.) В параметре <em class="parameter"><code>schema</code></em> обычно передаётся <code class="literal">pg_catalog</code>, но это не обязательно; правила сортировки могут быть установлены и в другую схему. Эта функция возвращает число созданных ей объектов правил сортировки; вызывать её разрешено только суперпользователям.</p></td></tr></tbody></table></div></div><br class="table-break" /><p>В <a class="xref" href="functions-admin.html#FUNCTIONS-INFO-PARTITION" title="Таблица 9.99. Функции получения информации о секционировании">Таблице 9.99</a> перечислены функции, предоставляющие информацию о структуре секционированных таблиц.</p><div class="table" id="FUNCTIONS-INFO-PARTITION"><p class="title"><strong>Таблица 9.99. Функции получения информации о секционировании</strong></p><div class="table-contents"><table class="table" summary="Функции получения информации о секционировании" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.10.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_partition_tree</code> ( <code class="type">regclass</code> ) → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>relid</code></em> <code class="type">regclass</code>, <em class="parameter"><code>parentrelid</code></em> <code class="type">regclass</code>, <em class="parameter"><code>isleaf</code></em> <code class="type">boolean</code>, <em class="parameter"><code>level</code></em> <code class="type">integer</code> )</p>
       <p>Выводит информацию о таблицах и индексах в дереве секционирования для заданной секционированной таблицы или секционированного индекса, отражая каждую секцию в отдельной строке. В этой информации представляется OID секции, OID её непосредственного родителя, логический признак того, что секция является конечной, и целое число, показывающее её уровень в иерархии. На уровне 0 будет находится указанная таблица или индекс, на уровне 1 непосредственные потомки-секции, на уровне 2 секции последних и т. д. Если заданное отношение не существует или не является секцией или секционированным отношением, эта функция выдаёт пустой результат.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.10.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_partition_ancestors</code> ( <code class="type">regclass</code> ) → <code class="returnvalue">setof regclass</code></p>
       <p>Выводит список вышестоящих отношений для заданной секции, включая её саму. Если заданное отношение не существует или не является секцией или секционированным отношением, эта функция выдаёт пустой результат.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.9.10.2.2.3.1.1.1" class="indexterm"></a> <code class="function">pg_partition_root</code> ( <code class="type">regclass</code> ) → <code class="returnvalue">regclass</code></p>
       <p>Выдаёт самое верхнее отношение в дереве секционирования, к которому относится заданное отношение. Если заданное отношение не существует или не является секцией или секционированным отношением, эта функция выдаёт <code class="literal">NULL</code>.</p></td></tr></tbody></table></div></div><br class="table-break" /><p>Например, чтобы определить общий размер данных, содержащихся в секционированной таблице <code class="structname">measurement</code>, можно использовать следующий запрос: </p><pre class="programlisting">SELECT pg_size_pretty(sum(pg_relation_size(relid))) AS total_size
  FROM pg_partition_tree('measurement');</pre></div><div class="sect2" id="FUNCTIONS-ADMIN-INDEX"><div class="titlepage"><div><div><h3 class="title">9.27.8. Функции обслуживания индексов <a href="#FUNCTIONS-ADMIN-INDEX" class="id_link">#</a></h3></div></div></div><p>В <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-INDEX-TABLE" title="Таблица 9.100. Функции обслуживания индексов">Таблице 9.100</a> перечислены функции, предназначенные для обслуживания индексов. (Заметьте, что задачи обслуживания обычно выполняются автоматически в ходе автоочистки; пользоваться данными функциями требуется только в особых случаях.) Выполнять эти функции во время восстановления нельзя. Использовать их разрешено только суперпользователям и владельцу определённого индекса.</p><div class="table" id="FUNCTIONS-ADMIN-INDEX-TABLE"><p class="title"><strong>Таблица 9.100. Функции обслуживания индексов</strong></p><div class="table-contents"><table class="table" summary="Функции обслуживания индексов" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.10.3.2.2.1.1.1.1" class="indexterm"></a> <code class="function">brin_summarize_new_values</code> ( <em class="parameter"><code>index</code></em> <code class="type">regclass</code> ) → <code class="returnvalue">integer</code></p>
       <p>Сканирует указанный BRIN-индекс в поисках зон страниц в базовой таблице, ещё не обобщённых в индексе; для каждой такой зоны в результате сканирования этих страниц создаётся новый обобщающий кортеж в индексе. Возвращает эта функция число вставленных в индекс обобщающих записей о зонах страниц.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.10.3.2.2.2.1.1.1" class="indexterm"></a> <code class="function">brin_summarize_range</code> ( <em class="parameter"><code>index</code></em> <code class="type">regclass</code>, <em class="parameter"><code>blockNumber</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">integer</code></p>
       <p>Обобщает зону страниц, охватывающую данный блок, если она ещё не была обобщена. Эта функция подобна <code class="function">brin_summarize_new_values</code>, но обрабатывает только одну выбранную зону страниц.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.10.3.2.2.3.1.1.1" class="indexterm"></a> <code class="function">brin_desummarize_range</code> ( <em class="parameter"><code>index</code></em> <code class="type">regclass</code>, <em class="parameter"><code>blockNumber</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">void</code></p>
       <p>Удаляет из BRIN-индекса кортеж, который обобщает зону страниц, охватывающую данный блок таблицы, если такой кортеж имеется.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.10.3.2.2.4.1.1.1" class="indexterm"></a> <code class="function">gin_clean_pending_list</code> ( <em class="parameter"><code>index</code></em> <code class="type">regclass</code> ) → <code class="returnvalue">bigint</code></p>
       <p>Очищает очередь указанного GIN-индекса, массово перемещая элементы из неё в основную структуру данных GIN, и возвращает число страниц, убранных из очереди. Если для обработки ей передаётся индекс GIN, построенный с отключённым параметром <code class="literal">fastupdate</code>, очистка не производится и возвращается 0, так как у такого индекса нет очереди записей. Подробнее об очереди записей и параметре <code class="literal">fastupdate</code> рассказывается в <a class="xref" href="gin-implementation.html#GIN-FAST-UPDATE" title="70.4.1. Методика быстрого обновления GIN">Подразделе 70.4.1</a> и <a class="xref" href="gin-tips.html" title="70.5. Приёмы и советы по применению GIN">Разделе 70.5</a>.</p></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="FUNCTIONS-ADMIN-GENFILE"><div class="titlepage"><div><div><h3 class="title">9.27.9. Функции для работы с обычными файлами <a href="#FUNCTIONS-ADMIN-GENFILE" class="id_link">#</a></h3></div></div></div><p>Функции, перечисленные в <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-GENFILE-TABLE" title="Таблица 9.101. Функции для работы с обычными файлами">Таблице 9.101</a>, предоставляют прямой доступ к файлам, находящимся на сервере. Обычным пользователям, не включённым в роль <code class="literal">pg_read_server_files</code>, они позволяют обращаться только к файлам в каталоге кластера баз данных и в каталоге <code class="varname">log_directory</code>. Для файлов в каталоге кластера этим функциям передаётся относительный путь, а для файлов журнала — путь, соответствующий значению параметра <code class="varname">log_directory</code>.</p><p>Заметьте, что пользователи, обладающие правом EXECUTE для <code class="function">pg_read_file()</code> или связанных функций, имеют возможность читать любой файл на сервере, который может прочитать серверный процесс; на эти функции не действуют никакие ограничения доступа внутри базы данных. В частности это означает, что пользователь с такими правами может прочитать содержимое таблицы <code class="literal">pg_authid</code>, в которой хранятся данные аутентификации, равно как и любой другой файл в базе данных. Таким образом, разрешать доступ к этим функциям следует с большой осторожностью.</p><p>При предоставлении прав для этих функций обратите внимание, что записи таблицы, показывающие необязательные параметры, в большинстве случаев реализованы как несколько физических функций с разными списками параметров. Права должны быть предоставлены отдельно для каждой такой функции, если она будет использоваться. Команда <span class="application">psql</span> <code class="command">\df</code> может быть полезна для проверки фактических сигнатур функций.</p><p>Некоторые из этих функций принимают необязательный параметр <em class="parameter"><code>missing_ok</code></em>, который определяет их поведение в случае отсутствия файла или каталога. Если он равен <code class="literal">true</code>, функция возвращает <code class="literal">NULL</code> или пустой набор данных. Если же он равен <code class="literal">false</code>, в указанном случае выдаётся ошибка. (Условия сбоя, кроме <span class="quote">«<span class="quote">file not found</span>»</span> (файл не найден), в любом случае считаются ошибками.) Значение по умолчанию — <code class="literal">false</code>.</p><div class="table" id="FUNCTIONS-ADMIN-GENFILE-TABLE"><p class="title"><strong>Таблица 9.101. Функции для работы с обычными файлами</strong></p><div class="table-contents"><table class="table" summary="Функции для работы с обычными файлами" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.11.6.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_ls_dir</code> ( <em class="parameter"><code>dirname</code></em> <code class="type">text</code> [<span class="optional">, <em class="parameter"><code>missing_ok</code></em> <code class="type">boolean</code>, <em class="parameter"><code>include_dot_dirs</code></em> <code class="type">boolean</code></span>] ) → <code class="returnvalue">setof text</code></p>
       <p>Выдаёт имена всех файлов (а также каталогов и других специальных файлов) в заданном каталоге. Параметр <em class="parameter"><code>include_dot_dirs</code></em> определяет, будут ли в результирующий набор включаться каталоги <span class="quote">«<span class="quote">.</span>»</span> и <span class="quote">«<span class="quote">..</span>»</span>. По умолчанию они не включаются, но их можно включить, чтобы с параметром <em class="parameter"><code>missing_ok</code></em> равным <code class="literal">true</code>, пустой каталог можно было отличить от несуществующего.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.11.6.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_ls_logdir</code> () → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>name</code></em> <code class="type">text</code>, <em class="parameter"><code>size</code></em> <code class="type">bigint</code>, <em class="parameter"><code>modification</code></em> <code class="type">timestamp with time zone</code> )</p>
       <p>Выводит имя, размер и время последнего изменения (mtime) всех обычных файлов в каталоге журналов сервера. Файлы с именами, начинающимися с точки, каталоги и другие специальные файлы исключаются из рассмотрения.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи или роли с правами роли <code class="literal">pg_monitor</code>, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.11.6.2.2.3.1.1.1" class="indexterm"></a> <code class="function">pg_ls_waldir</code> () → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>name</code></em> <code class="type">text</code>, <em class="parameter"><code>size</code></em> <code class="type">bigint</code>, <em class="parameter"><code>modification</code></em> <code class="type">timestamp with time zone</code> )</p>
       <p>Выводит имя, размер и время последнего изменения (mtime) всех обычных файлов в каталоге журнала предзаписи (WAL) сервера. Файлы с именами, начинающимися с точки, каталоги и другие специальные файлы исключаются из рассмотрения.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи или роли с правами роли <code class="literal">pg_monitor</code>, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.11.6.2.2.4.1.1.1" class="indexterm"></a> <code class="function">pg_ls_logicalmapdir</code> () → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>name</code></em> <code class="type">text</code>, <em class="parameter"><code>size</code></em> <code class="type">bigint</code>, <em class="parameter"><code>modification</code></em> <code class="type">timestamp with time zone</code> )</p>
       <p>Выводит имя, размер и время последнего изменения (mtime) всех обычных файлов в каталоге сервера <code class="filename">pg_logical/mappings</code>. Файлы с именами, начинающимися с точки, каталоги и другие специальные файлы исключаются из рассмотрения.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи и члены группы <code class="literal">pg_monitor</code>, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.11.6.2.2.5.1.1.1" class="indexterm"></a> <code class="function">pg_ls_logicalsnapdir</code> () → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>name</code></em> <code class="type">text</code>, <em class="parameter"><code>size</code></em> <code class="type">bigint</code>, <em class="parameter"><code>modification</code></em> <code class="type">timestamp with time zone</code> )</p>
       <p>Выводит имя, размер и время последнего изменения (mtime) всех обычных файлов в каталоге сервера <code class="filename">pg_logical/snapshots</code>. Файлы с именами, начинающимися с точки, каталоги и другие специальные файлы исключаются из рассмотрения.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи и члены группы <code class="literal">pg_monitor</code>, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.11.6.2.2.6.1.1.1" class="indexterm"></a> <code class="function">pg_ls_replslotdir</code> ( <em class="parameter"><code>slot_name</code></em> <code class="type">text</code> ) → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>name</code></em> <code class="type">text</code>, <em class="parameter"><code>size</code></em> <code class="type">bigint</code>, <em class="parameter"><code>modification</code></em> <code class="type">timestamp with time zone</code> )</p>
       <p>Выводит имя, размер и время последнего изменения (mtime) всех обычных файлов в каталоге сервера <code class="filename">pg_replslot/slot_name</code>, где <em class="parameter"><code>slot_name</code></em> — имя слота репликации, переданное функции. Файлы с именами, начинающимися с точки, каталоги и другие специальные файлы исключаются из рассмотрения.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи и члены группы <code class="literal">pg_monitor</code>, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.11.6.2.2.7.1.1.1" class="indexterm"></a> <code class="function">pg_ls_archive_statusdir</code> () → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>name</code></em> <code class="type">text</code>, <em class="parameter"><code>size</code></em> <code class="type">bigint</code>, <em class="parameter"><code>modification</code></em> <code class="type">timestamp with time zone</code> )</p>
       <p>Выводит имя, размер и время последнего изменения (mtime) всех обычных файлов в каталоге состояния архива WAL (<code class="filename">pg_wal/archive_status</code>). Файлы с именами, начинающимися с точки, каталоги и другие специальные файлы исключаются из рассмотрения.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи и члены группы <code class="literal">pg_monitor</code>, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.11.6.2.2.8.1.1.1" class="indexterm"></a> <code class="function">pg_ls_tmpdir</code> ( [<span class="optional"><em class="parameter"><code>tablespace</code></em> <code class="type">oid</code></span>] ) → <code class="returnvalue">setof record</code> ( <em class="parameter"><code>name</code></em> <code class="type">text</code>, <em class="parameter"><code>size</code></em> <code class="type">bigint</code>, <em class="parameter"><code>modification</code></em> <code class="type">timestamp with time zone</code> )</p>
       <p>Выводит имя, размер и время последнего изменения (mtime) всех обычных файлов во временном каталоге для табличного пространства <em class="parameter"><code>tablespace</code></em>. Если параметр <em class="parameter"><code>tablespace</code></em> не задан, подразумевается табличное пространство <code class="literal">pg_default</code>. Файлы с именами, начинающимися с точки, каталоги и другие специальные файлы исключаются из рассмотрения.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи и члены группы <code class="literal">pg_monitor</code>, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.11.6.2.2.9.1.1.1" class="indexterm"></a> <code class="function">pg_read_file</code> ( <em class="parameter"><code>filename</code></em> <code class="type">text</code> [<span class="optional">, <em class="parameter"><code>offset</code></em> <code class="type">bigint</code>, <em class="parameter"><code>length</code></em> <code class="type">bigint</code></span>] [<span class="optional">, <em class="parameter"><code>missing_ok</code></em> <code class="type">boolean</code></span>] ) → <code class="returnvalue">text</code></p>
       <p>Читает из текстового файла всё содержимое или фрагмент с заданного смещения (<em class="parameter"><code>offset</code></em>), размером не больше <em class="parameter"><code>length</code></em> байт (размер может быть меньше, если файл кончится раньше). Если смещение <em class="parameter"><code>offset</code></em> отрицательно, оно отсчитывается от конца файла. Если параметры <em class="parameter"><code>offset</code></em> и <em class="parameter"><code>length</code></em> опущены, возвращается всё содержимое файла. Прочитанные из файла байты обрабатываются как символы в кодировке базы данных; если они оказываются недопустимыми для этой кодировки, возникает ошибка.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.11.6.2.2.10.1.1.1" class="indexterm"></a> <code class="function">pg_read_binary_file</code> ( <em class="parameter"><code>filename</code></em> <code class="type">text</code> [<span class="optional">, <em class="parameter"><code>offset</code></em> <code class="type">bigint</code>, <em class="parameter"><code>length</code></em> <code class="type">bigint</code></span>] [<span class="optional">, <em class="parameter"><code>missing_ok</code></em> <code class="type">boolean</code></span>] ) → <code class="returnvalue">bytea</code></p>
       <p>Читает из текстового файла всё содержимое или заданный фрагмент. Эта функция подобна <code class="function">pg_read_file</code>, но может читать произвольные двоичные данные и возвращает результат в значении типа <code class="type">bytea</code>, а не <code class="type">text</code>; как следствие, никакие проверки кодировок не производятся.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p>
       <p>В сочетании с <code class="function">convert_from</code> эту функцию можно применять для чтения текста в указанной кодировке и преобразования в кодировку базы данных: </p><pre class="programlisting">SELECT convert_from(pg_read_binary_file('file_in_utf8.txt'), 'UTF8');</pre></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.11.6.2.2.11.1.1.1" class="indexterm"></a> <code class="function">pg_stat_file</code> ( <em class="parameter"><code>filename</code></em> <code class="type">text</code> [<span class="optional">, <em class="parameter"><code>missing_ok</code></em> <code class="type">boolean</code></span>] ) → <code class="returnvalue">record</code> ( <em class="parameter"><code>size</code></em> <code class="type">bigint</code>, <em class="parameter"><code>access</code></em> <code class="type">timestamp with time zone</code>, <em class="parameter"><code>modification</code></em> <code class="type">timestamp with time zone</code>, <em class="parameter"><code>change</code></em> <code class="type">timestamp with time zone</code>, <em class="parameter"><code>creation</code></em> <code class="type">timestamp with time zone</code>, <em class="parameter"><code>isdir</code></em> <code class="type">boolean</code> )</p>
       <p>Выдаёт запись, содержащую размер файла, время последнего обращения и последнего изменения, а также время последнего изменения состояния (только в Unix-системах), время создания (только в Windows) и флаг, показывающий, что это каталог.</p>
       <p>По умолчанию доступ к этой функции имеют только суперпользователи, но право на её выполнение (EXECUTE) можно дать и другим пользователям.</p></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="FUNCTIONS-ADVISORY-LOCKS"><div class="titlepage"><div><div><h3 class="title">9.27.10. Функции управления рекомендательными блокировками <a href="#FUNCTIONS-ADVISORY-LOCKS" class="id_link">#</a></h3></div></div></div><p>Функции, перечисленные в <a class="xref" href="functions-admin.html#FUNCTIONS-ADVISORY-LOCKS-TABLE" title="Таблица 9.102. Функции управления рекомендательными блокировками">Таблице 9.102</a>, предназначены для управления рекомендательными блокировками. Подробнее об их использовании можно узнать в <a class="xref" href="explicit-locking.html#ADVISORY-LOCKS" title="13.3.5. Рекомендательные блокировки">Подразделе 13.3.5</a>.</p><p>Все эти функции предназначены для оперирования блокировками ресурсов, определяемых приложением и задаваемых одним 64-битным или двумя 32-битными ключами (заметьте, что пространства этих ключей не пересекаются). Если конфликтующую блокировку с тем же идентификатором уже удерживает другой сеанс, эти функции либо дожидаются освобождения ресурса, либо выдают в результате <code class="literal">false</code>, в зависимости от вида функции. Блокировки могут быть как исключительными, так и разделяемыми — разделяемая блокировка не конфликтует с другими разделяемыми блокировками того же ресурса, но конфликтует с исключительными. Блокировки могут устанавливаться на сеансовом уровне (тогда они удерживаются до момента освобождения или до завершения сеанса) и на транзакционном (тогда они удерживаются до конца текущей транзакции, освободить их вручную нет возможности). Когда поступает несколько запросов на блокировку сеансового уровня, они накапливаются, так что если один идентификатор ресурса был заблокирован три раза, должны поступить три запроса на освобождение блокировки, чтобы ресурс был разблокирован до завершения сеанса.</p><div class="table" id="FUNCTIONS-ADVISORY-LOCKS-TABLE"><p class="title"><strong>Таблица 9.102. Функции управления рекомендательными блокировками</strong></p><div class="table-contents"><table class="table" summary="Функции управления рекомендательными блокировками" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.12.4.2.2.1.1.1.1" class="indexterm"></a> <code class="function">pg_advisory_lock</code> ( <em class="parameter"><code>key</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">void</code></p>
       <p class="func_signature"><code class="function">pg_advisory_lock</code> ( <em class="parameter"><code>key1</code></em> <code class="type">integer</code>, <em class="parameter"><code>key2</code></em> <code class="type">integer</code> ) → <code class="returnvalue">void</code></p>
       <p>Получает исключительную рекомендательную блокировку сеансового уровня, ожидая её, если это необходимо.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.12.4.2.2.2.1.1.1" class="indexterm"></a> <code class="function">pg_advisory_lock_shared</code> ( <em class="parameter"><code>key</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">void</code></p>
       <p class="func_signature"><code class="function">pg_advisory_lock_shared</code> ( <em class="parameter"><code>key1</code></em> <code class="type">integer</code>, <em class="parameter"><code>key2</code></em> <code class="type">integer</code> ) → <code class="returnvalue">void</code></p>
       <p>Получает разделяемую рекомендательную блокировку сеансового уровня, ожидая её, если это необходимо.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.12.4.2.2.3.1.1.1" class="indexterm"></a> <code class="function">pg_advisory_unlock</code> ( <em class="parameter"><code>key</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">boolean</code></p>
       <p class="func_signature"><code class="function">pg_advisory_unlock</code> ( <em class="parameter"><code>key1</code></em> <code class="type">integer</code>, <em class="parameter"><code>key2</code></em> <code class="type">integer</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Освобождает ранее полученную исключительную рекомендательную блокировку сеансового уровня. Если блокировка освобождена успешно, эта функция возвращает <code class="literal">true</code>, а если сеанс не владел ей — <code class="literal">false</code>, при этом сервер выдаёт предупреждение SQL.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.12.4.2.2.4.1.1.1" class="indexterm"></a> <code class="function">pg_advisory_unlock_all</code> () → <code class="returnvalue">void</code></p>
       <p>Освобождает все закреплённые за текущим сеансом рекомендательные блокировки сеансового уровня. (Эта функция неявно вызывается в конце любого сеанса, даже при нештатном отключении клиента.)</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.12.4.2.2.5.1.1.1" class="indexterm"></a> <code class="function">pg_advisory_unlock_shared</code> ( <em class="parameter"><code>key</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">boolean</code></p>
       <p class="func_signature"><code class="function">pg_advisory_unlock_shared</code> ( <em class="parameter"><code>key1</code></em> <code class="type">integer</code>, <em class="parameter"><code>key2</code></em> <code class="type">integer</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Освобождает ранее полученную разделяемую рекомендательную блокировку сеансового уровня. Если она освобождена успешно, эта функция возвращает <code class="literal">true</code>, а если сеанс не владел этой блокировкой — <code class="literal">false</code>, при этом сервер выдаёт предупреждение SQL.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.12.4.2.2.6.1.1.1" class="indexterm"></a> <code class="function">pg_advisory_xact_lock</code> ( <em class="parameter"><code>key</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">void</code></p>
       <p class="func_signature"><code class="function">pg_advisory_xact_lock</code> ( <em class="parameter"><code>key1</code></em> <code class="type">integer</code>, <em class="parameter"><code>key2</code></em> <code class="type">integer</code> ) → <code class="returnvalue">void</code></p>
       <p>Получает исключительную рекомендательную блокировку транзакционного уровня, ожидая её, если это необходимо.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.12.4.2.2.7.1.1.1" class="indexterm"></a> <code class="function">pg_advisory_xact_lock_shared</code> ( <em class="parameter"><code>key</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">void</code></p>
       <p class="func_signature"><code class="function">pg_advisory_xact_lock_shared</code> ( <em class="parameter"><code>key1</code></em> <code class="type">integer</code>, <em class="parameter"><code>key2</code></em> <code class="type">integer</code> ) → <code class="returnvalue">void</code></p>
       <p>Получает разделяемую рекомендательную блокировку транзакционного уровня, ожидая её, если это необходимо.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.12.4.2.2.8.1.1.1" class="indexterm"></a> <code class="function">pg_try_advisory_lock</code> ( <em class="parameter"><code>key</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">boolean</code></p>
       <p class="func_signature"><code class="function">pg_try_advisory_lock</code> ( <em class="parameter"><code>key1</code></em> <code class="type">integer</code>, <em class="parameter"><code>key2</code></em> <code class="type">integer</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Получает исключительную рекомендательную блокировку сеансового уровня, если она доступна. То есть эта функция либо немедленно получает блокировку и возвращает <code class="literal">true</code>, либо сразу возвращает <code class="literal">false</code>, если получить её нельзя.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.12.4.2.2.9.1.1.1" class="indexterm"></a> <code class="function">pg_try_advisory_lock_shared</code> ( <em class="parameter"><code>key</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">boolean</code></p>
       <p class="func_signature"><code class="function">pg_try_advisory_lock_shared</code> ( <em class="parameter"><code>key1</code></em> <code class="type">integer</code>, <em class="parameter"><code>key2</code></em> <code class="type">integer</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Получает разделяемую рекомендательную блокировку сеансового уровня, если она доступна. То есть эта функция либо немедленно получает блокировку и возвращает <code class="literal">true</code>, либо сразу возвращает <code class="literal">false</code>, если получить её нельзя.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.12.4.2.2.10.1.1.1" class="indexterm"></a> <code class="function">pg_try_advisory_xact_lock</code> ( <em class="parameter"><code>key</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">boolean</code></p>
       <p class="func_signature"><code class="function">pg_try_advisory_xact_lock</code> ( <em class="parameter"><code>key1</code></em> <code class="type">integer</code>, <em class="parameter"><code>key2</code></em> <code class="type">integer</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Получает исключительную рекомендательную блокировку транзакционного уровня, если она доступна. То есть эта функция либо немедленно получает блокировку и возвращает <code class="literal">true</code>, либо сразу возвращает <code class="literal">false</code>, если получить её нельзя.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.33.12.4.2.2.11.1.1.1" class="indexterm"></a> <code class="function">pg_try_advisory_xact_lock_shared</code> ( <em class="parameter"><code>key</code></em> <code class="type">bigint</code> ) → <code class="returnvalue">boolean</code></p>
       <p class="func_signature"><code class="function">pg_try_advisory_xact_lock_shared</code> ( <em class="parameter"><code>key1</code></em> <code class="type">integer</code>, <em class="parameter"><code>key2</code></em> <code class="type">integer</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Получает разделяемую рекомендательную блокировку транзакционного уровня, если она доступна. То есть эта функция либо немедленно получает блокировку и возвращает <code class="literal">true</code>, либо сразу возвращает <code class="literal">false</code>, если получить её нельзя.</p></td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="functions-info.html" title="9.26. Системные информационные функции и операторы">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="functions.html" title="Глава 9. Функции и операторы">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="functions-trigger.html" title="9.28. Триггерные функции">След.</a></td></tr><tr><td width="40%" align="left" valign="top">9.26. Системные информационные функции и операторы </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 9.28. Триггерные функции</td></tr></table></div></body></html>