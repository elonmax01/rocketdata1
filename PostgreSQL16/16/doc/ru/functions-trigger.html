<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>9.28. Триггерные функции</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="functions-admin.html" title="9.27. Функции для системного администрирования" /><link rel="next" href="functions-event-triggers.html" title="9.29. Функции событийных триггеров" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">9.28. Триггерные функции</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="functions-admin.html" title="9.27. Функции для системного администрирования">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="functions.html" title="Глава 9. Функции и операторы">Наверх</a></td><th width="60%" align="center">Глава 9. Функции и операторы</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="functions-event-triggers.html" title="9.29. Функции событийных триггеров">След.</a></td></tr></table><hr /></div><div class="sect1" id="FUNCTIONS-TRIGGER"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.28. Триггерные функции <a href="#FUNCTIONS-TRIGGER" class="id_link">#</a></h2></div></div></div><p>Тогда как в большинстве случаев использование триггеров подразумевает написание пользовательских триггерных функций, в <span class="productname">PostgreSQL</span> имеется несколько встроенных триггерных функций, которые можно использовать непосредственно в пользовательских триггерах. Эти функции показаны в <a class="xref" href="functions-trigger.html#BUILTIN-TRIGGERS-TABLE" title="Таблица 9.103. Встроенные триггерные функции">Таблице 9.103</a>. (Существуют и другие встроенные триггерные функции, реализующие ограничения внешнего ключа и отложенные ограничения по индексам. Однако они не документированы, так как пользователям не нужно использовать их непосредственно.)</p><p>Подробнее о создании триггеров можно узнать в описании <a class="xref" href="sql-createtrigger.html" title="CREATE TRIGGER"><span class="refentrytitle">CREATE TRIGGER</span></a>.</p><div class="table" id="BUILTIN-TRIGGERS-TABLE"><p class="title"><strong>Таблица 9.103. Встроенные триггерные функции</strong></p><div class="table-contents"><table class="table" summary="Встроенные триггерные функции" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p>
       <p>Пример использования</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.34.4.2.2.1.1.1.1" class="indexterm"></a> <code class="function">suppress_redundant_updates_trigger</code> ( ) → <code class="returnvalue">trigger</code></p>
       <p>Предотвращает изменения, не меняющие данные. Подробнее об этом рассказывается ниже.</p>
       <p>
        <code class="literal">CREATE TRIGGER ... suppress_redundant_updates_trigger()</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.34.4.2.2.2.1.1.1" class="indexterm"></a> <code class="function">tsvector_update_trigger</code> ( ) → <code class="returnvalue">trigger</code></p>
       <p>Автоматически обновляет содержимое столбца <code class="type">tsvector</code> из связанных столбцов с обычным текстовым содержимым. Конфигурация текстового поиска, которая будет использоваться, задаётся по имени в аргументе триггера. За подробностями обратитесь к <a class="xref" href="textsearch-features.html#TEXTSEARCH-UPDATE-TRIGGERS" title="12.4.3. Триггеры для автоматического обновления">Подразделу 12.4.3</a>.</p>
       <p>
        <code class="literal">CREATE TRIGGER ... tsvector_update_trigger(tsvcol, 'pg_catalog.​swedish', title, body)</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.34.4.2.2.3.1.1.1" class="indexterm"></a> <code class="function">tsvector_update_trigger_column</code> ( ) → <code class="returnvalue">trigger</code></p>
       <p>Автоматически обновляет содержимое столбца <code class="type">tsvector</code> из связанных столбцов с обычным текстовым содержимым. Конфигурация текстового поиска, которая будет использоваться, определяется содержимым столбца <code class="type">regconfig</code> целевой таблицы. За подробностями обратитесь к <a class="xref" href="textsearch-features.html#TEXTSEARCH-UPDATE-TRIGGERS" title="12.4.3. Триггеры для автоматического обновления">Подразделу 12.4.3</a>.</p>
       <p>
        <code class="literal">CREATE TRIGGER ... tsvector_update_trigger_column(tsvcol, tsconfigcol, title, body)</code>
       </p></td></tr></tbody></table></div></div><br class="table-break" /><p>Функция <code class="function">suppress_redundant_updates_trigger</code>, применяемая в качестве триггера <code class="literal">BEFORE UPDATE</code> на уровне строк, предотвратит внесение изменений, при которых данные в строке фактически не меняются. Тем самым переопределяется обычное поведение, когда изменение физической строки происходит вне зависимости от того, были ли изменены данные. (Обычное поведение не предполагает сравнения данных, поэтому операции изменения выполняются быстрее, и в ряде случаев именно это поведение желательно.)</p><p>В идеале следует избегать операций изменения, которые фактически не меняют данные в записях. Подобные ненужные изменения могут обходиться дорого, особенно когда требуется обновлять множество индексов, к тому же впоследствии базу данных придётся очищать от «мёртвых» строк. Однако выявить такие изменения в клиентском коде бывает сложно, если вообще возможно, а при составлении соответствующих проверочных выражений легко допустить ошибку. В качестве альтернативного решения можно использовать функцию <code class="function">suppress_redundant_updates_trigger</code>, которая опускает изменения, не меняющие данные. Однако использовать её следует с осторожностью. Данный триггер выполняется для каждой записи довольно быстро, но всё же не мгновенно, так что если большинство затронутых записей фактически изменяется, с этим триггером операция изменения в среднем замедлится.</p><p>Функцию <code class="function">suppress_redundant_updates_trigger</code> можно привязать к таблице так: </p><pre class="programlisting">CREATE TRIGGER z_min_update
BEFORE UPDATE ON tablename
FOR EACH ROW EXECUTE FUNCTION suppress_redundant_updates_trigger();</pre><p> В большинстве случаев этот триггер должен вызываться для каждой строки последним, чтобы он не перекрыл другие триггеры, которым может понадобиться изменить строку. С учётом того, что триггеры вызываются по порядку сортировки их имён, имя для него нужно выбирать таким, чтобы оно было последним среди имён всех триггеров, которые могут быть в таблице. (Из этого соображения выбран префикс <span class="quote">«<span class="quote">z</span>»</span> в данном примере.)</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="functions-admin.html" title="9.27. Функции для системного администрирования">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="functions.html" title="Глава 9. Функции и операторы">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="functions-event-triggers.html" title="9.29. Функции событийных триггеров">След.</a></td></tr><tr><td width="40%" align="left" valign="top">9.27. Функции для системного администрирования </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 9.29. Функции событийных триггеров</td></tr></table></div></body></html>