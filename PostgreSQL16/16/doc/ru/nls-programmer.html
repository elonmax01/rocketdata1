<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>57.2. Программисту</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="nls-translator.html" title="57.1. Переводчику" /><link rel="next" href="plhandler.html" title="Глава 58. Написание обработчика процедурного языка" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">57.2. Программисту</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="nls-translator.html" title="57.1. Переводчику">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="nls.html" title="Глава 57. Языковая поддержка">Наверх</a></td><th width="60%" align="center">Глава 57. Языковая поддержка</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="plhandler.html" title="Глава 58. Написание обработчика процедурного языка">След.</a></td></tr></table><hr /></div><div class="sect1" id="NLS-PROGRAMMER"><div class="titlepage"><div><div><h2 class="title" style="clear: both">57.2. Программисту <a href="#NLS-PROGRAMMER" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="nls-programmer.html#NLS-MECHANICS">57.2.1. Механизмы</a></span></dt><dt><span class="sect2"><a href="nls-programmer.html#NLS-GUIDELINES">57.2.2. Рекомендации по написанию сообщений</a></span></dt></dl></div><div class="sect2" id="NLS-MECHANICS"><div class="titlepage"><div><div><h3 class="title">57.2.1. Механизмы <a href="#NLS-MECHANICS" class="id_link">#</a></h3></div></div></div><p>В данном разделе описывается, как добавить языковую поддержку в программе или библиотеке, которая является частью дистрибутива <span class="productname">PostgreSQL</span>. В настоящий момент это относится только к программам на языке С.</p><div class="procedure" id="id-1.10.8.3.2.3"><p class="title"><strong>Добавление языковой поддержки для программы</strong></p><ol class="procedure" type="1"><li class="step"><p>Вставьте этот код в начало программы: </p><pre class="programlisting">#ifdef ENABLE_NLS
#include &lt;locale.h&gt;
#endif

...

#ifdef ENABLE_NLS
setlocale(LC_ALL, "");
bindtextdomain("<em class="replaceable"><code>progname</code></em>", LOCALEDIR);
textdomain("<em class="replaceable"><code>progname</code></em>");
#endif</pre><p> (<em class="replaceable"><code>progname</code></em> фактически может быть выбрана произвольно.)</p></li><li class="step"><p>Везде, где сообщение нуждается в переводе, необходимо вставить вызов <code class="function">gettext()</code>. Например: </p><pre class="programlisting">fprintf(stderr, "panic level %d\n", lvl);</pre><p> нужно заменить на: </p><pre class="programlisting">fprintf(stderr, gettext("panic level %d\n"), lvl);</pre><p> (<code class="symbol">gettext</code> определяется как холостая команда, если NLS поддержка не настроена.)</p><p>Это часто приводит к немалой путанице. Один из распространённых подходов в этом случае: </p><pre class="programlisting">#define _(x) gettext(x)</pre><p> Ещё одно решение допустимо, если программа часто выполняет обмен данными через одну или несколько функций, таких как <code class="function">ereport()</code> в серверном процессе. Тогда вы выполняете внутренний вызов функции <code class="function">gettext</code> для каждой входящей строки.</p></li><li class="step"><p>Добавьте файл <code class="filename">nls.mk</code> в каталог с исходными кодами программы. Данный файл будет считаться сборочным файлом (makefile). В нём необходимо выполнить присваивание значений для следующих переменных: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="varname">CATALOG_NAME</code></span></dt><dd><p>Имя программы, которое указано в вызове <code class="function">textdomain()</code>.</p></dd><dt><span class="term"><code class="varname">GETTEXT_FILES</code></span></dt><dd><p>Список файлов, которые содержат подлежащие переводу строки, т. е. помеченные <code class="function">gettext</code> или альтернативным решением. В итоге, в него будут включены почти все исходные файлы программы. Если список станет слишком длинным, можно первый <span class="quote">«<span class="quote">file</span>»</span> сделать <code class="literal">+</code> а второе слово — файлом, который содержит по одному имени файла на строку.</p></dd><dt><span class="term"><code class="varname">GETTEXT_TRIGGERS</code></span></dt><dd><p>Утилитам, которые генерируют каталоги сообщений для работы переводчиков, должно быть известно, какие вызовы функции содержат строки, подлежащие переводу. По умолчанию распознаются только вызовы <code class="function">gettext()</code>. Если вы использовали <code class="function">_</code> или другие идентификаторы, необходимо перечислить их здесь. Если подлежащая переводу строка не является первым аргументом, необходимо, чтобы элемент имел форму <code class="literal">func:2</code> (для второго аргумента). Если функция поддерживает сообщения в форме множественного числа, элемент должен выглядеть следующим образом <code class="literal">func:1,2</code> (идентификация аргументов в виде сообщений в форме единственного и множественного числа).</p></dd></dl></div></li><li class="step"><p>Добавьте файл <code class="filename">po/LINGUAS</code>, содержащий список языков, для которых есть переведённые файлы (изначально пустой).</p></li></ol></div><p>Система сборки автоматически соберёт и установит каталоги сообщений.</p></div><div class="sect2" id="NLS-GUIDELINES"><div class="titlepage"><div><div><h3 class="title">57.2.2. Рекомендации по написанию сообщений <a href="#NLS-GUIDELINES" class="id_link">#</a></h3></div></div></div><p>Ниже описаны некоторые рекомендации по написанию сообщений, которые легко перевести. </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Не составляйте предложения во время выполнения. Например: </p><pre class="programlisting">printf("Files were %s.\n", flag ? "copied" : "removed");</pre><p> Порядок слов в предложении может отличаться в других языках. Также, даже если вы не забываете вызывать <code class="function">gettext()</code> для каждого фрагмента, возможно, что по отдельности они не будут переведены хорошо. Лучше продублировать небольшую часть кода, чтобы каждое сообщение было переведено как единое целое. Лишь цифры, имена файлов и подобные текущие переменные следует вставлять в текст сообщения во время выполнения.</p></li><li class="listitem"><p>По тем же причинам следующий подход не будет работать: </p><pre class="programlisting">printf("copied %d file%s", n, n!=1 ? "s" : "");</pre><p> так как это подразумевает, как формируется форма множественного числа. Если вы думаете, что сможете решить это таким способом: </p><pre class="programlisting">if (n==1)
    printf("copied 1 file");
else
    printf("copied %d files", n):</pre><p> возможно, вы будете разочарованы. В некоторых языках существует более двух форм, и они образуются по особым правилам. Обычно лучше сформулировать сообщение, которое позволит полностью избежать этой проблемы, например: </p><pre class="programlisting">printf("number of copied files: %d", n);</pre><p>Если вы действительно хотите формировать правильно составленные сообщения в форме множественного числа, есть способ этого добиться, но это несколько неудобно. При генерировании первичного или детализированного сообщения об ошибке в <code class="function">ereport()</code>, можно написать так: </p><pre class="programlisting">errmsg_plural("copied %d file",
              "copied %d files",
              n,
              n)</pre><p> Первым аргументом является строка формата, соответствующая форме единственного числа в английском языке, вторым аргументом — строка формата, соответствующая форме множественного числа в английском языке, и третьим аргументом — управляющее целочисленное значение, которое определяет, какую форму (единственного или множественного числа) использовать. Последующие аргументы форматируются на основе строки формата, как обычно. (Как правило, значение аргумента для управления формой множественного числа будет также одним из значений, подлежащих форматированию, поэтому оно должно быть записано дважды.) В английском языке важно лишь, является ли значение <em class="replaceable"><code>n</code></em> единицей или нет, но в других языках может быть много различных форм множественного числа. Переводчик рассматривает две английские формы как группу и имеет возможность задать несколько вариантов замены строк, при этом подходящий вариант выбирается исходя из текущего значения <em class="replaceable"><code>n</code></em>.</p><p>Если вам нужно составить сообщение в форме множественного числа, которое не используется непосредственно при выводе сообщений в <code class="function">errmsg</code> или <code class="function">errdetail</code>, вы должны воспользоваться базовой функцией <code class="function">ngettext</code>. См. документацию по gettext.</p></li><li class="listitem"><p>Если вы хотите передать какую-либо информацию переводчику, например о том, насколько сообщение соотносится с другими выходными данными, перед строкой должен появиться комментарий, который начинается с <code class="literal">translator</code>, например: </p><pre class="programlisting">/* translator: This message is not what it seems to be. */</pre><p> Эти комментарии копируются в файлы каталога сообщений, чтобы переводчик мог их видеть.</p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="nls-translator.html" title="57.1. Переводчику">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="nls.html" title="Глава 57. Языковая поддержка">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="plhandler.html" title="Глава 58. Написание обработчика процедурного языка">След.</a></td></tr><tr><td width="40%" align="left" valign="top">57.1. Переводчику </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> Глава 58. Написание обработчика процедурного языка</td></tr></table></div></body></html>