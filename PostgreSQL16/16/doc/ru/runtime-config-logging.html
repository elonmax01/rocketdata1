<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>20.8. Регистрация ошибок и протоколирование работы сервера</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="runtime-config-query.html" title="20.7. Планирование запросов" /><link rel="next" href="runtime-config-statistics.html" title="20.9. Статистика времени выполнения" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">20.8. Регистрация ошибок и протоколирование работы сервера</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="runtime-config-query.html" title="20.7. Планирование запросов">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime-config.html" title="Глава 20. Настройка сервера">Наверх</a></td><th width="60%" align="center">Глава 20. Настройка сервера</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="runtime-config-statistics.html" title="20.9. Статистика времени выполнения">След.</a></td></tr></table><hr /></div><div class="sect1" id="RUNTIME-CONFIG-LOGGING"><div class="titlepage"><div><div><h2 class="title" style="clear: both">20.8. Регистрация ошибок и протоколирование работы сервера <a href="#RUNTIME-CONFIG-LOGGING" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-WHERE">20.8.1. Куда протоколировать</a></span></dt><dt><span class="sect2"><a href="runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-WHEN">20.8.2. Когда протоколировать</a></span></dt><dt><span class="sect2"><a href="runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-WHAT">20.8.3. Что протоколировать</a></span></dt><dt><span class="sect2"><a href="runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-CSVLOG">20.8.4. Использование вывода журнала в формате CSV</a></span></dt><dt><span class="sect2"><a href="runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-JSONLOG">20.8.5. Использование вывода журнала в формате JSON</a></span></dt><dt><span class="sect2"><a href="runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-PROC-TITLE">20.8.6. Заголовок процесса</a></span></dt></dl></div><a id="id-1.6.7.11.2" class="indexterm"></a><div class="sect2" id="RUNTIME-CONFIG-LOGGING-WHERE"><div class="titlepage"><div><div><h3 class="title">20.8.1. Куда протоколировать <a href="#RUNTIME-CONFIG-LOGGING-WHERE" class="id_link">#</a></h3></div></div></div><a id="id-1.6.7.11.3.2" class="indexterm"></a><a id="id-1.6.7.11.3.3" class="indexterm"></a><div class="variablelist"><dl class="variablelist"><dt id="GUC-LOG-DESTINATION"><span class="term"><code class="varname">log_destination</code> (<code class="type">string</code>) <a id="id-1.6.7.11.3.4.1.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-DESTINATION" class="id_link">#</a></dt><dd><p><span class="productname">PostgreSQL</span> поддерживает несколько методов протоколирования сообщений сервера: <span class="systemitem">stderr</span>, <span class="systemitem">csvlog</span>, <span class="systemitem">jsonlog</span> и <span class="systemitem">syslog</span>. В Windows также поддерживается <span class="systemitem">eventlog</span>. В качестве значения <code class="varname">log_destination</code> указывается один или несколько методов протоколирования, разделённых запятыми. По умолчанию используется <span class="systemitem">stderr</span>. Параметр можно задать только в конфигурационных файлах или в командной строке при запуске сервера.</p><p>Если в <code class="varname">log_destination</code> включено значение <span class="systemitem">csvlog</span>, то протоколирование ведётся в формате <acronym class="acronym">CSV</acronym> (разделённые запятыми значения). Это удобно для программной обработки журнала. Подробнее об этом в <a class="xref" href="runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-CSVLOG" title="20.8.4. Использование вывода журнала в формате CSV">Подразделе 20.8.4</a>. Для вывода в формате CSV должен быть включён <a class="xref" href="runtime-config-logging.html#GUC-LOGGING-COLLECTOR">logging_collector</a>.</p><p>Если в <code class="varname">log_destination</code> включено значение <span class="systemitem">jsonlog</span>, то протоколирование ведётся в формате <acronym class="acronym">JSON</acronym>. Это удобно для программной обработки журнала. Подробнее об этом в <a class="xref" href="runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-JSONLOG" title="20.8.5. Использование вывода журнала в формате JSON">Подразделе 20.8.5</a>. Для вывода в формате JSON должен быть включён <a class="xref" href="runtime-config-logging.html#GUC-LOGGING-COLLECTOR">logging_collector</a>.</p><p>Если присутствует указание <span class="systemitem">stderr</span>, <span class="systemitem">csvlog</span> или <span class="systemitem">jsonlog</span>, создаётся файл <code class="filename">current_logfiles</code>, в который записывается расположение файлов журнала, в настоящее время используемых сборщиком сообщений для соответствующих назначений. Это позволяет легко определить, какие файлы журнала используются в данный момент экземпляром сервера. Например, он может иметь такое содержание: </p><pre class="programlisting">stderr log/postgresql.log
csvlog log/postgresql.csv
jsonlog log/postgresql.json</pre><p> <code class="filename">current_logfiles</code> переписывается, когда при прокрутке создаётся новый файл журнала или когда изменяется значение <code class="varname">log_destination</code>. Он удаляется, когда в <code class="varname">log_destination</code> не задаётся ни <span class="systemitem">stderr</span>, ни <span class="systemitem">csvlog</span>, ни <span class="systemitem">jsonlog</span>, а также когда сборщик сообщений отключён.</p><div class="note"><h3 class="title">Примечание</h3><p>В большинстве систем Unix потребуется изменить конфигурацию системного демона <span class="application">syslog</span> для использования варианта <span class="systemitem">syslog</span> в <code class="varname">log_destination</code>. Для указания типа протоколируемой программы (facility), <span class="productname">PostgreSQL</span> может использовать значения с <code class="literal">LOCAL0</code> по <code class="literal">LOCAL7</code> (см. <a class="xref" href="runtime-config-logging.html#GUC-SYSLOG-FACILITY">syslog_facility</a>). Однако на большинстве платформ конфигурация <span class="application">syslog</span> по умолчанию не учитывает сообщения подобного типа. Чтобы это работало, потребуется добавить в конфигурацию демона <span class="application">syslog</span> что-то подобное: </p><pre class="programlisting">local0.*    /var/log/postgresql</pre><p>Для использования <code class="literal">eventlog</code> в <code class="varname">log_destination</code> на Windows, необходимо зарегистрировать источник событий и его библиотеку в операционной системе. Тогда Windows Event Viewer сможет отображать сообщения журнала событий. Подробнее в <a class="xref" href="event-log-registration.html" title="19.12. Регистрация журнала событий в Windows">Разделе 19.12</a>.</p></div></dd><dt id="GUC-LOGGING-COLLECTOR"><span class="term"><code class="varname">logging_collector</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.3.4.2.1.3" class="indexterm"></a></span> <a href="#GUC-LOGGING-COLLECTOR" class="id_link">#</a></dt><dd><p>Параметр включает сборщик сообщений (<em class="firstterm">logging collector</em>). Это фоновый процесс, который собирает отправленные в <span class="systemitem">stderr</span> сообщения и перенаправляет их в журнальные файлы. Такой подход зачастую более полезен чем запись в <span class="application">syslog</span>, поскольку некоторые сообщения в <span class="application">syslog</span> могут не попасть. (Типичный пример с сообщениями об ошибках динамического связывания, другой пример — ошибки в скриптах типа <code class="varname">archive_command</code>.) Для установки параметра требуется перезапуск сервера.</p><div class="note"><h3 class="title">Примечание</h3><p>Можно обойтись без сборщика сообщений и просто писать в <span class="systemitem">stderr</span>. Сообщения будут записываться в место, куда направлен поток <span class="systemitem">stderr</span>. Такой способ подойдёт только для небольших объёмов протоколирования, потому что не предоставляет удобных средств для организации ротации журнальных файлов. Кроме того, на некоторых платформах отказ от использования сборщика сообщений может привести к потере или искажению сообщений, так как несколько процессов, одновременно пишущих в один журнальный файл, могут перезаписывать информацию друг друга.</p></div><div class="note"><h3 class="title">Примечание</h3><p>Сборщик спроектирован так, чтобы сообщения никогда не терялись. А это значит, что при очень высокой нагрузке, серверные процессы могут быть заблокированы при попытке отправить сообщения во время сбоя фонового процесса сборщика. В противоположность этому, <span class="application">syslog</span> предпочитает удалять сообщения, при невозможности их записать. Поэтому часть сообщений может быть потеряна, но система не будет блокироваться.</p></div></dd><dt id="GUC-LOG-DIRECTORY"><span class="term"><code class="varname">log_directory</code> (<code class="type">string</code>) <a id="id-1.6.7.11.3.4.3.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-DIRECTORY" class="id_link">#</a></dt><dd><p>При включённом <code class="varname">logging_collector</code>, определяет каталог, в котором создаются журнальные файлы. Можно задавать как абсолютный путь, так и относительный от каталога данных кластера. Параметр можно задать только в конфигурационных файлах или в командной строке при запуске сервера. Значение по умолчанию — <code class="literal">log</code>.</p></dd><dt id="GUC-LOG-FILENAME"><span class="term"><code class="varname">log_filename</code> (<code class="type">string</code>) <a id="id-1.6.7.11.3.4.4.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-FILENAME" class="id_link">#</a></dt><dd><p>При включённом <code class="varname">logging_collector</code> задаёт имена журнальных файлов. Значение трактуется как строка формата в функции <code class="function">strftime</code>, поэтому в ней можно использовать спецификаторы <code class="literal">%</code> для включения в имена файлов информации о дате и времени. (При наличии зависящих от часового пояса спецификаторов <code class="literal">%</code> будет использован пояс, заданный в <a class="xref" href="runtime-config-logging.html#GUC-LOG-TIMEZONE">log_timezone</a>.) Поддерживаемые спецификаторы <code class="literal">%</code> похожи на те, что перечислены в описании <a class="ulink" href="https://pubs.opengroup.org/onlinepubs/009695399/functions/strftime.html" target="_top">strftime</a> спецификации Open Group. Обратите внимание, что системная функция <code class="function">strftime</code> напрямую не используется. Поэтому нестандартные, специфичные для платформы особенности не будут работать. Значение по умолчанию <code class="literal">postgresql-%Y-%m-%d_%H%M%S.log</code>.</p><p>Если для задания имени файлов не используются спецификаторы <code class="literal">%</code>, то для избежания переполнения диска, следует использовать утилиты для ротации журнальных файлов. В версиях до 8.4, при отсутствии спецификаторов <code class="literal">%</code>, <span class="productname">PostgreSQL</span> автоматически добавлял время в формате Epoch к имени файла. Сейчас в этом больше нет необходимости.</p><p>Если в <code class="varname">log_destination</code> включён вывод в формате CSV, то к имени журнального файла будет добавлено расширение <code class="literal">.csv</code>. (Если <code class="varname">log_filename</code> заканчивается на <code class="literal">.log</code>, то это расширение заменится на <code class="literal">.csv</code>.)</p><p>Если в <code class="varname">log_destination</code> включён вывод в формате JSON, то к имени журнального файла будет добавлено расширение <code class="literal">.json</code>. (Если <code class="varname">log_filename</code> заканчивается на <code class="literal">.log</code>, то это расширение заменится на <code class="literal">.json</code>.)</p><p>Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt id="GUC-LOG-FILE-MODE"><span class="term"><code class="varname">log_file_mode</code> (<code class="type">integer</code>) <a id="id-1.6.7.11.3.4.5.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-FILE-MODE" class="id_link">#</a></dt><dd><p>В системах Unix задаёт права доступа к журнальным файлам, при включённом <code class="varname">logging_collector</code>. (В Windows этот параметр игнорируется.) Значение параметра должно быть числовым, в формате команд <code class="function">chmod</code> и <code class="function">umask</code>. (Для восьмеричного формата, требуется задать лидирующий <code class="literal">0</code> (ноль).)</p><p>Права доступа по умолчанию <code class="literal">0600</code>, т. е. только владелец сервера может читать и писать в журнальные файлы. Также, может быть полезным значение <code class="literal">0640</code>, разрешающее чтение файлов членам группы. Однако чтобы установить такое значение, нужно каталог для хранения журнальных файлов (<a class="xref" href="runtime-config-logging.html#GUC-LOG-DIRECTORY">log_directory</a>) вынести за пределы каталога данных кластера. В любом случае нежелательно открывать для всех доступ на чтение журнальных файлов, так как они могут содержать конфиденциальные данные.</p><p>Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt id="GUC-LOG-ROTATION-AGE"><span class="term"><code class="varname">log_rotation_age</code> (<code class="type">integer</code>) <a id="id-1.6.7.11.3.4.6.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-ROTATION-AGE" class="id_link">#</a></dt><dd><p>При включённом <code class="varname">logging_collector</code> этот параметр определяет максимальное время жизни отдельного журнального файла, по истечении которого создаётся новый файл. Если это значение задаётся без единиц измерения, оно считается заданным в минутах. Значение по умолчанию — 24 часа. При нулевом значении смена файлов по времени не производится. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt id="GUC-LOG-ROTATION-SIZE"><span class="term"><code class="varname">log_rotation_size</code> (<code class="type">integer</code>) <a id="id-1.6.7.11.3.4.7.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-ROTATION-SIZE" class="id_link">#</a></dt><dd><p>При включённом <code class="varname">logging_collector</code> этот параметр определяет максимальный размер отдельного журнального файла. При достижении этого размера создаётся новый файл. Если это значение задаётся без единиц измерения, оно считается заданным в килобайтах. Значение по умолчанию — 10 мегабайт. При нулевом значении смена файлов по размеру не производится. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt id="GUC-LOG-TRUNCATE-ON-ROTATION"><span class="term"><code class="varname">log_truncate_on_rotation</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.3.4.8.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-TRUNCATE-ON-ROTATION" class="id_link">#</a></dt><dd><p>Если параметр <code class="varname">logging_collector</code> включён, <span class="productname">PostgreSQL</span> будет перезаписывать существующие журнальные файлы, а не дописывать в них. Однако перезапись при переключении на новый файл возможна только в результате ротации по времени, но не при старте сервера или ротации по размеру файла. При выключенном параметре всегда продолжается запись в существующий файл. Например, включение этого параметра в комбинации с <code class="varname">log_filename</code> равным <code class="literal">postgresql-%H.log</code>, приведёт к генерации 24-х часовых журнальных файлов, которые циклически перезаписываются. Параметр можно задать только в конфигурационных файлах или в командной строке при запуске сервера.</p><p>Пример: для хранения журнальных файлов в течение 7 дней, по одному файлу на каждый день с именами вида <code class="literal">server_log.Mon</code>, <code class="literal">server_log.Tue</code> и т. д., а также с автоматической перезаписью файлов прошлой недели, нужно установить <code class="varname">log_filename</code> в <code class="literal">server_log.%a</code>, <code class="varname">log_truncate_on_rotation</code> в <code class="literal">on</code> и <code class="varname">log_rotation_age</code> в <code class="literal">1440</code>.</p><p>Пример: для хранения журнальных файлов в течение 24 часов, по одному файлу на час, с дополнительной возможностью переключения файла при превышения 1ГБ, установите <code class="varname">log_filename</code> в <code class="literal">server_log.%H%M</code>, <code class="varname">log_truncate_on_rotation</code> в <code class="literal">on</code>, <code class="varname">log_rotation_age</code> в <code class="literal">60</code> и <code class="varname">log_rotation_size</code> в <code class="literal">1000000</code>. Добавление <code class="literal">%M</code> в <code class="varname">log_filename</code> позволит при переключении по размеру указать другое имя файла в пределах одного часа.</p></dd><dt id="GUC-SYSLOG-FACILITY"><span class="term"><code class="varname">syslog_facility</code> (<code class="type">enum</code>) <a id="id-1.6.7.11.3.4.9.1.3" class="indexterm"></a></span> <a href="#GUC-SYSLOG-FACILITY" class="id_link">#</a></dt><dd><p>При включённом протоколировании в <span class="application">syslog</span>, этот параметр определяет значение <span class="quote">«<span class="quote">facility</span>»</span>. Допустимые значения <code class="literal">LOCAL0</code>, <code class="literal">LOCAL1</code>, <code class="literal">LOCAL2</code>, <code class="literal">LOCAL3</code>, <code class="literal">LOCAL4</code>, <code class="literal">LOCAL5</code>, <code class="literal">LOCAL6</code>, <code class="literal">LOCAL7</code>. По умолчанию используется <code class="literal">LOCAL0</code>. Подробнее в документации на системный демон <span class="application">syslog</span>. Параметр можно задать только в конфигурационных файлах или в командной строке при запуске сервера.</p></dd><dt id="GUC-SYSLOG-IDENT"><span class="term"><code class="varname">syslog_ident</code> (<code class="type">string</code>) <a id="id-1.6.7.11.3.4.10.1.3" class="indexterm"></a></span> <a href="#GUC-SYSLOG-IDENT" class="id_link">#</a></dt><dd><p>При включённом протоколировании в <span class="application">syslog</span>, этот параметр задаёт имя программы, которое будет использоваться в <span class="application">syslog</span> для идентификации сообщений относящихся к <span class="productname">PostgreSQL</span>. По умолчанию используется <code class="literal">postgres</code>. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt id="GUC-SYSLOG-SEQUENCE-NUMBERS"><span class="term"><code class="varname">syslog_sequence_numbers</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.3.4.11.1.3" class="indexterm"></a></span> <a href="#GUC-SYSLOG-SEQUENCE-NUMBERS" class="id_link">#</a></dt><dd><p>Когда сообщения выводятся в <span class="application">syslog</span> и этот параметр включён (по умолчанию), все сообщения будут предваряться последовательно увеличивающимися номерами (например, <code class="literal">[2]</code>). Это позволяет обойти подавление повторов <span class="quote">«<span class="quote">--- последнее сообщение повторилось N раз ---</span>»</span>, которое по умолчанию осуществляется во многих реализациях syslog. В более современных реализациях syslog подавление повторных сообщений можно настроить (например, в <span class="productname">rsyslog</span> есть директива <code class="literal">$RepeatedMsgReduction</code>), так что это может излишне. Если же вы действительно хотите, чтобы повторные сообщения подавлялись, вы можете отключить этот параметр.</p><p>Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt id="GUC-SYSLOG-SPLIT-MESSAGES"><span class="term"><code class="varname">syslog_split_messages</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.3.4.12.1.3" class="indexterm"></a></span> <a href="#GUC-SYSLOG-SPLIT-MESSAGES" class="id_link">#</a></dt><dd><p>Когда активен вывод сообщений в <span class="application">syslog</span>, этот параметр определяет, как будут доставляться сообщения. Если он включён (по умолчанию), сообщения разделяются по строкам, а длинные строки разбиваются на строки не длиннее 1024 байт, что составляет типичное ограничение размера для традиционных реализаций syslog. Когда он отключён, сообщения сервера PostgreSQL передаются службе syslog как есть, и она должна сама корректно воспринять потенциально длинные сообщения.</p><p>Если syslog в итоге выводит сообщения в текстовый файл, результат будет тем же и лучше оставить этот параметр включённым, так как многие реализации syslog не способны обрабатывать большие сообщения или их нужно специально настраивать для этого. Но если syslog направляет сообщения в некоторую другую среду, может потребоваться или будет удобнее сохранять логическую целостность сообщений.</p><p>Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt id="GUC-EVENT-SOURCE"><span class="term"><code class="varname">event_source</code> (<code class="type">string</code>) <a id="id-1.6.7.11.3.4.13.1.3" class="indexterm"></a></span> <a href="#GUC-EVENT-SOURCE" class="id_link">#</a></dt><dd><p>При включённом протоколировании в <span class="application">event log</span>, этот параметр задаёт имя программы, которое будет использоваться в журнале событий для идентификации сообщений относящихся к <span class="productname">PostgreSQL</span>. По умолчанию используется <code class="literal">PostgreSQL</code>. Параметр можно задать только в конфигурационных файлах или в командной строке при запуске сервера.</p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-LOGGING-WHEN"><div class="titlepage"><div><div><h3 class="title">20.8.2. Когда протоколировать <a href="#RUNTIME-CONFIG-LOGGING-WHEN" class="id_link">#</a></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="GUC-LOG-MIN-MESSAGES"><span class="term"><code class="varname">log_min_messages</code> (<code class="type">enum</code>) <a id="id-1.6.7.11.4.2.1.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-MIN-MESSAGES" class="id_link">#</a></dt><dd><p>Управляет минимальным <a class="link" href="runtime-config-logging.html#RUNTIME-CONFIG-SEVERITY-LEVELS" title="Таблица 20.2. Уровни важности сообщений">уровнем сообщений</a>, записываемых в журнал сервера. Допустимые значения <code class="literal">DEBUG5</code>, <code class="literal">DEBUG4</code>, <code class="literal">DEBUG3</code>, <code class="literal">DEBUG2</code>, <code class="literal">DEBUG1</code>, <code class="literal">INFO</code>, <code class="literal">NOTICE</code>, <code class="literal">WARNING</code>, <code class="literal">ERROR</code>, <code class="literal">LOG</code>, <code class="literal">FATAL</code> и <code class="literal">PANIC</code>. Каждый из перечисленных уровней включает все идущие после него. Чем дальше в этом списке уровень сообщения, тем меньше сообщений будет записано в журнал сервера. По умолчанию используется <code class="literal">WARNING</code>. Обратите внимание, позиция <code class="literal">LOG</code> здесь отличается от принятой в <a class="xref" href="runtime-config-client.html#GUC-CLIENT-MIN-MESSAGES">client_min_messages</a>. Только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code> могут изменить этот параметр.</p></dd><dt id="GUC-LOG-MIN-ERROR-STATEMENT"><span class="term"><code class="varname">log_min_error_statement</code> (<code class="type">enum</code>) <a id="id-1.6.7.11.4.2.2.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-MIN-ERROR-STATEMENT" class="id_link">#</a></dt><dd><p>Управляет тем, какие SQL-операторы, завершившиеся ошибкой, записываются в журнал сервера. SQL-оператор будет записан в журнал, если он завершится ошибкой с указанным <a class="link" href="runtime-config-logging.html#RUNTIME-CONFIG-SEVERITY-LEVELS" title="Таблица 20.2. Уровни важности сообщений">уровнем важности</a> или выше. Допустимые значения: <code class="literal">DEBUG5</code>, <code class="literal">DEBUG4</code>, <code class="literal">DEBUG3</code>, <code class="literal">DEBUG2</code>, <code class="literal">DEBUG1</code>, <code class="literal">INFO</code>, <code class="literal">NOTICE</code>, <code class="literal">WARNING</code>, <code class="literal">ERROR</code>, <code class="literal">LOG</code>, <code class="literal">FATAL</code> и <code class="literal">PANIC</code>. По умолчанию используется <code class="literal">ERROR</code>. Это означает, что в журнал сервера будут записаны все операторы, завершившиеся сообщением с уровнем важности <code class="literal">ERROR</code>, <code class="literal">LOG</code>, <code class="literal">FATAL</code> и <code class="literal">PANIC</code>. Чтобы фактически отключить запись операторов с ошибками, установите для этого параметра значение <code class="literal">PANIC</code>. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p></dd><dt id="GUC-LOG-MIN-DURATION-STATEMENT"><span class="term"><code class="varname">log_min_duration_statement</code> (<code class="type">integer</code>) <a id="id-1.6.7.11.4.2.3.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-MIN-DURATION-STATEMENT" class="id_link">#</a></dt><dd><p>Записывает в журнал продолжительность выполнения всех команд, время работы которых не меньше указанного. Например, при значении <code class="literal">250ms</code> в журнал сервера будут записаны все команды, выполняющиеся 250 миллисекунд и дольше. С помощью этого параметра можно выявить неоптимизированные запросы в приложениях. Если значение этого параметра задаётся без единиц измерения, оно считается заданным в миллисекундах. При нулевом значении записывается продолжительность выполнения всех команд. Со значением -1 (по умолчанию) запись полностью отключается. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p><p>Этот параметр переопределяет <a class="xref" href="runtime-config-logging.html#GUC-LOG-MIN-DURATION-SAMPLE">log_min_duration_sample</a>, то есть запросы с длительностью, превышающей заданное значение, всегда фиксируются в журнале, вне зависимости от параметров извлечения выборки.</p><p>Для клиентов, использующих расширенный протокол запросов, будет записываться продолжительность фаз: разбор, связывание и выполнение.</p><div class="note"><h3 class="title">Примечание</h3><p>При использовании совместно с <a class="xref" href="runtime-config-logging.html#GUC-LOG-STATEMENT">log_statement</a>, текст SQL-операторов будет записываться только один раз (от использования <code class="varname">log_statement</code>) и не будет задублирован в сообщении о длительности выполнения. Если не используется вывод в <span class="application">syslog</span>, то рекомендуется в <a class="xref" href="runtime-config-logging.html#GUC-LOG-LINE-PREFIX">log_line_prefix</a> включить идентификатор процесса или сеанса. Это позволит связать текст запроса с записью о продолжительности выполнения, которая появится позже.</p></div></dd><dt id="GUC-LOG-MIN-DURATION-SAMPLE"><span class="term"><code class="varname">log_min_duration_sample</code> (<code class="type">integer</code>) <a id="id-1.6.7.11.4.2.4.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-MIN-DURATION-SAMPLE" class="id_link">#</a></dt><dd><p>Позволяет сделать выборку по продолжительности команд, которые выполнялись не менее чем определённое время. При этом в журнал будут вноситься такие же записи, как и при включённом параметре <a class="xref" href="runtime-config-logging.html#GUC-LOG-MIN-DURATION-STATEMENT">log_min_duration_statement</a>, но не для всех команд, а только для их подмножества, ограничиваемого параметром <a class="xref" href="runtime-config-logging.html#GUC-LOG-STATEMENT-SAMPLE-RATE">log_statement_sample_rate</a>. Например, при значении <code class="literal">100ms</code> предварительно для выборки будут отобраны все SQL-операторы, выполняющиеся 100 миллисекунд и дольше. Этот параметр может быть полезен, когда количество запросов слишком велико, чтобы записывать в журнал их все. Если значение этого параметра задаётся без единиц измерения, оно считается заданным в миллисекундах. При нулевом значении для выборки отбираются команды с любой продолжительностью. Со значением -1 (по умолчанию) формирование выборки по продолжительности полностью отключается. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p><p>Этот параметр имеет меньший приоритет, чем <code class="varname">log_min_duration_statement</code>, то есть команды с длительностью, превышающей <code class="varname">log_min_duration_statement</code>, будут регистрироваться в журнале всегда, вне зависимости от того, какой будет выборка.</p><p>Другие замечания, относящиеся к <code class="varname">log_min_duration_statement</code>, применимы так же и к данному параметру.</p></dd><dt id="GUC-LOG-STATEMENT-SAMPLE-RATE"><span class="term"><code class="varname">log_statement_sample_rate</code> (<code class="type">floating point</code>) <a id="id-1.6.7.11.4.2.5.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-STATEMENT-SAMPLE-RATE" class="id_link">#</a></dt><dd><p>Определяет, какая доля команд с длительностью, достигшей <a class="xref" href="runtime-config-logging.html#GUC-LOG-MIN-DURATION-SAMPLE">log_min_duration_sample</a>, будет регистрироваться в журнале. Выборка формируется вероятностным образом, например, со значением <code class="literal">0.5</code> можно считать, что шанс попадания каждой отдельной команды в выборку равен один к двум. Значение по умолчанию — <code class="literal">1.0</code>, то есть выбираются и регистрируются все команды. Со значением 0 запись команд выборки, в зависимости от их длительности, отключается, так же как и при <code class="varname">log_min_duration_sample</code>, равном <code class="literal">-1</code>. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p></dd><dt id="GUC-LOG-TRANSACTION-SAMPLE-RATE"><span class="term"><code class="varname">log_transaction_sample_rate</code> (<code class="type">floating point</code>) <a id="id-1.6.7.11.4.2.6.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-TRANSACTION-SAMPLE-RATE" class="id_link">#</a></dt><dd><p>Задаёт долю транзакций, команды из которых будут записываться в журнал дополнительно (помимо команд, записываемых по другим причинам). Этот параметр действует на все транзакции, независимо от длительности команд. Выборка осуществляется вероятностным образом, например, со значением <code class="literal">0.1</code> можно считать, что каждая транзакция может попасть в журнал с шансом один к десяти. Параметр <code class="varname">log_transaction_sample_rate</code> может быть полезен для анализа выборки транзакций. Значение по умолчанию — <code class="literal">0</code>, то есть команды из дополнительно выбираемых транзакций не записываются. При значении <code class="literal">1</code> записываются все команды из всех транзакций. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>С этим параметром, как и со всеми остальными, управляющими журналированием команд, могут быть связаны значительные издержки.</p></div></dd><dt id="GUC-LOG-STARTUP-PROGRESS-INTERVAL"><span class="term"><code class="varname">log_startup_progress_interval</code> (<code class="type">integer</code>) <a id="id-1.6.7.11.4.2.7.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-STARTUP-PROGRESS-INTERVAL" class="id_link">#</a></dt><dd><p>Задаёт интервал времени, по истечении которого процесс запуска будет выдавать сообщение о длительной операции, которая всё ещё выполняется; с таким же интервалом будут выдаваться и последующие сообщения об этой операции. Значение по умолчанию — 10 секунд. Значение <code class="literal">0</code> отключает эту функцию. Если это значение указано без единиц измерения, оно считается заданным в миллисекундах. Этот интервал отсчитывается для каждой операции в отдельности. Задать этот параметр можно только в файле <code class="filename">postgresql.conf</code> или в командной строке сервера.</p><p>Например, при значении по умолчанию, равном 10 сек., если синхронизация каталога данных продолжается 25 секунд, а после этого сброс нежурналируемых отношений выполняется 8 секунд, в журнал будет выдано сообщение об операции синхронизации через 10 секунд после её начала, а затем ещё одно сообщение об этой операции, когда её продолжительность достигнет 20 секунд, а сообщений об операции сброса нежурналируемых отношений в журнале не будет.</p></dd></dl></div><p>В <a class="xref" href="runtime-config-logging.html#RUNTIME-CONFIG-SEVERITY-LEVELS" title="Таблица 20.2. Уровни важности сообщений">Таблице 20.2</a> поясняются уровни важности сообщений в <span class="productname">PostgreSQL</span>. Также в этой таблице показано, как эти уровни транслируются в системные при использовании <span class="systemitem">syslog</span> или <span class="systemitem">eventlog</span> в Windows.</p><div class="table" id="RUNTIME-CONFIG-SEVERITY-LEVELS"><p class="title"><strong>Таблица 20.2. Уровни важности сообщений</strong></p><div class="table-contents"><table class="table" summary="Уровни важности сообщений" border="1"><colgroup><col class="col1" /><col class="col2" /><col class="col3" /><col class="col4" /></colgroup><thead><tr><th>Уровень</th><th>Использование</th><th><span class="systemitem">syslog</span></th><th><span class="systemitem">eventlog</span></th></tr></thead><tbody><tr><td><code class="literal">DEBUG1 .. DEBUG5</code></td><td>Более детальная информация для разработчиков. Чем больше номер, тем детальнее.</td><td><code class="literal">DEBUG</code></td><td><code class="literal">INFORMATION</code></td></tr><tr><td><code class="literal">INFO</code></td><td>Неявно запрошенная пользователем информация, например вывод команды <code class="command">VACUUM VERBOSE</code>.</td><td><code class="literal">INFO</code></td><td><code class="literal">INFORMATION</code></td></tr><tr><td><code class="literal">NOTICE</code></td><td>Информация, которая может быть полезной пользователям. Например, уведомления об усечении длинных идентификаторов.</td><td><code class="literal">NOTICE</code></td><td><code class="literal">INFORMATION</code></td></tr><tr><td><code class="literal">WARNING</code></td><td>Предупреждения о возможных проблемах. Например, <code class="command">COMMIT</code> вне транзакционного блока.</td><td><code class="literal">NOTICE</code></td><td><code class="literal">WARNING</code></td></tr><tr><td><code class="literal">ERROR</code></td><td>Сообщает об ошибке, из-за которой прервана текущая команда.</td><td><code class="literal">WARNING</code></td><td><code class="literal">ERROR</code></td></tr><tr><td><code class="literal">LOG</code></td><td>Информация, полезная для администраторов. Например, выполнение контрольных точек.</td><td><code class="literal">INFO</code></td><td><code class="literal">INFORMATION</code></td></tr><tr><td><code class="literal">FATAL</code></td><td>Сообщает об ошибке, из-за которой прерван текущий сеанс.</td><td><code class="literal">ERR</code></td><td><code class="literal">ERROR</code></td></tr><tr><td><code class="literal">PANIC</code></td><td>Сообщает об ошибке, из-за которой прерваны все сеансы.</td><td><code class="literal">CRIT</code></td><td><code class="literal">ERROR</code></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="RUNTIME-CONFIG-LOGGING-WHAT"><div class="titlepage"><div><div><h3 class="title">20.8.3. Что протоколировать <a href="#RUNTIME-CONFIG-LOGGING-WHAT" class="id_link">#</a></h3></div></div></div><div class="note"><h3 class="title">Примечание</h3><p>Выбирая, что будет записываться в протокол, важно учитывать возможные риски безопасности; подробнее об этом говорится в <a class="xref" href="logfile-maintenance.html" title="25.3. Обслуживание журнала">Разделе 25.3</a>.</p></div><div class="variablelist"><dl class="variablelist"><dt id="GUC-APPLICATION-NAME"><span class="term"><code class="varname">application_name</code> (<code class="type">string</code>) <a id="id-1.6.7.11.5.3.1.1.3" class="indexterm"></a></span> <a href="#GUC-APPLICATION-NAME" class="id_link">#</a></dt><dd><p><code class="varname">application_name</code> — это любая строка длиной не более <code class="symbol">NAMEDATALEN</code> символов (64 символа при стандартной сборке). Обычно устанавливается приложением при подключении к серверу. Значение отображается в представлении <code class="structname">pg_stat_activity</code> и добавляется в журнал сервера, при использовании формата CSV. Для прочих форматов, <code class="varname">application_name</code> можно добавить в журнал через параметр <a class="xref" href="runtime-config-logging.html#GUC-LOG-LINE-PREFIX">log_line_prefix</a>. Значение <code class="varname">application_name</code> может содержать только печатные ASCII символы. Остальные символы заменяются <a class="link" href="sql-syntax-lexical.html#SQL-SYNTAX-STRINGS-ESCAPE" title="4.1.2.2. Строковые константы со спецпоследовательностями в стиле C">шестнадцатеричными спецсимволами в стиле C</a>.</p></dd><dt id="GUC-DEBUG-PRINT-PARSE"><span class="term"><code class="varname">debug_print_parse</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.2.1.3" class="indexterm"></a><br /></span><span class="term"><code class="varname">debug_print_rewritten</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.2.2.3" class="indexterm"></a><br /></span><span class="term"><code class="varname">debug_print_plan</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.2.3.3" class="indexterm"></a></span> <a href="#GUC-DEBUG-PRINT-PARSE" class="id_link">#</a></dt><dd><p>Эти параметры включают вывод различной отладочной информации. А именно: вывод дерева запроса, дерево запроса после применения правил или плана выполнения запроса, соответственно. Все эти сообщения имеют уровень <code class="literal">LOG</code>. Поэтому, по умолчанию, они записываются в журнал сервера, но не отправляются клиенту. Отправку клиенту можно настроить через <a class="xref" href="runtime-config-client.html#GUC-CLIENT-MIN-MESSAGES">client_min_messages</a> и/или <a class="xref" href="runtime-config-logging.html#GUC-LOG-MIN-MESSAGES">log_min_messages</a>. По умолчанию параметры выключены.</p></dd><dt id="GUC-DEBUG-PRETTY-PRINT"><span class="term"><code class="varname">debug_pretty_print</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.3.1.3" class="indexterm"></a></span> <a href="#GUC-DEBUG-PRETTY-PRINT" class="id_link">#</a></dt><dd><p>Включает выравнивание сообщений, выводимых <code class="varname">debug_print_parse</code>, <code class="varname">debug_print_rewritten</code> или <code class="varname">debug_print_plan</code>. В результате сообщения легче читать, но они значительно длиннее, чем в формате <span class="quote">«<span class="quote">compact</span>»</span>, который используется при выключенном значении. По умолчанию включён.</p></dd><dt id="GUC-LOG-AUTOVACUUM-MIN-DURATION"><span class="term"><code class="varname">log_autovacuum_min_duration</code> (<code class="type">integer</code>) <a id="id-1.6.7.11.5.3.4.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-AUTOVACUUM-MIN-DURATION" class="id_link">#</a></dt><dd><p>Задаёт время выполнения действия автоочистки, при превышении которого информация об этом действии записывается в журнал. При нулевом значении в журнале фиксируются все действия автоочистки. Значение <code class="literal">-1</code> отключает журналирование действий автоочистки. Если это значение задаётся без единиц измерения, оно считается заданным в миллисекундах. Например, если задать значение <code class="literal">250ms</code>, в журнале будут фиксироваться все операции автоматической очистки и анализа, выполняемые дольше 250 мс. Кроме того, когда этот параметр имеет любое значение, отличное от <code class="literal">-1</code>, в журнал будет записываться сообщение в случае пропуска действия автоочистки из-за конфликтующей блокировки или параллельного удаления отношения. Значение по умолчанию — <code class="literal">10min</code>. Во включённом состоянии этот параметр помогает отслеживать активность автоочистки. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако его можно переопределить для отдельных таблиц, изменив их параметры хранения.</p></dd><dt id="GUC-LOG-CHECKPOINTS"><span class="term"><code class="varname">log_checkpoints</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.5.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-CHECKPOINTS" class="id_link">#</a></dt><dd><p>Включает протоколирование выполнения контрольных точек и точек перезапуска сервера. При этом записывается некоторая статистическая информация. Например, число записанных буферов и время, затраченное на их запись. Параметр можно задать только в конфигурационных файлах или в командной строке при запуске сервера. По умолчанию включён.</p></dd><dt id="GUC-LOG-CONNECTIONS"><span class="term"><code class="varname">log_connections</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.6.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-CONNECTIONS" class="id_link">#</a></dt><dd><p>Включает протоколирование всех попыток подключения к серверу, в том числе успешного завершения как аутентификации (если она требуется), так и авторизации клиентов. Изменить его можно только в начале сеанса и сделать это могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>. Значение по умолчанию — <code class="literal">off</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>Некоторые программы, например <span class="application">psql</span>, предпринимают две попытки подключения (первая для определения, нужен ли пароль). Поэтому дублирование сообщения <span class="quote">«<span class="quote">connection received</span>»</span> не обязательно говорит о наличии проблемы.</p></div></dd><dt id="GUC-LOG-DISCONNECTIONS"><span class="term"><code class="varname">log_disconnections</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.7.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-DISCONNECTIONS" class="id_link">#</a></dt><dd><p>Включает протоколирование завершения сеанса. В журнал выводится примерно та же информация, что и с <code class="varname">log_connections</code>, плюс длительность сеанса. Изменить этот параметр можно только в начале сеанса и сделать это могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>. Значение по умолчанию — <code class="literal">off</code>.</p></dd><dt id="GUC-LOG-DURATION"><span class="term"><code class="varname">log_duration</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.8.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-DURATION" class="id_link">#</a></dt><dd><p>Записывает продолжительность каждой завершённой команды. По умолчанию выключен. Только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code> могут изменить этот параметр.</p><p>Для клиентов, использующих расширенный протокол запросов, будет записываться продолжительность фаз: разбор, связывание и выполнение.</p><div class="note"><h3 class="title">Примечание</h3><p>Включение параметра <code class="varname">log_duration</code> не равнозначно установке нулевого значения для <a class="xref" href="runtime-config-logging.html#GUC-LOG-MIN-DURATION-STATEMENT">log_min_duration_statement</a>. Разница в том, что при превышении значения <code class="varname">log_min_duration_statement</code> в журнал записывается текст запроса, а при включении данного параметра — нет. Таким образом, при <code class="varname">log_duration</code> = <code class="literal">on</code> и положительном значении <code class="varname">log_min_duration_statement</code> в журнал записывается длительность для всех команд, а текст запроса — только для команд с длительностью, превышающей предел. Такое поведение может оказаться полезным при сборе статистики в условиях большой нагрузки.</p></div></dd><dt id="GUC-LOG-ERROR-VERBOSITY"><span class="term"><code class="varname">log_error_verbosity</code> (<code class="type">enum</code>) <a id="id-1.6.7.11.5.3.9.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-ERROR-VERBOSITY" class="id_link">#</a></dt><dd><p>Управляет количеством детальной информации, записываемой в журнал сервера для каждого сообщения. Допустимые значения: <code class="literal">TERSE</code>, <code class="literal">DEFAULT</code> и <code class="literal">VERBOSE</code>. Каждое последующее значение добавляет больше полей в выводимое сообщение. Для <code class="literal">TERSE</code> из сообщения об ошибке исключаются поля <code class="literal">DETAIL</code>, <code class="literal">HINT</code>, <code class="literal">QUERY</code> и <code class="literal">CONTEXT</code>. Для <code class="literal">VERBOSE</code> в сообщение включается код ошибки <code class="symbol">SQLSTATE</code> (см. <a class="xref" href="errcodes-appendix.html" title="Приложение A. Коды ошибок PostgreSQL">Приложение A</a>), а также имя файла с исходным кодом, имя функции и номер строки сгенерировавшей ошибку. Только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code> могут изменить этот параметр.</p></dd><dt id="GUC-LOG-HOSTNAME"><span class="term"><code class="varname">log_hostname</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.10.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-HOSTNAME" class="id_link">#</a></dt><dd><p>По умолчанию, сообщения журнала содержат лишь IP-адрес подключившегося клиента. При включении этого параметра, дополнительно будет фиксироваться и имя сервера. Обратите внимание, что в зависимости от применяемого способа разрешения имён, это может отрицательно сказаться на производительности. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt id="GUC-LOG-LINE-PREFIX"><span class="term"><code class="varname">log_line_prefix</code> (<code class="type">string</code>) <a id="id-1.6.7.11.5.3.11.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-LINE-PREFIX" class="id_link">#</a></dt><dd><p>Строка, в стиле функции <code class="function">printf</code>, которая выводится в начале каждой строки журнала сообщений. С символов <code class="literal">%</code> начинаются управляющие последовательности, которые заменяются статусной информацией, описанной ниже. Неизвестные управляющие последовательности игнорируются. Все остальные символы напрямую копируются в выводимую строку. Некоторые управляющие последовательности используются только для пользовательских процессов и будут игнорироваться фоновыми процессами, например основным процессом сервера. Статусная информация может быть выровнена по ширине влево или вправо указанием числа после % и перед кодом последовательности. Отрицательное число дополняет значение пробелами справа до заданной ширины, а положительное число — слева. Выравнивание может быть полезно для улучшения читаемости.</p><p>Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. По умолчанию этот параметр имеет значение <code class="literal">'%m [%p] '</code>, с которым в журнал выводится время и идентификатор процесса (PID).</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Спецсимвол</th><th>Назначение</th><th>Только для пользовательского процесса</th></tr></thead><tbody><tr><td><code class="literal">%a</code></td><td>Имя приложения (<a class="xref" href="runtime-config-logging.html#GUC-APPLICATION-NAME">application_name</a>)</td><td>да</td></tr><tr><td><code class="literal">%u</code></td><td>Имя пользователя</td><td>да</td></tr><tr><td><code class="literal">%d</code></td><td>Имя базы данных</td><td>да</td></tr><tr><td><code class="literal">%r</code></td><td>Имя удалённого узла или IP-адрес, а также номер порта</td><td>да</td></tr><tr><td><code class="literal">%h</code></td><td>Имя удалённого узла или IP-адрес</td><td>да</td></tr><tr><td><code class="literal">%b</code></td><td>Тип обслуживающего процесса</td><td>нет</td></tr><tr><td><code class="literal">%p</code></td><td>Идентификатор процесса</td><td>нет</td></tr><tr><td><code class="literal">%P</code></td><td>Идентификатор ведущего процесса группы, если текущий процесс является исполнителем параллельного запроса</td><td>нет</td></tr><tr><td><code class="literal">%t</code></td><td>Штамп времени, без миллисекунд</td><td>нет</td></tr><tr><td><code class="literal">%m</code></td><td>Штамп времени, с миллисекундами</td><td>нет</td></tr><tr><td><code class="literal">%n</code></td><td>Штамп времени, с миллисекундами (в виде времени Unix)</td><td>нет</td></tr><tr><td><code class="literal">%i</code></td><td>Тег команды: тип текущей команды в сеансе</td><td>да</td></tr><tr><td><code class="literal">%e</code></td><td>Код ошибки SQLSTATE</td><td>нет</td></tr><tr><td><code class="literal">%c</code></td><td>Идентификатор сеанса. Подробности ниже</td><td>нет</td></tr><tr><td><code class="literal">%l</code></td><td>Номер строки журнала для каждого сеанса или процесса. Начинается с 1</td><td>нет</td></tr><tr><td><code class="literal">%s</code></td><td>Штамп времени начала процесса</td><td>нет</td></tr><tr><td><code class="literal">%v</code></td><td>Идентификатор виртуальной транзакции (backendID/localXID); см. <a class="xref" href="transaction-id.html" title="74.1. Транзакции и идентификаторы">Раздел 74.1</a></td><td>нет</td></tr><tr><td><code class="literal">%x</code></td><td>Идентификатор транзакции (0 если не присвоен); см. <a class="xref" href="transaction-id.html" title="74.1. Транзакции и идентификаторы">Раздел 74.1</a></td><td>нет</td></tr><tr><td><code class="literal">%q</code></td><td>Ничего не выводит. Непользовательские процессы останавливаются в этой точке. Игнорируется пользовательскими процессами</td><td>нет</td></tr><tr><td><code class="literal">%Q</code></td><td>Идентификатор текущего запроса. Вычисление идентификаторов запроса по умолчанию отключено, поэтому в этом поле будет выводиться значение 0, если не включён параметр <a class="xref" href="runtime-config-statistics.html#GUC-COMPUTE-QUERY-ID">compute_query_id</a> или не настроен дополнительный модуль, вычисляющий идентификаторы запросов.</td><td>да</td></tr><tr><td><code class="literal">%%</code></td><td>Выводит <code class="literal">%</code></td><td>нет</td></tr></tbody></table></div><p>Тип обслуживающего процесса соответствует содержимому столбца <code class="structfield">backend_type</code> в представлении <a class="link" href="monitoring-stats.html#MONITORING-PG-STAT-ACTIVITY-VIEW" title="28.2.3. pg_stat_activity"><code class="structname">pg_stat_activity</code></a>, но в журнале могут фигурировать и другие типы, которые не показываются в этом представлении.</p><p>Спецпоследовательность <code class="literal">%c</code> заменяется на практически уникальный идентификатор сеанса, содержащий из 4 шестнадцатеричных чисел (без ведущих нулей), разделённых точками. Эти числа представляют время запуска процесса и его PID, так что <code class="literal">%c</code> можно использовать как более компактную альтернативу совокупности этих двух элементов. Чтобы получить такой идентификатор сеанса, например из <code class="literal">pg_stat_activity</code>, воспользуйтесь этим запросом: </p><pre class="programlisting">SELECT to_hex(trunc(EXTRACT(EPOCH FROM backend_start))::integer) || '.' ||
       to_hex(pid)
FROM pg_stat_activity;</pre><div class="tip"><h3 class="title">Подсказка</h3><p>Последним символом в <code class="varname">log_line_prefix</code> лучше оставлять пробел, чтобы отделить от остальной строки. Можно использовать и символы пунктуации.</p></div><div class="tip"><h3 class="title">Подсказка</h3><p><span class="application">Syslog</span> также формирует штамп времени и идентификатор процесса, поэтому вероятно нет смысла использовать соответствующие управляющие последовательности при использовании <span class="application">syslog</span>.</p></div><div class="tip"><h3 class="title">Подсказка</h3><p>Спецпоследовательность <code class="literal">%q</code> полезна для включения информации, которая существует только в контексте сеанса (обслуживающего процесса), например, имя пользователя или базы данных. Например: </p><pre class="programlisting">log_line_prefix = '%m [%p] %q%u@%d/%a '</pre></div><div class="note"><h3 class="title">Примечание</h3><p>Спецпоследовательность <code class="literal">%Q</code> всегда выдаёт нулевой идентификатор для строк, выводимых посредством <a class="xref" href="runtime-config-logging.html#GUC-LOG-STATEMENT">log_statement</a>, потому что соответствующий вывод <code class="varname">log_statement</code> формируется до вычисления этого идентификатора, в том числе и для некорректных операторов, для которых идентификатор вычислить нельзя.</p></div></dd><dt id="GUC-LOG-LOCK-WAITS"><span class="term"><code class="varname">log_lock_waits</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.12.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-LOCK-WAITS" class="id_link">#</a></dt><dd><p>Определяет, нужно ли фиксировать в журнале события, когда сеанс ожидает получения блокировки дольше, чем указано в <a class="xref" href="runtime-config-locks.html#GUC-DEADLOCK-TIMEOUT">deadlock_timeout</a>. Это позволяет выяснить, не связана ли низкая производительность с ожиданием блокировок. По умолчанию отключён. Только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code> могут изменить этот параметр.</p></dd><dt id="GUC-LOG-RECOVERY-CONFLICT-WAITS"><span class="term"><code class="varname">log_recovery_conflict_waits</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.13.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-RECOVERY-CONFLICT-WAITS" class="id_link">#</a></dt><dd><p>Определяет, нужно ли фиксировать в журнале события, когда сеанс ожидает получения блокировки дольше, чем указано в <code class="varname">deadlock_timeout</code> для конфликтов восстановления. Это позволяет выяснить, препятствуют ли конфликты восстановления применению WAL.</p><p>Значение по умолчанию — <code class="literal">off</code> (выкл.). Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt id="GUC-LOG-PARAMETER-MAX-LENGTH"><span class="term"><code class="varname">log_parameter_max_length</code> (<code class="type">integer</code>) <a id="id-1.6.7.11.5.3.14.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-PARAMETER-MAX-LENGTH" class="id_link">#</a></dt><dd><p>Положительное значение устанавливает количество байт, до которого будут усекаться значения привязанных SQL-параметров, выводимые в сообщениях вместе с SQL-операторами (это не относится к регистрации ошибок). Ноль отключает вывод значений привязанных параметров в таких сообщениях. Значение <code class="literal">-1</code> (по умолчанию) позволяет получить в журнале привязанные параметры в полном объёме. Если значение этого параметра задаётся без единиц измерения, оно считается заданным в байтах. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p><p>Этот параметр влияет только на сообщения, выводимые в журнал по критериям, которые устанавливают параметры <a class="xref" href="runtime-config-logging.html#GUC-LOG-STATEMENT">log_statement</a>, <a class="xref" href="runtime-config-logging.html#GUC-LOG-DURATION">log_duration</a> и связанные с ними. С ненулевыми значениями этого параметра сопряжены некоторые издержки, особенно если привязанные значения передаются в двоичной форме, так как их нужно будет переводить в текстовый вид.</p></dd><dt id="GUC-LOG-PARAMETER-MAX-LENGTH-ON-ERROR"><span class="term"><code class="varname">log_parameter_max_length_on_error</code> (<code class="type">integer</code>) <a id="id-1.6.7.11.5.3.15.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-PARAMETER-MAX-LENGTH-ON-ERROR" class="id_link">#</a></dt><dd><p>Положительное значение устанавливает количество байт, до которого будут усекаться значения привязанных SQL-параметров, выводимые вместе с SQL-операторами при регистрации ошибок. Нулевое значение отключает вывод значений привязанных операторов в сообщениях об ошибках. Значение <code class="literal">-1</code> (по умолчанию) позволяет получить в журнале привязанные параметры в полном объёме. Если значение этого параметра задаётся без единиц измерения, оно считается заданным в байтах.</p><p>С ненулевыми значениями этого параметра сопряжены некоторые издержки, так как <span class="productname">PostgreSQL</span> должен будет сформировать в памяти текстовые представления всех значений параметров перед выполнением всех операторов, в том числе, выполненных в итоге без ошибок. Издержки дополнительно возрастают, когда привязанные параметры передаются не в текстовой, а в двоичной форме, так как их недостаточно просто скопировать в строку, их нужно ещё преобразовать.</p></dd><dt id="GUC-LOG-STATEMENT"><span class="term"><code class="varname">log_statement</code> (<code class="type">enum</code>) <a id="id-1.6.7.11.5.3.16.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-STATEMENT" class="id_link">#</a></dt><dd><p>Управляет тем, какие SQL-команды записывать в журнал. Допустимые значения: <code class="literal">none</code> (отключено), <code class="literal">ddl</code>, <code class="literal">mod</code> и <code class="literal">all</code> (все команды). <code class="literal">ddl</code> записывает все команды определения данных, такие как <code class="command">CREATE</code>, <code class="command">ALTER</code>, <code class="command">DROP</code>. <code class="literal">mod</code> записывает все команды <code class="literal">ddl</code>, а также команды изменяющие данные, такие как <code class="command">INSERT</code>, <code class="command">UPDATE</code>, <code class="command">DELETE</code>, <code class="command">TRUNCATE</code> и <code class="command">COPY FROM</code>. <code class="command">PREPARE</code>, <code class="command">EXECUTE</code> и <code class="command">EXPLAIN ANALYZE</code> также записываются, если вызваны для команды соответствующего типа. Если клиент использует расширенный протокол запросов, то запись происходит на фазе выполнения и содержит значения всех связанных переменных (если есть символы одиночных кавычек, то они дублируются).</p><p>По умолчанию <code class="literal">none</code>. Только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code> могут изменить этот параметр.</p><div class="note"><h3 class="title">Примечание</h3><p>Команды с синтаксическими ошибками не записываются, даже если <code class="varname">log_statement</code> = <code class="literal">all</code>, так как сообщение формируется только после выполнения предварительного разбора, определяющего тип команды. При расширенном протоколе запросов, похожим образом не будут записываться команды, неуспешно завершившиеся до фазы выполнения (например, при разборе или построении плана запроса). Для включения в журнал таких команд установите <code class="varname">log_min_error_statement</code> в <code class="literal">ERROR</code> (или ниже).</p><p>Записываемые в журнал команды могут раскрывать конфиденциальные данные и даже содержать незашифрованные пароли.</p></div></dd><dt id="GUC-LOG-REPLICATION-COMMANDS"><span class="term"><code class="varname">log_replication_commands</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.5.3.17.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-REPLICATION-COMMANDS" class="id_link">#</a></dt><dd><p>Включает запись в журнал сервера всех команд репликации. Подробнее о командах репликации можно узнать в <a class="xref" href="protocol-replication.html" title="55.4. Протокол потоковой репликации">Разделе 55.4</a>. Значение по умолчанию — <code class="literal">off</code>. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p></dd><dt id="GUC-LOG-TEMP-FILES"><span class="term"><code class="varname">log_temp_files</code> (<code class="type">integer</code>) <a id="id-1.6.7.11.5.3.18.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-TEMP-FILES" class="id_link">#</a></dt><dd><p>Управляет регистрацией в журнале имён и размеров временных файлов. Временные файлы могут использоваться для сортировки, хеширования и временного хранения результатов запросов. Когда этот параметр включён, при удалении временного файла информация о нём может записываться в журнал с указанием размера файла в байтах. При нулевом значении записывается информация обо всех файлах, а при положительном — о файлах, размер которых не меньше заданной величины. Если это значение задаётся без единиц измерения, оно считается заданным в килобайтах. Значение по умолчанию равно -1, то есть запись такой информации отключена. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p></dd><dt id="GUC-LOG-TIMEZONE"><span class="term"><code class="varname">log_timezone</code> (<code class="type">string</code>) <a id="id-1.6.7.11.5.3.19.1.3" class="indexterm"></a></span> <a href="#GUC-LOG-TIMEZONE" class="id_link">#</a></dt><dd><p>Устанавливает часовой пояс для штампов времени при записи в журнал сервера. В отличие от <a class="xref" href="runtime-config-client.html#GUC-TIMEZONE">TimeZone</a>, это значение одинаково для всех баз данных кластера, поэтому для всех сеансов используются согласованные значения штампов времени. Встроенное значение по умолчанию <code class="literal">GMT</code>, но оно переопределяется в <code class="filename">postgresql.conf</code>: <span class="application">initdb</span> записывает в него значение, соответствующее системной среде. Подробнее об этом в <a class="xref" href="datatype-datetime.html#DATATYPE-TIMEZONES" title="8.5.3. Часовые пояса">Подразделе 8.5.3</a>. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-LOGGING-CSVLOG"><div class="titlepage"><div><div><h3 class="title">20.8.4. Использование вывода журнала в формате CSV <a href="#RUNTIME-CONFIG-LOGGING-CSVLOG" class="id_link">#</a></h3></div></div></div><p>Добавление <code class="literal">csvlog</code> в <code class="varname">log_destination</code> делает удобным загрузку журнальных файлов в таблицу базы данных. Строки журнала представляют собой значения, разделённые запятыми (формат <acronym class="acronym">CSV</acronym>), со следующими полями: штамп времени с миллисекундами; имя пользователя; имя базы данных; идентификатор процесса; клиентский узел:номер порта; идентификатор сеанса; номер строки каждого сеанса; тег команды; время начала сеанса; виртуальный идентификатор транзакции; идентификатор транзакции; уровень важности ошибки; код ошибки SQLSTATE; сообщение об ошибке; подробности к сообщению об ошибке; подсказка к сообщению об ошибке; внутренний запрос, приведший к ошибке (если есть); номер символа внутреннего запроса, где произошла ошибка; контекст ошибки; запрос пользователя, приведший к ошибке (если есть и включён <code class="varname">log_min_error_statement</code>); номер символа в запросе пользователя, где произошла ошибка; расположение ошибки в исходном коде PostgreSQL (если <code class="varname">log_error_verbosity</code> установлен в <code class="literal">verbose</code>), имя приложения, тип обслуживающего процесса, идентификатор ведущего процесса группы и идентификатор запроса. Вот пример определения таблицы, для хранения журналов в формате CSV: </p><pre class="programlisting">CREATE TABLE postgres_log
(
  log_time timestamp(3) with time zone,
  user_name text,
  database_name text,
  process_id integer,
  connection_from text,
  session_id text,
  session_line_num bigint,
  command_tag text,
  session_start_time timestamp with time zone,
  virtual_transaction_id text,
  transaction_id bigint,
  error_severity text,
  sql_state_code text,
  message text,
  detail text,
  hint text,
  internal_query text,
  internal_query_pos integer,
  context text,
  query text,
  query_pos integer,
  location text,
  application_name text,
  backend_type text,
  leader_pid integer,
  query_id bigint,
  PRIMARY KEY (session_id, session_line_num)
);</pre><p>Для загрузки журнального файла в такую таблицу можно использовать команду <code class="command">COPY FROM</code>: </p><pre class="programlisting">COPY postgres_log FROM '/full/path/to/logfile.csv' WITH csv;</pre><p> Также можно обратиться к этому файлу как к сторонней таблице, используя поставляемый модуль <a class="xref" href="file-fdw.html" title="F.16. file_fdw — обращение к файлам данных в файловой системе сервера">file_fdw</a>.</p><p>Для упрощения загрузки журналов в CSV формате используйте следующее: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Установите для <code class="varname">log_filename</code> и <code class="varname">log_rotation_age</code> значения, гарантирующие согласованную и предсказуемую схему именования журнальных файлов. Зная, какие имена будут у журнальных файлов, можно определить, когда конкретный файл заполнен и готов к загрузке.</p></li><li class="listitem"><p>Установите <code class="varname">log_rotation_size</code> в 0, чтобы запретить ротацию файлов по достижении определённого размера, так как это делает непредсказуемой схему именования журнальных файлов.</p></li><li class="listitem"><p>Установите <code class="varname">log_truncate_on_rotation</code> в <code class="literal">on</code>, чтобы новые сообщения не смешивались со старыми при переключении на существующий файл.</p></li><li class="listitem"><p>Определение таблицы содержит первичный ключ. Это полезно для предотвращения случайной повторной загрузки данных. Команда <code class="command">COPY</code> фиксирует изменения один раз, поэтому любая ошибка приведёт к отмене всей загрузки. Если сначала загрузить неполный журнальный файл, то его повторная загрузка (по заполнении) приведёт к нарушению первичного ключа и, следовательно, к ошибке загрузки. Поэтому необходимо дожидаться окончания записи в журнальный файл перед началом загрузки. Похожим образом предотвращается случайная загрузка частично сформированной строки сообщения, что также приведёт к сбою в команде <code class="command">COPY</code>.</p></li></ol></div></div><div class="sect2" id="RUNTIME-CONFIG-LOGGING-JSONLOG"><div class="titlepage"><div><div><h3 class="title">20.8.5. Использование вывода журнала в формате JSON <a href="#RUNTIME-CONFIG-LOGGING-JSONLOG" class="id_link">#</a></h3></div></div></div><p>Добавление <code class="literal">jsonlog</code> в список <code class="varname">log_destination</code> позволяет легко импортировать файлы журналов в различные программы. Когда выбран этот метод, строки журнала выводятся в формате <acronym class="acronym">JSON</acronym>.</p><p>В этом формате строковые поля, содержащие NULL, не выводятся. Описанный ниже набор полей не окончательный, в будущем могут появиться новые поля. При обработке вывода <code class="literal">jsonlog</code> в пользовательских приложениях поля, неизвестные для этих приложений, должны игнорироваться.</p><p>Каждая строка журнала сериализуется в виде объекта JSON с набором ключей и связанных с ними значений, перечисленных в <a class="xref" href="runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-JSONLOG-KEYS-VALUES" title="Таблица 20.3. Ключи и значения записей журнала в формате JSON">Таблица 20.3</a>.</p><div class="table" id="RUNTIME-CONFIG-LOGGING-JSONLOG-KEYS-VALUES"><p class="title"><strong>Таблица 20.3. Ключи и значения записей журнала в формате JSON</strong></p><div class="table-contents"><table class="table" summary="Ключи и значения записей журнала в формате JSON" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>Имя ключа</th><th>Тип</th><th>Описание</th></tr></thead><tbody><tr><td><code class="literal">timestamp</code></td><td>строка</td><td>Штамп времени, с миллисекундами</td></tr><tr><td><code class="literal">user</code></td><td>строка</td><td>Имя пользователя</td></tr><tr><td><code class="literal">dbname</code></td><td>строка</td><td>Имя базы данных</td></tr><tr><td><code class="literal">pid</code></td><td>число</td><td>Идентификатор процесса</td></tr><tr><td><code class="literal">remote_host</code></td><td>строка</td><td>Компьютер клиента</td></tr><tr><td><code class="literal">remote_port</code></td><td>число</td><td>Порт клиента</td></tr><tr><td><code class="literal">session_id</code></td><td>строка</td><td>Идентификатор сеанса</td></tr><tr><td><code class="literal">line_num</code></td><td>число</td><td>Номер строки внутри сеанса</td></tr><tr><td><code class="literal">ps</code></td><td>строка</td><td>Текущая строка для ps</td></tr><tr><td><code class="literal">session_start</code></td><td>строка</td><td>Время начала сеанса</td></tr><tr><td><code class="literal">vxid</code></td><td>строка</td><td>Идентификатор виртуальной транзакции</td></tr><tr><td><code class="literal">txid</code></td><td>строка</td><td>Идентификатор обычной транзакции</td></tr><tr><td><code class="literal">error_severity</code></td><td>строка</td><td>Уровень ошибки</td></tr><tr><td><code class="literal">state_code</code></td><td>строка</td><td>Код SQLSTATE</td></tr><tr><td><code class="literal">message</code></td><td>строка</td><td>Сообщение об ошибке</td></tr><tr><td><code class="literal">detail</code></td><td>строка</td><td>Подробное сообщение об ошибке</td></tr><tr><td><code class="literal">hint</code></td><td>строка</td><td>Подсказка, связанная с ошибкой</td></tr><tr><td><code class="literal">internal_query</code></td><td>строка</td><td>Внутренний запрос, вызвавший ошибку</td></tr><tr><td><code class="literal">internal_position</code></td><td>число</td><td>Положение курсора в тексте внутреннего запроса</td></tr><tr><td><code class="literal">context</code></td><td>строка</td><td>Контекст ошибки</td></tr><tr><td><code class="literal">statement</code></td><td>строка</td><td>Строка запроса, предоставленная клиентом</td></tr><tr><td><code class="literal">cursor_position</code></td><td>число</td><td>Положение курсора в строке запроса</td></tr><tr><td><code class="literal">func_name</code></td><td>строка</td><td>Имя функции, в которой произошла ошибка</td></tr><tr><td><code class="literal">file_name</code></td><td>строка</td><td>Имя файла, в котором произошла ошибка</td></tr><tr><td><code class="literal">file_line_num</code></td><td>число</td><td>Номер строки в файле, где произошла ошибка</td></tr><tr><td><code class="literal">application_name</code></td><td>строка</td><td>Имя клиентского приложения</td></tr><tr><td><code class="literal">backend_type</code></td><td>строка</td><td>Тип обслуживающего процесса</td></tr><tr><td><code class="literal">leader_pid</code></td><td>число</td><td>Идентификатор ведущего процесса группы параллельных исполнителей</td></tr><tr><td><code class="literal">query_id</code></td><td>число</td><td>Идентификатор запроса</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="RUNTIME-CONFIG-LOGGING-PROC-TITLE"><div class="titlepage"><div><div><h3 class="title">20.8.6. Заголовок процесса <a href="#RUNTIME-CONFIG-LOGGING-PROC-TITLE" class="id_link">#</a></h3></div></div></div><p>Эти параметры влияют на то, как формируются заголовки серверных процессов. Заголовок процесса обычно можно наблюдать в программах типа <span class="application">ps</span>, а в Windows — в <span class="application">Process Explorer</span>. За подробностями обратитесь к <a class="xref" href="monitoring-ps.html" title="28.1. Стандартные инструменты Unix">Разделу 28.1</a>.</p><div class="variablelist"><dl class="variablelist"><dt id="GUC-CLUSTER-NAME"><span class="term"><code class="varname">cluster_name</code> (<code class="type">string</code>) <a id="id-1.6.7.11.8.3.1.1.3" class="indexterm"></a></span> <a href="#GUC-CLUSTER-NAME" class="id_link">#</a></dt><dd><p>Задаёт имя, которое идентифицирует данный кластер (экземпляр сервера) для различных целей. Имя кластера выводится в заголовке процесса для всех серверных процессов в данном кластере. Более того, это имя будет именем приложения по умолчанию, используемым при подключении ведомого сервера (см. <a class="xref" href="runtime-config-replication.html#GUC-SYNCHRONOUS-STANDBY-NAMES">synchronous_standby_names</a>.)</p><p>Это имя может быть любой строкой не длиннее <code class="symbol">NAMEDATALEN</code> символов (64 символа в стандартной сборке). В строке <code class="varname">cluster_name</code> могут использоваться только печатаемые ASCII-символы. Остальные символы заменяются <a class="link" href="sql-syntax-lexical.html#SQL-SYNTAX-STRINGS-ESCAPE" title="4.1.2.2. Строковые константы со спецпоследовательностями в стиле C">шестнадцатеричными спецсимволами в стиле C</a>. Если этот параметр содержит пустую строку <code class="literal">''</code> (это значение по умолчанию), никакое имя не выводится. Этот параметр можно задать только при запуске сервера.</p></dd><dt id="GUC-UPDATE-PROCESS-TITLE"><span class="term"><code class="varname">update_process_title</code> (<code class="type">boolean</code>) <a id="id-1.6.7.11.8.3.2.1.3" class="indexterm"></a></span> <a href="#GUC-UPDATE-PROCESS-TITLE" class="id_link">#</a></dt><dd><p>Включает изменение заголовка процесса при получении сервером каждой очередной команды SQL. На большинстве платформ он включён (имеет значение <code class="literal">on</code>), но в Windows по умолчанию выключен (<code class="literal">off</code>) ввиду больших издержек на изменение этого заголовка. Изменить этот параметр могут только суперпользователи и пользователи с соответствующим правом <code class="literal">SET</code>.</p></dd></dl></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-query.html" title="20.7. Планирование запросов">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html" title="Глава 20. Настройка сервера">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-statistics.html" title="20.9. Статистика времени выполнения">След.</a></td></tr><tr><td width="40%" align="left" valign="top">20.7. Планирование запросов </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 20.9. Статистика времени выполнения</td></tr></table></div></body></html>