<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>45.5. Доверенный и недоверенный PL/Perl</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="plperl-global.html" title="45.4. Глобальные значения в PL/Perl" /><link rel="next" href="plperl-triggers.html" title="45.6. Триггеры на PL/Perl" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">45.5. Доверенный и недоверенный PL/Perl</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="plperl-global.html" title="45.4. Глобальные значения в PL/Perl">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="plperl.html" title="Глава 45. PL/Perl — процедурный язык Perl">Наверх</a></td><th width="60%" align="center">Глава 45. PL/Perl — процедурный язык Perl</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="plperl-triggers.html" title="45.6. Триггеры на PL/Perl">След.</a></td></tr></table><hr /></div><div class="sect1" id="PLPERL-TRUSTED"><div class="titlepage"><div><div><h2 class="title" style="clear: both">45.5. Доверенный и недоверенный PL/Perl <a href="#PLPERL-TRUSTED" class="id_link">#</a></h2></div></div></div><a id="id-1.8.10.13.2" class="indexterm"></a><p>Обычно PL/Perl устанавливается в базу данных как <span class="quote">«<span class="quote">доверенный</span>»</span> язык программирования с именем <code class="literal">plperl</code>. При этом в целях безопасности определённые операции в Perl запрещаются. Вообще говоря, запрещаются все операции, взаимодействующие с окружением. В том числе, это операции с файлами, <code class="literal">require</code> и <code class="literal">use</code> (для внешних модулей). Поэтому функции на PL/Perl, в отличие от функций на C, никаким образом не могут взаимодействовать с внутренними механизмами сервера баз данных или обращаться к операционной системе с правами серверного процесса. Вследствие этого, использовать этот язык можно разрешить любому непривилегированному пользователю баз данных.</p><p>В следующем примере показана функция, которая не будет работать, потому что операции с файловой системы запрещены по соображениям безопасности: </p><pre class="programlisting">CREATE FUNCTION badfunc() RETURNS integer AS $$
    my $tmpfile = "/tmp/badfile";
    open my $fh, '&gt;', $tmpfile
        or elog(ERROR, qq{could not open the file "$tmpfile": $!});
    print $fh "Testing writing to a file\n";
    close $fh or elog(ERROR, qq{could not close the file "$tmpfile": $!});
    return 1;
$$ LANGUAGE plperl;</pre><p> Создать эту функцию не удастся, так как при проверке её правильности будет обнаружено использование запрещённого оператора.</p><p>Иногда возникает желание написать на Perl код, функциональность которого не будет ограничиваться. Например, может потребоваться функция на Perl, которая будет посылать почту. Для таких потребностей PL/Perl также можно установить как <span class="quote">«<span class="quote">недоверенный</span>»</span> язык (обычно его называют <span class="application">PL/PerlU</span><a id="id-1.8.10.13.5.3" class="indexterm"></a>). В этом случае будут доступны все возможности языка Perl. Устанавливая язык, укажите имя <code class="literal">plperlu</code>, чтобы выбрать недоверенную вариацию PL/Perl.</p><p>Автор функции на <span class="application">PL/PerlU</span> должен позаботиться о том, чтобы эту функцию нельзя было использовать не по назначению, так как она может делать всё, что может пользователь с правами администратора баз данных. Заметьте, что СУБД позволяет создавать функции на недоверенных языках только суперпользователям базы данных.</p><p>Если показанная выше функция будет создана суперпользователем, и при этом будет выбран язык <code class="literal">plperlu</code>, она выполнится успешно.</p><p>Таким же образом, в анонимном блоке кода на Perl разрешены абсолютно любые операции, если в качестве языка вместо <code class="literal">plperl</code> выбирается <code class="literal">plperlu</code>, но выполнять этот код должен суперпользователь.</p><div class="note"><h3 class="title">Примечание</h3><p>Тогда как функции на <span class="application">PL/Perl</span> исполняются отдельными интерпретаторами Perl для каждой роли SQL, все функции на <span class="application">PL/PerlU</span>, вызываемые в рамках сеанса, исполняются в одном интерпретаторе Perl (отличном от тех, что исполняют функции <span class="application">PL/Perl</span>). Благодаря этому, функции <span class="application">PL/PerlU</span> могут свободно разделять общие данные, но между функциями <span class="application">PL/Perl</span> и <span class="application">PL/PerlU</span> взаимодействие невозможно.</p></div><div class="note"><h3 class="title">Примечание</h3><p>Perl поддерживает работу нескольких интерпретаторов в одном процессе, только если он был собран с нужными флагами, а именно, с флагом <code class="literal">usemultiplicity</code> или с флагом <code class="literal">useithreads</code>. (В отсутствие веских причин использовать потоки предпочтительным является вариант <code class="literal">usemultiplicity</code>. Дополнительную информацию вы можете получить на странице man <span class="citerefentry"><span class="refentrytitle">perlembed</span></span>.) При использовании <span class="application">PL/Perl</span> с версией Perl, собранной без этих флагов, в рамках сеанса можно будет запустить только один интерпретатор Perl, так что в сеансе будет возможно выполнять либо функции <span class="application">PL/PerlU</span>, либо функции <span class="application">PL/Perl</span> (и вызывать их должна одна роль SQL).</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="plperl-global.html" title="45.4. Глобальные значения в PL/Perl">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="plperl.html" title="Глава 45. PL/Perl — процедурный язык Perl">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="plperl-triggers.html" title="45.6. Триггеры на PL/Perl">След.</a></td></tr><tr><td width="40%" align="left" valign="top">45.4. Глобальные значения в PL/Perl </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 45.6. Триггеры на PL/Perl</td></tr></table></div></body></html>