<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.35. pg_trgm — поддержка определения схожести текста на основе триграмм</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="pgsurgery.html" title="F.34. pg_surgery — проведение операций низкого уровня с данными отношений" /><link rel="next" href="pgvisibility.html" title="F.36. pg_visibility — информация из карты видимости и вспомогательные функции" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.35. pg_trgm — поддержка определения схожести текста на основе триграмм</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="pgsurgery.html" title="F.34. pg_surgery — проведение операций низкого уровня с данными отношений">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><th width="60%" align="center">Приложение F. Дополнительно поставляемые модули и расширения</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="pgvisibility.html" title="F.36. pg_visibility — информация из карты видимости и вспомогательные функции">След.</a></td></tr></table><hr /></div><div class="sect1" id="PGTRGM"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.35. pg_trgm — поддержка определения схожести текста на основе триграмм <a href="#PGTRGM" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="pgtrgm.html#PGTRGM-CONCEPTS">F.35.1. Понятия, связанные с триграммами (или триграфами)</a></span></dt><dt><span class="sect2"><a href="pgtrgm.html#PGTRGM-FUNCS-OPS">F.35.2. Функции и операторы</a></span></dt><dt><span class="sect2"><a href="pgtrgm.html#PGTRGM-GUC">F.35.3. Параметры GUC</a></span></dt><dt><span class="sect2"><a href="pgtrgm.html#PGTRGM-INDEX">F.35.4. Поддержка индексов</a></span></dt><dt><span class="sect2"><a href="pgtrgm.html#PGTRGM-TEXT-SEARCH">F.35.5. Интеграция с текстовым поиском</a></span></dt><dt><span class="sect2"><a href="pgtrgm.html#PGTRGM-REFERENCES">F.35.6. Ссылки</a></span></dt><dt><span class="sect2"><a href="pgtrgm.html#PGTRGM-AUTHORS">F.35.7. Авторы</a></span></dt></dl></div><a id="id-1.11.7.45.2" class="indexterm"></a><p>Модуль <code class="filename">pg_trgm</code> предоставляет функции и операторы для определения схожести алфавитно-цифровых строк на основе триграмм, а также классы операторов индексов, поддерживающие быстрый поиск схожих строк.</p><p>Данный модуль считается <span class="quote">«<span class="quote">доверенным</span>»</span>, то есть его могут устанавливать обычные пользователи, имеющие право <code class="literal">CREATE</code> в текущей базе данных.</p><div class="sect2" id="PGTRGM-CONCEPTS"><div class="titlepage"><div><div><h3 class="title">F.35.1. Понятия, связанные с триграммами (или триграфами) <a href="#PGTRGM-CONCEPTS" class="id_link">#</a></h3></div></div></div><p>Триграмма — это группа трёх последовательных символов, взятых из строки. Мы можем измерить схожесть двух строк, подсчитав число триграмм, которые есть в обеих. Эта простая идея оказывается очень эффективной для измерения схожести слов на многих естественных языках.</p><div class="note"><h3 class="title">Примечание</h3><p><code class="filename">pg_trgm</code>, извлекая триграммы из строк, игнорирует символы, не относящиеся к словам (не алфавитно-цифровые). При выделении триграмм, содержащихся в строке, считается, что перед каждым словом находятся два пробела, а после — один пробел. Например, из строки <span class="quote">«<span class="quote"><code class="literal">cat</code></span>»</span> выделяется набор триграмм: <span class="quote">«<span class="quote"><code class="literal"> c</code></span>»</span>, <span class="quote">«<span class="quote"><code class="literal"> ca</code></span>»</span>, <span class="quote">«<span class="quote"><code class="literal">cat</code></span>»</span> и <span class="quote">«<span class="quote"><code class="literal">at </code></span>»</span>. Из строки <span class="quote">«<span class="quote"><code class="literal">foo|bar</code></span>»</span> выделяются триграммы: <span class="quote">«<span class="quote"><code class="literal"> f</code></span>»</span>, <span class="quote">«<span class="quote"><code class="literal"> fo</code></span>»</span>, <span class="quote">«<span class="quote"><code class="literal">foo</code></span>»</span>, <span class="quote">«<span class="quote"><code class="literal">oo </code></span>»</span>, <span class="quote">«<span class="quote"><code class="literal"> b</code></span>»</span>, <span class="quote">«<span class="quote"><code class="literal"> ba</code></span>»</span>, <span class="quote">«<span class="quote"><code class="literal">bar</code></span>»</span> и <span class="quote">«<span class="quote"><code class="literal">ar </code></span>»</span>.</p></div></div><div class="sect2" id="PGTRGM-FUNCS-OPS"><div class="titlepage"><div><div><h3 class="title">F.35.2. Функции и операторы <a href="#PGTRGM-FUNCS-OPS" class="id_link">#</a></h3></div></div></div><p>Реализованные в модуле <code class="filename">pg_trgm</code> функции перечислены в <a class="xref" href="pgtrgm.html#PGTRGM-FUNC-TABLE" title="Таблица F.26. Функции pg_trgm">Таблице F.26</a>, а операторы — в <a class="xref" href="pgtrgm.html#PGTRGM-OP-TABLE" title="Таблица F.27. Операторы pg_trgm">Таблице F.27</a>.</p><div class="table" id="PGTRGM-FUNC-TABLE"><p class="title"><strong>Таблица F.26. Функции <code class="filename">pg_trgm</code></strong></p><div class="table-contents"><table class="table" summary="Функции pg_trgm" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.45.6.3.2.2.1.1.1.1" class="indexterm"></a> <code class="function">similarity</code> ( <code class="type">text</code>, <code class="type">text</code> ) → <code class="returnvalue">real</code></p>
       <p>Возвращает число, показывающее, насколько близки два аргумента. Диапазон результатов — от нуля (это значение указывает, что две строки полностью различны) до одного (это значение указывает, что две строки идентичны).</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.45.6.3.2.2.2.1.1.1" class="indexterm"></a> <code class="function">show_trgm</code> ( <code class="type">text</code> ) → <code class="returnvalue">text[]</code></p>
       <p>Возвращает массив всех триграмм в заданной строке. (На практике это редко бывает полезно, кроме как для отладки.)</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.45.6.3.2.2.3.1.1.1" class="indexterm"></a> <code class="function">word_similarity</code> ( <code class="type">text</code>, <code class="type">text</code> ) → <code class="returnvalue">real</code></p>
       <p>Возвращает число, представляющее наибольшую степень схожести между набором триграмм в первой строке и любым непрерывным фрагментом упорядоченного набора триграмм во второй строке. Подробнее об этом рассказывается ниже.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.45.6.3.2.2.4.1.1.1" class="indexterm"></a> <code class="function">strict_word_similarity</code> ( <code class="type">text</code>, <code class="type">text</code> ) → <code class="returnvalue">real</code></p>
       <p>Подобна <code class="function">word_similarity</code>, но подгоняет границы фрагментов к границам слов. Так как триграммы не пересекают слова, эта функция фактически выдаёт наибольшую степень схожести между первой строкой и любой непрерывной последовательностью слов во второй строке.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.45.6.3.2.2.5.1.1.1" class="indexterm"></a> <code class="function">show_limit</code> () → <code class="returnvalue">real</code></p>
       <p>Возвращает текущий порог схожести, который использует оператор <code class="literal">%</code>. Это значение задаёт минимальную схожесть между двумя словами, при которой они считаются настолько близкими, что одно может быть, например, ошибочным написанием другого (<span class="emphasis"><em>Устаревшая</em></span> функция; используйте вместо неё <code class="command">SHOW</code> <code class="varname">pg_trgm.similarity_threshold</code>.)</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.45.6.3.2.2.6.1.1.1" class="indexterm"></a> <code class="function">set_limit</code> ( <code class="type">real</code> ) → <code class="returnvalue">real</code></p>
       <p>Задаёт текущий порог схожести, который использует оператор <code class="literal">%</code>. Это значение должно быть в диапазоне от 0 до 1 (по умолчанию 0.3). Возвращает то же значение, что было передано на вход. (<span class="emphasis"><em>Устаревшая</em></span> функция; используйте вместо неё <code class="command">SET</code> <code class="varname">pg_trgm.similarity_threshold</code>.)</p></td></tr></tbody></table></div></div><br class="table-break" /><p>Рассмотрим следующий пример: </p><pre class="programlisting"># SELECT word_similarity('word', 'two words');
 word_similarity
-----------------
             0.8
(1 row)</pre><p> Набор триграмм для первой строки: <code class="literal">{" w"," wo","wor","ord","rd "}</code>. Во второй строке упорядоченный набор триграмм: <code class="literal">{" t"," tw","two","wo "," w"," wo","wor","ord","rds","ds "}</code>. Наиболее близкий фрагмент упорядоченного множества триграмм во второй строке: <code class="literal">{" w"," wo","wor","ord"}</code>, а коэффициент схожести равен <code class="literal">0.8</code>.</p><p>Эта функция возвращает значение, которое можно примерно воспринимать как максимальную оценку схожести первой строки с любой подстрокой второй строки. Данная функция не добавляет пробелы к границам фрагмента, поэтому совпадение с отдельным словом оценивается выше, чем совпадение с частью слова.</p><p>При этом <code class="function">strict_word_similarity</code> выбирает последовательность слов во второй строке. В показанном выше примере <code class="function">strict_word_similarity</code> выберет последовательность из одного слова <code class="literal">'words'</code>, которой соответствуют триграммы <code class="literal">{" w"," wo","wor","ord","rds","ds "}</code>. </p><pre class="programlisting"># SELECT strict_word_similarity('word', 'two words'), similarity('word', 'words');
 strict_word_similarity | similarity
------------------------+------------
               0.571429 |   0.571429
(1 row)</pre><p>Таким образом, функция <code class="function">strict_word_similarity</code> полезна для определения схожести целых слов, а <code class="function">word_similarity</code> больше подходит для определения схожести частей слов.</p><div class="table" id="PGTRGM-OP-TABLE"><p class="title"><strong>Таблица F.27. Операторы <code class="filename">pg_trgm</code></strong></p><div class="table-contents"><table class="table" summary="Операторы pg_trgm" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Оператор</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">text</code> <code class="literal">%</code> <code class="type">text</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Возвращает <code class="literal">true</code>, если схожесть аргументов выше текущего порога, заданного параметром <code class="varname">pg_trgm.similarity_threshold</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">text</code> <code class="literal">&lt;%</code> <code class="type">text</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Возвращает <code class="literal">true</code>, если схожесть между набором триграмм в первом аргументе и непрерывным фрагментом упорядоченного набора триграмм во втором превышает уровень схожести, устанавливаемый параметром <code class="varname">pg_trgm.word_similarity_threshold</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">text</code> <code class="literal">%&gt;</code> <code class="type">text</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Коммутирующий оператор для <code class="literal">&lt;%</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">text</code> <code class="literal">&lt;&lt;%</code> <code class="type">text</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Возвращает <code class="literal">true</code>, если во втором аргументе имеется непрерывный фрагмент упорядоченного набора триграмм, соответствующего границам слов, и его схожесть с набором триграмм первого аргумента превышает уровень схожести, устанавливаемый параметром <code class="varname">pg_trgm.strict_word_similarity_threshold</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">text</code> <code class="literal">%&gt;&gt;</code> <code class="type">text</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>Коммутирующий оператор для <code class="literal">&lt;&lt;%</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">text</code> <code class="literal">&lt;-&gt;</code> <code class="type">text</code>
        → <code class="returnvalue">real</code>
       </p>
       <p>Возвращает <span class="quote">«<span class="quote">расстояние</span>»</span> между аргументами, то есть один минус значение <code class="function">similarity()</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">text</code> <code class="literal">&lt;&lt;-&gt;</code> <code class="type">text</code>
        → <code class="returnvalue">real</code>
       </p>
       <p>Возвращает <span class="quote">«<span class="quote">расстояние</span>»</span> между аргументами, то есть один минус значение <code class="function">word_similarity()</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">text</code> <code class="literal">&lt;-&gt;&gt;</code> <code class="type">text</code>
        → <code class="returnvalue">real</code>
       </p>
       <p>Коммутирующий оператор для <code class="literal">&lt;&lt;-&gt;</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">text</code> <code class="literal">&lt;&lt;&lt;-&gt;</code> <code class="type">text</code>
        → <code class="returnvalue">real</code>
       </p>
       <p>Возвращает <span class="quote">«<span class="quote">расстояние</span>»</span> между аргументами, то есть один минус значение <code class="function">strict_word_similarity()</code>.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">text</code> <code class="literal">&lt;-&gt;&gt;&gt;</code> <code class="type">text</code>
        → <code class="returnvalue">real</code>
       </p>
       <p>Коммутирующий оператор для <code class="literal">&lt;&lt;&lt;-&gt;</code>.</p></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="PGTRGM-GUC"><div class="titlepage"><div><div><h3 class="title">F.35.3. Параметры GUC <a href="#PGTRGM-GUC" class="id_link">#</a></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="GUC-PGTRGM-SIMILARITY-THRESHOLD"><span class="term"><code class="varname">pg_trgm.similarity_threshold</code> (<code class="type">real</code>) <a id="id-1.11.7.45.7.2.1.1.3" class="indexterm"></a></span> <a href="#GUC-PGTRGM-SIMILARITY-THRESHOLD" class="id_link">#</a></dt><dd><p>Задаёт текущий порог схожести, который использует оператор <code class="literal">%</code>. Это значение должно быть в диапазоне от 0 до 1 (по умолчанию 0.3).</p></dd><dt id="GUC-PGTRGM-WORD-SIMILARITY-THRESHOLD"><span class="term"><code class="varname">pg_trgm.word_similarity_threshold</code> (<code class="type">real</code>) <a id="id-1.11.7.45.7.2.2.1.3" class="indexterm"></a></span> <a href="#GUC-PGTRGM-WORD-SIMILARITY-THRESHOLD" class="id_link">#</a></dt><dd><p>Задаёт текущий порог схожести слов, который используют операторы <code class="literal">&lt;%</code> и <code class="literal">%&gt;</code>. Это значение должно быть в диапазоне от 0 до 1 (по умолчанию 0.6).</p></dd><dt id="GUC-PGTRGM-STRICT-WORD-SIMILARITY-THRESHOLD"><span class="term"><code class="varname">pg_trgm.strict_word_similarity_threshold</code> (<code class="type">real</code>) <a id="id-1.11.7.45.7.2.3.1.3" class="indexterm"></a></span> <a href="#GUC-PGTRGM-STRICT-WORD-SIMILARITY-THRESHOLD" class="id_link">#</a></dt><dd><p>Задаёт текущий порог схожести строго слов, который используют операторы <code class="literal">&lt;&lt;%</code> и <code class="literal">%&gt;&gt;</code>. Это значение должно быть в диапазоне от 0 до 1 (по умолчанию 0.5).</p></dd></dl></div></div><div class="sect2" id="PGTRGM-INDEX"><div class="titlepage"><div><div><h3 class="title">F.35.4. Поддержка индексов <a href="#PGTRGM-INDEX" class="id_link">#</a></h3></div></div></div><p>Модуль <code class="filename">pg_trgm</code> предоставляет классы операторов индексов GiST и GIN, позволяющие создавать индекс по текстовым столбцам для очень быстрого поиска по критерию схожести. Эти типы индексов поддерживают вышеописанные операторы схожести и дополнительно поддерживают поиск на основе триграмм для запросов с <code class="literal">LIKE</code>, <code class="literal">ILIKE</code>, <code class="literal">~</code>, <code class="literal">~*</code> и <code class="literal">=</code>. В стандартной сборке <code class="filename">pg_trgm</code> регистр при определении схожести не учитывается. Операторы неравенства не поддерживаются. Обратите внимание, что для операторов равенства эти индексы могут быть не так эффективны, как индексы-B-деревья.</p><p>Пример: </p><pre class="programlisting">CREATE TABLE test_trgm (t text);
CREATE INDEX trgm_idx ON test_trgm USING GIST (t gist_trgm_ops);</pre><p> или </p><pre class="programlisting">CREATE INDEX trgm_idx ON test_trgm USING GIN (t gin_trgm_ops);</pre><p>Класс операторов GiST <code class="literal">gist_trgm_ops</code> аппроксимирует набор триграмм в виде сигнатуры битовой карты. В его необязательном целочисленном параметре <code class="literal">siglen</code> можно задать размер сигнатуры в байтах. Параметр может принимать значения от 1 до 2024, по умолчанию он равен 12. При увеличении размера сигнатуры поиск работает точнее (сканируется меньшая область в индексе и меньше страниц кучи), но сам индекс становится больше.</p><p>Пример создания такого индекса с длиной сигнатуры 32 байта:</p><pre class="programlisting">CREATE INDEX trgm_idx ON test_trgm USING GIST (t gist_trgm_ops(siglen=32));</pre><p>На этот момент у вас будет индекс по столбцу <code class="structfield">t</code>, используя который можно осуществлять поиск по схожести. Пример типичного запроса: </p><pre class="programlisting">SELECT t, similarity(t, '<em class="replaceable"><code>слово</code></em>') AS sml
  FROM test_trgm
  WHERE t % '<em class="replaceable"><code>слово</code></em>'
  ORDER BY sml DESC, t;</pre><p> Он выдаст все значения в текстовом столбце, которые достаточно схожи со словом <em class="replaceable"><code>word</code></em>, в порядке сортировки от наиболее к наименее схожим. Благодаря использованию индекса, эта операция будет быстрой даже с очень большими наборами данных.</p><p>Другой вариант предыдущего запроса: </p><pre class="programlisting">SELECT t, t &lt;-&gt; '<em class="replaceable"><code>слово</code></em>' AS dist
  FROM test_trgm
  ORDER BY dist LIMIT 10;</pre><p> Он может быть довольно эффективно выполнен с применением индексов GiST, а не GIN. Обычно он выигрышнее первого варианта только когда требуется получить небольшое количество близких совпадений.</p><p>Также вы можете использовать индекс по столбцу <code class="structfield">t</code> для оценки схожести слов условных и оценки схожести слов в строгом смысле. Примеры типичных запросов: </p><pre class="programlisting">SELECT t, word_similarity('<em class="replaceable"><code>слово</code></em>', t) AS sml
  FROM test_trgm
  WHERE '<em class="replaceable"><code>слово</code></em>' &lt;% t
  ORDER BY sml DESC, t;</pre><p> и </p><pre class="programlisting">SELECT t, strict_word_similarity('<em class="replaceable"><code>слово</code></em>', t) AS sml
  FROM test_trgm
  WHERE '<em class="replaceable"><code>слово</code></em>' &lt;&lt;% t
  ORDER BY sml DESC, t;</pre><p> В результате будут возвращены все значения в текстовом столбце, для которых найдется непрерывный фрагмент в упорядоченном наборе триграмм, достаточно схожий с набором триграмм строки <em class="replaceable"><code>слово</code></em>. Данные значения будут отсортированы по порядку от наиболее к наименее схожим. Этот индекс позволит ускорить поиск даже с очень большим объёмом данных.</p><p>Другие возможные варианты предыдущих запросов: </p><pre class="programlisting">SELECT t, '<em class="replaceable"><code>слово</code></em>' &lt;&lt;-&gt; t AS dist
  FROM test_trgm
  ORDER BY dist LIMIT 10;</pre><p> и </p><pre class="programlisting">SELECT t, '<em class="replaceable"><code>слово</code></em>' &lt;&lt;&lt;-&gt; t AS dist
  FROM test_trgm
  ORDER BY dist LIMIT 10;</pre><p> Они могут быть довольно эффективно выполнены с применением индексов GiST, а не GIN.</p><p>Начиная с <span class="productname">PostgreSQL</span> 9.1, эти типы индексов также поддерживают поиск с операторами <code class="literal">LIKE</code> и <code class="literal">ILIKE</code>, например: </p><pre class="programlisting">SELECT * FROM test_trgm WHERE t LIKE '%foo%bar';</pre><p> При таком поиске по индексу сначала из искомой строки извлекаются триграммы, а затем они ищутся в индексе. Чем больше триграмм оказывается в искомой строке, тем более эффективным будет поиск по индексу. В отличие от поиска по B-дереву, искомая строка не должна привязываться к левому краю.</p><p>Начиная с <span class="productname">PostgreSQL</span> 9.3, индексы этих типов также поддерживают поиск по регулярным выражениям (операторы <code class="literal">~</code> и <code class="literal">~*</code>), например: </p><pre class="programlisting">SELECT * FROM test_trgm WHERE t ~ '(foo|bar)';</pre><p> При таком поиске из регулярного выражения извлекаются триграммы, а затем они ищутся в индексе. Чем больше триграмм удаётся извлечь из регулярного выражения, тем более эффективным будет поиск по индексу. В отличие от поиска по B-дереву, искомая строка не должна привязываться к левому краю.</p><p>Относительно поиска по регулярному выражению или с <code class="literal">LIKE</code>, имейте в виду, что при отсутствии триграмм в искомом шаблоне поиск сводится к полному сканирования индекса.</p><p>Выбор между индексами GiST и GIN зависит от относительных характеристик производительности GiST и GIN, которые здесь не рассматриваются.</p></div><div class="sect2" id="PGTRGM-TEXT-SEARCH"><div class="titlepage"><div><div><h3 class="title">F.35.5. Интеграция с текстовым поиском <a href="#PGTRGM-TEXT-SEARCH" class="id_link">#</a></h3></div></div></div><p>Сопоставление триграмм — очень полезный приём в сочетании с применением полнотекстового индекса. В частности это может помочь найти слова, написанные неправильно, которые не будут находиться непосредственно механизмом полнотекстового поиска.</p><p>В первую очередь нужно построить дополнительную таблицу, содержащую все уникальные слова в документе: </p><pre class="programlisting">CREATE TABLE words AS SELECT word FROM
        ts_stat('SELECT to_tsvector(''simple'', bodytext) FROM documents');</pre><p> Здесь <code class="structname">documents</code> — это таблица с текстовым полем <code class="structfield">bodytext</code>, по которому мы будем выполнять поиск. Конфигурация <code class="literal">simple</code> используется с функцией <code class="function">to_tsvector</code> вместо конфигурации для определённого языка по той причине, что нам нужен список исходных (необработанных стеммером) слов.</p><p>Затем нужно создать индекс триграмм по столбцу со словами: </p><pre class="programlisting">CREATE INDEX words_idx ON words USING GIN (word gin_trgm_ops);</pre><p> Теперь мы можем использовать запрос <code class="command">SELECT</code>, подобный показанному в предыдущем примере, и предлагать варианты исправлений слов, введённых пользователем с ошибками. Кроме того, может быть полезно дополнительно проверить, что выбранные слова также имеют длину, примерно равную длине ошибочных слов.</p><div class="note"><h3 class="title">Примечание</h3><p>Так как таблица <code class="structname">words</code> была сформирована как отдельная статическая таблица, её нужно периодически обновлять, чтобы она достаточно хорошо соответствовала набору документов. Постоянно поддерживать её в полностью актуальном состоянии обычно не требуется.</p></div></div><div class="sect2" id="PGTRGM-REFERENCES"><div class="titlepage"><div><div><h3 class="title">F.35.6. Ссылки <a href="#PGTRGM-REFERENCES" class="id_link">#</a></h3></div></div></div><p>Сайт разработки GiST <a class="ulink" href="http://www.sai.msu.su/~megera/postgres/gist/" target="_top">http://www.sai.msu.su/~megera/postgres/gist/</a></p><p>Сайт разработки Tsearch2 <a class="ulink" href="http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/" target="_top">http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/</a></p></div><div class="sect2" id="PGTRGM-AUTHORS"><div class="titlepage"><div><div><h3 class="title">F.35.7. Авторы <a href="#PGTRGM-AUTHORS" class="id_link">#</a></h3></div></div></div><p>Олег Бартунов <code class="email">&lt;<a class="email" href="mailto:oleg@sai.msu.su">oleg@sai.msu.su</a>&gt;</code>, Москва, Московский Государственный Университет, Россия</p><p>Фёдор Сигаев <code class="email">&lt;<a class="email" href="mailto:teodor@sigaev.ru">teodor@sigaev.ru</a>&gt;</code>, Москва, ООО «Дельта-Софт», Россия</p><p>Александр Коротков <code class="email">&lt;<a class="email" href="mailto:a.korotkov@postgrespro.ru">a.korotkov@postgrespro.ru</a>&gt;</code>, Москва, Postgres Professional, Россия</p><p>Документация: Кристофер Кингс-Линн</p><p>Разработку этого модуля спонсировало ООО «Дельта-Софт», г. Москва, Россия.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pgsurgery.html" title="F.34. pg_surgery — проведение операций низкого уровня с данными отношений">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="pgvisibility.html" title="F.36. pg_visibility — информация из карты видимости и вспомогательные функции">След.</a></td></tr><tr><td width="40%" align="left" valign="top">F.34. pg_surgery — проведение операций низкого уровня с данными отношений </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> F.36. pg_visibility — информация из карты видимости и вспомогательные функции</td></tr></table></div></body></html>