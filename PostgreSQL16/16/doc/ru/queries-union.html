<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>7.4. Сочетание запросов (UNION, INTERSECT, EXCEPT)</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="queries-select-lists.html" title="7.3. Списки выборки" /><link rel="next" href="queries-order.html" title="7.5. Сортировка строк (ORDER BY)" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">7.4. Сочетание запросов (<code class="literal">UNION</code>, <code class="literal">INTERSECT</code>, <code class="literal">EXCEPT</code>)</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="queries-select-lists.html" title="7.3. Списки выборки">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="queries.html" title="Глава 7. Запросы">Наверх</a></td><th width="60%" align="center">Глава 7. Запросы</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="queries-order.html" title="7.5. Сортировка строк (ORDER BY)">След.</a></td></tr></table><hr /></div><div class="sect1" id="QUERIES-UNION"><div class="titlepage"><div><div><h2 class="title" style="clear: both">7.4. Сочетание запросов (<code class="literal">UNION</code>, <code class="literal">INTERSECT</code>, <code class="literal">EXCEPT</code>) <a href="#QUERIES-UNION" class="id_link">#</a></h2></div></div></div><a id="id-1.5.6.8.2" class="indexterm"></a><a id="id-1.5.6.8.3" class="indexterm"></a><a id="id-1.5.6.8.4" class="indexterm"></a><a id="id-1.5.6.8.5" class="indexterm"></a><a id="id-1.5.6.8.6" class="indexterm"></a><a id="id-1.5.6.8.7" class="indexterm"></a><a id="id-1.5.6.8.8" class="indexterm"></a><p>Результаты двух запросов можно обработать, используя операции над множествами: объединение, пересечение и вычитание. Эти операции записываются соответственно так: </p><pre class="synopsis">
<em class="replaceable"><code>запрос1</code></em> UNION [<span class="optional">ALL</span>] <em class="replaceable"><code>запрос2</code></em>
<em class="replaceable"><code>запрос1</code></em> INTERSECT [<span class="optional">ALL</span>] <em class="replaceable"><code>запрос2</code></em>
<em class="replaceable"><code>запрос1</code></em> EXCEPT [<span class="optional">ALL</span>] <em class="replaceable"><code>запрос2</code></em>
</pre><p> Здесь <em class="replaceable"><code>запрос1</code></em> и <em class="replaceable"><code>запрос2</code></em> — это запросы, в которых могут использоваться все возможности, рассмотренные до этого.</p><p><code class="literal">UNION</code> по сути добавляет результаты второго запроса к результатам первого (хотя никакой порядок возвращаемых строк при этом не гарантируется). Более того, эта операция убирает дублирующиеся строки из результата так же, как это делает <code class="literal">DISTINCT</code>, если только не указано <code class="literal">UNION ALL</code>.</p><p><code class="literal">INTERSECT</code> возвращает все строки, содержащиеся в результате и первого, и второго запроса. Дублирующиеся строки отфильтровываются, если не указано <code class="literal">ALL</code>.</p><p><code class="literal">EXCEPT</code> возвращает все строки, которые есть в результате первого запроса, но отсутствуют в результате второго. (Иногда это называют <em class="firstterm">разницей</em> двух запросов.) И здесь дублирующиеся строки отфильтровываются, если не указано <code class="literal">ALL</code>.</p><p>Чтобы можно было вычислить объединение, пересечение или разницу результатов двух запросов, эти запросы должны быть <span class="quote">«<span class="quote">совместимыми для объединения</span>»</span>, что означает, что они должны иметь одинаковое число столбцов и соответствующие столбцы должны быть совместимых типов, как описывается в <a class="xref" href="typeconv-union-case.html" title="10.5. UNION, CASE и связанные конструкции">Разделе 10.5</a>.</p><p>Операции над множествами можно объединять, например </p><pre class="synopsis">
<em class="replaceable"><code>запрос1</code></em> UNION <em class="replaceable"><code>запрос2</code></em> EXCEPT <em class="replaceable"><code>запрос3</code></em>
</pre><p> что равнозначно </p><pre class="synopsis">
(<em class="replaceable"><code>запрос1</code></em> UNION <em class="replaceable"><code>запрос2</code></em>) EXCEPT <em class="replaceable"><code>запрос3</code></em>
</pre><p> Как показано выше, вы можете использовать круглые скобки, чтобы управлять очередью обработки. Без круглых скобок <code class="literal">UNION</code> и <code class="literal">EXCEPT</code> объединяются слева направо, но оператор <code class="literal">INTERSECT</code> имеет больший приоритет, чем первые два. Таким образом, </p><pre class="synopsis">
<em class="replaceable"><code>запрос1</code></em> UNION <em class="replaceable"><code>запрос2</code></em> INTERSECT <em class="replaceable"><code>запрос3</code></em>
</pre><p> означает </p><pre class="synopsis">
<em class="replaceable"><code>запрос1</code></em> UNION (<em class="replaceable"><code>запрос2</code></em> INTERSECT <em class="replaceable"><code>запрос3</code></em>)
</pre><p> Вы также можете заключить отдельный <em class="replaceable"><code>запрос</code></em> в круглые скобки. Это важно, если в <em class="replaceable"><code>запросе</code></em> необходимо использовать любое из предложений, обсуждаемых в следующих разделах, например <code class="literal">LIMIT</code>. Без круглых скобок возникнет синтаксическая ошибка или предложение будет восприниматься как относящееся к результату операции над множествами, а не к её аргументам. Например, </p><pre class="synopsis">
SELECT a FROM b UNION SELECT x FROM y LIMIT 10
</pre><p> не вызовет ошибку, но будет означать </p><pre class="synopsis">
(SELECT a FROM b UNION SELECT x FROM y) LIMIT 10
</pre><p> а не </p><pre class="synopsis">
SELECT a FROM b UNION (SELECT x FROM y LIMIT 10)
</pre></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="queries-select-lists.html" title="7.3. Списки выборки">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="queries.html" title="Глава 7. Запросы">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="queries-order.html" title="7.5. Сортировка строк (ORDER BY)">След.</a></td></tr><tr><td width="40%" align="left" valign="top">7.3. Списки выборки </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 7.5. Сортировка строк (<code class="literal">ORDER BY</code>)</td></tr></table></div></body></html>