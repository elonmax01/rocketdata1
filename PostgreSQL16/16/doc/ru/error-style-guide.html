<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>56.3. Руководство по стилю сообщений об ошибках</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="error-message-reporting.html" title="56.2. Вывод сообщений об ошибках в коде сервера" /><link rel="next" href="source-conventions.html" title="56.4. Различные соглашения по оформлению кода" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">56.3. Руководство по стилю сообщений об ошибках</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="error-message-reporting.html" title="56.2. Вывод сообщений об ошибках в коде сервера">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="source.html" title="Глава 56. Соглашения по оформлению кода PostgreSQL">Наверх</a></td><th width="60%" align="center">Глава 56. Соглашения по оформлению кода PostgreSQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="source-conventions.html" title="56.4. Различные соглашения по оформлению кода">След.</a></td></tr></table><hr /></div><div class="sect1" id="ERROR-STYLE-GUIDE"><div class="titlepage"><div><div><h2 class="title" style="clear: both">56.3. Руководство по стилю сообщений об ошибках <a href="#ERROR-STYLE-GUIDE" class="id_link">#</a></h2></div></div></div><p>Это руководство по стилю предлагается в надежде обеспечить единообразный и понятный пользователю стиль для всех сообщений, которые выдаёт <span class="productname">PostgreSQL</span>.</p><div class="simplesect" id="ERROR-STYLE-GUIDE-WHAT-GOES-WHERE"><div class="titlepage"><div><div><h3 class="title">56.3.1. Что и куда выводить <a href="#ERROR-STYLE-GUIDE-WHAT-GOES-WHERE" class="id_link">#</a></h3></div></div></div><p>Основное сообщение должно быть кратким, фактологическим и, по возможности, не говорить о тонкостях реализации, например, не упоминать конкретные имена функций. Под <span class="quote">«<span class="quote">кратким</span>»</span> понимается <span class="quote">«<span class="quote">должно умещаться в одной строке при обычных условиях</span>»</span>. Дополнительное подробное сообщение добавляется, когда краткого сообщения недостаточно, или вы считаете, что нужно упомянуть какие-то внутренние детали, например, конкретный системный вызов, в котором произошла ошибка. И основное, и подробное сообщения должны сообщать исключительно факты. Чтобы предложить решение проблемы, особенно, если это решение может быть применимо не всегда, передайте его в сообщении-подсказке.</p><p>Например, вместо: </p><pre class="programlisting">IpcMemoryCreate: ошибка в shmget(ключ=%d, размер=%u, 0%o): %m
(плюс длинное дополнение, по сути представляющее собой подсказку)</pre><p> следует записать: </p><pre class="programlisting">Основное:    не удалось создать сегмент разделяемой памяти: %m
Подробное:   Ошибка в системном вызове shmget(key=%d, size=%u, 0%o).
Подсказка:   дополнительный текст</pre><p>Объяснение: когда основное сообщение достаточно краткое, клиенты могут выделить для него место на экране в предположении, что одной строки будет достаточно. Подробное сообщение и подсказка могут выводиться в режиме дополнительных сведений или, возможно, в разворачивающемся окне «ошибка-подробности». Кроме того, подробности и подсказки обычно не записываются в журнал сервера для сокращения его объёма. Детали реализации лучше опускать, так как пользователи не должны в них разбираться.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-FORMATTING"><div class="titlepage"><div><div><h3 class="title">56.3.2. Форматирование <a href="#ERROR-STYLE-GUIDE-FORMATTING" class="id_link">#</a></h3></div></div></div><p>Не полагайтесь на какое-либо определённое форматирование в тексте сообщений. Следует ожидать, что в клиентском интерфейсе и в журнале сервера длинные строки будут переноситься в зависимости от ситуации. В длинных сообщениях можно обозначить предполагаемые места разрыва абзацев символами новой строки (\n). Завершать сообщение этим символом не нужно. Также не используйте табуляции или другие символы форматирования. (При выводе контекста ошибок автоматически добавляются символы перевода строки для разделения уровней контекста, например, вызовов функций.)</p><p>Объяснение: сообщение не обязательно будет выводиться в интерфейсе терминального типа. В графических интерфейсах или браузерах эти инструкции форматирования в лучшем случае игнорируются.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-QUOTATION-MARKS"><div class="titlepage"><div><div><h3 class="title">56.3.3. Символы кавычек <a href="#ERROR-STYLE-GUIDE-QUOTATION-MARKS" class="id_link">#</a></h3></div></div></div><p>В тексте на английском языке везде, где это уместно, следует использовать двойные кавычки. В тексте на других языках следует единообразно использовать тот тип кавычек, который принят для печати вывода других программ.</p><p>Объяснение: выбор двойных кавычек вместо апострофов несколько своевольный, но ему сейчас отдаётся предпочтение. Некоторые разработчики предлагали выбирать тип кавычек в зависимости от типа объекта, следуя соглашениям SQL (а именно, строки заключать в апострофы, а идентификаторы в кавычки). Но это внутренняя техническая особенность языка, о которой многие пользователи даже не догадываются; кроме того, это нельзя распространить на другие типы сущностей в кавычках, не всегда можно перевести на другие языки и к тому же довольно бессмысленно.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-QUOTES"><div class="titlepage"><div><div><h3 class="title">56.3.4. Использование кавычек <a href="#ERROR-STYLE-GUIDE-QUOTES" class="id_link">#</a></h3></div></div></div><p>Всегда используйте кавычки для заключения имён файлов, задаваемых пользователем идентификаторов и других переменных, которые могут содержать слова. Не заключайте в кавычки переменные, которые никогда не будут содержать слова (например, имена операторов).</p><p>В коде сервера есть функции, которые при необходимости сами заключают выводимый результат в кавычки (например, <code class="function">format_type_be()</code>). Дополнительные кавычки вокруг результата таких функций добавлять не следует.</p><p>Объяснение: у объектов могут быть имена, создающие двусмысленность, когда они появляются в сообщении. Всегда одинаково обозначайте, где начинается и где заканчивается встроенное имя. Но не загромождайте сообщения ненужными или повторными знаками кавычек.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-GRAMMAR-PUNCTUATION"><div class="titlepage"><div><div><h3 class="title">56.3.5. Грамматика и пунктуация <a href="#ERROR-STYLE-GUIDE-GRAMMAR-PUNCTUATION" class="id_link">#</a></h3></div></div></div><p>Правила для основного сообщения и дополнительного сообщения/подсказки различаются:</p><p>Основное сообщение об ошибке: не делайте первую букву заглавной. Не завершайте сообщение точкой. Даже не думайте о том, чтобы завершить сообщение восклицательным знаком!</p><p>Подробное сообщение и подсказка: пишите полные предложения и завершайте каждое точкой. Начинайте первое слово предложения с большой буквы. Добавляйте два пробела после точки, если за одним предложением следует другое (для английского текста; может не подходить для других языков).</p><p>Строка с контекстом ошибки: не делайте первую букву заглавной и не завершайте строку точкой. Строки контекста обычно не должны быть полными предложениями.</p><p>Объяснение: при отсутствии знаков пунктуации клиентским приложениям проще вставить сообщение в самые разные грамматические контексты. Часто основные сообщения всё равно не являются грамматически полными предложениями. (Если сообщение настолько длинное, что занимает не одно предложение, его следует поделить на основную и дополнительную часть.) Однако подробные сообщения и подсказки по определению длиннее и могут содержать несколько предложений. Единообразия ради, они должны следовать стилю полного предложения, даже если предложение всего одно.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-CASE"><div class="titlepage"><div><div><h3 class="title">56.3.6. Верхний регистр или нижний регистр <a href="#ERROR-STYLE-GUIDE-CASE" class="id_link">#</a></h3></div></div></div><p>Пишите сообщение в нижнем регистре, включая первую букву основного сообщения об ошибке. Используйте верхний регистр для команд SQL и ключевых слов, если они выводятся в сообщении.</p><p>Объяснение: так проще сделать, чтобы всё выглядело единообразно, так как некоторые сообщения могут быть полными предложениями, а другие нет.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-PASSIVE-VOICE"><div class="titlepage"><div><div><h3 class="title">56.3.7. Избегайте пассивного залога <a href="#ERROR-STYLE-GUIDE-PASSIVE-VOICE" class="id_link">#</a></h3></div></div></div><p>Используйте активный залог. Когда есть действующий субъект, формулируйте полные предложения (<span class="quote">«<span class="quote">A не удалось сделать B</span>»</span>). Используйте телеграфный стиль без субъекта, если субъект — сама программа; не пишите <span class="quote">«<span class="quote">я</span>»</span> от имени программы.</p><p>Объяснение: программа — не человек. Не создавайте впечатление, что это не так.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-TENSE"><div class="titlepage"><div><div><h3 class="title">56.3.8. Настоящее или прошедшее время <a href="#ERROR-STYLE-GUIDE-TENSE" class="id_link">#</a></h3></div></div></div><p>Используйте прошедшее время, если попытка сделать что-то не удалась, но может быть успешной в следующий раз (возможно, после устранения некоторой проблемы). Используйте настоящее время, если ошибка, определённо, постоянная.</p><p>Есть нетривиальное смысловое различие между предложениями вида: </p><pre class="programlisting">не удалось открыть файл "%s": %m</pre><p> и: </p><pre class="programlisting">нельзя открыть файл "%s"</pre><p> Первое означает, что попытка открыть файл не удалась. Сообщение должно сообщать причину, например, <span class="quote">«<span class="quote">переполнение диска</span>»</span> или <span class="quote">«<span class="quote">файл не существует</span>»</span>. Прошедшее время уместно, потому что в следующий раз диск может быть не переполнен или запрошенный файл будет найден.</p><p>Вторая форма показывает, что функциональность открытия файла с заданным именем полностью отсутствует в программе, либо это невозможно в принципе. Настоящее время в этом случае уместно, так как это условие будет сохраняться неопределённое время.</p><p>Объяснение: конечно, средний пользователь не сможет сделать глубокие выводы, проанализировав синтаксическое время, но если язык даёт нам возможность такого выражения, мы должны использовать это корректно.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-OBJECT-TYPE"><div class="titlepage"><div><div><h3 class="title">56.3.9. Тип объекта <a href="#ERROR-STYLE-GUIDE-OBJECT-TYPE" class="id_link">#</a></h3></div></div></div><p>Цитируя имя объекта, указывайте также его тип.</p><p>Объяснение: иначе никто не поймёт, к чему относится <span class="quote">«<span class="quote">foo.bar.baz</span>»</span>.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-BRACKETS"><div class="titlepage"><div><div><h3 class="title">56.3.10. Скобки <a href="#ERROR-STYLE-GUIDE-BRACKETS" class="id_link">#</a></h3></div></div></div><p>Квадратные скобки должны использоваться только (1) в описаниях команд и обозначать необязательные аргументы, либо (2) для обозначения индекса массива.</p><p>Объяснение: все другие варианты их использования не являются общепринятыми и будут вводить в заблуждение.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-ERROR-MESSAGES"><div class="titlepage"><div><div><h3 class="title">56.3.11. Сборка сообщений об ошибках <a href="#ERROR-STYLE-GUIDE-ERROR-MESSAGES" class="id_link">#</a></h3></div></div></div><p>Когда сообщение включает текст, сгенерированный в другом месте, внедряйте его следующим образом: </p><pre class="programlisting">не удалось открыть файл %s: %m</pre><p>Объяснение: довольно сложно учесть все возможные варианты ошибок, которые будут вставляться в предложение, чтобы оно при этом оставалось складным, поэтому требуется какая-то пунктуация. Было предложение заключать включаемый текст в скобки, но это не вполне естественно, если этот текст содержит наиболее важную часть сообщения, что часто имеет место.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-ERROR-REASONS"><div class="titlepage"><div><div><h3 class="title">56.3.12. Причины ошибок <a href="#ERROR-STYLE-GUIDE-ERROR-REASONS" class="id_link">#</a></h3></div></div></div><p>Сообщения должны всегда сообщать о причине произошедшей ошибки. Например: </p><pre class="programlisting">ПЛОХО:  не удалось открыть файл %s
ЛУЧШЕ:  не удалось открыть файл %s (ошибка ввода/вывода)</pre><p> Если причина неизвестна, лучше исправить код.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-FUNCTION-NAMES"><div class="titlepage"><div><div><h3 class="title">56.3.13. Имена функций <a href="#ERROR-STYLE-GUIDE-FUNCTION-NAMES" class="id_link">#</a></h3></div></div></div><p>Не включайте в текст ошибки имя функции, в которой возникла ошибка. У нас есть другие механизмы, позволяющие узнать его, когда требуется, а для большинства пользователей это бесполезная информация. Если текст ошибки оказывается бессвязным без имени функции, перефразируйте его. </p><pre class="programlisting">ПЛОХО:  pg_strtoint32: ошибка в "z": не удалось разобрать "z"
ЛУЧШЕ:  неверное значение для целого числа: "z"</pre><p>Избегайте упоминания имён вызываемых функций; вместо этого скажите, что пытается делать код: </p><pre class="programlisting">ПЛОХО:  ошибка в open(): %m
ЛУЧШЕ:  не удалось открыть файл %s: %m</pre><p> Если это действительно кажется необходимым, упомяните системный вызов в подробном сообщении. (В некоторых случаях в подробном сообщении стоит показать фактические значения, передаваемые системному вызову.)</p><p>Объяснение: пользователи не знают, что делают все эти функции.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-TRICKY-WORDS"><div class="titlepage"><div><div><h3 class="title">56.3.14. Скользкие слова, которых следует избегать <a href="#ERROR-STYLE-GUIDE-TRICKY-WORDS" class="id_link">#</a></h3></div></div></div><p><strong>Unable (Неспособен). </strong><span class="quote">«<span class="quote">Unable</span>»</span> — это почти пассивный залог. Лучше использовать <span class="quote">«<span class="quote">cannot</span>»</span> (нельзя) или <span class="quote">«<span class="quote">could not</span>»</span> (не удалось), в зависимости от ситуации.</p><p><strong>Bad (Плохое). </strong>Сообщения об ошибках типа <span class="quote">«<span class="quote">bad result</span>»</span> (плохой результат) трудно воспринять осмысленно. Лучше написать, почему результат <span class="quote">«<span class="quote">плохой</span>»</span>, например, <span class="quote">«<span class="quote">invalid format</span>»</span> (неверный формат).</p><p><strong>Illegal (Нелегальное). </strong><span class="quote">«<span class="quote">Illegal</span>»</span> (нелегально) — то, что нарушает закон, всё остальное можно называть <span class="quote">«<span class="quote">invalid</span>»</span> (неверным). Опять же лучше сказать, почему что-то неверное.</p><p><strong>Unknown (Неизвестное). </strong>Постарайтесь исключить <span class="quote">«<span class="quote">unknown</span>»</span> (неизвестное). Взгляните на сообщение: <span class="quote">«<span class="quote">error: unknown response</span>»</span> (ошибка: неизвестный ответ). Если вы не знаете, что за ответ получен, как вы поняли, что он ошибочный? Вместо этого часто лучше сказать <span class="quote">«<span class="quote">unrecognized</span>»</span> (нераспознанный). Также обязательно добавьте значение, которое не было воспринято. </p><pre class="programlisting">ПЛОХО:  неизвестный тип узла
ЛУЧШЕ:  нераспознанный тип узла: 42</pre><p><strong>«Не найдено» или «не существует». </strong>Если программа выполняет поиск ресурса, используя нетривиальный алгоритм (например, поиск по пути), и этот алгоритм не срабатывает, лучше честно сказать, что программа не смогла <span class="quote">«<span class="quote">найти</span>»</span> ресурс. С другой стороны, если ожидаемое расположение ресурса точно известно, но программа не может обратиться к нему, скажите, что этот ресурс не <span class="quote">«<span class="quote">существует</span>»</span>. Формулировка с глаголом <span class="quote">«<span class="quote">найти</span>»</span> в данном случае звучит слабо и затрудняет понимание.</p><p><strong>Разрешено, могу или возможно. </strong><span class="quote">«<span class="quote">May</span>»</span> (разрешено) подразумевает разрешение (например, «Вам разрешено воспользоваться моими граблями.») и этому практически нет применения в документации или сообщениях об ошибках. <span class="quote">«<span class="quote">Can</span>»</span> (могу) подразумевает способность (например, «Я могу поднять это бревно.»), а <span class="quote">«<span class="quote">might</span>»</span> (возможно) подразумевает возможность (например, «Сегодня возможен дождь.»). Использование подходящего слова проясняет значение и облегчает перевод.</p><p><strong>Сокращения. </strong>Избегайте сокращений, например <span class="quote">«<span class="quote">can't</span>»</span>; вместо это напишите <span class="quote">«<span class="quote">cannot</span>»</span>.</p><p><strong>Неотрицательный. </strong>Избегайте определения <span class="quote">«<span class="quote">неотрицательный</span>»</span>, так как может быть непонятно, включает ли оно ноль. Лучше использовать выражения <span class="quote">«<span class="quote">больше нуля</span>»</span> или <span class="quote">«<span class="quote">больше или равно нулю</span>»</span>.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-SPELLING"><div class="titlepage"><div><div><h3 class="title">56.3.15. Правильное написание <a href="#ERROR-STYLE-GUIDE-SPELLING" class="id_link">#</a></h3></div></div></div><p>Пишите слова полностью. Например, избегайте (в английском): </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>spec</p></li><li class="listitem"><p>stats</p></li><li class="listitem"><p>parens</p></li><li class="listitem"><p>auth</p></li><li class="listitem"><p>xact</p></li></ul></div><p>Объяснение: так сообщения будут единообразными.</p></div><div class="simplesect" id="ERROR-STYLE-GUIDE-LOCALIZATION"><div class="titlepage"><div><div><h3 class="title">56.3.16. Локализация <a href="#ERROR-STYLE-GUIDE-LOCALIZATION" class="id_link">#</a></h3></div></div></div><p>Помните, что текст сообщений должен переводиться на другие языки. Следуйте советам, приведённым в <a class="xref" href="nls-programmer.html#NLS-GUIDELINES" title="57.2.2. Рекомендации по написанию сообщений">Подразделе 57.2.2</a>, чтобы излишне не усложнять жизнь переводчикам.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="error-message-reporting.html" title="56.2. Вывод сообщений об ошибках в коде сервера">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="source.html" title="Глава 56. Соглашения по оформлению кода PostgreSQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="source-conventions.html" title="56.4. Различные соглашения по оформлению кода">След.</a></td></tr><tr><td width="40%" align="left" valign="top">56.2. Вывод сообщений об ошибках в коде сервера </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 56.4. Различные соглашения по оформлению кода</td></tr></table></div></body></html>