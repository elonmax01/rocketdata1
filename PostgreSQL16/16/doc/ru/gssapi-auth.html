<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>21.6. Аутентификация GSSAPI</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="auth-password.html" title="21.5. Аутентификация password" /><link rel="next" href="sspi-auth.html" title="21.7. Аутентификация SSPI" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">21.6. Аутентификация GSSAPI</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="auth-password.html" title="21.5. Аутентификация password">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения">Наверх</a></td><th width="60%" align="center">Глава 21. Аутентификация клиентского приложения</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sspi-auth.html" title="21.7. Аутентификация SSPI">След.</a></td></tr></table><hr /></div><div class="sect1" id="GSSAPI-AUTH"><div class="titlepage"><div><div><h2 class="title" style="clear: both">21.6. Аутентификация GSSAPI <a href="#GSSAPI-AUTH" class="id_link">#</a></h2></div></div></div><a id="id-1.6.8.13.2" class="indexterm"></a><p><span class="productname">GSSAPI</span> — стандартизированный протокол для безопасной аутентификации, определённый в <a class="ulink" href="https://datatracker.ietf.org/doc/html/rfc2743" target="_top">RFC 2743</a>. <span class="productname">PostgreSQL</span> поддерживает применение <span class="productname">GSSAPI</span> для аутентификации или шифрования соединения, а также для шифрования с аутентификацией. <span class="productname">GSSAPI</span> обеспечивает автоматическую проверку подлинности (единый вход) для систем, которые её поддерживают. Проверка подлинности реализуется безопасно, но данные, передаваемые через подключение к БД, будут защищены, только если используется шифрование <span class="productname">GSSAPI</span> или <acronym class="acronym">SSL</acronym>.</p><p>Поддержка GSSAPI должна быть включена при сборке <span class="productname">PostgreSQL</span>; за дополнительными сведениями обратитесь к <a class="xref" href="installation.html" title="Глава 17. Установка из исходного кода">Главе 17</a>.</p><p>При работе с <span class="productname">Kerberos</span> <span class="productname">GSSAPI</span> использует стандартные имена принципалов служб (аутентификационные идентификаторы) в формате <code class="literal"><em class="replaceable"><code>имя_службы</code></em>/<em class="replaceable"><code>имя_сервера</code></em>@<em class="replaceable"><code>область</code></em></code>. Имя принципала, используемое конкретным установленным экземпляром <span class="productname">PostgreSQL</span>, не зашито в сервере ни в каком виде; оно задаётся в файле <em class="firstterm">keytab</em>, прочитав который сервер определяет назначенный ему идентификатор. Если в данном файле задано несколько принципалов, сервер выберет любой из них. В качестве области сервера выбирается предпочитаемая область, заданная в доступных серверу файлах конфигурации Kerberos.</p><p>Подключающийся к серверу клиент должен знать имя принципала данного сервера. Обычно в компоненте <em class="replaceable"><code>имя_службы</code></em> принципала фигурирует <code class="literal">postgres</code>, но параметр подключения <a class="xref" href="libpq-connect.html#LIBPQ-CONNECT-KRBSRVNAME">krbsrvname</a> в <span class="application">libpq</span> позволяет задать и другое значение. В компоненте <em class="replaceable"><code>имя_сервера</code></em> задаётся полностью определённое имя узла, к которому будет подключаться <span class="application">libpq</span>. В качестве области выбирается предпочитаемая область, заданная в доступных клиенту файлах конфигурации Kerberos.</p><p>У клиента также должно быть назначенное ему имя принципала (и он должен иметь действительный билет для этого принципала). Чтобы <span class="productname">GSSAPI</span> проверил подлинность клиента, имя принципала клиента должно быть связано с именем пользователя базы <span class="productname">PostgreSQL</span>. Определить такие сопоставления можно в файле <code class="filename">pg_ident.conf</code>; например, <code class="literal">pgusername@realm</code> можно сопоставить с именем <code class="literal">pgusername</code>. Также возможно использовать в качестве имени роли в <span class="productname">PostgreSQL</span> полное имя принципала <code class="literal">username@realm</code> без какого-либо сопоставления.</p><p><span class="productname">PostgreSQL</span> также может сопоставлять принципалы клиентов именам пользователей, просто убирая компонент области из имени принципала. Эта возможность оставлена для обратной совместимости, и использовать её крайне нежелательно, так как при этом оказывается невозможно различить разных пользователей, имеющих одинаковые имена, но приходящих из разных областей. Чтобы включить её, установите для <code class="literal">include_realm</code> значение 0. В простых конфигурациях с одной областью исключение области в сочетании с параметром <code class="literal">krb_realm</code> (который позволяет ограничить область пользователя одним значением, заданным в <code class="literal">krb_realm</code> parameter) будет безопасным, но менее гибким вариантом по сравнению с явным описанием сопоставлений в <code class="filename">pg_ident.conf</code>.</p><p>Размещение файла keytab на сервере задаётся параметром конфигурации <a class="xref" href="runtime-config-connection.html#GUC-KRB-SERVER-KEYFILE">krb_server_keyfile</a>. По соображениям безопасности рекомендуется использовать отдельный файл для сервера <span class="productname">PostgreSQL</span>, а не разрешать серверу читать системный keytab. Предоставьте пользователю, от имени которого работает сервер <span class="productname">PostgreSQL</span>, право чтения этого файла (право записи давать не нужно). (См. также <a class="xref" href="postgres-user.html" title="19.1. Учётная запись пользователя PostgreSQL">Раздел 19.1</a>.)</p><p>Файл таблицы ключей генерируется с использованием ПО Kerberos; подробнее это описано в документации Kerberos. Следующий пример показывает, как его сгенерировать, используя программу <span class="application">kadmin</span> в MIT-реализации Kerberos: </p><pre class="screen">
<code class="prompt">kadmin% </code><strong class="userinput"><code>addprinc -randkey postgres/server.my.domain.org</code></strong>
<code class="prompt">kadmin% </code><strong class="userinput"><code>ktadd -k krb5.keytab postgres/server.my.domain.org</code></strong>
</pre><p>Для метода аутентификации <span class="productname">GSSAPI</span> поддерживаются следующие параметры: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">include_realm</code></span></dt><dd><p>Когда этот параметр равен 0, из принципала аутентифицированного пользователя убирается область, и оставшееся имя проходит сопоставление имён (см. <a class="xref" href="auth-username-maps.html" title="21.2. Файл сопоставления имён пользователей">Раздел 21.2</a>). Этот вариант не рекомендуется и поддерживается в основном для обратной совместимости, так как он небезопасен в окружениях с несколькими областями, если только дополнительно не задаётся <code class="literal">krb_realm</code>. Более предпочтительный вариант — оставить значение <code class="literal">include_realm</code> по умолчанию (1) и задать в <code class="filename">pg_ident.conf</code> явное сопоставление для преобразования имён принципалов в имена пользователей <span class="productname">PostgreSQL</span>.</p></dd><dt><span class="term"><code class="literal">map</code></span></dt><dd><p>Разрешает сопоставление принципалов клиентов пользователям баз данных. За подробностями обратитесь к <a class="xref" href="auth-username-maps.html" title="21.2. Файл сопоставления имён пользователей">Разделу 21.2</a>. Для принципала GSSAPI/Kerberos, такого как <code class="literal">username@EXAMPLE.COM</code> (или более редкого <code class="literal">username/hostbased@EXAMPLE.COM</code>), именем пользователя в сопоставлении будет <code class="literal">username@EXAMPLE.COM</code> (или <code class="literal">username/hostbased@EXAMPLE.COM</code>, соответственно), если <code class="literal">include_realm</code> не равно 0; в противном случае именем системного пользователя в сопоставлении будет <code class="literal">username</code> (или <code class="literal">username/hostbased</code>).</p></dd><dt><span class="term"><code class="literal">krb_realm</code></span></dt><dd><p>Устанавливает область, с которой будут сверяться имена принципалов пользователей. Если этот параметр задан, подключаться смогут только пользователи из этой области. Если не задан, подключаться смогут пользователи из любой области, в зависимости от установленного сопоставления имён пользователей.</p></dd></dl></div><p>В дополнение к этим параметрам, которые могут быть разными в разных записях <code class="filename">pg_hba.conf</code>, существует параметр конфигурации <a class="xref" href="runtime-config-connection.html#GUC-KRB-CASEINS-USERS">krb_caseins_users</a>, действующий на уровне сервера. Если он равен true, принципалы клиентов сопоставляются с записями пользователей без учёта регистра. В значении <code class="literal">krb_realm</code>, если оно задано, регистр символов тоже не учитывается.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="auth-password.html" title="21.5. Аутентификация password">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sspi-auth.html" title="21.7. Аутентификация SSPI">След.</a></td></tr><tr><td width="40%" align="left" valign="top">21.5. Аутентификация password </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 21.7. Аутентификация SSPI</td></tr></table></div></body></html>