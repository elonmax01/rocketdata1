<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>pg_restore</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="app-pgrecvlogical.html" title="pg_recvlogical" /><link rel="next" href="app-pgverifybackup.html" title="pg_verifybackup" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center"><span class="application">pg_restore</span></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="app-pgrecvlogical.html" title="pg_recvlogical">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><th width="60%" align="center">Клиентские приложения PostgreSQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="app-pgverifybackup.html" title="pg_verifybackup">След.</a></td></tr></table><hr /></div><div class="refentry" id="APP-PGRESTORE"><div class="titlepage"></div><a id="id-1.9.4.18.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle"><span class="application">pg_restore</span></span></h2><p>pg_restore — восстановить базу данных <span class="productname">PostgreSQL</span> из файла архива, созданного командой <span class="application">pg_dump</span></p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><div class="cmdsynopsis"><p id="id-1.9.4.18.4.1"><code class="command">pg_restore</code> [<em class="replaceable"><code>параметр-подключения</code></em>...] [<em class="replaceable"><code>параметр</code></em>...] [<em class="replaceable"><code>имя_файла</code></em>]</p></div></div><div class="refsect1" id="APP-PGRESTORE-DESCRIPTION"><h2>Описание</h2><p>Утилита <span class="application">pg_restore</span> предназначена для восстановления базы данных <span class="productname">PostgreSQL</span> из архива, созданного командой <a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle"><span class="application">pg_dump</span></span></a> в любом из не текстовых форматов. Она выполняет команды, необходимые для восстановления того состояния базы данных, в котором база была сохранена. При наличии файлов архивов, <span class="application">pg_restore</span> может восстанавливать данные избирательно или даже переупорядочить объекты перед восстановлением. Заметьте, что разработанный для файлов архива формат не привязан к архитектуре.</p><p>Утилита <span class="application">pg_restore</span> может работать в двух режимах. Если указывается имя базы данных, <span class="application">pg_restore</span> подключается к этой базе данных и восстанавливает содержимое архива непосредственно в неё. В противном случае создаётся SQL-скрипт с командами, необходимыми для пересоздания базы данных, который затем выводится в файл или в стандартное устройство вывода. Сформированный скрипт будет в точности соответствовать выводу <span class="application">pg_dump</span> в простом текстовом формате. Поэтому некоторые из параметров, управляющих выводом, аналогичны параметрам <span class="application">pg_dump</span>.</p><p>Разумеется, <span class="application">pg_restore</span> может восстановить информацию, только если она присутствует в файле архива, и только в существующем виде. Например, если архив был создан с указанием <span class="quote">«<span class="quote">выгрузить данные в виде команд <code class="command">INSERT</code></span>»</span>, <span class="application">pg_restore</span> не сможет загрузить эти данные, используя операторы <code class="command">COPY</code>.</p></div><div class="refsect1" id="APP-PGRESTORE-OPTIONS"><h2>Параметры</h2><p>Утилита <span class="application">pg_restore</span> принимает следующие аргументы командной строки. </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>имя_файла</code></em></span></dt><dd><p>Указывает расположение восстанавливаемого файла архива (или каталога, для архива в формате каталога). По умолчанию используется устройство стандартного ввода.</p></dd><dt><span class="term"><code class="option">-a</code><br /></span><span class="term"><code class="option">--data-only</code></span></dt><dd><p>Восстанавливать только данные, без схемы (определений данных). При этом восстанавливаются данные таблиц, большие объекты и значения последовательностей, имеющиеся в архиве.</p><p>Флаг похож на <code class="option">--section=data</code>, но по историческим причинам не равнозначен ему.</p></dd><dt><span class="term"><code class="option">-c</code><br /></span><span class="term"><code class="option">--clean</code></span></dt><dd><p>Прежде чем восстанавливать объекты базы данных, выполните команды <code class="command">DROP</code> для всех восстанавливаемых объектов. Этот параметр полезен для перезаписи существующей базы данных. Без дополнительного указания <code class="option">--if-exists</code> при этом могут выдаваться безвредные сообщения об ошибках, если таких объектов не окажется в целевой базе данных.</p></dd><dt><span class="term"><code class="option">-C</code><br /></span><span class="term"><code class="option">--create</code></span></dt><dd><p>Создать базу данных, прежде чем восстанавливать данные. Если также указан параметр <code class="option">--clean</code>, удалить и пересоздать целевую базу данных перед подключением к ней.</p><p>С ключом <code class="option">--create</code> программа <span class="application">pg_restore</span> также восстанавливает комментарий к базе данных (если он задан) и все назначения переменных конфигурации, связанные с базой данных, то есть все команды <code class="command">ALTER DATABASE ... SET ...</code> и <code class="command">ALTER ROLE ... IN DATABASE ... SET ...</code>, ссылающиеся на эту базу данных. Также восстанавливаются права доступа к самой базе данных, если не добавлен ключ <code class="option">--no-acl</code>.</p><p>С этим параметром база, заданная параметром <code class="option">-d</code>, применяется только для подключения и выполнения начальных команд <code class="command">DROP DATABASE</code> и <code class="command">CREATE DATABASE</code>. Все данные восстанавливаются в базу данных, имя которой записано в архиве.</p></dd><dt><span class="term"><code class="option">-d <em class="replaceable"><code>имя_бд</code></em></code><br /></span><span class="term"><code class="option">--dbname=<em class="replaceable"><code>имя_бд</code></em></code></span></dt><dd><p>Подключиться к базе данных <em class="replaceable"><code>имя_базы</code></em> и восстановить данные непосредственно в неё. В данном аргументе может задаваться <a class="link" href="libpq-connect.html#LIBPQ-CONNSTRING" title="34.1.1. Строки параметров подключения">строка подключения</a>. В этом случае параметры в строке подключения переопределяют одноимённые параметры, заданные в командной строке.</p></dd><dt><span class="term"><code class="option">-e</code><br /></span><span class="term"><code class="option">--exit-on-error</code></span></dt><dd><p>Завершать работу в случае возникновения ошибки при выполнении команд SQL в базе данных. По умолчанию процесс восстановления продолжается, а по его окончании выдаётся число ошибок.</p></dd><dt><span class="term"><code class="option">-f <em class="replaceable"><code>имя_файла</code></em></code><br /></span><span class="term"><code class="option">--file=<em class="replaceable"><code>имя_файла</code></em></code></span></dt><dd><p>Задаёт файл для вывода сгенерированного скрипта или списка объектов, получаемого с параметром <code class="option">-l</code>. Чтобы выбрать <span class="systemitem">stdout</span>, используйте <code class="literal">-</code>.</p></dd><dt><span class="term"><code class="option">-F <em class="replaceable"><code>формат</code></em></code><br /></span><span class="term"><code class="option">--format=<em class="replaceable"><code>формат</code></em></code></span></dt><dd><p>Задаёт формат архива. Указывать формат необязательно, так как <span class="application">pg_restore</span> определяет формат автоматически. Но если формат задаётся, допускается один из этих вариантов: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">c</code><br /></span><span class="term"><code class="literal">custom</code></span></dt><dd><p>Архив сохранён в специальном формате <span class="application">pg_dump</span>.</p></dd><dt><span class="term"><code class="literal">d</code><br /></span><span class="term"><code class="literal">directory</code></span></dt><dd><p>Архив сохранён в каталоге.</p></dd><dt><span class="term"><code class="literal">t</code><br /></span><span class="term"><code class="literal">tar</code></span></dt><dd><p>Архив сохранён в формате <code class="command">tar</code>.</p></dd></dl></div></dd><dt><span class="term"><code class="option">-I <em class="replaceable"><code>индекс</code></em></code><br /></span><span class="term"><code class="option">--index=<em class="replaceable"><code>индекс</code></em></code></span></dt><dd><p>Восстановить определение только заданного индекса. Добавив дополнительные ключи <code class="option">-I</code>, можно указать несколько индексов.</p></dd><dt><span class="term"><code class="option">-j <em class="replaceable"><code>число-заданий</code></em></code><br /></span><span class="term"><code class="option">--jobs=<em class="replaceable"><code>число-заданий</code></em></code></span></dt><dd><p>Выполнять наиболее длительные этапы <span class="application">pg_restore</span> (в частности, загрузку данных, создание индексов или ограничений) параллельно, используя несколько заданий (в количестве, не превышающем <em class="replaceable"><code>число-заданий</code></em>). Это позволяет кардинально сократить время восстановления большой базы данных, когда сервер работает на многопроцессорном компьютере. Данный параметр игнорируется, когда генерируется скрипт (нет прямого подключения к базе данных).</p><p>Каждое задание выполняется в отдельном задании или потоке, в зависимости от операционной системы, и использует отдельное подключение к серверу.</p><p>Оптимальное значение этого параметра зависит от аппаратной конфигурации сервера, клиента и сети. В частности, имеет значение количество процессорных ядер и устройство дискового хранилища. В качестве начального значения можно выбрать число ядер на сервере, но и при увеличении этого значения во многих случаях восстановление будет быстрее. Конечно, при слишком больших значениях производительность упадёт из-за перегрузки.</p><p>Этот параметр поддерживается только с архивом в специальном формате или в каталоге. Входные данные должны поступать из обычного файла или каталога, а не из канала или стандартного устройства ввода. Кроме того, несколько заданий не могут выполняться в сочетании с параметром <code class="option">--single-transaction</code>.</p></dd><dt><span class="term"><code class="option">-l</code><br /></span><span class="term"><code class="option">--list</code></span></dt><dd><p>Вывести оглавление архива. Вывод этой операции можно подать на вход этой же команде с параметром <code class="option">-L</code>. Учтите, что когда вместе с <code class="option">-l</code> применяются параметры фильтрации (например, <code class="option">-n</code> или <code class="option">-t</code>), они сокращают список выводимых объектов.</p></dd><dt><span class="term"><code class="option">-L <em class="replaceable"><code>файл-список</code></em></code><br /></span><span class="term"><code class="option">--use-list=<em class="replaceable"><code>файл-список</code></em></code></span></dt><dd><p>Восстановить из архива только элементы, перечисленные в <em class="replaceable"><code>файле-списке</code></em>, и в том порядке, в каком они идут в этом файле. Заметьте, что когда вместе с <code class="option">-L</code> применяются параметры фильтрации (например, <code class="option">-n</code> или <code class="option">-t</code>), они дополнительно ограничивают восстанавливаемые объекты.</p><p>Данный <em class="replaceable"><code>файл-список</code></em> обычно представляет собой отредактированный результат предыдущей операции <code class="option">-l</code>. Строки в нём могут быть переставлены или удалены, а также могут быть закомментированы точкой с запятой (<code class="literal">;</code>), добавленной в начале строки. См. примеры ниже.</p></dd><dt><span class="term"><code class="option">-n <em class="replaceable"><code>схема</code></em></code><br /></span><span class="term"><code class="option">--schema=<em class="replaceable"><code>схема</code></em></code></span></dt><dd><p>Восстановить только объекты в указанной схеме. Добавив дополнительные ключи <code class="option">-n</code>, можно указать несколько схем. Этот параметр можно сочетать с <code class="option">-t</code>, чтобы восстановить только определённую таблицу.</p></dd><dt><span class="term"><code class="option">-N <em class="replaceable"><code>схема</code></em></code><br /></span><span class="term"><code class="option">--exclude-schema=<em class="replaceable"><code>схема</code></em></code></span></dt><dd><p>Не восстанавливать объекты в указанной схеме. Добавив дополнительные ключи <code class="option">-N</code>, можно исключить несколько схем.</p><p>Когда и с ключом <code class="option">-n</code>, и с ключом <code class="option">-N</code> передаётся имя одной схемы, ключ <code class="option">-N</code> выигрывает и схема исключается.</p></dd><dt><span class="term"><code class="option">-O</code><br /></span><span class="term"><code class="option">--no-owner</code></span></dt><dd><p>Не генерировать команды, устанавливающие владение объектами, как в исходной базе данных. По умолчанию, <span class="application">pg_restore</span> генерирует команды <code class="command">ALTER OWNER</code> или <code class="command">SET SESSION AUTHORIZATION</code>, восстанавливающие исходных владельцев создаваемых элементов схемы. Однако эти команды можно будет выполнить, только если к базе данных первоначально подключается суперпользователь (или пользователь, владеющими всеми объектами в скрипте). Чтобы получить скрипт, который сможет восстановить любой подключающийся пользователь (но при этом он станет владельцем всех созданных объектов), используется <code class="option">-O</code>.</p></dd><dt><span class="term"><code class="option">-P <em class="replaceable"><code>имя-функции(тип-аргумента[, ...])</code></em></code><br /></span><span class="term"><code class="option">--function=<em class="replaceable"><code>имя-функции(тип-аргумента[, ...])</code></em></code></span></dt><dd><p>Восстановить только указанную функцию. При этом важно записать имя функции и аргументы в точности так, как они фигурируют в оглавлении файла архива. Добавив дополнительные ключи <code class="option">-P</code>, можно указать несколько функций.</p></dd><dt><span class="term"><code class="option">-R</code><br /></span><span class="term"><code class="option">--no-reconnect</code></span></dt><dd><p>Параметр является устаревшим, но в целях совместимости ещё работает.</p></dd><dt><span class="term"><code class="option">-s</code><br /></span><span class="term"><code class="option">--schema-only</code></span></dt><dd><p>Восстановить только схему (определения данных), без данных, в объёме, в котором элементы схемы представлены в архиве.</p><p>Действие параметра противоположно действию <code class="option">--data-only</code>. Это похоже на указание <code class="option">--section=pre-data --section=post-data</code>, но по историческим причинам не равнозначно ему.</p><p>(Не путайте этот параметр с <code class="option">--schema</code>, где слово <span class="quote">«<span class="quote">схема</span>»</span> используется в другом значении.)</p></dd><dt><span class="term"><code class="option">-S <em class="replaceable"><code>имя_пользователя</code></em></code><br /></span><span class="term"><code class="option">--superuser=<em class="replaceable"><code>имя_пользователя</code></em></code></span></dt><dd><p>Задаёт имя суперпользователя, полномочия которого будут использоваться для отключения триггеров. Этот параметр применяется только с параметром <code class="option">--disable-triggers</code>.</p></dd><dt><span class="term"><code class="option">-t <em class="replaceable"><code>таблица</code></em></code><br /></span><span class="term"><code class="option">--table=<em class="replaceable"><code>таблица</code></em></code></span></dt><dd><p>Восстановить определение и/или данные только указанной таблицы. В этом контексте под <span class="quote">«<span class="quote">таблицей</span>»</span> подразумеваются также представления, материализованные представления, последовательности и сторонние таблицы. Чтобы выбрать несколько таблиц, ключ <code class="option">-t</code> можно указать несколько раз. Этот параметр можно скомбинировать с <code class="option">-n</code>, чтобы выбрать таблицу(ы) в определённой схеме.</p><div class="note"><h3 class="title">Примечание</h3><p>Когда указывается <code class="option">-t</code>, <span class="application">pg_restore</span> не пытается восстанавливать объекты базы данных, от которых могут зависеть выбранные таблицы. Таким образом, в этом случае не гарантируется, что выгруженные таблицы будут успешно восстановлены в чистой базе данных.</p></div><div class="note"><h3 class="title">Примечание</h3><p>Этот флаг действует не совсем так, как флаг <code class="option">-t</code> утилиты <span class="application">pg_dump</span>. В настоящее время <span class="application">pg_restore</span> не поддерживает выбор объектов по маске, а также не позволяет указать имя схемы с <code class="option">-t</code>. И хотя <span class="application">pg_dump</span> с флагом <code class="option">-t</code> также выгружает подчинённые объекты (например, индексы) выбранных таблиц, <span class="application">pg_restore</span> с флагом <code class="option">-t</code> такие подчинённые объекты не обрабатывает.</p></div><div class="note"><h3 class="title">Примечание</h3><p>В версиях <span class="productname">PostgreSQL</span> до 9.6 этот флаг выбирал только таблицы, но не другие типы отношений.</p></div></dd><dt><span class="term"><code class="option">-T <em class="replaceable"><code>триггер</code></em></code><br /></span><span class="term"><code class="option">--trigger=<em class="replaceable"><code>триггер</code></em></code></span></dt><dd><p>Восстановить только указанный триггер. Добавив дополнительные ключи <code class="option">-T</code>, можно указать несколько триггеров.</p></dd><dt><span class="term"><code class="option">-v</code><br /></span><span class="term"><code class="option">--verbose</code></span></dt><dd><p>Включить подробный режим. <span class="application">pg_restore</span> будет выводить в стандартный поток ошибок подробные комментарии к объектам, включая время начала и окончания операции, а также сообщения о прогрессе выполнения. Если повторить этот ключ, в стандартный поток ошибок будут выдаваться дополнительные отладочные сообщения.</p></dd><dt><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span></dt><dd><p>Сообщить версию <span class="application">pg_restore</span> и завершиться.</p></dd><dt><span class="term"><code class="option">-x</code><br /></span><span class="term"><code class="option">--no-privileges</code><br /></span><span class="term"><code class="option">--no-acl</code></span></dt><dd><p>Не восстанавливать права доступа (не выполнять команды GRANT/REVOKE).</p></dd><dt><span class="term"><code class="option">-1</code><br /></span><span class="term"><code class="option">--single-transaction</code></span></dt><dd><p>Произвести восстановление в одной транзакции (то есть, завернуть выполняемые команды в <code class="command">BEGIN</code>/<code class="command">COMMIT</code>). При этом гарантируется, что либо все команды будут выполнены успешно, либо не будет никаких изменений. Этот режим подразумевает <code class="option">--exit-on-error</code>.</p></dd><dt><span class="term"><code class="option">--disable-triggers</code></span></dt><dd><p>Этот параметр действует только при выгрузке одних данных. С ним <span class="application">pg_restore</span> выполняет команды, отключающие триггеры в целевых таблицах на время восстановления данных. Используйте его, если в ваших таблицах определены проверки ссылочной целостности или другие триггеры, которые вы не хотели бы выполнять в процессе восстановления данных.</p><p>В настоящее время команды, генерируемые с <code class="option">--disable-triggers</code>, должны выполнятся суперпользователем. Поэтому необходимо также задать имя суперпользователя в параметре <code class="option">-S</code> или, что предпочтительнее, запускать <span class="application">pg_restore</span> от имени суперпользователя <span class="productname">PostgreSQL</span>.</p></dd><dt><span class="term"><code class="option">--enable-row-security</code></span></dt><dd><p>Этот параметр имеет смысл только при восстановлении содержимого таблицы, для которой включена защита строк. По умолчанию <span class="application">pg_restore</span> устанавливает для <a class="xref" href="runtime-config-client.html#GUC-ROW-SECURITY">row_security</a> значение off для уверенности, что в таблице восстановлены все данные. Если у пользователя недостаточно прав для обхода защиты строк, выдаётся ошибка. Этот параметр указывает <span class="application">pg_restore</span> установить в <a class="xref" href="runtime-config-client.html#GUC-ROW-SECURITY">row_security</a> значение on, чтобы пользователь мог попытаться восстановить содержимое таблицы с включённой защитой строк. Однако и при этом возможна ошибка, если пользователь не будет иметь права добавлять в эту таблицу выгруженные строки данных.</p><p>Заметьте, что в настоящее время для этого требуется, чтобы выгрузка выполнялась в режиме <code class="command">INSERT</code>, так как <code class="command">COPY FROM</code> не поддерживает защиту строк.</p></dd><dt><span class="term"><code class="option">--if-exists</code></span></dt><dd><p>Используйте команды <code class="literal">DROP ... IF EXISTS</code> для удаления объектов в режиме <code class="option">--clean</code>. При этом возможные ошибки <span class="quote">«<span class="quote">does not exist</span>»</span> (не существует) не выводятся. Этот параметр недействителен без указания <code class="option">--clean</code>.</p></dd><dt><span class="term"><code class="option">--no-comments</code></span></dt><dd><p>Не выводить команды, восстанавливающие комментарии, даже если они содержатся в архиве.</p></dd><dt><span class="term"><code class="option">--no-data-for-failed-tables</code></span></dt><dd><p>По умолчанию данные восстанавливаются даже при ошибке команды создания таблицы (например, когда она уже существует). С этим параметром данные в таком случае не восстанавливаются. Это поведение полезно, если в целевой таблице уже содержатся нужные данные. Например, вспомогательные таблицы для расширений <span class="productname">PostgreSQL</span> (в частности, <span class="productname">PostGIS</span>) могут быть уже заполнены; этот параметр позволяет предотвратить дублирование или загрузку устаревших данных в эти таблицы.</p><p>Этот параметр действует только при восстановлении непосредственно в базу данных (не при генерации SQL-скрипта).</p></dd><dt><span class="term"><code class="option">--no-publications</code></span></dt><dd><p>Не выводить команды, восстанавливающие публикации, даже если они содержатся в архиве.</p></dd><dt><span class="term"><code class="option">--no-security-labels</code></span></dt><dd><p>Не выводить команды, восстанавливающие метки безопасности, даже если они содержатся в архиве.</p></dd><dt><span class="term"><code class="option">--no-subscriptions</code></span></dt><dd><p>Не выводить команды, восстанавливающие подписки, даже если они содержатся в архиве.</p></dd><dt><span class="term"><code class="option">--no-table-access-method</code></span></dt><dd><p>Не выводить команды для указания табличных методов доступа. При восстановлении все объекты будут создаваться с табличным методом доступа, выбираемым по умолчанию.</p></dd><dt><span class="term"><code class="option">--no-tablespaces</code></span></dt><dd><p>Не формировать команды для указания табличных пространств. При восстановлении все объекты будут создаваться в табличном пространстве по умолчанию.</p></dd><dt><span class="term"><code class="option">--section=<em class="replaceable"><code>имя секции</code></em></code></span></dt><dd><p>Восстановить только указанный раздел. В качестве имени раздела можно задать <code class="option">pre-data</code>, <code class="option">data</code> или <code class="option">post-data</code>. Указав этот параметр неоднократно, можно выбрать несколько разделов. По умолчанию восстанавливаются все разделы.</p><p>Раздел «data» содержит собственно данные таблиц и определения больших объектов. В разделе «post-data» содержатся определения индексов, триггеров, правил и ограничений (кроме отдельно проверяемых). Раздел «pre-data» содержит все остальные определения.</p></dd><dt><span class="term"><code class="option">--strict-names</code></span></dt><dd><p>Требует, чтобы каждому указанию схемы (<code class="option">-n</code>/<code class="option">--schema</code>) и таблицы (<code class="option">-t</code>/<code class="option">--table</code>) соответствовала минимум одна схема/таблица в файле резервной копии.</p></dd><dt><span class="term"><code class="option">--use-set-session-authorization</code></span></dt><dd><p>Выводить команды <code class="command">SET SESSION AUTHORIZATION</code>, соответствующие стандарту, вместо <code class="command">ALTER OWNER</code>, для назначения владельцев объектов. В результате выгруженный скрипт будет более стандартизированным, но может не восстановиться корректно, в зависимости от истории объектов.</p></dd><dt><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help</code></span></dt><dd><p>Показать справку по аргументам командной строки <span class="application">pg_restore</span> и завершиться.</p></dd></dl></div><p><span class="application">pg_restore</span> также принимает в качестве параметров соединения следующие аргументы командной строки: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-h <em class="replaceable"><code>сервер</code></em></code><br /></span><span class="term"><code class="option">--host=<em class="replaceable"><code>сервер</code></em></code></span></dt><dd><p>Указывает имя компьютера, на котором работает сервер. Если значение начинается с косой черты, оно определяет каталог Unix-сокета. Значение по умолчанию берётся из переменной окружения <code class="envar">PGHOST</code>, если она установлена. В противном случае выполняется подключение к Unix-сокету.</p></dd><dt><span class="term"><code class="option">-p <em class="replaceable"><code>порт</code></em></code><br /></span><span class="term"><code class="option">--port=<em class="replaceable"><code>порт</code></em></code></span></dt><dd><p>Указывает TCP-порт или расширение файла локального Unix-сокета, через который сервер принимает подключения. Значение по умолчанию определяется переменной окружения <code class="envar">PGPORT</code>, если она установлена, либо числом, заданным при компиляции.</p></dd><dt><span class="term"><code class="option">-U <em class="replaceable"><code>имя_пользователя</code></em></code><br /></span><span class="term"><code class="option">--username=<em class="replaceable"><code>имя_пользователя</code></em></code></span></dt><dd><p>Имя пользователя, под которым производится подключение.</p></dd><dt><span class="term"><code class="option">-w</code><br /></span><span class="term"><code class="option">--no-password</code></span></dt><dd><p>Не выдавать запрос на ввод пароля. Если сервер требует аутентификацию по паролю и пароль не доступен с помощью других средств, таких как файл <code class="filename">.pgpass</code>, попытка соединения не удастся. Этот параметр может быть полезен в пакетных заданиях и скриптах, где нет пользователя, который вводит пароль.</p></dd><dt><span class="term"><code class="option">-W</code><br /></span><span class="term"><code class="option">--password</code></span></dt><dd><p>Принудительно запрашивать пароль перед подключением к базе данных.</p><p>Это несущественный параметр, так как <span class="application">pg_restore</span> запрашивает пароль автоматически, если сервер проверяет подлинность по паролю. Однако чтобы понять это, <span class="application">pg_restore</span> лишний раз подключается к серверу. Поэтому иногда имеет смысл ввести <code class="option">-W</code>, чтобы исключить эту ненужную попытку подключения.</p></dd><dt><span class="term"><code class="option">--role=<em class="replaceable"><code>имя роли</code></em></code></span></dt><dd><p>Задаёт имя роли, которая будет осуществлять восстановление. Получив это имя, <span class="application">pg_restore</span> выполнит <code class="command">SET ROLE</code> <em class="replaceable"><code>имя_роли</code></em> после подключения к базе данных. Это полезно, когда проходящий проверку пользователь (указанный в <code class="option">-U</code>) не имеет прав, необходимых для <span class="application">pg_restore</span>, но может переключиться на роль, наделённую этими правами. В некоторых окружениях правила запрещают подключаться к серверу непосредственно суперпользователю, и этот параметр позволяет выполнить восстановление, не нарушая их.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.4.18.7"><h2>Переменные окружения</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="envar">PGHOST</code><br /></span><span class="term"><code class="envar">PGOPTIONS</code><br /></span><span class="term"><code class="envar">PGPORT</code><br /></span><span class="term"><code class="envar">PGUSER</code></span></dt><dd><p>Параметры подключения по умолчанию</p></dd><dt><span class="term"><code class="envar">PG_COLOR</code></span></dt><dd><p>Выбирает вариант использования цвета в диагностических сообщениях. Возможные значения: <code class="literal">always</code> (всегда), <code class="literal">auto</code> (автоматически) и <code class="literal">never</code> (никогда).</p></dd></dl></div><p>Как и большинство других утилит <span class="productname">PostgreSQL</span>, эта утилита также использует переменные среды, поддерживаемые <span class="application">libpq</span> (см. <a class="xref" href="libpq-envars.html" title="34.15. Переменные окружения">Раздел 34.15</a>). Однако она не учитывает <code class="envar">PGDATABASE</code>, когда имя базы не указано.</p></div><div class="refsect1" id="APP-PGRESTORE-DIAGNOSTICS"><h2>Диагностика</h2><p>Когда с параметром <code class="option">-d</code> устанавливается прямое подключение к базе данных, <span class="application">pg_restore</span> выполняет обычные операторы <acronym class="acronym">SQL</acronym>. При этом применяются все свойства подключения по умолчанию и переменные окружения, которые использует клиентская библиотека <span class="application">libpq</span>. Если вы сталкиваетесь с проблемами при запуске <span class="application">pg_restore</span>, убедитесь в том, что вы можете получить информацию из базы данных, используя, например <a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a>.</p></div><div class="refsect1" id="APP-PGRESTORE-NOTES"><h2>Замечания</h2><p>Если в вашей инсталляции база данных <code class="literal">template1</code> содержит какие-либо дополнения, важно убедиться в том, что вывод <span class="application">pg_restore</span> загружается в действительно пустую базу; иначе вы, скорее всего, получите ошибки из-за дублирования определений создаваемых объектов. Чтобы получить пустую базу данных без дополнительных объектов, выберите в качестве шаблона <code class="literal">template0</code>, а не <code class="literal">template1</code>, например так: </p><pre class="programlisting">CREATE DATABASE foo WITH TEMPLATE template0;</pre><p>Ограничения <span class="application">pg_restore</span> описаны ниже. </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>При восстановлении данных в уже существующие таблицы с параметром <code class="option">--disable-triggers</code>, <span class="application">pg_restore</span> выполняет команды, отключающие триггеры в пользовательских таблицах до добавления данных, а затем, после добавления данных, выполняет команды, снова включающие эти триггеры. Если восстановление прервётся в середине, системные каталоги могут оказаться в некорректном состоянии.</p></li><li class="listitem"><p>Утилита <span class="application">pg_restore</span> не способна восстанавливать большие объекты избирательно; например, только для определённой таблицы. Если архив содержит большие объекты, они будут восстановлены все, либо не будут восстановлены никакие (если они были исключены параметрами <code class="option">-L</code>, <code class="option">-t</code> и т. п.).</p></li></ul></div><p>Также обратитесь к документации <a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle"><span class="application">pg_dump</span></span></a>, чтобы узнать о связанных ограничениях <span class="application">pg_dump</span>.</p><p>После восстановления имеет смысл запустить <code class="command">ANALYZE</code> для каждой восстановленной таблицы, чтобы оптимизатор получил актуальную статистику; за дополнительными сведениями обратитесь к <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-STATISTICS" title="25.1.3. Обновление статистики планировщика">Подразделу 25.1.3</a> и <a class="xref" href="routine-vacuuming.html#AUTOVACUUM" title="25.1.6. Демон автоочистки">Подразделу 25.1.6</a>.</p></div><div class="refsect1" id="APP-PGRESTORE-EXAMPLES"><h2>Примеры</h2><p>Предположим, что мы выгрузили базу данных <code class="literal">mydb</code> в файл специального формата: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dump -Fc mydb &gt; db.dump</code></strong>
</pre><p>Мы можем удалить базу данных и восстановить её из копии: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>dropdb mydb</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>pg_restore -C -d postgres db.dump</code></strong>
</pre><p> В аргументе <code class="option">-d</code> можно указать любую базу данных, существующую в кластере; <span class="application">pg_restore</span> использует её, только чтобы выполнить команду <code class="command">CREATE DATABASE</code> для базы <code class="literal">mydb</code>. С параметром <code class="option">-C</code> данные всегда восстанавливаются в базу, имя которой записано в файле архива.</p><p>Восстановить данные в новую базу <code class="literal">newdb</code> можно так: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>createdb -T template0 newdb</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>pg_restore -d newdb db.dump</code></strong>
</pre><p> Обратите внимание, мы не используем параметр <code class="option">-C</code>, а вместо этого подключаемся непосредственно к базе, в которую хотим восстановить данные. Также заметьте, что мы создаём базу данных из шаблона <code class="literal">template0</code>, а не <code class="literal">template1</code>, чтобы изначально она была гарантированно пустой.</p><p>Чтобы переупорядочить элементы базы данных, сначала необходимо получить оглавление архива: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_restore -l db.dump &gt; db.list</code></strong>
</pre><p> Файл оглавления содержит заголовок и по одной строке для каждого элемента, например: </p><pre class="programlisting">;
; Archive created at Mon Sep 14 13:55:39 2009
;     dbname: DBDEMOS
;     TOC Entries: 81
;     Compression: 9
;     Dump Version: 1.10-0
;     Format: CUSTOM
;     Integer: 4 bytes
;     Offset: 8 bytes
;     Dumped from database version: 8.3.5
;     Dumped by pg_dump version: 8.3.8
;
;
; Selected TOC Entries:
;
3; 2615 2200 SCHEMA - public pasha
1861; 0 0 COMMENT - SCHEMA public pasha
1862; 0 0 ACL - public pasha
317; 1247 17715 TYPE public composite pasha
319; 1247 25899 DOMAIN public domain0 pasha</pre><p> С точки с запятой начинаются комментарии, а число в начале строки обозначает внутренний идентификатор, назначаемый каждому элементу в архиве.</p><p>Строки в этом файле можно закомментировать, удалить или переместить. Например, список: </p><pre class="programlisting">10; 145433 TABLE map_resolutions postgres
;2; 145344 TABLE species postgres
;4; 145359 TABLE nt_header postgres
6; 145402 TABLE species_records postgres
;8; 145416 TABLE ss_old postgres</pre><p> можно передать утилите <span class="application">pg_restore</span>, чтобы восстановить только элементы 10 и 6 в указанном порядке: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_restore -L db.list db.dump</code></strong>
</pre></div><div class="refsect1" id="id-1.9.4.18.11"><h2>См. также</h2><span class="simplelist"><a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle"><span class="application">pg_dump</span></span></a>, <a class="xref" href="app-pg-dumpall.html" title="pg_dumpall"><span class="refentrytitle"><span class="application">pg_dumpall</span></span></a>, <a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="app-pgrecvlogical.html" title="pg_recvlogical">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="app-pgverifybackup.html" title="pg_verifybackup">След.</a></td></tr><tr><td width="40%" align="left" valign="top"><span class="application">pg_recvlogical</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> <span class="application">pg_verifybackup</span></td></tr></table></div></body></html>