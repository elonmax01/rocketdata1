<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>20.1. Изменение параметров</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="runtime-config.html" title="Глава 20. Настройка сервера" /><link rel="next" href="runtime-config-file-locations.html" title="20.2. Расположения файлов" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">20.1. Изменение параметров</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="runtime-config.html" title="Глава 20. Настройка сервера">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime-config.html" title="Глава 20. Настройка сервера">Наверх</a></td><th width="60%" align="center">Глава 20. Настройка сервера</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="runtime-config-file-locations.html" title="20.2. Расположения файлов">След.</a></td></tr></table><hr /></div><div class="sect1" id="CONFIG-SETTING"><div class="titlepage"><div><div><h2 class="title" style="clear: both">20.1. Изменение параметров <a href="#CONFIG-SETTING" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="config-setting.html#CONFIG-SETTING-NAMES-VALUES">20.1.1. Имена и значения параметров</a></span></dt><dt><span class="sect2"><a href="config-setting.html#CONFIG-SETTING-CONFIGURATION-FILE">20.1.2. Определение параметров в файле конфигурации</a></span></dt><dt><span class="sect2"><a href="config-setting.html#CONFIG-SETTING-SQL">20.1.3. Управление параметрами через SQL</a></span></dt><dt><span class="sect2"><a href="config-setting.html#CONFIG-SETTING-SHELL">20.1.4. Управление параметрами в командной строке</a></span></dt><dt><span class="sect2"><a href="config-setting.html#CONFIG-INCLUDES">20.1.5. Упорядочение содержимого файлов конфигурации</a></span></dt></dl></div><div class="sect2" id="CONFIG-SETTING-NAMES-VALUES"><div class="titlepage"><div><div><h3 class="title">20.1.1. Имена и значения параметров <a href="#CONFIG-SETTING-NAMES-VALUES" class="id_link">#</a></h3></div></div></div><p>Имена всех параметров являются регистронезависимыми. Каждый параметр принимает значение одного из пяти типов: логический, строка, целое, число с плавающей точкой или перечисление. От типа значения зависит синтаксис установки этого параметра:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>Логический:</em></span> Значения могут задаваться строками <code class="literal">on</code>, <code class="literal">off</code>, <code class="literal">true</code>, <code class="literal">false</code>, <code class="literal">yes</code>, <code class="literal">no</code>, <code class="literal">1</code>, <code class="literal">0</code> (регистр не имеет значения), либо как достаточно однозначный префикс одной из этих строк.</p></li><li class="listitem"><p><span class="emphasis"><em>Строка:</em></span> Обычно строковое значение заключается в апострофы (при этом внутренние апострофы дублируются). Однако если значение является простым числом или идентификатором, апострофы обычно можно опустить. (Значения, совпадающие с ключевыми словами SQL, всё же требуют заключения в апострофы в некоторых контекстах.)</p></li><li class="listitem"><p><span class="emphasis"><em>Число (целое или с плавающей точкой):</em></span> Значения числовых параметров могут задаваться в обычных форматах, принятых для целых чисел или чисел с плавающей точкой; если параметр целочисленный, дробные значения округляются до ближайшего целого. Кроме того, целочисленные параметры принимают значения в шестнадцатеричном (с префиксом <code class="literal">0x</code>) и восьмеричном (с префиксом <code class="literal">0</code>) виде, но дробная часть в таких случаях исключена. Разделители разрядов в значениях использовать нельзя. Заключать в кавычки требуется только значения в шестнадцатеричном виде.</p></li><li class="listitem"><p><span class="emphasis"><em>Число с единицей измерения:</em></span> Некоторые числовые параметры задаются с единицами измерения, так как они описывают количества информации или времени. Единицами могут быть байты, килобайты, блоки (обычно восемь килобайт), миллисекунды, секунды или минуты. При указании только числового значения для такого параметра единицей измерения будет считаться установленная для него единица по умолчанию, которая указывается в <code class="structname">pg_settings</code>.<code class="structfield">unit</code>. Для удобства параметры также можно задавать, указывая единицу измерения явно, например, задать <code class="literal">'120 ms'</code> для значения времени. При этом такое значение будет переведено в основную единицу измерения параметра. Заметьте, что для этого значение должно записываться в виде строки (в апострофах). Имя единицы является регистронезависимым, а между ним и числом допускаются пробельные символы. </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Допустимые единицы информации: <code class="literal">B</code> (байты), <code class="literal">kB</code> (килобайты), <code class="literal">MB</code> (мегабайты), <code class="literal">GB</code> (гигабайты) и <code class="literal">TB</code> (терабайты). Множителем единиц информации считается 1024, не 1000.</p></li><li class="listitem"><p>Допустимые единицы времени: <code class="literal">us</code> (микросекунды), <code class="literal">ms</code> (миллисекунды), <code class="literal">s</code> (секунды), <code class="literal">min</code> (минуты), <code class="literal">h</code> (часы) и <code class="literal">d</code> (дни).</p></li></ul></div><p> Если с единицей измерения задаётся дробное значение, оно будет округлено до следующей меньшей единицы, если такая имеется. Например, значение <code class="literal">30.1 GB</code> будет преобразовано в <code class="literal">30822 MB</code>, а не в <code class="literal">32319628902 B</code>. Если параметр имеет целочисленный тип, после преобразования единицы измерения значение окончательно округляется до целого.</p></li><li class="listitem"><p><span class="emphasis"><em>Перечисление:</em></span> Параметры, имеющие тип перечисление, записываются так же, как строковые параметры, но могут иметь только ограниченный набор значений. Список допустимых значений такого параметра задаётся в <code class="structname">pg_settings</code>.<code class="structfield">enumvals</code>. В значениях перечислений регистр не учитывается.</p></li></ul></div></div><div class="sect2" id="CONFIG-SETTING-CONFIGURATION-FILE"><div class="titlepage"><div><div><h3 class="title">20.1.2. Определение параметров в файле конфигурации <a href="#CONFIG-SETTING-CONFIGURATION-FILE" class="id_link">#</a></h3></div></div></div><p>Самый основной способ установки этих параметров — определение их значений в файле <code class="filename">postgresql.conf</code><a id="id-1.6.7.4.3.2.2" class="indexterm"></a>, который обычно находится в каталоге данных. При инициализации каталога кластера БД в этот каталог помещается копия стандартного файла. Например, он может выглядеть так: </p><pre class="programlisting"># Это комментарий
log_connections = yes
log_destination = 'syslog'
search_path = '"$user", public'
shared_buffers = 128MB</pre><p> Каждый параметр определяется в отдельной строке. Знак равенства в ней между именем и значением является необязательным. Пробельные символы в строке не играют роли (кроме значений, заключённых в апострофы), а пустые строки игнорируются. Знаки решётки (<code class="literal">#</code>) обозначают продолжение строки как комментарий. Значения параметров, не являющиеся простыми идентификаторами или числами, должны заключаться в апострофы. Чтобы включить в такое значение собственно апостроф, его следует продублировать (предпочтительнее) или предварить обратной косой чертой. Если один и тот же параметр определяется в файле конфигурации неоднократно, действовать будет только последнее определение, остальные игнорируются.</p><p>Параметры, установленные таким образом, задают значения по умолчанию для данного кластера. Эти значения будут действовать в активных сеансах, если не будут переопределены. В следующих разделах описывается, как их может переопределить администратор или пользователь.</p><p><a id="id-1.6.7.4.3.4.1" class="indexterm"></a> Основной процесс сервера перечитывает файл конфигурации заново, получая сигнал <span class="systemitem">SIGHUP</span>; послать его проще всего можно, запустив <code class="literal">pg_ctl reload</code> в командной строке или вызвав SQL-функцию <code class="function">pg_reload_conf()</code>. Основной процесс сервера передаёт этот сигнал всем остальным запущенным серверным процессам, так что существующие сеансы тоже получают новые значения (после того, как завершится выполнение текущей команды клиента). Также возможно послать этот сигнал напрямую одному из серверных процессов. Учтите, что некоторые параметры можно установить только при запуске сервера; любые изменения их значений в файле конфигурации не будут учитываться до перезапуска сервера. Более того, при обработке <span class="systemitem">SIGHUP</span> игнорируются неверные значения параметров (но об этом сообщается в журнале).</p><p>В дополнение к <code class="filename">postgresql.conf</code> в каталоге данных <span class="productname">PostgreSQL</span> содержится файл <code class="filename">postgresql.auto.conf</code><a id="id-1.6.7.4.3.5.4" class="indexterm"></a>, который имеет тот же формат, что и <code class="filename">postgresql.conf</code>, но предназначен для автоматического изменения, а не для редактирования вручную. Этот файл содержит параметры, задаваемые командой <a class="link" href="sql-altersystem.html" title="ALTER SYSTEM"><code class="command">ALTER SYSTEM</code></a>. Он считывается одновременно с <code class="filename">postgresql.conf</code> и заданные в нём параметры действуют таким же образом. Параметры в <code class="filename">postgresql.auto.conf</code> переопределяют те, что указаны в <code class="filename">postgresql.conf</code>.</p><p>Вносить изменения в <code class="filename">postgresql.auto.conf</code> можно и с использованием внешних средств. Однако это не рекомендуется делать в процессе работы сервера, так эти изменения могут быть потеряны при параллельном выполнении команды <code class="command">ALTER SYSTEM</code>. Внешние программы могут просто добавлять новые определения параметров в конец файла или удалять повторяющиеся определения и/или комментарии (как делает <code class="command">ALTER SYSTEM</code>).</p><p>Системное представление <a class="link" href="view-pg-file-settings.html" title="54.7. pg_file_settings"><code class="structname">pg_file_settings</code></a> может быть полезным для предварительной проверки изменений в файлах конфигурации или для диагностики проблем, если сигнал <span class="systemitem">SIGHUP</span> не даёт желаемого эффекта.</p></div><div class="sect2" id="CONFIG-SETTING-SQL"><div class="titlepage"><div><div><h3 class="title">20.1.3. Управление параметрами через SQL <a href="#CONFIG-SETTING-SQL" class="id_link">#</a></h3></div></div></div><p>В <span class="productname">PostgreSQL</span> есть три SQL-команды, задающие для параметров значения по умолчанию. Уже упомянутая команда <code class="command">ALTER SYSTEM</code> даёт возможность изменять глобальные значения средствами SQL; она функционально равнозначна редактированию <code class="filename">postgresql.conf</code>. Кроме того, есть ещё две команды, которые позволяют задавать значения по умолчанию на уровне баз данных и ролей:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Команда <a class="link" href="sql-alterdatabase.html" title="ALTER DATABASE"><code class="command">ALTER DATABASE</code></a> позволяет переопределить глобальные параметры на уровне базы данных.</p></li><li class="listitem"><p>Команда <a class="link" href="sql-alterrole.html" title="ALTER ROLE"><code class="command">ALTER ROLE</code></a> позволяет переопределить для конкретного пользователя как глобальные, так и локальные для базы данных параметры.</p></li></ul></div><p>Значения, установленные командами <code class="command">ALTER DATABASE</code> и <code class="command">ALTER ROLE</code>, применяются только при новом подключении к базе данных. Они переопределяют значения, полученные из файлов конфигурации или командной строки сервера, и применяются по умолчанию в рамках сеанса. Заметьте, что некоторые параметры невозможно изменить после запуска сервера, поэтому их нельзя установить этими командами (или командами, перечисленными ниже).</p><p>Когда клиент подключён к базе данных, он может воспользоваться двумя дополнительными командами SQL (и равнозначными функциями), которые предоставляет <span class="productname">PostgreSQL</span> для управления параметрами конфигурации:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Команда <a class="link" href="sql-show.html" title="SHOW"><code class="command">SHOW</code></a> позволяет узнать текущее значение любого параметра. Ей соответствует SQL-функция <code class="function">current_setting(setting_name text)</code> (см. <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-SET" title="9.27.1. Функции для управления конфигурацией">Подраздел 9.27.1</a>).</p></li><li class="listitem"><p>Команда <a class="link" href="sql-set.html" title="SET"><code class="command">SET</code></a> позволяет изменить текущее значение тех параметров, которые устанавливаются локально в рамках сеанса; на другие сеансы она не влияет. Многие параметры могут быть установлены таким образом любым пользователем, а некоторые — только суперпользователями и пользователями, которым предоставлено право <code class="literal">SET</code> для этого параметра. Ей соответствует SQL-функция <code class="function">set_config(setting_name, new_value, is_local)</code> (см. <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-SET" title="9.27.1. Функции для управления конфигурацией">Подраздел 9.27.1</a>).</p></li></ul></div><p>Кроме того, просмотреть и изменить значения параметров для текущего сеанса можно в системном представлении <a class="link" href="view-pg-settings.html" title="54.24. pg_settings"><code class="structname">pg_settings</code></a>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Запрос на чтение представления выдаёт ту же информацию, что и <code class="command">SHOW ALL</code>, но более подробно. Этот подход и более гибкий, так как в нём можно указать условия фильтра или связать результат с другими отношениями.</p></li><li class="listitem"><p>Выполнение <code class="command">UPDATE</code> для этого представления, а именно присваивание значения столбцу <code class="structfield">setting</code>, равносильно выполнению команды <code class="command">SET</code>. Например, команде </p><pre class="programlisting">SET configuration_parameter TO DEFAULT;</pre><p> равнозначен запрос: </p><pre class="programlisting">UPDATE pg_settings SET setting = reset_val WHERE name = 'configuration_parameter';</pre></li></ul></div></div><div class="sect2" id="CONFIG-SETTING-SHELL"><div class="titlepage"><div><div><h3 class="title">20.1.4. Управление параметрами в командной строке <a href="#CONFIG-SETTING-SHELL" class="id_link">#</a></h3></div></div></div><p>Помимо изменения глобальных значений по умолчанию и переопределения их на уровне базы данных или роли, параметры <span class="productname">PostgreSQL</span> можно изменить, используя средства командной строки. Управление через командную строку поддерживают и сервер, и клиентская библиотека <span class="application">libpq</span>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>При запуске сервера, значения параметров можно передать команде <code class="command">postgres</code> в аргументе командной строки <code class="option">-c</code>. Например: </p><pre class="programlisting">postgres -c log_connections=yes -c log_destination='syslog'</pre><p> Параметры, заданные таким образом, переопределяют те, что были установлены в <code class="filename">postgresql.conf</code> или командой <code class="command">ALTER SYSTEM</code>, так что их нельзя изменить глобально без перезапуска сервера.</p></li><li class="listitem"><p>При запуске клиентского сеанса, использующего <span class="application">libpq</span>, значения параметров можно указать в переменной окружения <code class="envar">PGOPTIONS</code>. Заданные таким образом параметры будут определять значения по умолчанию на время сеанса, но никак не влияют на другие сеансы. По историческим причинам формат <code class="envar">PGOPTIONS</code> похож на тот, что применяется при запуске команды <code class="command">postgres</code>; в частности, в нём должен присутствовать флаг <code class="option">-c</code>. Например: </p><pre class="programlisting">env PGOPTIONS="-c geqo=off -c statement_timeout=5min" psql</pre><p>Другие клиенты и библиотеки могут иметь собственные механизмы управления параметрами, через командную строку или как-то иначе, используя которые пользователь сможет менять параметры сеанса, не выполняя непосредственно команды SQL.</p></li></ul></div></div><div class="sect2" id="CONFIG-INCLUDES"><div class="titlepage"><div><div><h3 class="title">20.1.5. Упорядочение содержимого файлов конфигурации <a href="#CONFIG-INCLUDES" class="id_link">#</a></h3></div></div></div><p><span class="productname">PostgreSQL</span> предоставляет несколько возможностей для разделения сложных файлов <code class="filename">postgresql.conf</code> на вложенные файлы. Эти возможности особенно полезны при управлении множеством серверов с похожими, но не одинаковыми конфигурациями.</p><p><a id="id-1.6.7.4.6.3.1" class="indexterm"></a> Помимо присваиваний значений параметров, <code class="filename">postgresql.conf</code> может содержать <em class="firstterm">директивы включения</em> файлов, которые будут прочитаны и обработаны, как если бы их содержимое было вставлено в данном месте файла конфигурации. Это позволяет разбивать файл конфигурации на физически отдельные части. Директивы включения записываются просто: </p><pre class="programlisting">include 'имя_файла'</pre><p> Если имя файла задаётся не абсолютным путём, оно рассматривается относительно каталога, в котором находится включающий файл конфигурации. Включения файлов могут быть вложенными.</p><p><a id="id-1.6.7.4.6.4.1" class="indexterm"></a> Кроме того, есть директива <code class="literal">include_if_exists</code>, которая работает подобно <code class="literal">include</code>, за исключением случаев, когда включаемый файл не существует или не может быть прочитан. Обычная директива <code class="literal">include</code> считает это критической ошибкой, но <code class="literal">include_if_exists</code> просто выводит сообщение и продолжает обрабатывать текущий файл конфигурации.</p><p><a id="id-1.6.7.4.6.5.1" class="indexterm"></a> Файл <code class="filename">postgresql.conf</code> может также содержать директивы <code class="literal">include_dir</code>, позволяющие подключать целые каталоги с файлами конфигурации. Они записываются так: </p><pre class="programlisting">include_dir 'каталог'</pre><p> Имена, заданные не абсолютным путём, рассматриваются относительно каталога, содержащего текущий файл конфигурации. В заданном каталоге включению подлежат только файлы с именами, оканчивающимися на <code class="literal">.conf</code>. При этом файлы с именами, начинающимися с «<code class="literal">.</code>», тоже игнорируются, для предотвращения ошибок, так как они считаются скрытыми в ряде систем. Набор файлов во включаемом каталоге обрабатывается по порядку имён (определяемому правилами, принятыми в C, т. е. цифры идут перед буквами, а буквы в верхнем регистре — перед буквами в нижнем).</p><p>Включение файлов или каталогов позволяет разделить конфигурацию базы данных на логические части, а не вести один большой файл <code class="filename">postgresql.conf</code>. Например, представьте, что в некоторой компании есть два сервера баз данных, с разным объёмом ОЗУ. Скорее всего при этом их конфигурации будут иметь общие элементы, например, параметры ведения журналов. Но параметры, связанные с памятью, у них будут различаться. Кроме того, другие параметры могут быть специфическими для каждого сервера. Один из вариантов эффективного управления такими конфигурациями — разделить изменения стандартной конфигурации на три файла. Чтобы подключить эти файлы, можно добавить в конец файла <code class="filename">postgresql.conf</code> следующие директивы: </p><pre class="programlisting">include 'shared.conf'
include 'memory.conf'
include 'server.conf'</pre><p> Общие для всех серверов параметры будут помещаться в <code class="filename">shared.conf</code>. Файл <code class="filename">memory.conf</code> может иметь два варианта — первый для серверов с 8ГБ ОЗУ, а второй для серверов с 16 ГБ. Наконец, <code class="filename">server.conf</code> может содержать действительно специфические параметры для каждого отдельного сервера.</p><p>Также возможно создать каталог с файлами конфигурации и поместить туда все эти файлы. Например, так можно подключить каталог <code class="filename">conf.d</code> в конце <code class="filename">postgresql.conf</code>: </p><pre class="programlisting">include_dir 'conf.d'</pre><p> Затем можно дать файлам в каталоге <code class="filename">conf.d</code> следующие имена: </p><pre class="programlisting">00shared.conf
01memory.conf
02server.conf</pre><p> Такое именование устанавливает чёткий порядок подключения этих файлов, что важно, так как если параметр определяется несколько раз в разных файлах конфигурации, действовать будет последнее определение. В рамках данного примера, установленное в <code class="filename">conf.d/02server.conf</code> значение переопределит значение того же параметра, заданное в <code class="filename">conf.d/01memory.conf</code>.</p><p>Вы можете применить этот подход и с описательными именами файлов: </p><pre class="programlisting">00shared.conf
01memory-8GB.conf
02server-foo.conf</pre><p> При таком упорядочивании каждому варианту файла конфигурации даётся уникальное имя. Это помогает исключить конфликты, если конфигурации разных серверов нужно хранить в одном месте, например, в репозитории системы управления версиями. (Кстати, хранение файлов конфигурации в системе управления версиями — это ещё один эффективный приём, который стоит применять.)</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config.html" title="Глава 20. Настройка сервера">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html" title="Глава 20. Настройка сервера">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-file-locations.html" title="20.2. Расположения файлов">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Глава 20. Настройка сервера </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 20.2. Расположения файлов</td></tr></table></div></body></html>