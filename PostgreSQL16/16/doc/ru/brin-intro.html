<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>71.1. Введение</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="brin.html" title="Глава 71. Индексы BRIN" /><link rel="next" href="brin-builtin-opclasses.html" title="71.2. Встроенные классы операторов" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">71.1. Введение</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="brin.html" title="Глава 71. Индексы BRIN">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="brin.html" title="Глава 71. Индексы BRIN">Наверх</a></td><th width="60%" align="center">Глава 71. Индексы BRIN</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="brin-builtin-opclasses.html" title="71.2. Встроенные классы операторов">След.</a></td></tr></table><hr /></div><div class="sect1" id="BRIN-INTRO"><div class="titlepage"><div><div><h2 class="title" style="clear: both">71.1. Введение <a href="#BRIN-INTRO" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="brin-intro.html#BRIN-OPERATION">71.1.1. Обслуживание индекса</a></span></dt></dl></div><p><acronym class="acronym">BRIN</acronym> расшифровывается как «Block Range Index» (Индекс зон блоков). <acronym class="acronym">BRIN</acronym> предназначается для обработки очень больших таблиц, в которых определённые столбцы некоторым естественным образом коррелируют с их физическим расположением в таблице.</p><p>В <acronym class="acronym">BRIN</acronym> используется понятие <em class="firstterm">зоны блоков</em> (или <span class="quote">«<span class="quote">зоны страниц</span>»</span>). <em class="firstterm">Зоной блоков</em> называется группа страниц, физически расположенных в таблице рядом; для каждой зоны в индексе сохраняется некоторая сводная информация. Например, в таблице заказов магазина может содержаться поле с датой добавления заказа, и практически всегда записи более ранних заказов и в таблице будут размещены ближе к началу; в таблице, содержащей столбец с почтовым индексом, также естественным образом могут группироваться записи по городам.</p><p>Индексы <acronym class="acronym">BRIN</acronym> могут удовлетворять запросы, выполняя обычное сканирование по битовой карте, и будут возвращать все кортежи во всех страницах каждой зоны, если сводные данные, сохранённые в индексе, <em class="firstterm">соответствуют</em> условиям запроса. Исполнитель запроса должен перепроверить эти кортежи и отбросить те, что не соответствуют условиям запроса — другими словами, эти индексы неточные. Так как индекс <acronym class="acronym">BRIN</acronym> очень маленький, сканирование индекса влечёт мизерные издержки по сравнению с последовательным сканированием, но может избавить от необходимости сканирования больших областей таблицы, которые определённо не содержат подходящие кортежи.</p><p>Конкретные данные, которые будут хранится в индексе <acronym class="acronym">BRIN</acronym>, а также запросы, которые сможет поддержать этот индекс, зависят от класса операторов, выбранного для каждого столбца индекса. Например, типы данных с линейным порядком сортировки могут иметь классы операторов, хранящие минимальное и максимальное значение для каждой зоны блоков; для геометрических типов может храниться прямоугольник, вмещающий все объекты в зоне блоков.</p><p>Размер зоны блоков определяется в момент создания индекса параметром хранения <code class="literal">pages_per_range</code>. Число записей в индексе будет равняться размеру отношения в страницах, делённому на установленное значение <code class="literal">pages_per_range</code>. Таким образом, чем меньше это число, тем больше становится индекс (так как в нём требуется хранить больше элементов), но в то же время сводные данные могут быть более точными и большее число блоков данных может быть пропущено при сканировании индекса.</p><div class="sect2" id="BRIN-OPERATION"><div class="titlepage"><div><div><h3 class="title">71.1.1. Обслуживание индекса <a href="#BRIN-OPERATION" class="id_link">#</a></h3></div></div></div><p>Во время создания индекса сканируются все существующие страницы, и в результате в индексе создаётся сводный кортеж для каждой зоны, в том числе, возможно неполной зоны в конце. По мере того, как данными наполняются новые страницы, если они оказываются в зонах, для которых уже есть сводная информация, она будет обновлена с учётом данных из новых кортежей. Если же создаётся новая страница, не попадающая в последнюю зону, для зоны, в которую попадает новая страница, сводная запись не рассчитывается автоматически; кортежи на таких страницах остаются неучтёнными, пока не будет проведён начальный расчёт сводных данных для этой зоны.</p><p>Начальный расчёт сводки для зоны страниц может производиться несколькими способами. Во-первых, сводка рассчитывается в ходе процедуры VACUUM, запущенной вручную или из процесса <a class="link" href="routine-vacuuming.html#AUTOVACUUM" title="25.1.6. Демон автоочистки">autovacuum</a>, для всех существующих зон. Во-вторых, если включён параметр <a class="xref" href="sql-createindex.html#INDEX-RELOPTION-AUTOSUMMARIZE">autosummarize</a> для индекса (по умолчанию он отключён), при автоочистке этой базы данных производится расчёт сводки для всех зон без сводной информации, охватывающих недавно заполненные страницы таблицы, независимо от того, выполняется ли автоочистка именно этой таблицы; подробнее см. ниже.</p><p>Наконец, можно использовать следующие функции: </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="function">brin_summarize_new_values(regclass)</code>, рассчитывающую сводку для зон без сводных данных;</td></tr><tr><td><code class="function">brin_summarize_range(regclass, bigint)</code>, рассчитывающую сводку для зоны без сводных данных, содержащей указанную страницу.</td></tr></table><p>Когда включён режим автопересчёта сводки, при первом добавлении данных в первую страницу новой зоны процессу <code class="literal">autovacuum</code> передаётся запрос на расчёт сводки для этой зоны. Этот запрос будет выполнен при следующей обработке этой базы рабочим процессом автоочистки. Если очередь запросов переполнена, запрос в неё не записывается и в журнал сервера выводится соответствующее сообщение: </p><pre class="screen">
LOG:  request for BRIN range summarization for index "brin_wi_idx" page 128 was not recorded
</pre><p> В этом случае зона останется без сводного значения, а чтобы его рассчитать, нужно вручную выполнить очистку этой таблицы или вызвать одну из вышеуказанных функций.</p><p>И наоборот, можно удалить сводное значение для зоны, вызвав функцию <code class="function">brin_desummarize_range(regclass, bigint)</code>, что может быть полезно, когда этот кортеж в индексе становится не очень хорошим представлением соответствующих данных, так как они изменились. За дополнительной информацией обратитесь к <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-INDEX" title="9.27.8. Функции обслуживания индексов">Подразделу 9.27.8</a>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="brin.html" title="Глава 71. Индексы BRIN">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="brin.html" title="Глава 71. Индексы BRIN">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="brin-builtin-opclasses.html" title="71.2. Встроенные классы операторов">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Глава 71. Индексы BRIN </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 71.2. Встроенные классы операторов</td></tr></table></div></body></html>