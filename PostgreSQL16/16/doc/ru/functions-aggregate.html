<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>9.21. Агрегатные функции</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="functions-range.html" title="9.20. Диапазонные/мультидиапазонные функции и операторы" /><link rel="next" href="functions-window.html" title="9.22. Оконные функции" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">9.21. Агрегатные функции</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="functions-range.html" title="9.20. Диапазонные/мультидиапазонные функции и операторы">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="functions.html" title="Глава 9. Функции и операторы">Наверх</a></td><th width="60%" align="center">Глава 9. Функции и операторы</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="functions-window.html" title="9.22. Оконные функции">След.</a></td></tr></table><hr /></div><div class="sect1" id="FUNCTIONS-AGGREGATE"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.21. Агрегатные функции <a href="#FUNCTIONS-AGGREGATE" class="id_link">#</a></h2></div></div></div><a id="id-1.5.8.27.2" class="indexterm"></a><p><em class="firstterm">Агрегатные функции</em> получают единственный результат из набора входных значений. Встроенные агрегатные функции общего назначения перечислены в <a class="xref" href="functions-aggregate.html#FUNCTIONS-AGGREGATE-TABLE" title="Таблица 9.59. Агрегатные функции общего назначения">Таблице 9.59</a>, а статистические агрегатные функции — в <a class="xref" href="functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE" title="Таблица 9.60. Агрегатные функции для статистических вычислений">Таблице 9.60</a>. Встроенные внутригрупповые сортирующие агрегатные функции перечислены в <a class="xref" href="functions-aggregate.html#FUNCTIONS-ORDEREDSET-TABLE" title="Таблица 9.61. Сортирующие агрегатные функции">Таблице 9.61</a>, встроенные внутригрупповые гипотезирующие — в <a class="xref" href="functions-aggregate.html#FUNCTIONS-HYPOTHETICAL-TABLE" title="Таблица 9.62. Гипотезирующие агрегатные функции">Таблице 9.62</a>. Группирующие операторы, тесно связанные с агрегатными функциями, перечислены в <a class="xref" href="functions-aggregate.html#FUNCTIONS-GROUPING-TABLE" title="Таблица 9.63. Операции группировки">Таблице 9.63</a>. Особенности синтаксиса агрегатных функцией разъясняются в <a class="xref" href="sql-expressions.html#SYNTAX-AGGREGATES" title="4.2.7. Агрегатные выражения">Подразделе 4.2.7</a>. За дополнительной вводной информацией обратитесь к <a class="xref" href="tutorial-agg.html" title="2.7. Агрегатные функции">Разделу 2.7</a>.</p><p>Агрегатные функции, поддерживающие <em class="firstterm">частичный режим</em>, являются кандидатами на участие в различных оптимизациях, например, в параллельном агрегировании.</p><div class="table" id="FUNCTIONS-AGGREGATE-TABLE"><p class="title"><strong>Таблица 9.59. Агрегатные функции общего назначения</strong></p><div class="table-contents"><table class="table" summary="Агрегатные функции общего назначения" border="1"><colgroup><col class="col1" /><col class="col2" /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th><th>Частичный режим</th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.1.1.1.1" class="indexterm"></a> <code class="function">any_value</code> ( <code class="type">anyelement</code> ) → <code class="returnvalue"><em class="replaceable"><code>тот же тип, что на входе</code></em></code></p>
       <p>Возвращает произвольное значение из входных значений, отличных от NULL.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.2.1.1.1" class="indexterm"></a> <code class="function">array_agg</code> ( <code class="type">anynonarray</code> ) → <code class="returnvalue">anyarray</code></p>
       <p>Собирает все входные значения, включая NULL, в массив.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><code class="function">array_agg</code> ( <code class="type">anyarray</code> ) → <code class="returnvalue">anyarray</code></p>
       <p>Собирает все входные массивы в массив с размерностью больше на один. (Входные массивы должны иметь одинаковую размерность и не могут быть пустыми или равны NULL).</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.4.1.1.1" class="indexterm"></a> <a id="id-1.5.8.27.5.2.4.4.1.1.2" class="indexterm"></a> <code class="function">avg</code> ( <code class="type">smallint</code> ) → <code class="returnvalue">numeric</code></p>
       <p class="func_signature"><code class="function">avg</code> ( <code class="type">integer</code> ) → <code class="returnvalue">numeric</code></p>
       <p class="func_signature"><code class="function">avg</code> ( <code class="type">bigint</code> ) → <code class="returnvalue">numeric</code></p>
       <p class="func_signature"><code class="function">avg</code> ( <code class="type">numeric</code> ) → <code class="returnvalue">numeric</code></p>
       <p class="func_signature"><code class="function">avg</code> ( <code class="type">real</code> ) → <code class="returnvalue">double precision</code></p>
       <p class="func_signature"><code class="function">avg</code> ( <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p class="func_signature"><code class="function">avg</code> ( <code class="type">interval</code> ) → <code class="returnvalue">interval</code></p>
       <p>Вычисляет арифметическое среднее для всех входных значений, отличных от NULL.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.5.1.1.1" class="indexterm"></a> <code class="function">bit_and</code> ( <code class="type">smallint</code> ) → <code class="returnvalue">smallint</code></p>
       <p class="func_signature"><code class="function">bit_and</code> ( <code class="type">integer</code> ) → <code class="returnvalue">integer</code></p>
       <p class="func_signature"><code class="function">bit_and</code> ( <code class="type">bigint</code> ) → <code class="returnvalue">bigint</code></p>
       <p class="func_signature"><code class="function">bit_and</code> ( <code class="type">bit</code> ) → <code class="returnvalue">bit</code></p>
       <p>Вычисляет побитовое И для всех входных значений, отличных от NULL.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.6.1.1.1" class="indexterm"></a> <code class="function">bit_or</code> ( <code class="type">smallint</code> ) → <code class="returnvalue">smallint</code></p>
       <p class="func_signature"><code class="function">bit_or</code> ( <code class="type">integer</code> ) → <code class="returnvalue">integer</code></p>
       <p class="func_signature"><code class="function">bit_or</code> ( <code class="type">bigint</code> ) → <code class="returnvalue">bigint</code></p>
       <p class="func_signature"><code class="function">bit_or</code> ( <code class="type">bit</code> ) → <code class="returnvalue">bit</code></p>
       <p>Вычисляет побитовое ИЛИ для всех входных значений, отличных от NULL.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.7.1.1.1" class="indexterm"></a> <code class="function">bit_xor</code> ( <code class="type">smallint</code> ) → <code class="returnvalue">smallint</code></p>
       <p class="func_signature"><code class="function">bit_xor</code> ( <code class="type">integer</code> ) → <code class="returnvalue">integer</code></p>
       <p class="func_signature"><code class="function">bit_xor</code> ( <code class="type">bigint</code> ) → <code class="returnvalue">bigint</code></p>
       <p class="func_signature"><code class="function">bit_xor</code> ( <code class="type">bit</code> ) → <code class="returnvalue">bit</code></p>
       <p>Вычисляет побитовое исключающее ИЛИ для всех входных значений, отличных от NULL. Может быть полезна для вычисления контрольной суммы неупорядоченного набора значений.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.8.1.1.1" class="indexterm"></a> <code class="function">bool_and</code> ( <code class="type">boolean</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Возвращает true, если все входные значения, отличные от NULL, равны true, и false в противном случае.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.9.1.1.1" class="indexterm"></a> <code class="function">bool_or</code> ( <code class="type">boolean</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Возвращает true, если хотя бы одно входное значение, отличное от NULL, равно true, и false в противном случае.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.10.1.1.1" class="indexterm"></a> <code class="function">count</code> ( <code class="literal">*</code> ) → <code class="returnvalue">bigint</code></p>
       <p>Выдаёт количество входных строк.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><code class="function">count</code> ( <code class="type">"any"</code> ) → <code class="returnvalue">bigint</code></p>
       <p>Выдаёт количество входных строк, в которых входное значение отлично от NULL.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.12.1.1.1" class="indexterm"></a> <code class="function">every</code> ( <code class="type">boolean</code> ) → <code class="returnvalue">boolean</code></p>
       <p>Это соответствующий стандарту SQL аналог <code class="function">bool_and</code>.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.13.1.1.1" class="indexterm"></a> <code class="function">json_agg</code> ( <code class="type">anyelement</code> ) → <code class="returnvalue">json</code></p>
       <p class="func_signature"><a id="id-1.5.8.27.5.2.4.13.1.2.1" class="indexterm"></a> <code class="function">jsonb_agg</code> ( <code class="type">anyelement</code> ) → <code class="returnvalue">jsonb</code></p>
       <p>Собирает все входные значения, включая NULL, в JSON-массив. Значения преобразуются в JSON методом <code class="function">to_json</code> или <code class="function">to_jsonb</code>.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.14.1.1.1" class="indexterm"></a> <code class="function">json_objectagg</code> ( [<span class="optional"> { <em class="replaceable"><code>выражение_ключа</code></em> { <code class="literal">VALUE</code> | ':' } <em class="replaceable"><code>выражение_значения</code></em> } </span>] [<span class="optional"> { <code class="literal">NULL</code> | <code class="literal">ABSENT</code> } <code class="literal">ON NULL</code></span>] [<span class="optional"> { <code class="literal">WITH</code> | <code class="literal">WITHOUT</code> } <code class="literal">UNIQUE</code> [<span class="optional"><code class="literal">KEYS</code></span>]</span>] [<span class="optional"><code class="literal">RETURNING</code> <em class="replaceable"><code>тип_данных</code></em> [<span class="optional"><code class="literal">FORMAT JSON</code> [<span class="optional"><code class="literal">ENCODING UTF8</code></span>]</span>]</span>])</p>
        <p>Ведёт себя так же, как описанная выше функция <code class="function">json_object</code>, но является агрегатной, поэтому принимает только один аргумент <em class="replaceable"><code>выражение_ключа</code></em> и один аргумент <em class="replaceable"><code>выражение_значения</code></em>.</p>
        <p>
         <code class="literal">SELECT json_objectagg(k:v) FROM (VALUES ('a'::text,current_date),('b',current_date + 1)) AS t(k,v)</code>
         → <code class="returnvalue">{ "a" : "2022-05-10", "b" : "2022-05-11" }</code>
       </p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.15.1.1.1" class="indexterm"></a> <code class="function">json_object_agg</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">json</code></p>
       <p class="func_signature"><a id="id-1.5.8.27.5.2.4.15.1.2.1" class="indexterm"></a> <code class="function">jsonb_object_agg</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">jsonb</code></p>
       <p>Собирает все пары ключ/значение в JSON-объект. Аргументы-ключи приводятся к текстовому типу, а значения преобразуются методом <code class="function">to_json</code> или <code class="function">to_jsonb</code>. В качестве значений, но не ключей, могут передаваться null.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.16.1.1.1" class="indexterm"></a> <code class="function">json_object_agg_strict</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">json</code></p>
       <p class="func_signature"><a id="id-1.5.8.27.5.2.4.16.1.2.1" class="indexterm"></a> <code class="function">jsonb_object_agg_strict</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">jsonb</code></p>
       <p>Собирает все пары ключ/значение в JSON-объект. Аргументы-ключи приводятся к текстовому типу, а значения преобразуются методом <code class="function">to_json</code> или <code class="function">to_jsonb</code>. Аргумент <em class="parameter"><code>key</code></em> должен быть отличен от NULL. Если <em class="parameter"><code>value</code></em> равно NULL, запись пропускается.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.17.1.1.1" class="indexterm"></a> <code class="function">json_object_agg_unique</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">json</code></p>
       <p class="func_signature"><a id="id-1.5.8.27.5.2.4.17.1.2.1" class="indexterm"></a> <code class="function">jsonb_object_agg_unique</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">jsonb</code></p>
       <p>Собирает все пары ключ/значение в JSON-объект. Аргументы-ключи приводятся к текстовому типу, а значения преобразуются методом <code class="function">to_json</code> или <code class="function">to_jsonb</code>. В качестве значений, но не ключей, могут передаваться null. При наличии повторяющихся ключей выдаётся ошибка.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.18.1.1.1" class="indexterm"></a> <code class="function">json_arrayagg</code> ( [<span class="optional"><em class="replaceable"><code>выражение_значения</code></em></span>] [<span class="optional"><code class="literal">ORDER BY</code> <em class="replaceable"><code>выражение_сортировки</code></em></span>] [<span class="optional"> { <code class="literal">NULL</code> | <code class="literal">ABSENT</code> } <code class="literal">ON NULL</code></span>] [<span class="optional"><code class="literal">RETURNING</code> <em class="replaceable"><code>тип_данных</code></em> [<span class="optional"><code class="literal">FORMAT JSON</code> [<span class="optional"><code class="literal">ENCODING UTF8</code></span>]</span>]</span>])</p>
       <p>Ведёт себя так же, как функция <code class="function">json_array</code>, но агрегатная, поэтому принимает только один параметр <em class="replaceable"><code>выражение_значения</code></em>. С указанием <code class="literal">ABSENT ON NULL</code> любые значения NULL пропускаются. С указанием <code class="literal">ORDER BY</code> элементы добавляются в массив в заданном порядке, а не в том порядке, в котором они вводятся.</p>
       <p>
        <code class="literal">SELECT json_arrayagg(v) FROM (VALUES(2),(1)) t(v)</code>
        → <code class="returnvalue">[2, 1]</code>
       </p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.19.1.1.1" class="indexterm"></a> <code class="function">json_object_agg_unique_strict</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">json</code></p>
       <p class="func_signature"><a id="id-1.5.8.27.5.2.4.19.1.2.1" class="indexterm"></a> <code class="function">jsonb_object_agg_unique_strict</code> ( <em class="parameter"><code>key</code></em> <code class="type">"any"</code>, <em class="parameter"><code>value</code></em> <code class="type">"any"</code> ) → <code class="returnvalue">jsonb</code></p>
       <p>Собирает все пары ключ/значение в JSON-объект. Аргументы-ключи приводятся к текстовому типу, а значения преобразуются методом <code class="function">to_json</code> или <code class="function">to_jsonb</code>. В качестве значений, но не ключей, могут передаваться null. Если <em class="parameter"><code>value</code></em> равно null, запись пропускается. Если есть повторяющийся ключ, выдаётся ошибка.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.20.1.1.1" class="indexterm"></a> <code class="function">max</code> ( <em class="replaceable"><code>см. описание</code></em> ) → <code class="returnvalue"><em class="replaceable"><code>тот же тип, что на входе</code></em></code></p>
       <p>Вычисляет максимальное из всех значений, отличных от NULL. Имеется для всех числовых и строковых типов, типов-перечислений и даты/времени, а также типов <code class="type">inet</code>, <code class="type">interval</code>, <code class="type">money</code>, <code class="type">oid</code>, <code class="type">pg_lsn</code>, <code class="type">tid</code>, <code class="type">xid8</code> и массивов с элементами этих типов.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.21.1.1.1" class="indexterm"></a> <code class="function">min</code> ( <em class="replaceable"><code>см. описание</code></em> ) → <code class="returnvalue"><em class="replaceable"><code>тот же тип, что на входе</code></em></code></p>
       <p>Вычисляет минимальное из всех значений, отличных от NULL. Имеется для всех числовых и строковых типов, типов-перечислений и даты/времени, а также типов <code class="type">inet</code>, <code class="type">interval</code>, <code class="type">money</code>, <code class="type">oid</code>, <code class="type">pg_lsn</code>, <code class="type">tid</code>, <code class="type">xid8</code> и массивов с элементами этих типов.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.22.1.1.1" class="indexterm"></a> <code class="function">range_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">anyrange</code> ) → <code class="returnvalue">anymultirange</code></p>
       <p class="func_signature"><code class="function">range_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">anymultirange</code> ) → <code class="returnvalue">anymultirange</code></p>
       <p>Вычисляет объединение всех входных значений, отличных от NULL.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.23.1.1.1" class="indexterm"></a> <code class="function">range_intersect_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">anyrange</code> ) → <code class="returnvalue">anyrange</code></p>
       <p class="func_signature"><code class="function">range_intersect_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">anymultirange</code> ) → <code class="returnvalue">anymultirange</code></p>
       <p>Вычисляет пересечение всех входных значений, отличных от NULL.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.24.1.1.1" class="indexterm"></a> <code class="function">json_agg_strict</code> ( <code class="type">anyelement</code> ) → <code class="returnvalue">json</code></p>
       <p class="func_signature"><a id="id-1.5.8.27.5.2.4.24.1.2.1" class="indexterm"></a> <code class="function">jsonb_agg_strict</code> ( <code class="type">anyelement</code> ) → <code class="returnvalue">jsonb</code></p>
       <p>Собирает все входные значения, исключая NULL, в JSON-массив. Значения преобразуются в JSON методом <code class="function">to_json</code> или <code class="function">to_jsonb</code>.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.25.1.1.1" class="indexterm"></a> <code class="function">string_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">text</code>, <em class="parameter"><code>delimiter</code></em> <code class="type">text</code> ) → <code class="returnvalue">text</code></p>
       <p class="func_signature"><code class="function">string_agg</code> ( <em class="parameter"><code>value</code></em> <code class="type">bytea</code>, <em class="parameter"><code>delimiter</code></em> <code class="type">bytea</code> ) → <code class="returnvalue">bytea</code></p>
       <p>Соединяет все входные значения, отличные от NULL, в строку. Перед каждым значением, кроме первого, добавляется соответствующий разделитель, заданный параметром <em class="parameter"><code>delimiter</code></em> (если он отличен от NULL).</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.26.1.1.1" class="indexterm"></a> <code class="function">sum</code> ( <code class="type">smallint</code> ) → <code class="returnvalue">bigint</code></p>
       <p class="func_signature"><code class="function">sum</code> ( <code class="type">integer</code> ) → <code class="returnvalue">bigint</code></p>
       <p class="func_signature"><code class="function">sum</code> ( <code class="type">bigint</code> ) → <code class="returnvalue">numeric</code></p>
       <p class="func_signature"><code class="function">sum</code> ( <code class="type">numeric</code> ) → <code class="returnvalue">numeric</code></p>
       <p class="func_signature"><code class="function">sum</code> ( <code class="type">real</code> ) → <code class="returnvalue">real</code></p>
       <p class="func_signature"><code class="function">sum</code> ( <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p class="func_signature"><code class="function">sum</code> ( <code class="type">interval</code> ) → <code class="returnvalue">interval</code></p>
       <p class="func_signature"><code class="function">sum</code> ( <code class="type">money</code> ) → <code class="returnvalue">money</code></p>
       <p>Вычисляет сумму всех входных значений, отличных от NULL.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.5.2.4.27.1.1.1" class="indexterm"></a> <code class="function">xmlagg</code> ( <code class="type">xml</code> ) → <code class="returnvalue">xml</code></p>
       <p>Соединяет вместе входные XML-значения, отличные от NULL (см. также <a class="xref" href="functions-xml.html#FUNCTIONS-XML-XMLAGG" title="9.15.1.7. xmlagg">Подраздел 9.15.1.7</a>).</p></td><td>Нет</td></tr></tbody></table></div></div><br class="table-break" /><p>Следует заметить, что за исключением <code class="function">count</code>, все эти функции возвращают NULL, если для них не была выбрана ни одна строка. В частности, функция <code class="function">sum</code>, не получив строк, возвращает NULL, а не 0, как можно было бы ожидать, и <code class="function">array_agg</code> в этом случае возвращает NULL, а не пустой массив. Если необходимо, подставить в результат 0 или пустой массив вместо NULL можно с помощью функции <code class="function">coalesce</code>.</p><p>Агрегатные функции <code class="function">array_agg</code>, <code class="function">json_agg</code>, <code class="function">jsonb_agg</code>, <code class="function">json_agg_strict</code>, <code class="function">jsonb_agg_strict</code>, <code class="function">json_object_agg</code>, <code class="function">jsonb_object_agg</code>, <code class="function">json_object_agg_strict</code>, <code class="function">jsonb_object_agg_strict</code>, <code class="function">json_object_agg_unique</code>, <code class="function">jsonb_object_agg_unique</code>, <code class="function">json_object_agg_unique_strict</code>, <code class="function">jsonb_object_agg_unique_strict</code>, <code class="function">string_agg</code> и <code class="function">xmlagg</code> так же, как и подобные пользовательские агрегатные функции, выдают разные по содержанию результаты в зависимости от порядка входных значений. По умолчанию порядок не определён, но его можно задать, дополнив вызов агрегатной функции предложением <code class="literal">ORDER BY</code>, как описано в <a class="xref" href="sql-expressions.html#SYNTAX-AGGREGATES" title="4.2.7. Агрегатные выражения">Подразделе 4.2.7</a>. Обычно нужного результата также можно добиться, передав для агрегирования результат подзапроса с сортировкой. Например: </p><pre class="screen">
SELECT xmlagg(x) FROM (SELECT x FROM test ORDER BY y DESC) AS tab;
</pre><p> Но учтите, что этот подход может не работать, если на внешнем уровне запроса выполняется дополнительная обработка, например соединение, так как при этом результат подзапроса может быть переупорядочен перед вычислением агрегатной функции.</p><div class="note"><h3 class="title">Примечание</h3><a id="id-1.5.8.27.8.1" class="indexterm"></a><a id="id-1.5.8.27.8.2" class="indexterm"></a><p>Логические агрегатные функции <code class="function">bool_and</code> и <code class="function">bool_or</code> равнозначны описанным в стандарте SQL агрегатам <code class="function">every</code> и <code class="function">any</code> или <code class="function">some</code>. <span class="productname">PostgreSQL</span> поддерживает <code class="function">every</code>, но не <code class="function">any</code>/<code class="function">some</code>, так как синтаксис, описанный в стандарте, допускает неоднозначность: </p><pre class="programlisting">SELECT b1 = ANY((SELECT b2 FROM t2 ...)) FROM t1 ...;</pre><p> Здесь <code class="function">ANY</code> можно рассматривать и как объявление подзапроса, и как агрегатную функцию, если этот подзапрос возвращает одну строку с булевым значением. Таким образом, этим агрегатным функциям нельзя было дать стандартные имена.</p></div><div class="note"><h3 class="title">Примечание</h3><p>Пользователи с опытом использования других СУБД SQL могут быть недовольны скоростью агрегатной функции <code class="function">count</code>, когда она применяется ко всей таблице. Подобный запрос: </p><pre class="programlisting">SELECT count(*) FROM sometable;</pre><p> потребует затрат в количестве, пропорциональном размеру таблицы: <span class="productname">PostgreSQL</span> придётся полностью просканировать либо всю таблицу, либо один из индексов, включающий все её строки.</p></div><p>В <a class="xref" href="functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE" title="Таблица 9.60. Агрегатные функции для статистических вычислений">Таблице 9.60</a> перечислены агрегатные функции, обычно применяемые в статистическом анализе. (Они выделены просто для того, чтобы не загромождать список наиболее популярных агрегатных функций.) Функции, показанные как принимающие <em class="replaceable"><code>числовой_тип</code></em>, существуют для типов <code class="type">smallint</code>, <code class="type">integer</code>, <code class="type">bigint</code>, <code class="type">numeric</code>, <code class="type">real</code>, и <code class="type">double precision</code>. В их описании под <em class="parameter"><code>N</code></em> подразумевается число входных строк, для которых все входные выражения отличны от NULL. Во всех случаях, когда вычисление не имеет смысла, например, когда <em class="parameter"><code>N</code></em> равно нулю, возвращается null.</p><a id="id-1.5.8.27.11" class="indexterm"></a><a id="id-1.5.8.27.12" class="indexterm"></a><div class="table" id="FUNCTIONS-AGGREGATE-STATISTICS-TABLE"><p class="title"><strong>Таблица 9.60. Агрегатные функции для статистических вычислений</strong></p><div class="table-contents"><table class="table" summary="Агрегатные функции для статистических вычислений" border="1"><colgroup><col class="col1" /><col class="col2" /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th><th>Частичный режим</th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.1.1.1.1" class="indexterm"></a> <a id="id-1.5.8.27.13.2.4.1.1.1.2" class="indexterm"></a> <code class="function">corr</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет коэффициент корреляции.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.2.1.1.1" class="indexterm"></a> <a id="id-1.5.8.27.13.2.4.2.1.1.2" class="indexterm"></a> <code class="function">covar_pop</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет ковариацию совокупности.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.3.1.1.1" class="indexterm"></a> <a id="id-1.5.8.27.13.2.4.3.1.1.2" class="indexterm"></a> <code class="function">covar_samp</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет ковариацию выборки.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.4.1.1.1" class="indexterm"></a> <code class="function">regr_avgx</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет среднее для независимой переменной, <code class="literal">sum(<em class="parameter"><code>X</code></em>)/<em class="parameter"><code>N</code></em></code>.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.5.1.1.1" class="indexterm"></a> <code class="function">regr_avgy</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет среднее для зависимой переменной, <code class="literal">sum(<em class="parameter"><code>Y</code></em>)/<em class="parameter"><code>N</code></em></code>.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.6.1.1.1" class="indexterm"></a> <code class="function">regr_count</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">bigint</code></p>
       <p>Вычисляет число входных строк, в которых оба выражения отличны от NULL.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.7.1.1.1" class="indexterm"></a> <a id="id-1.5.8.27.13.2.4.7.1.1.2" class="indexterm"></a> <code class="function">regr_intercept</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет пересечение с осью OY линии, полученной методом наименьших квадратов по парам (<em class="parameter"><code>X</code></em>, <em class="parameter"><code>Y</code></em>).</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.8.1.1.1" class="indexterm"></a> <code class="function">regr_r2</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет квадрат коэффициента корреляции.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.9.1.1.1" class="indexterm"></a> <a id="id-1.5.8.27.13.2.4.9.1.1.2" class="indexterm"></a> <code class="function">regr_slope</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет наклон линии, полученной методом наименьших квадратов по парам (<em class="parameter"><code>X</code></em>, <em class="parameter"><code>Y</code></em>).</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.10.1.1.1" class="indexterm"></a> <code class="function">regr_sxx</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет <span class="quote">«<span class="quote">сумму квадратов</span>»</span> независимой переменной, <code class="literal">sum(<em class="parameter"><code>X</code></em>^2) - sum(<em class="parameter"><code>X</code></em>)^2/<em class="parameter"><code>N</code></em></code>.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.11.1.1.1" class="indexterm"></a> <code class="function">regr_sxy</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет <span class="quote">«<span class="quote">сумму произведений</span>»</span> независимой и зависимой переменных, <code class="literal">sum(<em class="parameter"><code>X</code></em>*<em class="parameter"><code>Y</code></em>) - sum(<em class="parameter"><code>X</code></em>) * sum(<em class="parameter"><code>Y</code></em>)/<em class="parameter"><code>N</code></em></code>.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.12.1.1.1" class="indexterm"></a> <code class="function">regr_syy</code> ( <em class="parameter"><code>Y</code></em> <code class="type">double precision</code>, <em class="parameter"><code>X</code></em> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет <span class="quote">«<span class="quote">сумму квадратов</span>»</span> зависимой переменной, <code class="literal">sum(<em class="parameter"><code>Y</code></em>^2) - sum(<em class="parameter"><code>Y</code></em>)^2/<em class="parameter"><code>N</code></em></code>.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.13.1.1.1" class="indexterm"></a> <a id="id-1.5.8.27.13.2.4.13.1.1.2" class="indexterm"></a> <code class="function">stddev</code> ( <em class="replaceable"><code>числовой_тип</code></em> ) → <code class="returnvalue"></code> <code class="type">double precision</code> для <code class="type">real</code> или <code class="type">double precision</code>, иначе <code class="type">numeric</code></p>
       <p>Сохранившийся синоним <code class="function">stddev_samp</code>.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.14.1.1.1" class="indexterm"></a> <a id="id-1.5.8.27.13.2.4.14.1.1.2" class="indexterm"></a> <code class="function">stddev_pop</code> ( <em class="replaceable"><code>numeric_type</code></em> ) → <code class="returnvalue"></code> <code class="type">double precision</code> для <code class="type">real</code> или <code class="type">double precision</code>, иначе <code class="type">numeric</code></p>
       <p>Вычисляет стандартное отклонение по генеральной совокупности входных значений.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.15.1.1.1" class="indexterm"></a> <a id="id-1.5.8.27.13.2.4.15.1.1.2" class="indexterm"></a> <code class="function">stddev_samp</code> ( <em class="replaceable"><code>числовой_тип</code></em> ) → <code class="returnvalue"></code> <code class="type">double precision</code> для <code class="type">real</code> или <code class="type">double precision</code>, иначе <code class="type">numeric</code></p>
       <p>Вычисляет стандартное отклонение по выборке входных значений.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.16.1.1.1" class="indexterm"></a> <code class="function">variance</code> ( <em class="replaceable"><code>numeric_type</code></em> ) → <code class="returnvalue"></code> <code class="type">double precision</code> для <code class="type">real</code> или <code class="type">double precision</code>, иначе <code class="type">numeric</code></p>
       <p>Сохранившийся синоним <code class="function">var_samp</code>.</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.17.1.1.1" class="indexterm"></a> <a id="id-1.5.8.27.13.2.4.17.1.1.2" class="indexterm"></a> <code class="function">var_pop</code> ( <em class="replaceable"><code>numeric_type</code></em> ) → <code class="returnvalue"></code> <code class="type">double precision</code> для <code class="type">real</code> или <code class="type">double precision</code>, иначе <code class="type">numeric</code></p>
       <p>Вычисляет дисперсию для генеральной совокупности входных значений (квадрат стандартного отклонения).</p></td><td>Да</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.13.2.4.18.1.1.1" class="indexterm"></a> <a id="id-1.5.8.27.13.2.4.18.1.1.2" class="indexterm"></a> <code class="function">var_samp</code> ( <em class="replaceable"><code>числовой_тип</code></em> ) → <code class="returnvalue"></code> <code class="type">double precision</code> для <code class="type">real</code> или <code class="type">double precision</code>, иначе <code class="type">numeric</code></p>
       <p>Вычисляет дисперсию по выборке для входных значений (квадрат отклонения по выборке).</p></td><td>Да</td></tr></tbody></table></div></div><br class="table-break" /><p>В <a class="xref" href="functions-aggregate.html#FUNCTIONS-ORDEREDSET-TABLE" title="Таблица 9.61. Сортирующие агрегатные функции">Таблица 9.61</a> показаны некоторые агрегатные функции, использующие синтаксис <em class="firstterm">сортирующих агрегатных функций</em>. Эти функции иногда называются функциями <span class="quote">«<span class="quote">обратного распределения</span>»</span>. Их агрегированные входные данные формируются указанием <code class="literal">ORDER BY</code>, а кроме того они могут принимать не агрегируемый <em class="firstterm">непосредственный аргумент</em>, который вычисляется только один раз. Все эти функции игнорируют значения NULL в агрегируемых данных. Для тех функций, которые принимают параметр <em class="parameter"><code>fraction</code></em>, его значение должно быть между 0 и 1; в противном случае выдаётся ошибка. Однако если значение <em class="parameter"><code>fraction</code></em> — NULL, они выдают NULL в результате.</p><a id="id-1.5.8.27.15" class="indexterm"></a><a id="id-1.5.8.27.16" class="indexterm"></a><div class="table" id="FUNCTIONS-ORDEREDSET-TABLE"><p class="title"><strong>Таблица 9.61. Сортирующие агрегатные функции</strong></p><div class="table-contents"><table class="table" summary="Сортирующие агрегатные функции" border="1"><colgroup><col class="col1" /><col class="col2" /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th><th>Частичный режим</th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.17.2.4.1.1.1.1" class="indexterm"></a> <code class="function">mode</code> () <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">anyelement</code> ) → <code class="returnvalue">anyelement</code></p>
       <p>Вычисляет <em class="firstterm">моду</em> — наиболее часто встречающееся в агрегируемом аргументе значение (если одинаково часто встречаются несколько значений, произвольно выбирается первое из них). Агрегируемый аргумент должен быть сортируемого типа.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.17.2.4.2.1.1.1" class="indexterm"></a> <code class="function">percentile_cont</code> ( <em class="parameter"><code>fraction</code></em> <code class="type">double precision</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">double precision</code> ) → <code class="returnvalue">double precision</code></p>
       <p class="func_signature"><code class="function">percentile_cont</code> ( <em class="parameter"><code>fraction</code></em> <code class="type">double precision</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">interval</code> ) → <code class="returnvalue">interval</code></p>
       <p>Вычисляет <em class="firstterm">непрерывный процентиль</em> — значение, соответствующее дроби, заданной параметром <em class="parameter"><code>fraction</code></em>, в отсортированном множестве значений агрегатного аргумента. При этом в случае необходимости соседние входные значения будут интерполироваться.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><code class="function">percentile_cont</code> ( <em class="parameter"><code>fractions</code></em> <code class="type">double precision[]</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">double precision</code> ) → <code class="returnvalue">double precision[]</code></p>
       <p class="func_signature"><code class="function">percentile_cont</code> ( <em class="parameter"><code>fractions</code></em> <code class="type">double precision[]</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">interval</code> ) → <code class="returnvalue">interval[]</code></p>
       <p>Вычисляет множественные непрерывные процентили. Возвращает массив той же размерности, что имеет параметр <em class="parameter"><code>fractions</code></em>, в котором каждый отличный от NULL элемент заменяется соответствующим данному перцентилю значением (возможно интерполированным).</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.17.2.4.4.1.1.1" class="indexterm"></a> <code class="function">percentile_disc</code> ( <em class="parameter"><code>fraction</code></em> <code class="type">double precision</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">anyelement</code> ) → <code class="returnvalue">anyelement</code></p>
       <p>Вычисляет <em class="firstterm">дискретный процентиль</em> — первое значение в отсортированном множестве значений агрегатного аргумента, позиция которого в этом множестве равна или больше значения <em class="parameter"><code>fraction</code></em>. Агрегируемый аргумент должен быть сортируемого типа.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><code class="function">percentile_disc</code> ( <em class="parameter"><code>fractions</code></em> <code class="type">double precision[]</code> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <code class="type">anyelement</code> ) → <code class="returnvalue">anyarray</code></p>
       <p>Вычисляет множественные дискретные процентили. Возвращает массив той же размерности, что имеет параметр <em class="parameter"><code>fractions</code></em>, в котором каждый отличный от NULL элемент заменяется соответствующим данному перцентилю значением. Агрегируемый аргумент должен быть сортируемого типа.</p></td><td>Нет</td></tr></tbody></table></div></div><br class="table-break" /><a id="id-1.5.8.27.18" class="indexterm"></a><p>Все <span class="quote">«<span class="quote">гипотезирующие</span>»</span> агрегатные функции, перечисленные в <a class="xref" href="functions-aggregate.html#FUNCTIONS-HYPOTHETICAL-TABLE" title="Таблица 9.62. Гипотезирующие агрегатные функции">Таблице 9.62</a>, связаны с одноимёнными оконными функциями, определёнными в <a class="xref" href="functions-window.html" title="9.22. Оконные функции">Разделе 9.22</a>. В каждом случае их результат — значение, которое бы вернула связанная оконная функция для <span class="quote">«<span class="quote">гипотетической</span>»</span> строки, полученной из <em class="replaceable"><code>аргументов</code></em>, если бы такая строка была добавлена в сортированную группу строк, которую образуют <em class="replaceable"><code>сортирующие_аргументы</code></em>. Для всех этих функций список непосредственных аргументов, переданный в качестве <em class="replaceable"><code>аргументов</code></em>, по числу и типу элементов должен соответствовать списку, передаваемому в качестве <em class="replaceable"><code>сортирующих_аргументов</code></em>. В отличие от большинства встроенных агрегатов, данные агрегаты не являются строгими, то есть они не игнорируют строки, содержащие NULL. Значения NULL сортируются по правилу, заданному в предложении <code class="literal">ORDER BY</code>.</p><div class="table" id="FUNCTIONS-HYPOTHETICAL-TABLE"><p class="title"><strong>Таблица 9.62. Гипотезирующие агрегатные функции</strong></p><div class="table-contents"><table class="table" summary="Гипотезирующие агрегатные функции" border="1"><colgroup><col class="col1" /><col class="col2" /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th><th>Частичный режим</th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.20.2.4.1.1.1.1" class="indexterm"></a> <code class="function">rank</code> ( <em class="replaceable"><code>аргументы</code></em> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <em class="replaceable"><code>сортирующие_аргументы</code></em> ) → <code class="returnvalue">bigint</code></p>
       <p>Вычисляет ранг гипотетической строки с пропусками, то есть номер первой родственной ей строки.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.20.2.4.2.1.1.1" class="indexterm"></a> <code class="function">dense_rank</code> ( <em class="replaceable"><code>args</code></em> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <em class="replaceable"><code>сортируемые_аргументы</code></em> ) → <code class="returnvalue">bigint</code></p>
       <p>Вычисляет ранг гипотетической строки без пропусков; по сути эта функция считает группы родственных строк.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.20.2.4.3.1.1.1" class="indexterm"></a> <code class="function">percent_rank</code> ( <em class="replaceable"><code>аргументы</code></em> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <em class="replaceable"><code>сортируемые_аргументы</code></em> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет относительный ранг гипотетической строки, то есть (<code class="function">rank</code> - 1) / (общее число строк - 1). Таким образом, результат лежит в интервале от 0 до 1, включая границы.</p></td><td>Нет</td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.20.2.4.4.1.1.1" class="indexterm"></a> <code class="function">cume_dist</code> ( <em class="replaceable"><code>аргументы</code></em> ) <code class="literal">WITHIN GROUP</code> ( <code class="literal">ORDER BY</code> <em class="replaceable"><code>сортируемые_аргументы</code></em> ) → <code class="returnvalue">double precision</code></p>
       <p>Вычисляет кумулятивное распределение, то есть (число строк, предшествующих или родственных гипотетической строке) / (общее число строк). Результат лежит в интервале от 1/<em class="parameter"><code>N</code></em> до 1.</p></td><td>Нет</td></tr></tbody></table></div></div><br class="table-break" /><div class="table" id="FUNCTIONS-GROUPING-TABLE"><p class="title"><strong>Таблица 9.63. Операции группировки</strong></p><div class="table-contents"><table class="table" summary="Операции группировки" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.5.8.27.21.2.2.1.1.1.1" class="indexterm"></a> <code class="function">GROUPING</code> ( <em class="replaceable"><code>выражения_group_by</code></em> ) → <code class="returnvalue">integer</code></p>
       <p>Выдаёт битовую маску, показывающую, какие выражения <code class="literal">GROUP BY</code> не вошли в текущий набор группирования. Биты назначаются справа налево, то есть самому правому аргументу соответствует самый младший бит; бит равен 0, если соответствующее выражение вошло в критерий группировки набора группирования, для которого сформирована текущая строка результата, или 1 в противном случае.</p></td></tr></tbody></table></div></div><br class="table-break" /><p>Операции группировки, показанные в <a class="xref" href="functions-aggregate.html#FUNCTIONS-GROUPING-TABLE" title="Таблица 9.63. Операции группировки">Таблице 9.63</a>, применяются в сочетании с наборами группирования (см. <a class="xref" href="queries-table-expressions.html#QUERIES-GROUPING-SETS" title="7.2.4. GROUPING SETS, CUBE и ROLLUP">Подраздел 7.2.4</a>) для различения результирующих строк. Аргументы функции <code class="literal">GROUPING</code> на самом деле не вычисляются, но они должны в точности соответствовать выражениям, заданным в предложении <code class="literal">GROUP BY</code> на их уровне запроса. Например: </p><pre class="screen">
<code class="prompt">=&gt;</code> <strong class="userinput"><code>SELECT * FROM items_sold;</code></strong>
 make  | model | sales
-------+-------+-------
 Foo   | GT    |  10
 Foo   | Tour  |  20
 Bar   | City  |  15
 Bar   | Sport |  5
(4 rows)

<code class="prompt">=&gt;</code> <strong class="userinput"><code>SELECT make, model, GROUPING(make,model), sum(sales) FROM items_sold GROUP BY ROLLUP(make,model);</code></strong>
 make  | model | grouping | sum
-------+-------+----------+-----
 Foo   | GT    |        0 | 10
 Foo   | Tour  |        0 | 20
 Bar   | City  |        0 | 15
 Bar   | Sport |        0 | 5
 Foo   |       |        1 | 30
 Bar   |       |        1 | 20
       |       |        3 | 50
(7 rows)
</pre><p> Здесь значение <code class="literal">grouping</code>, равное <code class="literal">0</code> в первых четырёх строках, показывает, что эти строки были сгруппированы обычным образом по обоим группирующим столбцам. Значение <code class="literal">1</code> в двух предпоследних строках показывает, что столбец <code class="literal">model</code> не был группирующим, а значение <code class="literal">3</code> в последней строке показывает, что при группировании не учитывались ни <code class="literal">make</code>, ни <code class="literal">model</code>, то есть агрегирование выполнялось по всем входным строкам.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="functions-range.html" title="9.20. Диапазонные/мультидиапазонные функции и операторы">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="functions.html" title="Глава 9. Функции и операторы">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="functions-window.html" title="9.22. Оконные функции">След.</a></td></tr><tr><td width="40%" align="left" valign="top">9.20. Диапазонные/мультидиапазонные функции и операторы </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 9.22. Оконные функции</td></tr></table></div></body></html>