<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE ROLE</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-createpublication.html" title="CREATE PUBLICATION" /><link rel="next" href="sql-createrule.html" title="CREATE RULE" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">CREATE ROLE</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-createpublication.html" title="CREATE PUBLICATION">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><th width="60%" align="center">Команды SQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-createrule.html" title="CREATE RULE">След.</a></td></tr></table><hr /></div><div class="refentry" id="SQL-CREATEROLE"><div class="titlepage"></div><a id="id-1.9.3.78.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">CREATE ROLE</span></h2><p>CREATE ROLE — создать роль в базе данных</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">CREATE ROLE <em class="replaceable"><code>имя</code></em> [ [ WITH ] <em class="replaceable"><code>параметр</code></em> [ ... ] ]

<span class="phrase">Здесь <em class="replaceable"><code>параметр</code></em>:</span>

      SUPERUSER | NOSUPERUSER
    | CREATEDB | NOCREATEDB
    | CREATEROLE | NOCREATEROLE
    | INHERIT | NOINHERIT
    | LOGIN | NOLOGIN
    | REPLICATION | NOREPLICATION
    | BYPASSRLS | NOBYPASSRLS
    | CONNECTION LIMIT <em class="replaceable"><code>предел_подключений</code></em>
    | [ ENCRYPTED ] PASSWORD '<em class="replaceable"><code>пароль</code></em>' | PASSWORD NULL
    | VALID UNTIL '<em class="replaceable"><code>дата_время</code></em>'
    | IN ROLE <em class="replaceable"><code>имя_роли</code></em> [, ...]
    | IN GROUP <em class="replaceable"><code>имя_роли</code></em> [, ...]
    | ROLE <em class="replaceable"><code>имя_роли</code></em> [, ...]
    | ADMIN <em class="replaceable"><code>имя_роли</code></em> [, ...]
    | USER <em class="replaceable"><code>имя_роли</code></em> [, ...]
    | SYSID <em class="replaceable"><code>uid</code></em></pre></div><div class="refsect1" id="id-1.9.3.78.5"><h2>Описание</h2><p><code class="command">CREATE ROLE</code> добавляет новую роль в кластер баз данных <span class="productname">PostgreSQL</span>. Роль — это сущность, которая может владеть объектами и иметь определённые права в базе; роль может представлять <span class="quote">«<span class="quote">пользователя</span>»</span>, <span class="quote">«<span class="quote">группу</span>»</span> или и то, и другое, в зависимости от варианта использования. За информацией об управлении пользователями и проверке подлинности обратитесь к <a class="xref" href="user-manag.html" title="Глава 22. Роли базы данных">Главе 22</a> и <a class="xref" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения">Главе 21</a>. Чтобы выполнить эту команду, необходимо быть суперпользователем или иметь право <code class="literal">CREATEROLE</code>.</p><p>Учтите, что роли определяются на уровне кластера баз данных, так что они действуют во всех базах в кластере.</p><p>Во время создания роли можно сразу назначить создаваемую роль членом существующей роли, а также назначить существующие роли членами создаваемой роли. Правила, по которым включаются начальные параметры членства в роли, описаны ниже в предложениях <code class="literal">IN ROLE</code>, <code class="literal">ROLE</code> и <code class="literal">ADMIN</code>. Команда <a class="xref" href="sql-grant.html" title="GRANT"><span class="refentrytitle">GRANT</span></a> позволяет управлять назначением членов ролей и даёт возможность изменять эти параметры после создания новой роли.</p></div><div class="refsect1" id="id-1.9.3.78.6"><h2>Параметры</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>имя</code></em></span></dt><dd><p>Имя создаваемой роли.</p></dd><dt><span class="term"><code class="literal">SUPERUSER</code><br /></span><span class="term"><code class="literal">NOSUPERUSER</code></span></dt><dd><p>Эти предложения определяют, будет ли эта роль <span class="quote">«<span class="quote">суперпользователем</span>»</span>, который может переопределить все ограничения доступа в базе данных. Статус суперпользователя несёт опасность и назначать его следует только в случае необходимости. Создать нового суперпользователя может только суперпользователь. В отсутствие этих предложений по умолчанию подразумевается <code class="literal">NOSUPERUSER</code>.</p></dd><dt><span class="term"><code class="literal">CREATEDB</code><br /></span><span class="term"><code class="literal">NOCREATEDB</code></span></dt><dd><p>Эти предложения определяют, сможет ли роль создавать базы данных. Указание <code class="literal">CREATEDB</code> даёт новой роли это право, а <code class="literal">NOCREATEDB</code> запрещает роли создавать базы данных. По умолчанию подразумевается <code class="literal">NOCREATEDB</code>. Только суперпользователи или роли с правом <code class="literal">CREATEDB</code> могут указывать <code class="literal">CREATEDB</code>.</p></dd><dt><span class="term"><code class="literal">CREATEROLE</code><br /></span><span class="term"><code class="literal">NOCREATEROLE</code></span></dt><dd><p>Эти предложения определяют, сможет ли роль создавать, изменять и удалять другие роли, добавлять для них комментарии и изменять метку безопасности в любых ролях. Подробнее возможности, предоставляемые этим правом, описаны в <a class="xref" href="role-attributes.html#ROLE-CREATION">Создание роли</a>. Если предложение не указано, по умолчанию используется <code class="literal">NOCREATEROLE</code>.</p></dd><dt><span class="term"><code class="literal">INHERIT</code><br /></span><span class="term"><code class="literal">NOINHERIT</code></span></dt><dd><p>Эти предложения влияют на статус наследования членства, когда данная роль добавляется как член другой роли, как в текущей, так и в будущих командах. В частности, они контролируют статус наследования членства, добавленного этой командой с помощью предложения <code class="literal">IN ROLE</code>, а в более поздних командах — с помощью предложения <code class="literal">ROLE</code>. Они также используются по умолчанию для статуса наследования при добавлении данной роли в качестве члена с помощью команды <code class="literal">GRANT</code>. Если предложение не указано, по умолчанию используется <code class="literal">INHERIT</code>.</p><p>В версиях <span class="productname">PostgreSQL</span> до 16 наследование было атрибутом на уровне роли, который управлял для этой роли всеми проверками членства во время выполнения.</p></dd><dt><span class="term"><code class="literal">LOGIN</code><br /></span><span class="term"><code class="literal">NOLOGIN</code></span></dt><dd><p>Эти предложения определяют, разрешается ли новой роли вход на сервер; то есть, может ли эта роль стать начальным авторизованным именем при подключении клиента. Можно считать, что роль с атрибутом <code class="literal">LOGIN</code> соответствует пользователю. Роли без этого атрибута бывают полезны для управления доступом в базе данных, но это не пользователи в обычном понимании. По умолчанию подразумевается вариант <code class="literal">NOLOGIN</code>, за исключением вызова <code class="command">CREATE ROLE</code> в виде <a class="link" href="sql-createuser.html" title="CREATE USER"><code class="command">CREATE USER</code></a>.</p></dd><dt><span class="term"><code class="literal">REPLICATION</code><br /></span><span class="term"><code class="literal">NOREPLICATION</code></span></dt><dd><p>Эти предложения определяют, будет ли роль ролью репликации. Чтобы роль могла подключаться к серверу в режиме репликации (в режиме физической или логической репликации) и создавать/удалять слоты репликации, у неё должен быть этот атрибут (либо это должна быть роль суперпользователя). Роль, имеющая атрибут <code class="literal">REPLICATION</code>, обладает очень большими привилегиями и поэтому этот атрибут должны иметь только роли, фактически используемые для репликации. По умолчанию подразумевается вариант <code class="literal">NOREPLICATION</code>. Выдавать атрибут <code class="literal">REPLICATION</code> могут только суперпользователи или роли с <code class="literal">REPLICATION</code>.</p></dd><dt><span class="term"><code class="literal">BYPASSRLS</code><br /></span><span class="term"><code class="literal">NOBYPASSRLS</code></span></dt><dd><p>Эти предложения определяют, будут ли для роли игнорироваться все политики защиты на уровне строк (RLS). По умолчанию подразумевается вариант <code class="literal">NOBYPASSRLS</code>. Выдавать атрибут <code class="literal">BYPASSRLS</code> могут только суперпользователи или роли с <code class="literal">BYPASSRLS</code>.</p><p>Заметьте, что pg_dump по умолчанию отключает <code class="literal">row_security</code> (устанавливает значение <code class="literal">OFF</code>), чтобы гарантированно было выгружено всё содержимое таблицы. Если пользователь, запускающий pg_dump, не будет иметь необходимых прав, он получит ошибку. Однако суперпользователи и владелец выгружаемой таблицы всегда обходят защиту RLS.</p></dd><dt><span class="term"><code class="literal">CONNECTION LIMIT</code> <em class="replaceable"><code>предел_подключений</code></em></span></dt><dd><p>Если роли разрешён вход, этот параметр определяет, сколько параллельных подключений может установить роль. Значение -1 (по умолчанию) снимает ограничение. Заметьте, что под это ограничение подпадают только обычные подключения. Ни подготовленные транзакции, ни соединения фоновых рабочих процессов в расчёт не берутся.</p></dd><dt><span class="term">[ <code class="literal">ENCRYPTED</code> ] <code class="literal">PASSWORD</code> '<em class="replaceable"><code>пароль</code></em>'<br /></span><span class="term"><code class="literal">PASSWORD NULL</code></span></dt><dd><p>Задаёт пароль роли. (Пароль полезен только для ролей с атрибутом <code class="literal">LOGIN</code>, но задать его можно и для ролей без такого атрибута.) Если проверка подлинности по паролю не будет использоваться, этот параметр можно опустить. При указании пустого значения будет задан пароль NULL, что не позволит данному пользователю пройти проверку подлинности по паролю. При желании пароль NULL можно установить явно, указав <code class="literal">PASSWORD NULL</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>Если задана пустая строка, пароль также будет сброшен в NULL, но в <span class="productname">PostgreSQL</span> до версии 10 было не так. В ранних версиях пустая строка могла приниматься или нет, в зависимости от метода аутентификации и версии сервера, а libpq не давала использовать такой пароль в любом случае. Во избежание неоднозначности указывать пустую строку в качестве пароля не следует.</p></div><p>Пароль всегда хранится в системных каталогах в зашифрованном виде. Ключевое слово <code class="literal">ENCRYPTED</code> не имеет эффекта, но принимается для обратной совместимости. Метод шифрования определяется параметром конфигурации <a class="xref" href="runtime-config-connection.html#GUC-PASSWORD-ENCRYPTION">password_encryption</a>. Если представленная строка пароля уже зашифрована с применением MD5 или SCRAM, она сохраняется как есть вне зависимости от значения <code class="varname">password_encryption</code> (так как система не может расшифровать переданный зашифрованной пароль, чтобы зашифровать его по другому алгоритму). Это позволяет пересохранять зашифрованные пароли при выгрузке/восстановлении.</p></dd><dt><span class="term"><code class="literal">VALID UNTIL</code> '<em class="replaceable"><code>дата_время</code></em>'</span></dt><dd><p>Предложение <code class="literal">VALID UNTIL</code> устанавливает дату и время, после которого пароль роли перестаёт действовать. Если это предложение отсутствует, срок действия пароля будет неограниченным.</p></dd><dt><span class="term"><code class="literal">IN ROLE</code> <em class="replaceable"><code>имя_роли</code></em></span></dt><dd><p>С предложением <code class="literal">IN ROLE</code> новая роль автоматически становится членом указанных существующих ролей. Для нового члена будет включён атрибут <code class="literal">SET</code> и отключён атрибут <code class="literal">ADMIN</code>. Атрибут <code class="literal">INHERIT</code> будет включён, если не указан атрибут <code class="literal">NOINHERIT</code>.</p></dd><dt><span class="term"><code class="literal">IN GROUP</code> <em class="replaceable"><code>имя_роли</code></em></span></dt><dd><p><code class="literal">IN GROUP</code> — устаревшее написание предложения <code class="literal">IN ROLE</code>.</p></dd><dt><span class="term"><code class="literal">ROLE</code> <em class="replaceable"><code>имя_роли</code></em></span></dt><dd><p>С предложением <code class="literal">ROLE</code> одна или нескольких указанных существующих ролей автоматически добавляются как члены новой роли с включённым атрибутом <code class="literal">SET</code>. Фактически это делает новую роль <span class="quote">«<span class="quote">группой</span>»</span>. Для ролей, указанных в этом предложении с атрибутом <code class="literal">INHERIT</code>, будет включён атрибут <code class="literal">INHERIT</code> в новом членстве. Для новых участников атрибут <code class="literal">ADMIN</code> будет отключён.</p></dd><dt><span class="term"><code class="literal">ADMIN</code> <em class="replaceable"><code>имя_роли</code></em></span></dt><dd><p>Предложение <code class="literal">ADMIN</code> работает подобно <code class="literal">ROLE</code>, но перечисленные в нём роли добавляются как члены новой роли с включённым атрибутом <code class="literal">ADMIN</code>, что даёт им право включать в новою роль другие роли.</p></dd><dt><span class="term"><code class="literal">USER</code> <em class="replaceable"><code>имя_роли</code></em></span></dt><dd><p>Предложение <code class="literal">USER</code> является устаревшим написанием предложения <code class="literal">ROLE</code>.</p></dd><dt><span class="term"><code class="literal">SYSID</code> <em class="replaceable"><code>uid</code></em></span></dt><dd><p>Предложение <code class="literal">SYSID</code> игнорируется, но принимается для обратной совместимости.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.3.78.7"><h2>Замечания</h2><p>Для изменения атрибутов роли применяется <a class="link" href="sql-alterrole.html" title="ALTER ROLE"><code class="command">ALTER ROLE</code></a>, а для удаления роли — <a class="link" href="sql-droprole.html" title="DROP ROLE"><code class="command">DROP ROLE</code></a>. Все атрибуты, заданные в <code class="command">CREATE ROLE</code>, могут быть изменены позднее командами <code class="command">ALTER ROLE</code>.</p><p>Для добавления и удаления членов ролей, используемых в качестве групп, рекомендуется использовать <a class="link" href="sql-grant.html" title="GRANT"><code class="command">GRANT</code></a> и <a class="link" href="sql-revoke.html" title="REVOKE"><code class="command">REVOKE</code></a>.</p><p>Предложение <code class="literal">VALID UNTIL</code> определяет срок действия только пароля, но не роли как таковой. В частности, ограничение срока пароля не действует при входе пользователя без проверки подлинности по паролю.</p><p>Определённые здесь атрибуты роли не наследуются, т. е. членство в роли, например, с правом <code class="literal">CREATEDB</code>, не позволит её участнику создавать новые базы данных, даже если членство было выдано с атрибутом <code class="literal">INHERIT</code>. Разумеется, если в выдаче членства есть атрибут <code class="literal">SET</code>, роль участника сможет выполнить команду <a class="link" href="sql-set-role.html" title="SET ROLE"><code class="command">SET ROLE</code></a> для роли createdb, а затем создать новую базу данных.</p><p>При выдаче членства с помощью предложений <code class="literal">IN ROLE</code>, <code class="literal">ROLE</code> и <code class="literal">ADMIN</code> праводателем является роль, выполняющая эту команду.</p><p>Атрибут <code class="literal">INHERIT</code> устанавливается по умолчанию в целях обратной совместимости: в предыдущих выпусках <span class="productname">PostgreSQL</span> пользователи всегда обладали всеми правами групп, в которые они были включены. Однако <code class="literal">NOINHERIT</code> по смыслу ближе к тому, что описано в стандарте SQL.</p><p><span class="productname">PostgreSQL</span> включает программу <a class="xref" href="app-createuser.html" title="createuser"><span class="refentrytitle"><span class="application">createuser</span></span></a>, которая предоставляет ту же функциональность, что и команда <code class="command">CREATE ROLE</code> (на самом деле она вызывает эту команду), но может запускаться в командной оболочке.</p><p>Ограничение <code class="literal">CONNECTION LIMIT</code> действует только приблизительно; если одновременно запускаются два сеанса, тогда как для этой роли остаётся только одно <span class="quote">«<span class="quote">свободное место</span>»</span>, может так случиться, что будут отклонены оба подключения. Кроме того, это ограничение не распространяется на суперпользователей.</p><p>Указывая в этой команде незашифрованный пароль, следует проявлять осторожность. Пароль будет передаваться на сервер открытым текстом и может также записываться в историю команд клиента или в протокол работы сервера. Команда <a class="xref" href="app-createuser.html" title="createuser"><span class="refentrytitle"><span class="application">createuser</span></span></a>, однако, передаёт пароль зашифрованным. Кроме того, в <a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a> есть команда <code class="command">\password</code>, с помощью которой можно безопасно сменить пароль позже.</p></div><div class="refsect1" id="id-1.9.3.78.8"><h2>Примеры</h2><p>Создание роли, для которой разрешён вход, но не задан пароль: </p><pre class="programlisting">CREATE ROLE jonathan LOGIN;</pre><p>Создание роли с паролем: </p><pre class="programlisting">CREATE USER davide WITH PASSWORD 'jw8s0F4';</pre><p> (<code class="command">CREATE USER</code> действует так же, как <code class="command">CREATE ROLE</code>, но подразумевает ещё и атрибут <code class="literal">LOGIN</code>.)</p><p>Создание роли с паролем, действующим до конца 2004 г., то есть пароль перестаёт действовать в первую же секунду 2005 г. </p><pre class="programlisting">CREATE ROLE miriam WITH LOGIN PASSWORD 'jw8s0F4' VALID UNTIL '2005-01-01';</pre><p>Создание роли, которая может создавать базы данных и управлять ролями: </p><pre class="programlisting">CREATE ROLE admin WITH CREATEDB CREATEROLE;</pre></div><div class="refsect1" id="id-1.9.3.78.9"><h2>Совместимость</h2><p>Оператор <code class="command">CREATE ROLE</code> описан в стандарте SQL, но стандарт требует поддержки только следующего синтаксиса: </p><pre class="synopsis">
CREATE ROLE <em class="replaceable"><code>имя</code></em> [ WITH ADMIN <em class="replaceable"><code>имя_роли</code></em> ]
</pre><p> Возможность создавать множество начальных администраторов и все другие параметры <code class="command">CREATE ROLE</code> относятся к расширениям <span class="productname">PostgreSQL</span>.</p><p>В стандарте SQL определяются концепции пользователей и ролей, но в нём они рассматриваются как отдельные сущности, а все команды создания пользователей считаются внутренней спецификой СУБД. В <span class="productname">PostgreSQL</span> мы решили объединить пользователей и роли в единую сущность, так что роли получили дополнительные атрибуты, не описанные в стандарте.</p><p>Наиболее близкое к описанному в стандарте SQL поведение можно получить, если создавать пользователей по стандарту SQL как роли <span class="productname">PostgreSQL</span> с атрибутом <code class="literal">NOINHERIT</code>, а роли по стандарту SQL как роли <span class="productname">PostgreSQL</span> с атрибутом <code class="literal">INHERIT</code>.</p></div><div class="refsect1" id="id-1.9.3.78.10"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-set-role.html" title="SET ROLE"><span class="refentrytitle">SET ROLE</span></a>, <a class="xref" href="sql-alterrole.html" title="ALTER ROLE"><span class="refentrytitle">ALTER ROLE</span></a>, <a class="xref" href="sql-droprole.html" title="DROP ROLE"><span class="refentrytitle">DROP ROLE</span></a>, <a class="xref" href="sql-grant.html" title="GRANT"><span class="refentrytitle">GRANT</span></a>, <a class="xref" href="sql-revoke.html" title="REVOKE"><span class="refentrytitle">REVOKE</span></a>, <a class="xref" href="app-createuser.html" title="createuser"><span class="refentrytitle"><span class="application">createuser</span></span></a>, <a class="xref" href="runtime-config-client.html#GUC-CREATEROLE-SELF-GRANT">createrole_self_grant</a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-createpublication.html" title="CREATE PUBLICATION">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-createrule.html" title="CREATE RULE">След.</a></td></tr><tr><td width="40%" align="left" valign="top">CREATE PUBLICATION </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> CREATE RULE</td></tr></table></div></body></html>