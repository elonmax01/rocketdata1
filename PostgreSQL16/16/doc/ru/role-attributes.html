<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>22.2. Атрибуты ролей</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="database-roles.html" title="22.1. Роли базы данных" /><link rel="next" href="role-membership.html" title="22.3. Членство в роли" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">22.2. Атрибуты ролей</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="database-roles.html" title="22.1. Роли базы данных">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="user-manag.html" title="Глава 22. Роли базы данных">Наверх</a></td><th width="60%" align="center">Глава 22. Роли базы данных</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="role-membership.html" title="22.3. Членство в роли">След.</a></td></tr></table><hr /></div><div class="sect1" id="ROLE-ATTRIBUTES"><div class="titlepage"><div><div><h2 class="title" style="clear: both">22.2. Атрибуты ролей <a href="#ROLE-ATTRIBUTES" class="id_link">#</a></h2></div></div></div><p>Роль базы данных может иметь атрибуты, определяющие её полномочия и взаимодействие с системой аутентификации клиентов. </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Право подключения<a id="id-1.6.9.6.2.1.1.1.1" class="indexterm"></a></span></dt><dd><p>Только роли с атрибутом <code class="literal">LOGIN</code> могут использоваться для начального подключения к базе данных. Роль с атрибутом <code class="literal">LOGIN</code> можно рассматривать как пользователя базы данных. Для создания такой роли можно использовать любой из вариантов: </p><pre class="programlisting">CREATE ROLE <em class="replaceable"><code>имя</code></em> LOGIN;
CREATE USER <em class="replaceable"><code>имя</code></em>;</pre><p> (Команда <code class="command">CREATE USER</code> эквивалентна <code class="command">CREATE ROLE</code> за исключением того, что <code class="command">CREATE USER</code> по умолчанию включает атрибут <code class="literal">LOGIN</code>, в то время как <code class="command">CREATE ROLE</code> — нет.)</p></dd><dt><span class="term">Статус суперпользователя<a id="id-1.6.9.6.2.1.2.1.1" class="indexterm"></a></span></dt><dd><p>Суперпользователь базы данных обходит все проверки прав доступа, за исключением права на вход в систему. Это опасная привилегия и она не должна использоваться небрежно. Лучше всего выполнять большую часть работы не как суперпользователь. Для создания нового суперпользователя используется <code class="literal">CREATE ROLE <em class="replaceable"><code>имя</code></em> SUPERUSER</code>. Это нужно выполнить из под роли, которая также является суперпользователем.</p></dd><dt><span class="term">Создание базы данных<a id="id-1.6.9.6.2.1.3.1.1" class="indexterm"></a></span></dt><dd><p>Роль должна явно иметь разрешение на создание базы данных (за исключением суперпользователей, которые пропускают все проверки). Для создания такой роли используется <code class="literal">CREATE ROLE <em class="replaceable"><code>имя</code></em> CREATEDB</code>.</p></dd><dt><span class="term" id="ROLE-CREATION">Создание роли<a id="id-1.6.9.6.2.1.4.1.1" class="indexterm"></a></span></dt><dd><p>Роль должна явно иметь разрешение на создание других ролей (за исключением суперпользователей, которые пропускают все проверки). Для создания такой роли используется <code class="command">CREATE ROLE <em class="replaceable"><code>имя</code></em> CREATEROLE</code>. Роль с правом <code class="literal">CREATEROLE</code> может изменять и удалять роли, которые были назначены пользователю с правами <code class="literal">CREATEROLE</code> и <code class="literal">ADMIN OPTION</code>. Такое назначение ролей происходит автоматически, когда пользователь с правом <code class="literal">CREATEROLE</code>, не являющийся суперпользователем, создаёт новую роль. Поэтому по умолчанию пользователь с правом <code class="literal">CREATEROLE</code> может изменять и удалять созданные им роли. Изменение роли включает большинство действий команды <code class="command">ALTER ROLE</code>, например смену пароля, а также действия команд <code class="command">COMMENT</code> и <code class="command">SECURITY LABEL</code> в отношении ролей.</p><p>Однако, имея право <code class="literal">CREATEROLE</code>, нельзя ни создавать, ни каким-либо образом влиять на роли <code class="literal">SUPERUSER</code>. Кроме того, с правом <code class="literal">CREATEROLE</code> нельзя ни создавать пользователей <code class="literal">REPLICATION</code>, ни предоставлять или отзывать право <code class="literal">REPLICATION</code>, ни изменять свойства ролей таких пользователей. Тем не менее, это право позволяет использовать команды <code class="literal">ALTER ROLE ... SET</code> и <code class="literal">ALTER ROLE ... RENAME</code> в отношении ролей <code class="literal">REPLICATION</code>, а также <code class="literal">COMMENT ON ROLE</code>, <code class="literal">SECURITY LABEL ON ROLE</code> и <code class="literal">DROP ROLE</code>. Наконец, право <code class="literal">CREATEROLE</code> не даёт возможности предоставлять или отзывать право <code class="literal">BYPASSRLS</code>.</p></dd><dt><span class="term">Запуск репликации<a id="id-1.6.9.6.2.1.5.1.1" class="indexterm"></a></span></dt><dd><p>Роль должна иметь явное разрешение на запуск потоковой репликации (за исключением суперпользователей, которые пропускают все проверки). Роль, используемая для потоковой репликации, также должна иметь атрибут <code class="literal">LOGIN</code>. Для создания такой роли используется <code class="literal">CREATE ROLE <em class="replaceable"><code>имя</code></em> REPLICATION LOGIN</code>.</p></dd><dt><span class="term">Пароль<a id="id-1.6.9.6.2.1.6.1.1" class="indexterm"></a></span></dt><dd><p>Пароль имеет значение, если метод аутентификации клиентов требует, чтобы пользователи предоставляли пароль при подключении к базе данных. Методы аутентификации <code class="option">password</code> и <code class="option">md5</code> используют пароли. База данных и операционная система используют раздельные пароли. Пароль указывается при создании роли: <code class="literal">CREATE ROLE <em class="replaceable"><code>имя</code></em> PASSWORD '<em class="replaceable"><code>строка</code></em>'</code>.</p></dd><dt><span class="term">Наследование прав<a id="id-1.6.9.6.2.1.7.1.1" class="indexterm"></a></span></dt><dd><p>По умолчанию роль наследует права ролей, членом которых она является. Однако можно создать роль, которая не будет наследовать права по умолчанию. Для этого выполните <code class="command">CREATE ROLE <em class="replaceable"><code>имя</code></em> NOINHERIT</code>. Как вариант, атрибуты наследования отдельных прав можно переопределить, указав <code class="literal">WITH INHERIT TRUE</code> или <code class="literal">WITH INHERIT FALSE</code>.</p></dd><dt><span class="term">Игнорирование защиты на уровне строк<a id="id-1.6.9.6.2.1.8.1.1" class="indexterm"></a></span></dt><dd><p>Разрешение обходить все политики защиты на уровне строк (RLS) нужно давать роли явно. Создать роль с таким разрешением можно, выполнив <code class="literal">CREATE ROLE <em class="replaceable"><code>имя</code></em> BYPASSRLS</code> от имени суперпользователя.</p></dd><dt><span class="term">Ограничение соединений<a id="id-1.6.9.6.2.1.9.1.1" class="indexterm"></a></span></dt><dd><p>Для роли можно ограничить число одновременных соединений. -1 (по умолчанию) означает отсутствие ограничения. Для создания роли с ограничением используется <code class="literal">CREATE ROLE <em class="replaceable"><code>name</code></em> CONNECTION LIMIT '<em class="replaceable"><code>число</code></em>'</code>.</p></dd></dl></div><p> Атрибуты ролей могут быть изменены после создания командой <code class="command">ALTER ROLE</code>.<a id="id-1.6.9.6.2.3" class="indexterm"></a> Более детальная информация в справке по командам <a class="xref" href="sql-createrole.html" title="CREATE ROLE"><span class="refentrytitle">CREATE ROLE</span></a> и <a class="xref" href="sql-alterrole.html" title="ALTER ROLE"><span class="refentrytitle">ALTER ROLE</span></a>.</p><p>На уровне ролей можно устанавливать многие конфигурационные параметры времени выполнения, описанные в <a class="xref" href="runtime-config.html" title="Глава 20. Настройка сервера">Главе 20</a>. Например, если по некоторым причинам всякий раз при подключении к базе данных требуется отключить использование индексов (подсказка: плохая идея) можно выполнить: </p><pre class="programlisting">ALTER ROLE myname SET enable_indexscan TO off;</pre><p> Установленное значение параметра будет сохранено (но не будет применено сразу). Для последующих подключений с этой ролью это будет выглядеть как выполнение команды <code class="literal">SET enable_indexscan TO off</code> перед началом сеанса. Но это только значение по умолчанию; в течение сеанса этот параметр можно изменить. Для удаления установок на уровне ролей для параметров конфигурации используется <code class="literal">ALTER ROLE <em class="replaceable"><code>имя_роли</code></em> RESET <em class="replaceable"><code>имя_переменной</code></em></code>. Обратите внимание, что установка параметров конфигурации на уровне роли без права <code class="literal">LOGIN</code> лишено смысла, т. к. они никогда не будут применены.</p><p>Когда не суперпользователь с правом <code class="literal">CREATEROLE</code> создаёт роль, созданная роль автоматически становится членом создавшей её роли, как если бы начальный суперпользователь выполнил команду <code class="command">GRANT created_user TO creating_user WITH ADMIN TRUE, SET FALSE, INHERIT FALSE</code>. Поскольку пользователь с правом <code class="literal">CREATEROLE</code> может пользоваться специальными правами в отношении существующей роли только при наличии атрибута <code class="literal">ADMIN OPTION</code>, такого права вполне достаточно для того, чтобы пользователь с правом <code class="literal">CREATEROLE</code> мог администрировать созданную им роль. Тем не менее, поскольку роль создаётся с атрибутами <code class="literal">INHERIT FALSE, SET FALSE</code>, пользователь с правом <code class="literal">CREATEROLE</code> не будет наследовать права созданной роли и не сможет переключиться на неё с помощью команды <code class="command">SET ROLE</code>. Однако поскольку любой пользователь с правом <code class="literal">ADMIN OPTION</code> для роли может разрешать членство в этой роли любым пользователям, пользователь с правом <code class="literal">CREATEROLE</code> может стать членом созданной им роли, просто назначив эту роль на себя при помощи <code class="literal">INHERIT</code> и/или <code class="literal">SET</code>. Поэтому факт того, что права не наследуются по умолчанию и что право не назначается по умолчанию командой <code class="command">SET ROLE</code>, — это способ оградиться от случайных ошибок, а не средство защиты. Кроме того, обратите внимание, что это право автоматически выдаётся от имени начального суперпользователя, поэтому пользователь с правом <code class="literal">CREATEROLE</code> не сможет удалить или изменить его. Тем не менее любой суперпользователь может отозвать, модифицировать и/или выдать дополнительно такие права другим пользователям с правом <code class="literal">CREATEROLE</code>. Любой пользователь с правами <code class="literal">CREATEROLE</code> и <code class="literal">ADMIN OPTION</code> в этой роли может её администрировать.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="database-roles.html" title="22.1. Роли базы данных">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="user-manag.html" title="Глава 22. Роли базы данных">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="role-membership.html" title="22.3. Членство в роли">След.</a></td></tr><tr><td width="40%" align="left" valign="top">22.1. Роли базы данных </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 22.3. Членство в роли</td></tr></table></div></body></html>