<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>21.1. Файл pg_hba.conf</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения" /><link rel="next" href="auth-username-maps.html" title="21.2. Файл сопоставления имён пользователей" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">21.1. Файл <code class="filename">pg_hba.conf</code></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения">Наверх</a></td><th width="60%" align="center">Глава 21. Аутентификация клиентского приложения</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="auth-username-maps.html" title="21.2. Файл сопоставления имён пользователей">След.</a></td></tr></table><hr /></div><div class="sect1" id="AUTH-PG-HBA-CONF"><div class="titlepage"><div><div><h2 class="title" style="clear: both">21.1. Файл <code class="filename">pg_hba.conf</code> <a href="#AUTH-PG-HBA-CONF" class="id_link">#</a></h2></div></div></div><a id="id-1.6.8.8.2" class="indexterm"></a><p>Аутентификация клиентов управляется конфигурационным файлом, который традиционно называется <code class="filename">pg_hba.conf</code> и расположен в каталоге с данными кластера базы данных. (<acronym class="acronym">HBA</acronym> расшифровывается как host-based authentication — аутентификации по имени узла.) Файл <code class="filename">pg_hba.conf</code>, со стандартным содержимым, создаётся командой <a class="xref" href="app-initdb.html" title="initdb"><span class="refentrytitle"><span class="application">initdb</span></span></a> при инициализации каталога с данными. Однако его можно разместить в любом другом месте; см. конфигурационный параметр <a class="xref" href="runtime-config-file-locations.html#GUC-HBA-FILE">hba_file</a>.</p><p>Общий формат файла <code class="filename">pg_hba.conf</code> — набор записей, по одной на строку. Пустые строки игнорируются, как и любой текст комментария после знака <code class="literal">#</code>. Запись может быть продолжена на следующей строке, для этого нужно завершить строку обратной косой чертой. (Обратная косая черта является спецсимволом только в конце строки.) Запись состоит из нескольких полей, разделённых пробелами и/или табуляциями. Поля могут содержать пробелы, если содержимое этих полей заключено в кавычки. Если в кавычки берётся какое-либо ключевое слово в поле базы данных, пользователя или адресации (например, <code class="literal">all</code> или <code class="literal">replication</code>), то слово теряет своё особое значение и просто обозначает базу данных, пользователя или сервер с данным именем. Обратная косая черта обозначает перенос строки даже в тексте в кавычках или комментариях.</p><p>Каждая запись аутентификации обозначает тип соединения, диапазон IP-адресов клиента (если он соотносится с типом соединения), имя базы данных, имя пользователя и способ аутентификации, который будет использован для соединения в соответствии с этими параметрами. Первая запись с соответствующим типом соединения, адресом клиента, указанной базой данных и именем пользователя применяется для аутентификации. Процедур <span class="quote">«<span class="quote">fall-through</span>»</span> или <span class="quote">«<span class="quote">backup</span>»</span> не предусмотрено: если выбрана запись и аутентификация не прошла, последующие записи не рассматриваются. Если же ни одна из записей не подошла, в доступе будет отказано.</p><p>Каждая запись может быть директивой включения или записью аутентификации. Директивы включения указывают, что нужно обработать дополнительные файлы с записями. Записи будут вставлены вместо директив включения. Директивы включения содержат только два поля: директиву <code class="literal">include</code>, <code class="literal">include_if_exists</code> или <code class="literal">include_dir</code> и включаемый файл или каталог. Путь к файлу или каталогу может задаваться и как абсолютный, и как относительный и заключаться в двойные кавычки. Для формы <code class="literal">include_dir</code> будут включены все файлы, не начинающиеся с <code class="literal">.</code> и заканчивающиеся на <code class="literal">.conf</code>. Набор файлов во включаемом каталоге обрабатывается по порядку имён (определяемому правилами, принятыми в C, т. е. цифры идут перед буквами, а буквы в верхнем регистре — перед буквами в нижнем).</p><p>Записи могут иметь следующие форматы: </p><pre class="synopsis">
local         <em class="replaceable"><code>база</code></em>  <em class="replaceable"><code>пользователь</code></em>  <em class="replaceable"><code>метод-аутентификации</code></em> [<span class="optional"><em class="replaceable"><code>параметры-аутентификации</code></em></span>]
host          <em class="replaceable"><code>база</code></em>  <em class="replaceable"><code>пользователь</code></em>  <em class="replaceable"><code>адрес</code></em>     <em class="replaceable"><code>метод-аутентификации</code></em>  [<span class="optional"><em class="replaceable"><code>параметры-аутентификации</code></em></span>]
hostssl       <em class="replaceable"><code>база</code></em>  <em class="replaceable"><code>пользователь</code></em>  <em class="replaceable"><code>адрес</code></em>     <em class="replaceable"><code>метод-аутентификации</code></em>  [<span class="optional"><em class="replaceable"><code>параметры-аутентификации</code></em></span>]
hostnossl     <em class="replaceable"><code>база</code></em>  <em class="replaceable"><code>пользователь</code></em>  <em class="replaceable"><code>адрес</code></em>     <em class="replaceable"><code>метод-аутентификации</code></em>  [<span class="optional"><em class="replaceable"><code>параметры-аутентификации</code></em></span>]
hostgssenc    <em class="replaceable"><code>база</code></em>  <em class="replaceable"><code>пользователь</code></em>  <em class="replaceable"><code>адрес</code></em>     <em class="replaceable"><code>метод-аутентификации</code></em>  [<span class="optional"><em class="replaceable"><code>параметры-аутентификации</code></em></span>]
hostnogssenc  <em class="replaceable"><code>база</code></em>  <em class="replaceable"><code>пользователь</code></em>  <em class="replaceable"><code>адрес</code></em>     <em class="replaceable"><code>метод-аутентификации</code></em>  [<span class="optional"><em class="replaceable"><code>параметры-аутентификации</code></em></span>]
host          <em class="replaceable"><code>база</code></em>  <em class="replaceable"><code>пользователь</code></em>  <em class="replaceable"><code>IP-адрес</code></em>  <em class="replaceable"><code>IP-маска</code></em>      <em class="replaceable"><code>метод-аутентификации</code></em>  [<span class="optional"><em class="replaceable"><code>параметры-аутентификации</code></em></span>]
hostssl       <em class="replaceable"><code>база</code></em>  <em class="replaceable"><code>пользователь</code></em>  <em class="replaceable"><code>IP-адрес</code></em>  <em class="replaceable"><code>IP-маска</code></em>      <em class="replaceable"><code>метод-аутентификации</code></em>  [<span class="optional"><em class="replaceable"><code>параметры-аутентификации</code></em></span>]
hostnossl     <em class="replaceable"><code>база</code></em>  <em class="replaceable"><code>пользователь</code></em>  <em class="replaceable"><code>IP-адрес</code></em>  <em class="replaceable"><code>IP-маска</code></em>      <em class="replaceable"><code>метод-аутентификации</code></em>  [<span class="optional"><em class="replaceable"><code>параметры-аутентификации</code></em></span>]
hostgssenc    <em class="replaceable"><code>база</code></em>  <em class="replaceable"><code>пользователь</code></em>  <em class="replaceable"><code>IP-адрес</code></em>  <em class="replaceable"><code>IP-маска</code></em>      <em class="replaceable"><code>метод-аутентификации</code></em>  [<span class="optional"><em class="replaceable"><code>параметры-аутентификации</code></em></span>]
hostnogssenc  <em class="replaceable"><code>база</code></em>  <em class="replaceable"><code>пользователь</code></em>  <em class="replaceable"><code>IP-адрес</code></em>  <em class="replaceable"><code>IP-маска</code></em>      <em class="replaceable"><code>метод-аутентификации</code></em>  [<span class="optional"><em class="replaceable"><code>параметры-аутентификации</code></em></span>]
include             <em class="replaceable"><code>файл</code></em>
include_if_exists   <em class="replaceable"><code>файл</code></em>
include_dir         <em class="replaceable"><code>каталог</code></em>
</pre><p> Значения полей описаны ниже: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">local</code></span></dt><dd><p>Управляет подключениями через Unix-сокеты. Без подобной записи подключения через Unix-сокеты невозможны.</p></dd><dt><span class="term"><code class="literal">host</code></span></dt><dd><p>Управляет подключениями, устанавливаемыми по TCP/IP. Записи <code class="literal">host</code> соответствуют подключениям c <acronym class="acronym">SSL</acronym> и без <acronym class="acronym">SSL</acronym>, а также подключениям, защищённым механизмами <acronym class="acronym">GSSAPI</acronym> и не защищённым <acronym class="acronym">GSSAPI</acronym>.</p><div class="note"><h3 class="title">Примечание</h3><p>Удалённое соединение по TCP/IP невозможно, если сервер запущен без определения соответствующих значений для параметра конфигурации <a class="xref" href="runtime-config-connection.html#GUC-LISTEN-ADDRESSES">listen_addresses</a>, поскольку по умолчанию система принимает подключения по TCP/IP только для локального адреса замыкания <code class="literal">localhost</code>.</p></div></dd><dt><span class="term"><code class="literal">hostssl</code></span></dt><dd><p>Управляет подключениями, устанавливаемыми по TCP/IP с применением шифрования <acronym class="acronym">SSL</acronym>.</p><p>Чтобы использовать эту возможность, сервер должен быть собран с поддержкой <acronym class="acronym">SSL</acronym>. Более того, механизм <acronym class="acronym">SSL</acronym> должен быть включён параметром конфигурации <a class="xref" href="runtime-config-connection.html#GUC-SSL">ssl</a> (подробнее об этом в <a class="xref" href="ssl-tcp.html" title="19.9. Защита соединений TCP/IP с применением SSL">Разделе 19.9</a>). В противном случае запись <code class="literal">hostssl</code> не играет роли (не считая предупреждения о том, что ей не будут соответствовать никакие подключения).</p></dd><dt><span class="term"><code class="literal">hostnossl</code></span></dt><dd><p>Этот тип записей противоположен <code class="literal">hostssl</code>, ему соответствуют только подключения по TCP/IP без шифрования <acronym class="acronym">SSL</acronym>.</p></dd><dt><span class="term"><code class="literal">hostgssenc</code></span></dt><dd><p>Управляет подключениями, устанавливаемыми по TCP/IP, для которых применяется шифрование <acronym class="acronym">GSSAPI</acronym>.</p><p>Чтобы использовать эту возможность, сервер должен быть собран с поддержкой <acronym class="acronym">GSSAPI</acronym>. В противном случае запись <code class="literal">hostgssenc</code> не играет роли (не считая предупреждения о том, что ей не будут соответствовать никакие подключения).</p></dd><dt><span class="term"><code class="literal">hostnogssenc</code></span></dt><dd><p>Этот тип записей противоположен <code class="literal">hostgssenc</code>; ему соответствуют только подключения по TCP/IP без шифрования <acronym class="acronym">GSSAPI</acronym>.</p></dd><dt><span class="term"><em class="replaceable"><code>база</code></em></span></dt><dd><p>Определяет, каким именам баз данных соответствует эта запись. Значение <code class="literal">all</code> определяет, что подходят все базы данных. Значение <code class="literal">sameuser</code> определяет, что данная запись соответствует, только если имя запрашиваемой базы данных совпадает с именем запрашиваемого пользователя. Значение <code class="literal">samerole</code> определяет, что запрашиваемый пользователь должен быть членом роли с таким же именем, как и у запрашиваемой базы данных. (<code class="literal">samegroup</code> — это устаревший, но допустимый вариант значения <code class="literal">samerole</code>.) Суперпользователи, несмотря на то, что они имеют полные права, считаются включёнными в <code class="literal">samerole</code>, только когда они явно входят в такую роль, непосредственно или косвенно. Значение <code class="literal">replication</code> показывает, что запись соответствует, когда запрашивается подключение для физической репликации, но не когда запрашивается подключение для логической. Имейте в виду, что для подключений физической репликации не указывается какая-то конкретная база данных, в то время как для подключений логической репликации должна указываться конкретная база. Любое другое значение воспринимается как имя определённой базы <span class="productname">PostgreSQL</span> или регулярное выражение. Несколько регулярных выражений и/или имён баз данных можно указать, разделяя их запятыми.</p><p>Если имя базы данных начинается с косой черты (<code class="literal">/</code>), оставшаяся часть имени обрабатывается как регулярное выражение. (Подробнее синтаксис регулярных выражений <span class="productname">PostgreSQL</span> описан в <a class="xref" href="functions-matching.html#POSIX-SYNTAX-DETAILS" title="9.7.3.1. Подробное описание регулярных выражений">Подразделе 9.7.3.1</a>.)</p><p>Также можно задать отдельный файл с именами баз данных и/или регулярными выражениями, написав имя файла после знака <code class="literal">@</code>.</p></dd><dt><span class="term"><em class="replaceable"><code>пользователь</code></em></span></dt><dd><p>Указывает, какому имени (или именам) пользователя базы данных соответствует эта запись. Значение <code class="literal">all</code> указывает, что запись соответствует всем пользователям. Любое другое значение задаёт либо имя конкретного пользователя базы данных, либо регулярное выражение (если это значение начинается с <code class="literal">/</code>), либо имя группы (если это значение начинается с <code class="literal">+</code>). (Напомним, что в <span class="productname">PostgreSQL</span> нет никакой разницы между пользователем и группой; знак <code class="literal">+</code> означает <span class="quote">«<span class="quote">совпадение любых ролей, которые прямо или косвенно являются членами роли</span>»</span>, тогда как имя без знака <code class="literal">+</code> является подходящим только для этой конкретной роли.) В связи с этим, суперпользователь рассматривается как член роли, только если он явно является членом этой роли, прямо или косвенно, а не только потому, что он является суперпользователем. Несколько регулярных выражений и/или имён пользователей можно указать, разделяя их запятыми.</p><p>Если имя пользователя начинается с косой черты (<code class="literal">/</code>), оставшаяся часть имени обрабатывается как регулярное выражение. (Подробнее синтаксис регулярных выражений <span class="productname">PostgreSQL</span> описан в <a class="xref" href="functions-matching.html#POSIX-SYNTAX-DETAILS" title="9.7.3.1. Подробное описание регулярных выражений">Подразделе 9.7.3.1</a>.)</p><p>Также можно задать отдельный файл с именами пользователей и/или регулярными выражениями, написав имя файла после знака <code class="literal">@</code>.</p></dd><dt><span class="term"><em class="replaceable"><code>адрес</code></em></span></dt><dd><p>Указывает адрес (или адреса) клиентской машины, которым соответствует данная запись. Это поле может содержать или имя компьютера, или диапазон IP-адресов, или одно из нижеупомянутых ключевых слов.</p><p>Диапазон IP-адресов указывается в виде начального адреса диапазона, дополненного косой чертой (<code class="literal">/</code>) и длиной маски <acronym class="acronym">CIDR</acronym>. Длина маски задаёт количество старших битов клиентского IP-адреса, которые должны совпадать с битами IP-адреса диапазона. Биты, находящиеся правее, в указанном IP-адресе должны быть нулевыми. Между IP-адресом, знаком <code class="literal">/</code> и длиной маски CIDR не должно быть пробельных символов.</p><p>Типичные примеры диапазонов адресов IPv4, указанных таким образом: <code class="literal">172.20.143.89/32</code> для одного компьютера, <code class="literal">172.20.143.0/24</code> для небольшой и <code class="literal">10.6.0.0/16</code> для крупной сети. Диапазон адресов IPv6 может выглядеть как <code class="literal">::1/128</code> для одного компьютера (это адрес замыкания IPv6) или как <code class="literal">fe80::7a31:c1ff:0000:0000/96</code> для небольшой сети. <code class="literal">0.0.0.0/0</code> представляет все адреса IPv4, а <code class="literal">::0/0</code> — все адреса IPv6. Чтобы указать один компьютер, используйте длину маски 32 для IPv4 или 128 для IPv6. Опускать замыкающие нули в сетевом адресе нельзя.</p><p>Запись, сделанная в формате IPv4, подойдёт только для подключений по IPv4, а запись в формате IPv6 подойдёт только для подключений по IPv6, даже если представленный адрес находится в диапазоне IPv4-в-IPv6.</p><p>Вы также можете прописать значение <code class="literal">all</code>, чтобы указать любой IP-адрес, <code class="literal">samehost</code>, чтобы указать любые IP-адреса данного сервера, или <code class="literal">samenet</code>, чтобы указать любой адрес любой подсети, к которой сервер подключён напрямую.</p><p>Если определено имя компьютера (всё, что не является диапазоном IP-адресов или специальным ключевым словом, воспринимается как имя компьютера), то оно сравнивается с результатом обратного преобразования IP-адреса клиента (например, обратного DNS-запроса, если используется DNS). При сравнении имён компьютеров регистр не учитывается. Если имена совпали, выполняется прямое преобразование имени (например, прямой DNS-запрос) для проверки, относится ли клиентский IP-адрес к адресам, соответствующим имени. Если двусторонняя проверка пройдена, запись считается соответствующей компьютеру. (В качестве имени узла в файле <code class="filename">pg_hba.conf</code> должно указываться то, что возвращается при преобразовании IP-адреса клиента в имя, иначе строка не будет соответствовать узлу. Некоторые базы данных имён позволяют связать с одним IP-адресом несколько имён узлов, но операционная система при попытке разрешить IP-адрес возвращает только одно имя.)</p><p>Указание имени, начинающееся с точки (<code class="literal">.</code>), соответствует суффиксу актуального имени узла. Так, <code class="literal">.example.com</code> будет соответствовать <code class="literal">foo.example.com</code> (а не только <code class="literal">example.com</code>).</p><p>Когда в <code class="filename">pg_hba.conf</code> указываются имена узлов, следует добиться, чтобы разрешение имён выполнялось достаточно быстро. Для этого может быть полезен локальный кеш разрешения имён, например, <code class="command">nscd</code>. Вы также можете включить конфигурационный параметр <code class="varname">log_hostname</code>, чтобы видеть в журналах имя компьютера клиента вместо IP-адреса.</p><p>Эти поля не применимы к записям <code class="literal">local</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>Пользователи часто задаются вопросом, почему имена серверов обрабатываются таким сложным, на первый взгляд, способом, с разрешением двух имён, включая обратный запрос клиентского IP-адреса. Это усложняет процесс в случае, если обратная DNS-запись клиента не установлена или включает в себя нежелательное имя узла. Такой способ избран, в первую очередь, для повышения эффективности: в этом случае соединение требует максимум два запроса разрешения, один прямой и один обратный. Если есть проблема разрешения с каким-то адресом, то она остаётся проблемой этого клиента. Гипотетически, могла бы быть реализована возможность во время каждой попытки соединения выполнять только прямой запрос для разрешения каждого имени сервера, упомянутого в <code class="filename">pg_hba.conf</code>. Но если список имён велик, процесс был бы довольно медленным, а в случае наличия проблемы разрешения у одного имени сервера, это стало бы общей проблемой.</p><p>Также обратный запрос необходим для того, чтобы реализовать возможность соответствия суффиксов, поскольку для сопоставления с шаблоном требуется знать фактическое имя компьютера клиента.</p><p>Обратите внимание, что такое поведение согласуется с другими популярными реализациями контроля доступа на основе имён, такими как Apache HTTP Server и TCP Wrappers.</p></div></dd><dt><span class="term"><em class="replaceable"><code>IP-адрес</code></em><br /></span><span class="term"><em class="replaceable"><code>IP-маска</code></em></span></dt><dd><p>Эти два поля могут быть использованы как альтернатива записи <em class="replaceable"><code>IP-адрес</code></em><code class="literal">/</code><em class="replaceable"><code>длина-маски</code></em>. Вместо того, чтобы указывать длину маски, в отдельном столбце указывается сама маска. Например, <code class="literal">255.0.0.0</code> представляет собой маску CIDR для IPv4 длиной 8 бит, а <code class="literal">255.255.255.255</code> представляет маску CIDR длиной 32 бита.</p><p>Эти поля не применимы к записям <code class="literal">local</code>.</p></dd><dt><span class="term"><em class="replaceable"><code>метод-аутентификации</code></em></span></dt><dd><p>Указывает метод аутентификации, когда подключение соответствует этой записи. Варианты выбора приводятся ниже; подробности в <a class="xref" href="auth-methods.html" title="21.3. Методы аутентификации">Разделе 21.3</a>. Все значения воспринимаются с учётом регистра и должны быть записаны в нижнем регистре, даже аббревиатуры типа <code class="literal">ldap</code>. </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">trust</code></span></dt><dd><p>Разрешает безусловное подключение. Этот метод позволяет тому, кто может подключиться к серверу с базой данных <span class="productname">PostgreSQL</span>, войти под любым желаемым пользователем <span class="productname">PostgreSQL</span> без введения пароля и без какой-либо другой аутентификации. За подробностями обратитесь к <a class="xref" href="auth-trust.html" title="21.4. Аутентификация trust">Разделу 21.4</a>.</p></dd><dt><span class="term"><code class="literal">reject</code></span></dt><dd><p>Отклоняет подключение безусловно. Эта возможность полезна для <span class="quote">«<span class="quote">фильтрации</span>»</span> некоторых серверов группы, например, строка <code class="literal">reject</code> может отклонить попытку подключения одного компьютера, при этом следующая строка позволяет подключиться остальным компьютерам в той же сети.</p></dd><dt><span class="term"><code class="literal">scram-sha-256</code></span></dt><dd><p>Проверяет пароль пользователя, производя аутентификацию SCRAM-SHA-256. За подробностями обратитесь к <a class="xref" href="auth-password.html" title="21.5. Аутентификация password">Разделу 21.5</a>.</p></dd><dt><span class="term"><code class="literal">md5</code></span></dt><dd><p>Проверяет пароль пользователя, производя аутентификацию SCRAM-SHA-256 или MD5. За подробностями обратитесь к <a class="xref" href="auth-password.html" title="21.5. Аутентификация password">Разделу 21.5</a>.</p></dd><dt><span class="term"><code class="literal">password</code></span></dt><dd><p>Требует для аутентификации введения клиентом незашифрованного пароля. Поскольку пароль посылается простым текстом через сеть, такой способ не стоит использовать, если сеть не вызывает доверия. За подробностями обратитесь к <a class="xref" href="auth-password.html" title="21.5. Аутентификация password">Разделу 21.5</a>.</p></dd><dt><span class="term"><code class="literal">gss</code></span></dt><dd><p>Для аутентификации пользователя использует GSSAPI. Этот способ доступен только для подключений по TCP/IP. За подробностями обратитесь к <a class="xref" href="gssapi-auth.html" title="21.6. Аутентификация GSSAPI">Разделу 21.6</a>. Он может применяться в сочетании с шифрованием GSSAPI.</p></dd><dt><span class="term"><code class="literal">sspi</code></span></dt><dd><p>Для аутентификации пользователя использует SSPI. Способ доступен только для Windows. За подробностями обратитесь к <a class="xref" href="sspi-auth.html" title="21.7. Аутентификация SSPI">Разделу 21.7</a>.</p></dd><dt><span class="term"><code class="literal">ident</code></span></dt><dd><p>Получает имя пользователя операционной системы клиента, связываясь с сервером Ident, и проверяет, соответствует ли оно имени пользователя базы данных. Аутентификация ident может использоваться только для подключений по TCP/IP. Для локальных подключений применяется аутентификация peer. За подробностями обратитесь к <a class="xref" href="auth-ident.html" title="21.8. Аутентификация ident">Разделу 21.8</a>.</p></dd><dt><span class="term"><code class="literal">peer</code></span></dt><dd><p>Получает имя пользователя операционной системы клиента из операционной системы и проверяет, соответствует ли оно имени пользователя запрашиваемой базы данных. Доступно только для локальных подключений. За подробностями обратитесь к <a class="xref" href="auth-peer.html" title="21.9. Аутентификация peer">Разделу 21.9</a>.</p></dd><dt><span class="term"><code class="literal">ldap</code></span></dt><dd><p>Проводит аутентификацию, используя сервер <acronym class="acronym">LDAP</acronym>. За подробностями обратитесь к <a class="xref" href="auth-ldap.html" title="21.10. Аутентификация LDAP">Разделу 21.10</a>.</p></dd><dt><span class="term"><code class="literal">radius</code></span></dt><dd><p>Проводит аутентификацию, используя сервер RADIUS. За подробностями обратитесь к <a class="xref" href="auth-radius.html" title="21.11. Аутентификация RADIUS">Разделу 21.11</a>.</p></dd><dt><span class="term"><code class="literal">cert</code></span></dt><dd><p>Проводит аутентификацию, используя клиентский сертификат SSL. За подробностями обратитесь к <a class="xref" href="auth-cert.html" title="21.12. Аутентификация по сертификату">Разделу 21.12</a>.</p></dd><dt><span class="term"><code class="literal">pam</code></span></dt><dd><p>Проводит аутентификацию, используя службу подключаемых модулей аутентификации (PAM), предоставляемую операционной системой. За подробностями обратитесь к <a class="xref" href="auth-pam.html" title="21.13. Аутентификация PAM">Разделу 21.13</a>.</p></dd><dt><span class="term"><code class="literal">bsd</code></span></dt><dd><p>Проводит аутентификацию, используя службу аутентификации BSD, предоставляемую операционной системой. За подробностями обратитесь к <a class="xref" href="auth-bsd.html" title="21.14. Аутентификация BSD">Разделу 21.14</a>.</p></dd></dl></div></dd><dt><span class="term"><em class="replaceable"><code>параметры-аутентификации</code></em></span></dt><dd><p>После поля <em class="replaceable"><code>метод-аутентификации</code></em> может идти поле (поля) вида <em class="replaceable"><code>имя</code></em><code class="literal">=</code><em class="replaceable"><code>значение</code></em>, определяющее параметры метода аутентификации. Подробнее о параметрах, доступных для различных методов аутентификации, рассказывается ниже.</p><p>Помимо описанных далее параметров, относящихся к различным методам, есть один общий параметр аутентификации <code class="literal">clientcert</code>, который можно задать в любой записи <code class="literal">hostssl</code>. Он может принимать значения <code class="literal">verify-ca</code> и <code class="literal">verify-full</code>. В обоих случаях клиент должен предоставить годный (доверенный) сертификат SSL, но вариант <code class="literal">verify-full</code> дополнительно требует, чтобы значение <code class="literal">cn</code> (Common Name, Общее имя) в сертификате совпадало с именем пользователя или применимым сопоставлением. Это указание работает подобно методу аутентификации <code class="literal">cert</code> (см. <a class="xref" href="auth-cert.html" title="21.12. Аутентификация по сертификату">Раздел 21.12</a>), но позволяет связать проверку клиентских сертификатов с любым методом аутентификации, поддерживающим записи <code class="literal">hostssl</code>.</p><p>В любой записи, включающей аутентификацию по клиентскому сертификату (то есть в записи с методом аутентификации <code class="literal">cert</code> или с параметром <code class="literal">clientcert</code>), в дополнительном параметре <code class="literal">clientname</code> можно выбрать сопоставляемый при проверке элемент учётных данных в клиентском сертификате. Этот параметр может иметь одно из двух значений. Если указано значение <code class="literal">clientname=CN</code> (оно подразумевается по умолчанию), имя пользователя сопоставляется с полем <code class="literal">Common Name (CN)</code>. Если указано значение <code class="literal">clientname=DN</code> — с полем <code class="literal">Distinguished name (DN)</code>. Этот вариант, вероятно, будет лучше использовать с сопоставлениями имён пользователей. Сравнение <code class="literal">DN</code> выполняется в формате <a class="ulink" href="https://datatracker.ietf.org/doc/html/rfc2253" target="_top">RFC 2253</a>. Извлечь поле <code class="literal">DN</code> в этом формате из клиентского сертификата можно так: </p><pre class="programlisting">openssl x509 -in myclient.crt -noout -subject -nameopt RFC2253 | sed "s/^subject=//"</pre><p> Использовать данный вариант следует с осторожностью, особенно когда для сопоставлений <code class="literal">DN</code> применяются регулярные выражения.</p></dd><dt><span class="term"><code class="literal">include</code></span></dt><dd><p>Эта строка будет заменена на содержимое указанного файла.</p></dd><dt><span class="term"><code class="literal">include_if_exists</code></span></dt><dd><p>Эта строка будет заменена на содержимое указанного файла, если файл существует. В противном случае в журнал вносится сообщение о том, что файл был пропущен.</p></dd><dt><span class="term"><code class="literal">include_dir</code></span></dt><dd><p>Эта строка будет заменена на содержимое всех файлов, найденных в каталоге, если они не начинаются с <code class="literal">.</code> и заканчиваются на <code class="literal">.conf</code>, обработанными в алфавитном порядке (определяемому правилами, принятыми в C, т. е. цифры идут перед буквами, а буквы в верхнем регистре — перед буквами в нижнем).</p></dd></dl></div><p>Файлы, включённые в конструкции, начинающиеся с <code class="literal">@</code>, читаются, как список имён, разделённых запятыми или пробелами. Комментарии предваряются знаком <code class="literal">#</code>, как и в файле <code class="filename">pg_hba.conf</code>, и вложенные <code class="literal">@</code> конструкции допустимы. Если только имя файла, начинающегося с <code class="literal">@</code> не является абсолютным путём.</p><p>Поскольку записи файла <code class="filename">pg_hba.conf</code> рассматриваются последовательно для каждого подключения, порядок записей имеет большое значение. Обычно более ранние записи определяют чёткие критерии для соответствия параметров подключения, но для методов аутентификации допускают послабления. Напротив, записи более поздние смягчают требования к соответствию параметров подключения, но усиливают их в отношении методов аутентификации. Например, некто желает использовать <code class="literal">trust</code> аутентификацию для локального подключения по TCP/IP, но при этом запрашивать пароль для удалённых подключений по TCP/IP. В этом случае запись, устанавливающая аутентификацию <code class="literal">trust</code> для подключения адреса 127.0.0.1, должна предшествовать записи, определяющей аутентификацию по паролю для более широкого диапазона клиентских IP-адресов.</p><p>Файл <code class="filename">pg_hba.conf</code> прочитывается при запуске системы, а также в тот момент, когда основной сервер получает сигнал <span class="systemitem">SIGHUP</span><a id="id-1.6.8.8.10.3" class="indexterm"></a>. Если вы редактируете файл во время работы системы, необходимо послать сигнал процессу postmaster (используя <code class="literal">pg_ctl reload</code>, вызвав SQL-функцию <code class="function">pg_reload_conf()</code> или выполнив <code class="literal">kill -HUP</code>), чтобы он прочел обновлённый файл.</p><div class="note"><h3 class="title">Примечание</h3><p>Предыдущее утверждение не касается Microsoft Windows: там любые изменения в <code class="filename">pg_hba.conf</code> сразу применяются к последующим подключениям.</p></div><p>Системное представление <a class="link" href="view-pg-hba-file-rules.html" title="54.9. pg_hba_file_rules"><code class="structname">pg_hba_file_rules</code></a> может быть полезно для предварительной проверки изменений в файле <code class="filename">pg_hba.conf</code> или для диагностики проблем, когда перезагрузка этого файла не даёт желаемого эффекта. Строки в этом представлении, содержащие в поле <code class="structfield">error</code> не NULL, указывают на проблемы в соответствующих строках файла.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Чтобы подключиться к конкретной базе данных, пользователь не только должен пройти все проверки файла <code class="filename">pg_hba.conf</code>, но должен иметь привилегию <code class="literal">CONNECT</code> для подключения к базе данных. Если вы хотите ограничить доступ к базам данных для определённых пользователей, проще предоставить/отозвать привилегию <code class="literal">CONNECT</code>, нежели устанавливать правила в записях файла <code class="filename">pg_hba.conf</code>.</p></div><p>Примеры записей файла <code class="filename">pg_hba.conf</code> показаны в <a class="xref" href="auth-pg-hba-conf.html#EXAMPLE-PG-HBA.CONF" title="Пример 21.1. Примеры записей pg_hba.conf">Примере 21.1</a>. Обратитесь к следующему разделу за более подробной информацией по методам аутентификации.</p><div class="example" id="EXAMPLE-PG-HBA.CONF"><p class="title"><strong>Пример 21.1. Примеры записей <code class="filename">pg_hba.conf</code></strong></p><div class="example-contents"><pre class="programlisting"># Позволяет любому пользователю локальной системы подключаться
# к любой базе данных, используя любое имя пользователя баз данных, через
# Unix-сокеты (по умолчанию для локальных подключений).
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
local   all             all                                     trust

# То же, но для локальных замкнутых подключений по TCP/IP.
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             127.0.0.1/32            trust

# То же, что и в предыдущей строке, но с указанием
# сетевой маски в отдельном столбце
#
# TYPE  DATABASE        USER            IP-ADDRESS      IP-MASK             METHOD
host    all             all             127.0.0.1       255.255.255.255     trust

# То же для IPv6.
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             ::1/128                 trust

# То же самое, но с использованием имени узла
# (обычно покрывает и IPv4, и IPv6).
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             localhost               trust

# То же самое с использованием регулярного выражения для DATABASE, позволяющего подключиться
# к базам данных db1, db2 и любой другой БД с именем, начинающимся с "db"
# и заканчивающимся на число, содержащее от 2 до 4 цифр (например, "db1234" или
# "db12").
#
# TYPE  DATABASE                   USER            ADDRESS          METHOD
local   db1,"/^db\d{2,4}$",db2     all             localhost        trust

# Позволяет любому пользователю любого компьютера с IP-адресом
# 192.168.93.x подключаться к базе данных "postgres"
# с именем, которое сообщает для данного подключения ident
# (как правило, имя пользователя операционной системы).
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    postgres        all             192.168.93.0/24         ident

# Позволяет любому пользователю компьютера 192.168.12.10 подключаться
# к базе данных "postgres", если он передаёт правильный пароль.
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    postgres        all             192.168.12.10/32        scram-sha-256

# Позволяет любым пользователям с компьютеров в домене example.com
# подключаться к любой базе данных, если передаётся правильный пароль.
#
# Для всех пользователей требуется аутентификация SCRAM, за исключением
# пользователя 'mike', который использует старый клиент, не поддерживающий
# аутентификацию SCRAM.
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             mike            .example.com            md5
host    all             all             .example.com            scram-sha-256

# В случае отсутствия предшествующих строчек с "host", следующие две строки
# откажут в подключении с 192.168.54.1 (поскольку данная запись будет
# выбрана первой), но разрешат подключения GSSAPI с любых других
# адресов. С нулевой маской ни один бит из IP-адреса компьютера
# не учитывается, так что этой строке соответствует любой компьютер.
# Незашифрованные средствами GSSAPI подключения (они "опускаются" # до третьей строки, так как записи "hostgssenc" соответствуют только # зашифрованные подключения) принимаются, но только с адреса 192.168.12.10.
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             192.168.54.1/32         reject
hostgssenc all          all             0.0.0.0/0               gss
host    all             all             192.168.12.10/32        gss

# Позволяет пользователям с любого компьютера 192.168.x.x подключаться
# к любой базе данных, если они проходят проверку ident.  Если же ident
# говорит, например, что это пользователь "bryanh" и он запрашивает
# подключение как пользователь PostgreSQL "guest1", подключение
# будет разрешено, если в файле pg_ident.conf есть сопоставление
# "omicron", позволяющее пользователю "bryanh" подключаться как "guest1".
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             192.168.0.0/16          ident map=omicron

# Если для локальных подключений предусмотрены только эти четыре строки,
# они позволят локальным пользователям подключаться только к своим
# базам данных (базам данных с именами, совпадающими с
# именами пользователей баз данных), кроме пользователей, чьё имя # заканчивается на "helpdesk", администраторов
# или членов роли "support", которые могут подключиться к любой БД.
# Список имён администраторов содержится в файле $PGDATA/admins.
# Пароли требуются в любом случае.
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
local   sameuser        all                                     md5
local   all             /^.*helpdesk$                           md5
local   all             @admins                                 md5
local   all             +support                                md5

# Последние две строчки выше могут быть объединены в одну:
local   all             @admins,+support                        md5

# В столбце DATABASE также могут указываться списки и имена файлов:
local   db1,db2,@demodbs  all                                   md5</pre></div></div><br class="example-break" /></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="client-authentication.html" title="Глава 21. Аутентификация клиентского приложения">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="auth-username-maps.html" title="21.2. Файл сопоставления имён пользователей">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Глава 21. Аутентификация клиентского приложения </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 21.2. Файл сопоставления имён пользователей</td></tr></table></div></body></html>