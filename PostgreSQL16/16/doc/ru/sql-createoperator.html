<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE OPERATOR</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-creatematerializedview.html" title="CREATE MATERIALIZED VIEW" /><link rel="next" href="sql-createopclass.html" title="CREATE OPERATOR CLASS" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">CREATE OPERATOR</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-creatematerializedview.html" title="CREATE MATERIALIZED VIEW">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><th width="60%" align="center">Команды SQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-createopclass.html" title="CREATE OPERATOR CLASS">След.</a></td></tr></table><hr /></div><div class="refentry" id="SQL-CREATEOPERATOR"><div class="titlepage"></div><a id="id-1.9.3.72.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">CREATE OPERATOR</span></h2><p>CREATE OPERATOR — создать оператор</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">CREATE OPERATOR <em class="replaceable"><code>имя</code></em> (
    {FUNCTION|PROCEDURE} = <em class="replaceable"><code>имя_функции</code></em>
    [, LEFTARG = <em class="replaceable"><code>тип_слева</code></em> ] [, RIGHTARG = <em class="replaceable"><code>тип_справа</code></em> ]
    [, COMMUTATOR = <em class="replaceable"><code>коммут_оператор</code></em> ] [, NEGATOR = <em class="replaceable"><code>обратный_оператор</code></em> ]
    [, RESTRICT = <em class="replaceable"><code>процедура_ограничения</code></em> ] [, JOIN = <em class="replaceable"><code>процедура_соединения</code></em> ]
    [, HASHES ] [, MERGES ]
)</pre></div><div class="refsect1" id="id-1.9.3.72.5"><h2>Описание</h2><p><code class="command">CREATE OPERATOR</code> определяет новый оператор, <em class="replaceable"><code>имя</code></em>. Владельцем оператора становится пользователь, его создавший. Если указано имя схемы, оператор создаётся в ней, в противном случае — в текущей схеме.</p><p>Имя оператора образует последовательность из нескольких символов (не более чем <code class="symbol">NAMEDATALEN</code>-1, по умолчанию 63) из следующего списка: </p><div class="literallayout"><p><br />
+ - * / &lt; &gt; = ~ ! @ # % ^ &amp; | ` ?<br />
</p></div><p> Однако выбор имени ограничен ещё следующими условиями: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Сочетания символов <code class="literal">--</code> и <code class="literal">/*</code> не могут присутствовать в имени оператора, так как они будут обозначать начало комментария.</p></li><li class="listitem"><p>Многосимвольное имя оператора не может заканчиваться знаком <code class="literal">+</code> или <code class="literal">-</code>, если только оно не содержит также один из этих символов: </p><div class="literallayout"><p><br />
~ ! @ # % ^ &amp; | ` ?<br />
</p></div><p> Например, <code class="literal">@-</code> — допустимое имя оператора, а <code class="literal">*-</code> — нет. Благодаря этому ограничению, <span class="productname">PostgreSQL</span> может разбирать корректные SQL-запросы без пробелов между компонентами.</p></li><li class="listitem"><p>Символ <code class="literal">=&gt;</code> зарезервирован для использования в грамматике языка SQL, поэтому его нельзя использовать в качестве имени оператора.</p></li></ul></div><p>Оператор <code class="literal">!=</code> отображается в <code class="literal">&lt;&gt;</code> при вводе, так что эти два имени всегда равнозначны.</p><p>Для бинарных операторов должны определяться оба параметра <code class="literal">LEFTARG</code> и <code class="literal">RIGHTARG</code>, а для префиксных операторов нужно определить только параметр <code class="literal">RIGHTARG</code>. Функция <em class="replaceable"><code>имя_функции</code></em> должна быть уже определена с помощью <code class="command">CREATE FUNCTION</code> и иметь соответствующее число аргументов (один или два) указанных типов.</p><p>В синтаксисе <code class="literal">CREATE OPERATOR</code> ключевые слова <code class="literal">FUNCTION</code> и <code class="literal">PROCEDURE</code> равнозначны, но указываемая функция должна в любом случае быть функцией, а не процедурой. Ключевое слово <code class="literal">PROCEDURE</code> здесь поддерживается по историческим причинам и считается устаревшим.</p><p>Другие предложения определяют дополнительные характеристики оптимизации. Их значение описано в <a class="xref" href="xoper-optimization.html" title="38.15. Информация для оптимизации операторов">Разделе 38.15</a>.</p><p>Чтобы создать оператор, необходимо иметь право <code class="literal">USAGE</code> для типов аргументов и результата, а также право <code class="literal">EXECUTE</code> для нижележащей функции. Если указывается коммутативный или обратный оператор, нужно быть его владельцем.</p></div><div class="refsect1" id="id-1.9.3.72.6"><h2>Параметры</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>имя</code></em></span></dt><dd><p>Имя определяемого оператора. Допустимые в нём символы перечислены ниже. Указанное имя может быть дополнено схемой, например так: <code class="literal">CREATE OPERATOR myschema.+ (...)</code>. Если схема не указана, оператор создаётся в текущей схеме. При этом два оператора в одной схеме могут иметь одно имя, если они работают с разными типами данных. Такое определение операторов называется <em class="firstterm">перегрузкой</em>.</p></dd><dt><span class="term"><em class="replaceable"><code>имя_функции</code></em></span></dt><dd><p>Функция, реализующая этот оператор.</p></dd><dt><span class="term"><em class="replaceable"><code>тип_слева</code></em></span></dt><dd><p>Тип данных левого операнда оператора, если он есть. Этот параметр опускается для префиксных операторов.</p></dd><dt><span class="term"><em class="replaceable"><code>тип_справа</code></em></span></dt><dd><p>Тип данных правого операнда оператора.</p></dd><dt><span class="term"><em class="replaceable"><code>коммут_оператор</code></em></span></dt><dd><p>Оператор, коммутирующий для данного.</p></dd><dt><span class="term"><em class="replaceable"><code>обратный_оператор</code></em></span></dt><dd><p>Оператор, обратный для данного.</p></dd><dt><span class="term"><em class="replaceable"><code>процедура_ограничения</code></em></span></dt><dd><p>Функция оценки избирательности ограничения для данного оператора.</p></dd><dt><span class="term"><em class="replaceable"><code>процедура_соединения</code></em></span></dt><dd><p>Функция оценки избирательности соединения для этого оператора.</p></dd><dt><span class="term"><code class="literal">HASHES</code></span></dt><dd><p>Показывает, что этот оператор поддерживает соединение по хешу.</p></dd><dt><span class="term"><code class="literal">MERGES</code></span></dt><dd><p>Показывает, что этот оператор поддерживает соединение слиянием.</p></dd></dl></div><p>Чтобы задать имя оператора с указанием схемы в <em class="replaceable"><code>коммут_оператор</code></em> или другом дополнительном аргументе, применяется синтаксис <code class="literal">OPERATOR()</code>, например: </p><pre class="programlisting">COMMUTATOR = OPERATOR(myschema.===) ,</pre></div><div class="refsect1" id="id-1.9.3.72.7"><h2>Замечания</h2><p>За дополнительными сведениями обратитесь к <a class="xref" href="xoper.html" title="38.14. Пользовательские операторы">Разделу 38.14</a>.</p><p>Задать лексический приоритет оператора в команде <code class="command">CREATE OPERATOR</code> невозможно, так как обработка приоритетов жёстко зашита в анализаторе. Подробнее приоритеты описаны в <a class="xref" href="sql-syntax-lexical.html#SQL-PRECEDENCE" title="4.1.6. Приоритеты операторов">Подразделе 4.1.6</a>.</p><p>Устаревшие параметры <code class="literal">SORT1</code>, <code class="literal">SORT2</code>, <code class="literal">LTCMP</code> и <code class="literal">GTCMP</code> ранее использовались для определения имён операторов сортировки, связанных с оператором, применяемым при соединении слиянием. Теперь это не требуется, так как информацию о связанных операторах теперь дают семейства операторов B-дерева. Если в команде отсутствует явное указание <code class="literal">MERGES</code>, все эти параметры игнорируются.</p><p>Для удаления пользовательских операторов из базы данных применяется <a class="link" href="sql-dropoperator.html" title="DROP OPERATOR"><code class="command">DROP OPERATOR</code></a>, а для изменения их свойств — <a class="xref" href="sql-alteroperator.html" title="ALTER OPERATOR"><span class="refentrytitle">ALTER OPERATOR</span></a>.</p></div><div class="refsect1" id="id-1.9.3.72.8"><h2>Примеры</h2><p>Следующая команда определяет новый оператор, проверяющий равенство площадей, для типа <code class="type">box</code>: </p><pre class="programlisting">CREATE OPERATOR === (
    LEFTARG = box,
    RIGHTARG = box,
    FUNCTION = area_equal_function,
    COMMUTATOR = ===,
    NEGATOR = !==,
    RESTRICT = area_restriction_function,
    JOIN = area_join_function,
    HASHES, MERGES
);</pre></div><div class="refsect1" id="id-1.9.3.72.9"><h2>Совместимость</h2><p><code class="command">CREATE OPERATOR</code> является языковым расширением <span class="productname">PostgreSQL</span>. Средства определения пользовательских операторов в стандарте SQL не описаны.</p></div><div class="refsect1" id="id-1.9.3.72.10"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-alteroperator.html" title="ALTER OPERATOR"><span class="refentrytitle">ALTER OPERATOR</span></a>, <a class="xref" href="sql-createopclass.html" title="CREATE OPERATOR CLASS"><span class="refentrytitle">CREATE OPERATOR CLASS</span></a>, <a class="xref" href="sql-dropoperator.html" title="DROP OPERATOR"><span class="refentrytitle">DROP OPERATOR</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-creatematerializedview.html" title="CREATE MATERIALIZED VIEW">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-createopclass.html" title="CREATE OPERATOR CLASS">След.</a></td></tr><tr><td width="40%" align="left" valign="top">CREATE MATERIALIZED VIEW </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> CREATE OPERATOR CLASS</td></tr></table></div></body></html>