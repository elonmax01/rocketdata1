<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>dblink_connect</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="dblink.html" title="F.12. dblink — подключение к другим базам данных PostgreSQL" /><link rel="next" href="contrib-dblink-connect-u.html" title="dblink_connect_u" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">dblink_connect</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="dblink.html" title="F.12. dblink — подключение к другим базам данных PostgreSQL">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="dblink.html" title="F.12. dblink — подключение к другим базам данных PostgreSQL">Наверх</a></td><th width="60%" align="center">F.12. dblink — подключение к другим базам данных PostgreSQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="contrib-dblink-connect-u.html" title="dblink_connect_u">След.</a></td></tr></table><hr /></div><div class="refentry" id="CONTRIB-DBLINK-CONNECT"><div class="titlepage"></div><a id="id-1.11.7.22.5.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">dblink_connect</span></h2><p>dblink_connect — открывает постоянное подключение к удалённой базе данных</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">dblink_connect(text connstr) returns text
dblink_connect(text connname, text connstr) returns text</pre></div><div class="refsect1" id="id-1.11.7.22.5.5"><h2>Описание</h2><p>Функция <code class="function">dblink_connect()</code> устанавливает подключение к удалённой базе данных <span class="productname">PostgreSQL</span>. Целевой сервер и база данных указываются в стандартной строке подключения <span class="application">libpq</span>. Если требуется, этому подключению можно назначить имя. В один момент времени могут быть открытыми несколько именованных подключений, но только одно подключение без имени. Подключение будет сохраняться, пока не будет закрыто или до завершения сеанса базы данных.</p><p>В строке подключения также может задаваться имя существующего стороннего сервера. Для определения стороннего сервера рекомендуется использовать обёртку сторонних данных <code class="literal">dblink_fdw</code>. См. пример ниже, а также <a class="xref" href="sql-createserver.html" title="CREATE SERVER"><span class="refentrytitle">CREATE SERVER</span></a> и <a class="xref" href="sql-createusermapping.html" title="CREATE USER MAPPING"><span class="refentrytitle">CREATE USER MAPPING</span></a>.</p></div><div class="refsect1" id="id-1.11.7.22.5.6"><h2>Аргументы</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="parameter"><code>connname</code></em></span></dt><dd><p>Имя, назначаемое этому подключению; если опускается, открывается безымянное подключение, заменяющее ранее существующее безымянное подключение.</p></dd><dt><span class="term"><em class="parameter"><code>connstr</code></em></span></dt><dd><p>Строка подключения в стиле <span class="application">libpq</span>, например <code class="literal">hostaddr=127.0.0.1 port=5432 dbname=mydb user=postgres password=mypasswd options=-csearch_path=</code>. За подробностями обратитесь к <a class="xref" href="libpq-connect.html#LIBPQ-CONNSTRING" title="34.1.1. Строки параметров подключения">Подразделу 34.1.1</a>. В ней также может задаваться имя стороннего сервера.</p></dd></dl></div></div><div class="refsect1" id="id-1.11.7.22.5.7"><h2>Возвращаемое значение</h2><p>Возвращает состояние (это всегда строка <code class="literal">OK</code>, так как в случае любой ошибки функция прерывается, выдавая исключение).</p></div><div class="refsect1" id="id-1.11.7.22.5.8"><h2>Замечания</h2><p>Если к базе данных, которая не приведена в соответствие <a class="link" href="ddl-schemas.html#DDL-SCHEMAS-PATTERNS" title="5.9.6. Шаблоны использования">шаблону безопасного использования схем</a>, имеют доступ недоверенные пользователи, начинайте сеанс с удаления доступных им для записи схем из пути поиска (<code class="varname">search_path</code>). Например, для этого можно добавить <code class="literal">options=-csearch_path=</code> в <em class="parameter"><code>connstr</code></em>. Это касается не только <code class="filename">dblink</code>, но и любых других интерфейсов для выполнения произвольных SQL-команд.</p><p>Создавать подключения, не требующие аутентификации по паролю и по GSSAPI, с помощью <code class="function">dblink_connect</code> разрешено только суперпользователям. Если эта возможность нужна обычным пользователям, следует воспользоваться функцией <code class="function">dblink_connect_u</code>.</p><p>Использовать в именах подключений знаки «равно» не рекомендуется, так как при этом возможна путаница со строками подключений в других функциях <code class="filename">dblink</code>.</p></div><div class="refsect1" id="id-1.11.7.22.5.9"><h2>Примеры</h2><pre class="screen">SELECT dblink_connect('dbname=postgres options=-csearch_path=');
 dblink_connect
----------------
 OK
(1 row)

SELECT dblink_connect('myconn', 'dbname=postgres options=-csearch_path=');
 dblink_connect
----------------
 OK
(1 row)

-- Функциональность обёртки сторонних данных (FOREIGN DATA WRAPPER)
-- Замечание: чтобы это работало, для локальных подключений требуется аутентификация по паролю
--       В противном случае, вызвав dblink_connect(), вы получите:
--       ERROR:  password is required
--       DETAIL:  Non-superuser cannot connect if the server does not request a password.
--       HINT:  Target server's authentication method must be changed.
--
--       ОШИБКА:  требуется пароль
--       ПОДРОБНОСТИ:  Обычный пользователь не может подключиться, если сервер не требует пароль.
--       ПОДСКАЗКА:  Необходимо изменить метод аутентификации целевого сервера.

CREATE SERVER fdtest FOREIGN DATA WRAPPER dblink_fdw OPTIONS (hostaddr '127.0.0.1', dbname 'contrib_regression');

CREATE USER regress_dblink_user WITH PASSWORD 'secret';
CREATE USER MAPPING FOR regress_dblink_user SERVER fdtest OPTIONS (user 'regress_dblink_user', password 'secret');
GRANT USAGE ON FOREIGN SERVER fdtest TO regress_dblink_user;
GRANT SELECT ON TABLE foo TO regress_dblink_user;

\set ORIGINAL_USER :USER
\c - regress_dblink_user
SELECT dblink_connect('myconn', 'fdtest');
 dblink_connect
----------------
 OK
(1 row)

SELECT * FROM dblink('myconn', 'SELECT * FROM foo') AS t(a int, b text, c text[]);
 a  | b |       c
----+---+---------------
  0 | a | {a0,b0,c0}
  1 | b | {a1,b1,c1}
  2 | c | {a2,b2,c2}
  3 | d | {a3,b3,c3}
  4 | e | {a4,b4,c4}
  5 | f | {a5,b5,c5}
  6 | g | {a6,b6,c6}
  7 | h | {a7,b7,c7}
  8 | i | {a8,b8,c8}
  9 | j | {a9,b9,c9}
 10 | k | {a10,b10,c10}
(11 rows)

\c - :ORIGINAL_USER
REVOKE USAGE ON FOREIGN SERVER fdtest FROM regress_dblink_user;
REVOKE SELECT ON TABLE foo FROM regress_dblink_user;
DROP USER MAPPING FOR regress_dblink_user SERVER fdtest;
DROP USER regress_dblink_user;
DROP SERVER fdtest;</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dblink.html" title="F.12. dblink — подключение к другим базам данных PostgreSQL">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="dblink.html" title="F.12. dblink — подключение к другим базам данных PostgreSQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="contrib-dblink-connect-u.html" title="dblink_connect_u">След.</a></td></tr><tr><td width="40%" align="left" valign="top">F.12. dblink — подключение к другим базам данных PostgreSQL </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> dblink_connect_u</td></tr></table></div></body></html>