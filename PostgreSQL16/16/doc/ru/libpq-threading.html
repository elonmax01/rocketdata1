<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>34.20. Поведение в многопоточных программах</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="libpq-ssl.html" title="34.19. Поддержка SSL" /><link rel="next" href="libpq-build.html" title="34.21. Сборка программ с libpq" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">34.20. Поведение в многопоточных программах</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="libpq-ssl.html" title="34.19. Поддержка SSL">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="libpq.html" title="Глава 34. libpq — библиотека для языка C">Наверх</a></td><th width="60%" align="center">Глава 34. <span class="application">libpq</span> — библиотека для языка C</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="libpq-build.html" title="34.21. Сборка программ с libpq">След.</a></td></tr></table><hr /></div><div class="sect1" id="LIBPQ-THREADING"><div class="titlepage"><div><div><h2 class="title" style="clear: both">34.20. Поведение в многопоточных программах <a href="#LIBPQ-THREADING" class="id_link">#</a></h2></div></div></div><a id="id-1.7.3.27.2" class="indexterm"></a><p>Библиотека <span class="application">libpq</span> по умолчанию поддерживает повторные вызовы и многопоточность. Для соответствующего варианта сборки вашего приложения вам может понадобиться передать компилятору специальные параметры командной строки. Чтобы узнать, как собрать многопоточное приложение, обратитесь к документации вашей системы или поищите в файле <code class="filename">src/Makefile.global</code> значения <code class="literal">PTHREAD_CFLAGS</code> и <code class="literal">PTHREAD_LIBS</code>. Эта функция позволяет узнать, поддерживает ли <span class="application">libpq</span> многопоточность:</p><div class="variablelist"><dl class="variablelist"><dt id="LIBPQ-PQISTHREADSAFE"><span class="term"><code class="function">PQisthreadsafe</code><a id="id-1.7.3.27.4.1.1.2" class="indexterm"></a></span> <a href="#LIBPQ-PQISTHREADSAFE" class="id_link">#</a></dt><dd><p>Возвращает состояние потокобезопасности в библиотеке <span class="application">libpq</span>. </p><pre class="synopsis">
int PQisthreadsafe();
</pre><p>Возвращает 1, если библиотека <span class="application">libpq</span> потокобезопасная, или 0 в противном случае.</p></dd></dl></div><p>Реализация многопоточности не лишена ограничений: два потока не должны пытаться одновременно работать с одним объектом <code class="structname">PGconn</code>. В частности, не допускается параллельное выполнение команд из разных потоков через один объект соединения. (Если вам нужно выполнять команды одновременно, используйте несколько соединений.)</p><p>Объекты <code class="structname">PGresult</code> после создания обычно доступны только для чтения, и поэтому их можно свободно передавать между потоками. Однако если вы используете какую-либо из функций, изменяющих <code class="structname">PGresult</code>, описанных в <a class="xref" href="libpq-misc.html" title="34.12. Функции разного назначения">Разделе 34.12</a> или <a class="xref" href="libpq-events.html" title="34.14. Система событий">Разделе 34.14</a>, вы должны также избегать одновременных обращений к одному объекту <code class="structname">PGresult</code>.</p><p>Устаревшие функции <a class="xref" href="libpq-cancel.html#LIBPQ-PQREQUESTCANCEL"><code class="function">PQrequestCancel</code></a> и <a class="xref" href="libpq-exec.html#LIBPQ-PQOIDSTATUS"><code class="function">PQoidStatus</code></a> не являются потокобезопасными и не должны применяться в многопоточных программах. Вместо <a class="xref" href="libpq-cancel.html#LIBPQ-PQREQUESTCANCEL"><code class="function">PQrequestCancel</code></a> можно использовать <a class="xref" href="libpq-cancel.html#LIBPQ-PQCANCEL"><code class="function">PQcancel</code></a>, а вместо <a class="xref" href="libpq-exec.html#LIBPQ-PQOIDSTATUS"><code class="function">PQoidStatus</code></a> — <a class="xref" href="libpq-exec.html#LIBPQ-PQOIDVALUE"><code class="function">PQoidValue</code></a>.</p><p>Если вы применяете Kerberos в своём приложении (помимо возможного использования внутри <span class="application">libpq</span>), вы должны обеспечить блокировку вокруг вызовов Kerberos, так как функции Kerberos не являются потокобезопасными. Обратите внимание на функцию <code class="function">PQregisterThreadLock</code> в исходном коде <span class="application">libpq</span>, позволяющую организовать совместные блокировки между <span class="application">libpq</span> и вашим приложением.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="libpq-ssl.html" title="34.19. Поддержка SSL">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="libpq.html" title="Глава 34. libpq — библиотека для языка C">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="libpq-build.html" title="34.21. Сборка программ с libpq">След.</a></td></tr><tr><td width="40%" align="left" valign="top">34.19. Поддержка SSL </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 34.21. Сборка программ с <span class="application">libpq</span></td></tr></table></div></body></html>