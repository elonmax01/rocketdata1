<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>31.4. Списки столбцов</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="logical-replication-row-filter.html" title="31.3. Фильтры строк" /><link rel="next" href="logical-replication-conflicts.html" title="31.5. Конфликты" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">31.4. Списки столбцов</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="logical-replication-row-filter.html" title="31.3. Фильтры строк">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="logical-replication.html" title="Глава 31. Логическая репликация">Наверх</a></td><th width="60%" align="center">Глава 31. Логическая репликация</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="logical-replication-conflicts.html" title="31.5. Конфликты">След.</a></td></tr></table><hr /></div><div class="sect1" id="LOGICAL-REPLICATION-COL-LISTS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">31.4. Списки столбцов <a href="#LOGICAL-REPLICATION-COL-LISTS" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="logical-replication-col-lists.html#LOGICAL-REPLICATION-COL-LIST-EXAMPLES">31.4.1. Примеры</a></span></dt></dl></div><p>Для каждой публикации можно дополнительно задать, какие столбцы каждой таблицы реплицируются для подписчиков. При этом в таблице на стороне подписчика должны быть как минимум все публикуемые столбцы. Если список столбов не задан, реплицируются все столбцы публикуемой таблицы. Подробнее синтаксис рассматривается в описании <a class="xref" href="sql-createpublication.html" title="CREATE PUBLICATION"><span class="refentrytitle">CREATE PUBLICATION</span></a>.</p><p>Ограничение множества столбцов может быть продиктовано соображениями производительности или требованиями к поведению. Однако из соображений безопасности использовать это не следует: злоумышленник на стороне подписчика может получить данные из столбцов, которые не были опубликованы явно. Когда важно обеспечить безопасность, надо применять защиту на стороне публикации.</p><p>Если список столбцов не задан, все столбцы, добавляемые позже, будут реплицироваться автоматически. Это означает, что наличие списка, включающего все столбцы, не равнозначно отсутствию списка столбцов.</p><p>Список столбцов может содержать только простые ссылки на столбцы. Порядок столбцов в этом списке не сохраняется.</p><p>Указать список столбцов в публикации, которая также публикует все таблицы в схеме (<a class="link" href="sql-createpublication.html#SQL-CREATEPUBLICATION-FOR-TABLES-IN-SCHEMA"><code class="literal">FOR TABLES IN SCHEMA</code></a>), нельзя.</p><p>Для секционированных таблиц параметр публикации <a class="link" href="sql-createpublication.html#SQL-CREATEPUBLICATION-WITH-PUBLISH-VIA-PARTITION-ROOT"><code class="literal">publish_via_partition_root</code></a> определяет, какой список столбцов использовать. Если <code class="literal">publish_via_partition_root</code> имеет значение <code class="literal">true</code>, используется список столбцов корневой секционированной таблицы. В противном случае, если <code class="literal">publish_via_partition_root</code> имеет значение <code class="literal">false</code> (по умолчанию), используется список столбцов каждой секции.</p><p>Если через публикацию реплицируются операции <code class="command">UPDATE</code> или <code class="command">DELETE</code>, список столбцов должен содержать столбцы, которые входят в идентификатор реплики для данной таблицы (см. <a class="xref" href="sql-altertable.html#SQL-ALTERTABLE-REPLICA-IDENTITY"><code class="literal">REPLICA IDENTITY</code></a>). Если же через публикацию реплицируются только операции <code class="command">INSERT</code>, столбцы идентификатора реплики в списке столбцов могут отсутствовать.</p><p>Для команды <code class="literal">TRUNCATE</code> списки столбцов не имеют значения.</p><p>Во время начальной синхронизации данных копируются только публикуемые столбцы. Однако если на стороне подписчика используется версия ниже 15, при начальной синхронизации копируются все столбцы в таблице, то есть любые списки столбцов игнорируются.</p><div class="warning" id="LOGICAL-REPLICATION-COL-LIST-COMBINING"><h3 class="title">Внимание: объединение списков столбцов из нескольких публикаций</h3><p>В настоящее время не поддерживаются подписки, связанные с несколькими публикациями, в которых одна таблица опубликована с разными списками столбцов. Команда <a class="xref" href="sql-createsubscription.html" title="CREATE SUBSCRIPTION"><span class="refentrytitle">CREATE SUBSCRIPTION</span></a> не допускает создание таких подписок, но это всё равно может произойти при добавлении или изменении списков столбцов на стороне публикации после создания подписки.</p><p>Это означает, что изменение списков столбцов таблиц в публикациях, у которых уже есть подписчики, может привести к возникновению ошибок на стороне подписчика.</p><p>Если подписка затронута этой проблемой, единственный способ возобновить репликацию — изменить один из списков столбцов на стороне публикации, чтобы все они совпадали; а затем либо заново создать подписку, либо использовать <code class="literal">ALTER SUBSCRIPTION ... DROP PUBLICATION</code>, чтобы удалить одну из проблемных публикаций и добавить её снова.</p></div><div class="sect2" id="LOGICAL-REPLICATION-COL-LIST-EXAMPLES"><div class="titlepage"><div><div><h3 class="title">31.4.1. Примеры <a href="#LOGICAL-REPLICATION-COL-LIST-EXAMPLES" class="id_link">#</a></h3></div></div></div><p>Создайте таблицу <code class="literal">t1</code>, которая будет использоваться в следующем примере. </p><pre class="programlisting">test_pub=# CREATE TABLE t1(id int, a text, b text, c text, d text, e text, PRIMARY KEY(id));
CREATE TABLE</pre><p>Создайте публикацию <code class="literal">p1</code>, в которой для таблицы <code class="literal">t1</code> определяется список столбцов, уменьшающий количество реплицируемых столбцов. Заметьте, что порядок имён столбцов в этом списке не имеет значения. </p><pre class="programlisting">test_pub=# CREATE PUBLICATION p1 FOR TABLE t1 (id, b, a, d);
CREATE PUBLICATION</pre><p>Списки столбцов для каждой публикации можно просмотреть в <code class="command">psql</code>. </p><pre class="programlisting">test_pub=# \dRp+
                               Publication p1
  Owner   | All tables | Inserts | Updates | Deletes | Truncates | Via root
----------+------------+---------+---------+---------+-----------+----------
 postgres | f          | t       | t       | t       | t         | f
Tables:
    "public.t1" (id, a, b, d)</pre><p>Списки столбцов для каждой таблицы можно просмотреть в <code class="command">psql</code>. </p><pre class="programlisting">test_pub=# \d t1
                 Table "public.t1"
 Column |  Type   | Collation | Nullable | Default
--------+---------+-----------+----------+---------
 id     | integer |           | not null |
 a      | text    |           |          |
 b      | text    |           |          |
 c      | text    |           |          |
 d      | text    |           |          |
 e      | text    |           |          |
Indexes:
    "t1_pkey" PRIMARY KEY, btree (id)
Publications:
    "p1" (id, a, b, d)</pre><p>Создайте на сервере подписчика таблицу <code class="literal">t1</code>, которая теперь должна содержать лишь подмножество столбцов, существующих в публикуемой таблице <code class="literal">t1</code>, а также создайте публикацию <code class="literal">s1</code>, связанную с публикацией <code class="literal">p1</code>. </p><pre class="programlisting">test_sub=# CREATE TABLE t1(id int, b text, a text, d text, PRIMARY KEY(id));
CREATE TABLE
test_sub=# CREATE SUBSCRIPTION s1
test_sub-# CONNECTION 'host=localhost dbname=test_pub application_name=s1'
test_sub-# PUBLICATION p1;
CREATE SUBSCRIPTION</pre><p>Добавьте на стороне публикации в таблицу <code class="literal">t1</code> несколько строк. </p><pre class="programlisting">test_pub=# INSERT INTO t1 VALUES(1, 'a-1', 'b-1', 'c-1', 'd-1', 'e-1');
INSERT 0 1
test_pub=# INSERT INTO t1 VALUES(2, 'a-2', 'b-2', 'c-2', 'd-2', 'e-2');
INSERT 0 1
test_pub=# INSERT INTO t1 VALUES(3, 'a-3', 'b-3', 'c-3', 'd-3', 'e-3');
INSERT 0 1
test_pub=# SELECT * FROM t1 ORDER BY id;
 id |  a  |  b  |  c  |  d  |  e
----+-----+-----+-----+-----+-----
  1 | a-1 | b-1 | c-1 | d-1 | e-1
  2 | a-2 | b-2 | c-2 | d-2 | e-2
  3 | a-3 | b-3 | c-3 | d-3 | e-3
(3 rows)</pre><p>Как можно видеть, реплицировались только данные из списка столбцов в публикации <code class="literal">p1</code>. </p><pre class="programlisting">test_sub=# SELECT * FROM t1 ORDER BY id;
 id |  b  |  a  |  d
----+-----+-----+-----
  1 | b-1 | a-1 | d-1
  2 | b-2 | a-2 | d-2
  3 | b-3 | a-3 | d-3
(3 rows)</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="logical-replication-row-filter.html" title="31.3. Фильтры строк">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="logical-replication.html" title="Глава 31. Логическая репликация">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="logical-replication-conflicts.html" title="31.5. Конфликты">След.</a></td></tr><tr><td width="40%" align="left" valign="top">31.3. Фильтры строк </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 31.5. Конфликты</td></tr></table></div></body></html>