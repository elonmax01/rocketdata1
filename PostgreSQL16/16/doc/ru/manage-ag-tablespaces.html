<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>23.6. Табличные пространства</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="manage-ag-dropdb.html" title="23.5. Удаление базы данных" /><link rel="next" href="charset.html" title="Глава 24. Локализация" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">23.6. Табличные пространства</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="manage-ag-dropdb.html" title="23.5. Удаление базы данных">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="managing-databases.html" title="Глава 23. Управление базами данных">Наверх</a></td><th width="60%" align="center">Глава 23. Управление базами данных</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="charset.html" title="Глава 24. Локализация">След.</a></td></tr></table><hr /></div><div class="sect1" id="MANAGE-AG-TABLESPACES"><div class="titlepage"><div><div><h2 class="title" style="clear: both">23.6. Табличные пространства <a href="#MANAGE-AG-TABLESPACES" class="id_link">#</a></h2></div></div></div><a id="id-1.6.10.9.2" class="indexterm"></a><p>Табличные пространства в <span class="productname">PostgreSQL</span> позволяют администраторам организовать логику размещения файлов объектов базы данных в файловой системе. К однажды созданному табличному пространству можно обращаться по имени на этапе создания объектов.</p><p>Табличные пространства позволяют администратору управлять дисковым пространством для инсталляции <span class="productname">PostgreSQL</span>. Это полезно минимум по двум причинам. Во-первых, это нехватка места в разделе, на котором был инициализирован кластер и невозможность его расширения. Табличное пространство можно создать в другом разделе и использовать его до тех пор, пока не появится возможность переконфигурирования системы.</p><p>Во-вторых, табличные пространства позволяют администраторам оптимизировать производительность согласно бизнес-процессам, связанным с объектами базы данных. Например, часто используемый индекс можно разместить на очень быстром и надёжном, но дорогом SSD-диске. В то же время таблица с архивными данными, которые редко используются и скорость к доступа к ним не важна, может быть размещена в более дешёвом и медленном хранилище.</p><div class="warning"><h3 class="title">Предупреждение</h3><p>Несмотря на внешнее размещение относительно основного каталога хранения данных PostgreSQL, табличные пространства являются неотъемлемой частью кластера и <span class="emphasis"><em>не могут</em></span> трактоваться, как самостоятельная коллекция файлов данных. Они зависят от метаданных, расположенных в главном каталоге, и потому не могут быть подключены к другому кластеру, или копироваться по отдельности. Также, в случае потери табличного пространства (при удалении файлов, сбое диска и т. п.), кластер может оказаться недоступным или не сможет запуститься. Таким образом, при размещении табличного пространства во временной файловой системе, например, в RAM-диске, возникает угроза надёжности всего кластера.</p></div><p>Для создания табличного пространства используется команда <a class="xref" href="sql-createtablespace.html" title="CREATE TABLESPACE"><span class="refentrytitle">CREATE TABLESPACE</span></a>, например:<a id="id-1.6.10.9.7.2" class="indexterm"></a>: </p><pre class="programlisting">CREATE TABLESPACE fastspace LOCATION '/ssd1/postgresql/data';</pre><p> Каталог должен существовать, быть пустым и принадлежать пользователю ОС, под которым запущен <span class="productname">PostgreSQL</span>. Все созданные впоследствии объекты, принадлежащие целевому табличному пространству, будут храниться в файлах расположенных в этом каталоге. Каталог не должен размещаться на съёмных или устройствах временного хранения, так как кластер может перестать функционировать из-за потери этого пространства.</p><div class="note"><h3 class="title">Примечание</h3><p>Обычно нет смысла создавать более одного пространства на одну логическую файловую систему, так как нет возможности контролировать расположение отдельных файлов в файловой системе. Однако <span class="productname">PostgreSQL</span> не накладывает никаких ограничений в этом отношении, и более того, напрямую не заботится о точках монтирования файловой системы. Просто осуществляется хранение файлов в указанных каталогах.</p></div><p>Создавать табличное пространство должен суперпользователь базы данных, но после этого можно разрешить обычным пользователям его использовать. Для этого необходимо предоставить привилегию <code class="literal">CREATE</code> на табличное пространство.</p><p>Таблицы, индексы и целые базы данных могут храниться в отдельных табличных пространствах. Для этого пользователь с правом <code class="literal">CREATE</code> на табличное пространство должен указать его имя в качестве параметра соответствующей команды. Например, далее создаётся таблица в табличном пространстве <code class="literal">space1</code>: </p><pre class="programlisting">CREATE TABLE foo(i int) TABLESPACE space1;</pre><p>Как вариант, используйте параметр <a class="xref" href="runtime-config-client.html#GUC-DEFAULT-TABLESPACE">default_tablespace</a>: </p><pre class="programlisting">SET default_tablespace = space1;
CREATE TABLE foo(i int);</pre><p> Когда <code class="varname">default_tablespace</code> имеет значение отличное от пустой строки, он будет использоваться неявно в качестве значения параметра <code class="literal">TABLESPACE</code> в командах <code class="command">CREATE TABLE</code> и <code class="command">CREATE INDEX</code>, если в самой команде не задано иное.</p><p>Существует параметр <a class="xref" href="runtime-config-client.html#GUC-TEMP-TABLESPACES">temp_tablespaces</a>, который указывает на размещение временных таблиц и индексов, а также файлов, создаваемых, например, при операциях сортировки больших наборов данных. Предпочтительнее, в качестве значения этого параметра, указывать не одно имя, а список из нескольких табличных пространств. Это поможет распределить нагрузку, связанную с временными объектами, по различным табличным пространствам. При каждом создании временного объекта будет случайным образом выбираться имя из указанного списка табличных пространств.</p><p>Табличное пространство, связанное с базой данных, также используется для хранения её системных каталогов. Более того, это табличное пространство используется по умолчанию для таблиц, индексов и временных файлов, создаваемых в базе данных, если не указано иное в выражении <code class="literal">TABLESPACE</code>, или переменной <code class="varname">default_tablespace</code>, или <code class="varname">temp_tablespaces</code> (соответственно). Если база данных создана без указания конкретного табличного пространства, то используется пространство, к которому принадлежит копируемый шаблон.</p><p>При инициализации кластера автоматически создаются два табличных пространства. Табличное пространство <code class="literal">pg_global</code> используется для общих системных каталогов. Табличное пространство <code class="literal">pg_default</code> используется по умолчанию для баз данных <code class="literal">template1</code> и <code class="literal">template0</code> (в свою очередь, также является пространством по умолчанию для других баз данных, пока не будет явно указано иное в выражении <code class="literal">TABLESPACE</code> команды <code class="command">CREATE DATABASE</code>).</p><p>После создания, табличное пространство можно использовать в рамках любой базы данных, при условии, что у пользователя имеются необходимые права. Это означает, что табличное пространство невозможно удалить до тех пор, пока не будут удалены все объекты баз данных, использующих это пространство.</p><p>Для удаления пустого табличного пространства используйте команду <a class="xref" href="sql-droptablespace.html" title="DROP TABLESPACE"><span class="refentrytitle">DROP TABLESPACE</span></a>.</p><p>Чтобы получить список табличных пространств можно сделать запрос к системному каталогу <a class="link" href="catalog-pg-tablespace.html" title="53.56. pg_tablespace"><code class="structname">pg_tablespace</code></a>, например, </p><pre class="synopsis">
SELECT spcname FROM pg_tablespace;
</pre><p> Метакоманда <code class="literal">\db</code> утилиты <a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a> также позволяет отобразить список существующих табличных пространств.</p><p>Каталог <code class="filename">$PGDATA/pg_tblspc</code> содержит символические ссылки, которые указывают на внешние табличные пространства кластера. Хоть и не рекомендуется, но возможно регулировать табличные пространства вручную, переопределяя эти ссылки. Ни при каких обстоятельствах эти операции нельзя проводить, пока запущен сервер баз данных. Обратите внимание, что в версии PostgreSQL 9.1 и более ранних также необходимо обновить информацию в <code class="structname">pg_tablespace</code> о новых расположениях. (Если это не сделать, то <code class="literal">pg_dump</code> будет продолжать выводить старые расположения табличных пространств.)</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="manage-ag-dropdb.html" title="23.5. Удаление базы данных">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="managing-databases.html" title="Глава 23. Управление базами данных">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="charset.html" title="Глава 24. Локализация">След.</a></td></tr><tr><td width="40%" align="left" valign="top">23.5. Удаление базы данных </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> Глава 24. Локализация</td></tr></table></div></body></html>