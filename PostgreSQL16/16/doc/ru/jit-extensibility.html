<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>32.4. Расширяемость</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="jit-configuration.html" title="32.3. Конфигурация" /><link rel="next" href="regress.html" title="Глава 33. Регрессионные тесты" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">32.4. Расширяемость</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="jit-configuration.html" title="32.3. Конфигурация">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="jit.html" title="Глава 32. JIT-компиляция">Наверх</a></td><th width="60%" align="center">Глава 32. <acronym class="acronym">JIT</acronym>-компиляция</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="regress.html" title="Глава 33. Регрессионные тесты">След.</a></td></tr></table><hr /></div><div class="sect1" id="JIT-EXTENSIBILITY"><div class="titlepage"><div><div><h2 class="title" style="clear: both">32.4. Расширяемость <a href="#JIT-EXTENSIBILITY" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="jit-extensibility.html#JIT-EXTENSIBILITY-BITCODE">32.4.1. Поддержка встраивания кода для расширений</a></span></dt><dt><span class="sect2"><a href="jit-extensibility.html#JIT-PLUGGABLE">32.4.2. Подключаемые провайдеры <acronym class="acronym">JIT</acronym></a></span></dt></dl></div><div class="sect2" id="JIT-EXTENSIBILITY-BITCODE"><div class="titlepage"><div><div><h3 class="title">32.4.1. Поддержка встраивания кода для расширений <a href="#JIT-EXTENSIBILITY-BITCODE" class="id_link">#</a></h3></div></div></div><p>Механизм <acronym class="acronym">JIT</acronym> в <span class="productname">PostgreSQL</span> может встраивать в код реализации функций (типа <code class="literal">C</code> и <code class="literal">internal</code>), а также операторов, использующих эти функции. Чтобы это встраивание выполнялось для функций в расширениях, должно быть доступно определение этих функций. При сборке с использованием <a class="link" href="extend-pgxs.html" title="38.18. Инфраструктура сборки расширений">PGXS</a> расширения для сервера, скомпилированного с JIT-поддержкой LLVM, соответствующие файлы будут собираться и устанавливаться автоматически.</p><p>Соответствующие файлы должны устанавливаться в <code class="filename">$pkglibdir/bitcode/$extension/</code>, а информация о них должна вноситься в <code class="filename">$pkglibdir/bitcode/$extension.index.bc</code>, где <code class="literal">$pkglibdir</code> — каталог, который выдаёт команда <code class="literal">pg_config --pkglibdir</code>, а <code class="literal">$extension</code> — базовое имя разделяемой библиотеки данного расширения. </p><div class="note"><h3 class="title">Примечание</h3><p>Для функций, встроенных в <span class="productname">PostgreSQL</span>, двоичный код устанавливается в <code class="literal">$pkglibdir/bitcode/postgres</code>.</p></div></div><div class="sect2" id="JIT-PLUGGABLE"><div class="titlepage"><div><div><h3 class="title">32.4.2. Подключаемые провайдеры <acronym class="acronym">JIT</acronym> <a href="#JIT-PLUGGABLE" class="id_link">#</a></h3></div></div></div><p><span class="productname">PostgreSQL</span> предоставляет реализацию <acronym class="acronym">JIT</acronym> на базе <span class="productname">LLVM</span>. Интерфейс <acronym class="acronym">JIT</acronym> предусматривает динамическое подключение провайдера и позволяет менять провайдер без перекомпиляции (хотя в настоящее время при сборке предоставляется поддержка встраивания только для <span class="productname">LLVM</span>). Провайдер выбирается параметром <a class="xref" href="runtime-config-client.html#GUC-JIT-PROVIDER">jit_provider</a>.</p><div class="sect3" id="JIT-PLUGGABLE-PROVIDER-INTERFACE"><div class="titlepage"><div><div><h4 class="title">32.4.2.1. Интерфейс провайдера <acronym class="acronym">JIT</acronym> <a href="#JIT-PLUGGABLE-PROVIDER-INTERFACE" class="id_link">#</a></h4></div></div></div><p>Провайдер <acronym class="acronym">JIT</acronym> загружается путём динамической загрузки заданной разделяемой библиотеки. Для поиска её используется обычный путь поиска библиотек. Чтобы предоставить требуемые функции-обработчики провайдера <acronym class="acronym">JIT</acronym> и показать, что библиотека является реализацией провайдера <acronym class="acronym">JIT</acronym>, она должна содержать функцию, имеющую в C имя <code class="function">_PG_jit_provider_init</code>. Этой функции передаётся структура, которую нужно заполнить указателями на функции-обработчики определённых действий. </p><pre class="programlisting">struct JitProviderCallbacks
{
    JitProviderResetAfterErrorCB reset_after_error;
    JitProviderReleaseContextCB release_context;
    JitProviderCompileExprCB compile_expr;
};

extern void _PG_jit_provider_init(JitProviderCallbacks *cb);</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jit-configuration.html" title="32.3. Конфигурация">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="jit.html" title="Глава 32. JIT-компиляция">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="regress.html" title="Глава 33. Регрессионные тесты">След.</a></td></tr><tr><td width="40%" align="left" valign="top">32.3. Конфигурация </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> Глава 33. Регрессионные тесты</td></tr></table></div></body></html>