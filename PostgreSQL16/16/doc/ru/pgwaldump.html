<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>pg_waldump</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="pgupgrade.html" title="pg_upgrade" /><link rel="next" href="app-postgres.html" title="postgres" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center"><span class="application">pg_waldump</span></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="pgupgrade.html" title="pg_upgrade">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="reference-server.html" title="Серверные приложения PostgreSQL">Наверх</a></td><th width="60%" align="center">Серверные приложения PostgreSQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="app-postgres.html" title="postgres">След.</a></td></tr></table><hr /></div><div class="refentry" id="PGWALDUMP"><div class="titlepage"></div><a id="id-1.9.5.13.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle"><span class="application">pg_waldump</span></span></h2><p>pg_waldump — вывести журнал предзаписи кластера БД <span class="productname">PostgreSQL</span> в понятном человеку виде</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><div class="cmdsynopsis"><p id="id-1.9.5.13.4.1"><code class="command">pg_waldump</code> [<code class="option">параметр</code>...] [<code class="option">начальный_сегмент</code> [<code class="option">конечный_сегмент</code>]]</p></div></div><div class="refsect1" id="R1-APP-PGWALDUMP-1"><h2>Описание</h2><p>Программа <code class="command">pg_waldump</code> показывает содержимое журнала предзаписи (WAL) и прежде всего полезна для целей отладки и обучения.</p><p>Эту утилиту может запускать только пользователь, установивший сервер, так как ей требуется доступ на чтение к каталогу данных.</p></div><div class="refsect1" id="id-1.9.5.13.6"><h2>Параметры</h2><p>Следующие аргументы командной строки задают расположение данных и формат вывода: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>начальный_сегмент</code></em></span></dt><dd><p>Начать чтение с указанного файла сегмента WAL. Это неявно определяет каталог, в котором будут находиться файлы, и целевую линию времени.</p></dd><dt><span class="term"><em class="replaceable"><code>конечный_сегмент</code></em></span></dt><dd><p>Остановиться после чтения указанного файла сегмента WAL.</p></dd><dt><span class="term"><code class="option">-b</code><br /></span><span class="term"><code class="option">--bkp-details</code></span></dt><dd><p>Выводить подробные сведения о блоках-копиях страниц.</p></dd><dt><span class="term"><code class="option">-B <em class="replaceable"><code>блок</code></em></code><br /></span><span class="term"><code class="option">--block=<em class="replaceable"><code>блок</code></em></code></span></dt><dd><p>Выводить только записи, изменяющие указанный блок. При этом также необходимо указать отношение в аргументе <code class="option">--relation</code> или <code class="option">-R</code>.</p></dd><dt><span class="term"><code class="option">-e <em class="replaceable"><code>конец</code></em></code><br /></span><span class="term"><code class="option">--end=<em class="replaceable"><code>конец</code></em></code></span></dt><dd><p>Прекратить чтение в заданной позиции в WAL, а не читать поток до конца.</p></dd><dt><span class="term"><code class="option">-f</code><br /></span><span class="term"><code class="option">--follow</code></span></dt><dd><p>Достигнув конца корректного WAL, проверять раз в секунду поступление новых записей WAL.</p></dd><dt><span class="term"><code class="option">-F <em class="replaceable"><code>слой</code></em></code><br /></span><span class="term"><code class="option">--fork=<em class="replaceable"><code>слой</code></em></code></span></dt><dd><p>Выводить только записи, изменяющие блоки в указанном слое. Допустимые значения: <code class="literal">main</code> (основной слой), <code class="literal">fsm</code> (карта свободного пространства), <code class="literal">vm</code> (карта видимости) и <code class="literal">init</code> (слой инициализации).</p></dd><dt><span class="term"><code class="option">-n <em class="replaceable"><code>предел</code></em></code><br /></span><span class="term"><code class="option">--limit=<em class="replaceable"><code>предел</code></em></code></span></dt><dd><p>Вывести заданное число записей и остановиться.</p></dd><dt><span class="term"><code class="option">-p <em class="replaceable"><code>путь</code></em></code><br /></span><span class="term"><code class="option">--path=<em class="replaceable"><code>путь</code></em></code></span></dt><dd><p>Задаёт каталог, содержащий файлы сегментов WAL, либо каталог с подкаталогом <code class="literal">pg_wal</code>, содержащим такие файлы. По умолчанию в поисках этих файлов просматривается текущий каталог, подкаталог <code class="literal">pg_wal</code> текущего каталога и подкаталог <code class="literal">pg_wal</code> каталога <code class="envar">PGDATA</code>.</p></dd><dt><span class="term"><code class="option">-q</code><br /></span><span class="term"><code class="option">--quiet</code></span></dt><dd><p>Не выводить ничего кроме ошибок. Этот ключ может быть полезен, когда вы хотите узнать, можно ли полностью разобрать диапазон записей WAL, но собственно содержимое записей вас не интересует.</p></dd><dt><span class="term"><code class="option">-r <em class="replaceable"><code>менеджер_ресурсов</code></em></code><br /></span><span class="term"><code class="option">--rmgr=<em class="replaceable"><code>менеджер_ресурсов</code></em></code></span></dt><dd><p>Выводить только записи, созданные указанным менеджером ресурсов. Вы можете указать параметр несколько раз, чтобы выбрать несколько менеджеров ресурсов. Когда в качестве имени менеджера передаётся <code class="literal">list</code>, программа выводит только список возможных имён менеджеров ресурсов и завершается.</p><p>Расширения могут определять пользовательские менеджеры ресурсов, но <span class="application">pg_waldump</span> не загружает модули расширений и поэтому не может распознать пользовательские менеджеры ресурсов по имени. Вместо этого можно обозначить пользовательского менеджера ресурсов в форме <code class="literal">custom###</code>, где <span class="quote">«<span class="quote"><code class="literal">###</code></span>»</span> — трёхзначный идентификатор менеджера ресурсов. Обозначения в этой форме всегда будут считаться действительными.</p></dd><dt><span class="term"><code class="option">-R <em class="replaceable"><code>табл_пространство</code></em>/<em class="replaceable"><code>бд</code></em>/<em class="replaceable"><code>отношение</code></em></code><br /></span><span class="term"><code class="option">--relation=<em class="replaceable"><code>табл_пространство</code></em>/<em class="replaceable"><code>бд</code></em>/<em class="replaceable"><code>отношение</code></em></code></span></dt><dd><p>Выводить только записи, изменяющие блоки в указанном отношении. Отношение указывается с OID табличного пространства, OID базы данных и номером файла, разделёнными косой чертой, например <code class="literal">1234/12345/12345</code>. В этом же формате отношения обозначаются в выводе программы.</p></dd><dt><span class="term"><code class="option">-s <em class="replaceable"><code>начало</code></em></code><br /></span><span class="term"><code class="option">--start=<em class="replaceable"><code>начало</code></em></code></span></dt><dd><p>Позиция в WAL, с которой нужно начать чтение. По умолчанию чтение начинается с первой корректной записи WAL в самом первом из найденных файлов.</p></dd><dt><span class="term"><code class="option">-t <em class="replaceable"><code>линия_времени</code></em></code><br /></span><span class="term"><code class="option">--timeline=<em class="replaceable"><code>линия_времени</code></em></code></span></dt><dd><p>Линия времени, из которой будут читаться записи WAL. По умолчанию используется значение, заданное параметром <em class="replaceable"><code>начальный_сегмент</code></em>, если он присутствует, а иначе — 1. Значение можно задавать в десятичном или шестнадцатеричном представлении, например <code class="literal">17</code> или <code class="literal">0x11</code>.</p></dd><dt><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span></dt><dd><p>Вывести версию <span class="application">pg_waldump</span> и завершиться.</p></dd><dt><span class="term"><code class="option">-w</code><br /></span><span class="term"><code class="option">--fullpage</code></span></dt><dd><p>Выводить только записи, содержащие образы полных страниц.</p></dd><dt><span class="term"><code class="option">-x <em class="replaceable"><code>ид_транзакции</code></em></code><br /></span><span class="term"><code class="option">--xid=<em class="replaceable"><code>ид_транзакции</code></em></code></span></dt><dd><p>Вывести только записи, относящиеся к указанной транзакции.</p></dd><dt><span class="term"><code class="option">-z</code><br /></span><span class="term"><code class="option">--stats[=record]</code></span></dt><dd><p>Вывести общую статистику (число и размер записей и образов полных страниц) вместо отдельных записей. Возможен вариант получения статистики по записям, а не по менеджерам ресурсов.</p><p>Если программа <span class="application">pg_waldump</span> прерывается сигналом <span class="systemitem">SIGINT</span> (<span class="keycap"><strong>Control</strong></span>+<span class="keycap"><strong>C</strong></span>), она выдаёт сводку по данным, которые были обработаны к моменту прерывания. Эта операция не поддерживается в <span class="productname">Windows</span>.</p></dd><dt><span class="term"><code class="option">--save-fullpage=<em class="replaceable"><code>путь_хранения</code></em></code></span></dt><dd><p>Сохранять образы полных страниц, записываемые в WAL, в каталог, указанный в <em class="replaceable"><code>пути_хранения</code></em>. Фильтровать сохраняемые образы и ограничивать их вывод можно так же, как и для записей.</p><p>Образы полных страниц сохраняются с именами в таком формате: <code class="literal"><em class="replaceable"><code>TIMELINE</code></em>-<em class="replaceable"><code>LSN</code></em>.<em class="replaceable"><code>RELTABLESPACE</code></em>.<em class="replaceable"><code>DATOID</code></em>.<em class="replaceable"><code>RELNODE</code></em>.<em class="replaceable"><code>BLKNO</code></em><em class="replaceable"><code>FORK</code></em></code>. Имена файлов состоят из следующих компонентов: </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>Компонент</th><th>Описание</th></tr></thead><tbody><tr><td>TIMELINE</td><td>линия времени файла-сегмента WAL, в котором хранится запись, состоит из одного шестнадцатеричного числа шириной 8 символов <code class="literal">%08X</code></td></tr><tr><td>LSN</td><td><acronym class="acronym">LSN</acronym> записи с этим образом, состоит из двух шестнадцатеричных чисел шириной 8 символов <code class="literal">%08X-%08X</code></td></tr><tr><td>RELTABLESPACE</td><td>OID табличного пространства, содержащего блок</td></tr><tr><td>DATOID</td><td>OID базы данных, содержащей блок</td></tr><tr><td>RELNODE</td><td>номер файлового узла для блока</td></tr><tr><td>BLKNO</td><td>номер блока</td></tr><tr><td>FORK</td><td>имя слоя, в котором был создан образ полной страницы: <code class="literal">_main</code>, <code class="literal">_fsm</code>, <code class="literal">_vm</code> или <code class="literal">_init</code></td></tr></tbody></table></div></dd><dt><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help</code></span></dt><dd><p>Вывести справку об аргументах командной строки <span class="application">pg_waldump</span> и завершиться.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.5.13.7"><h2>Переменные окружения</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="envar">PGDATA</code></span></dt><dd><p>Каталог данных; также см. параметр <code class="option">-p</code>.</p></dd><dt><span class="term"><code class="envar">PG_COLOR</code></span></dt><dd><p>Выбирает вариант использования цвета в диагностических сообщениях. Возможные значения: <code class="literal">always</code> (всегда), <code class="literal">auto</code> (автоматически) и <code class="literal">never</code> (никогда).</p></dd></dl></div></div><div class="refsect1" id="id-1.9.5.13.8"><h2>Замечания</h2><p>Когда сервер работает, результаты могут быть некорректными.</p><p>Выводятся записи только указанной линии времени (или линии времени по умолчанию, если она не задана явно). Записи в других линиях времени игнорируются.</p><p><span class="application">pg_waldump</span> не будет читать файлы WAL с расширением <code class="literal">.partial</code>. Если требуется прочитать такие файлы, расширение <code class="literal">.partial</code> нужно убрать из их имён.</p></div><div class="refsect1" id="id-1.9.5.13.9"><h2>См. также</h2><span class="simplelist"><a class="xref" href="wal-internals.html" title="30.6. Внутреннее устройство WAL">Раздел 30.6</a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pgupgrade.html" title="pg_upgrade">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="reference-server.html" title="Серверные приложения PostgreSQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="app-postgres.html" title="postgres">След.</a></td></tr><tr><td width="40%" align="left" valign="top"><span class="application">pg_upgrade</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> <span class="application">postgres</span></td></tr></table></div></body></html>