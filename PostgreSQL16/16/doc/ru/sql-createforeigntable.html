<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE FOREIGN TABLE</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-createforeigndatawrapper.html" title="CREATE FOREIGN DATA WRAPPER" /><link rel="next" href="sql-createfunction.html" title="CREATE FUNCTION" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">CREATE FOREIGN TABLE</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-createforeigndatawrapper.html" title="CREATE FOREIGN DATA WRAPPER">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><th width="60%" align="center">Команды SQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-createfunction.html" title="CREATE FUNCTION">След.</a></td></tr></table><hr /></div><div class="refentry" id="SQL-CREATEFOREIGNTABLE"><div class="titlepage"></div><a id="id-1.9.3.66.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">CREATE FOREIGN TABLE</span></h2><p>CREATE FOREIGN TABLE — создать стороннюю таблицу</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">CREATE FOREIGN TABLE [ IF NOT EXISTS ] <em class="replaceable"><code>имя_таблицы</code></em> ( [
  { <em class="replaceable"><code>имя_столбца</code></em> <em class="replaceable"><code>тип_данных</code></em> [ OPTIONS ( <em class="replaceable"><code>параметр</code></em> '<em class="replaceable"><code>значение</code></em>' [, ... ] ) ] [ COLLATE <em class="replaceable"><code>правило_сортировки</code></em> ] [ <em class="replaceable"><code>ограничение_столбца</code></em> [ ... ] ]
    | <em class="replaceable"><code>ограничение_таблицы</code></em> }
    [, ... ]
] )
[ INHERITS ( <em class="replaceable"><code>таблица_родитель</code></em> [, ... ] ) ]
  SERVER <em class="replaceable"><code>имя_сервера</code></em>
[ OPTIONS ( <em class="replaceable"><code>параметр</code></em> '<em class="replaceable"><code>значение</code></em>' [, ... ] ) ]

CREATE FOREIGN TABLE [ IF NOT EXISTS ] <em class="replaceable"><code>имя_таблицы</code></em>
  PARTITION OF <em class="replaceable"><code>таблица_родитель</code></em> [ (
  { <em class="replaceable"><code>имя_столбца</code></em> [ WITH OPTIONS ] [ <em class="replaceable"><code>ограничение_столбца</code></em> [ ... ] ]
    | <em class="replaceable"><code>ограничение_таблицы</code></em> }
    [, ... ]
) ]
{ FOR VALUES <em class="replaceable"><code>указание_границ_секции</code></em> | DEFAULT }
  SERVER <em class="replaceable"><code>имя_сервера</code></em>
[ OPTIONS ( <em class="replaceable"><code>параметр</code></em> '<em class="replaceable"><code>значение</code></em>' [, ... ] ) ]

<span class="phrase">Здесь <em class="replaceable"><code>ограничение_столбца</code></em>:</span>

[ CONSTRAINT <em class="replaceable"><code>имя_ограничения</code></em> ]
{ NOT NULL |
  NULL |
  CHECK ( <em class="replaceable"><code>выражение</code></em> ) [ NO INHERIT ] |
  DEFAULT <em class="replaceable"><code>выражение_по_умолчанию</code></em> |
  GENERATED ALWAYS AS ( <em class="replaceable"><code>генерирующее_выражение</code></em> ) STORED }

<span class="phrase">и <em class="replaceable"><code>ограничение_таблицы</code></em>:</span>

[ CONSTRAINT <em class="replaceable"><code>имя_ограничения</code></em> ]
CHECK ( <em class="replaceable"><code>выражение</code></em> ) [ NO INHERIT ]

<span class="phrase">и <em class="replaceable"><code>указание_границ_секции</code></em>:</span>

IN ( <em class="replaceable"><code>выражение_границ_секции</code></em> [, ...] ) |
FROM ( { <em class="replaceable"><code>выражение_границ_секции</code></em> | MINVALUE | MAXVALUE } [, ...] )
  TO ( { <em class="replaceable"><code>выражение_границ_секции</code></em> | MINVALUE | MAXVALUE } [, ...] ) |
WITH ( MODULUS <em class="replaceable"><code>числовая_константа</code></em>, REMAINDER <em class="replaceable"><code>числовая_константа</code></em> )</pre></div><div class="refsect1" id="SQL-CREATEFOREIGNTABLE-DESCRIPTION"><h2>Описание</h2><p><code class="command">CREATE FOREIGN TABLE</code> создаёт новую стороннюю таблицу в текущей базе данных. Владельцем таблицы будет пользователь, выполнивший эту команду.</p><p>Если указано имя схемы (например, <code class="literal">CREATE FOREIGN TABLE myschema.mytable ...</code>), таблица будет создана в этой схеме. В противном случае она создаётся в текущей схеме. Имя сторонней таблицы должно отличаться от имён других отношений (таблиц, последовательностей, индексов, представлений, материализованных представлений или сторонних таблиц), существующих в этой схеме.</p><p><code class="command">CREATE FOREIGN TABLE</code> также автоматически создаёт составной тип данных, соответствующий одной строке сторонней таблицы. Таким образом, имя сторонней таблицы не может совпадать с именем существующего типа в этой же схеме.</p><p>Если указано предложение <code class="literal">PARTITION OF</code>, таблица создаётся в виде секции <code class="literal">parent_table</code> с указанными границами.</p><p>Чтобы создать стороннюю таблицу, необходимо иметь право <code class="literal">USAGE</code> для стороннего сервера, а также право <code class="literal">USAGE</code> для всех типов столбцов, содержащихся в таблице.</p></div><div class="refsect1" id="id-1.9.3.66.6"><h2>Параметры</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">IF NOT EXISTS</code></span></dt><dd><p>Не считать ошибкой, если отношение с таким именем уже существует. В этом случае будет выдано замечание. Заметьте, что нет никакой гарантии, что существующее отношение как-то соотносится с тем, которое могло бы быть создано.</p></dd><dt><span class="term"><em class="replaceable"><code>имя_таблицы</code></em></span></dt><dd><p>Имя создаваемой таблицы (возможно, дополненное схемой).</p></dd><dt><span class="term"><em class="replaceable"><code>имя_столбца</code></em></span></dt><dd><p>Имя столбца, создаваемого в новой таблице.</p></dd><dt><span class="term"><em class="replaceable"><code>тип_данных</code></em></span></dt><dd><p>Тип данных столбца (может включать определение массива с этим типом). За дополнительными сведениями о типах данных, которые поддерживает <span class="productname">PostgreSQL</span>, обратитесь к <a class="xref" href="datatype.html" title="Глава 8. Типы данных">Главе 8</a>.</p></dd><dt><span class="term"><code class="literal">COLLATE <em class="replaceable"><code>правило_сортировки</code></em></code></span></dt><dd><p>Предложение <code class="literal">COLLATE</code> назначает правило сортировки для столбца (который должен иметь тип, поддерживающий сортировку). Если оно отсутствует, используется правило сортировки по умолчанию, установленное для типа данных столбца.</p></dd><dt><span class="term"><code class="literal">INHERITS ( <em class="replaceable"><code>таблица_родитель</code></em> [, ... ] )</code></span></dt><dd><p>Необязательное предложение <code class="literal">INHERITS</code> определяет список таблиц, от которых новая сторонняя таблица будет автоматически наследовать все столбцы. Родительскими таблицами могут быть обычные или сторонние таблицы. За подробностями обратитесь к описанию подобной формы <a class="link" href="sql-createtable.html" title="CREATE TABLE"><code class="command">CREATE TABLE</code></a>.</p></dd><dt><span class="term"><code class="literal">PARTITION OF <em class="replaceable"><code>таблица_родитель</code></em> { FOR VALUES <em class="replaceable"><code>указание_границ_секции</code></em> | DEFAULT }</code></span></dt><dd><p>Эта форма может использоваться для создания сторонней таблицы в виде секции указанной родительской таблицы с заданными граничными значениями. За подробностями обратитесь к описанию подобной формы команды <a class="link" href="sql-createtable.html" title="CREATE TABLE"><code class="command">CREATE TABLE</code></a>. Заметьте, что в настоящее время не допускается создание сторонней таблицы в виде секции родительской таблицы, если в этой таблице есть уникальные индексы (<code class="literal">UNIQUE</code>). (См. также описание <a class="link" href="sql-altertable.html" title="ALTER TABLE"><code class="command">ALTER TABLE ATTACH PARTITION</code></a>.)</p></dd><dt><span class="term"><code class="literal">CONSTRAINT <em class="replaceable"><code>имя_ограничения</code></em></code></span></dt><dd><p>Необязательное имя столбца или ограничения таблицы. При нарушении ограничения его имя будет выводиться в сообщении об ошибках, так что имена ограничений вида <code class="literal">столбец должен быть положительным</code> могут сообщить полезную информацию об ограничении клиентскому приложению. (Имена ограничений, включающие пробелы, необходимо заключать в двойные кавычки.) Если имя ограничения не указано, система генерирует имя автоматически.</p></dd><dt><span class="term"><code class="literal">NOT NULL</code></span></dt><dd><p>Данный столбец не принимает значения NULL.</p></dd><dt><span class="term"><code class="literal">NULL</code></span></dt><dd><p>Данный столбец может содержать значения NULL (по умолчанию).</p><p>Это предложение предназначено только для совместимости с нестандартными базами данных SQL. Использовать его в новых приложениях не рекомендуется.</p></dd><dt><span class="term"><code class="literal">CHECK ( <em class="replaceable"><code>выражение</code></em> ) [ NO INHERIT ]</code></span></dt><dd><p>В ограничении <code class="literal">CHECK</code> задаётся выражение, возвращающее логический результат, которому должны удовлетворять все строки в сторонней таблице; то есть это выражение должно выдавать TRUE или UNKNOWN, но никогда FALSE, для всех строк в сторонней таблице. Ограничение-проверка, заданное как ограничение столбца, должно ссылаться только на значение самого столбца, тогда как ограничение на уровне таблицы может ссылаться и на несколько столбцов.</p><p>В настоящее время выражения <code class="literal">CHECK</code> не могут содержать подзапросы или ссылаться на переменные, кроме как на столбцы текущей строки. Также допустима ссылка на системный столбец <code class="literal">tableoid</code>, но не на другие системные столбцы.</p><p>Ограничение с пометкой <code class="literal">NO INHERIT</code> не будет наследоваться дочерними таблицами.</p></dd><dt><span class="term"><code class="literal">DEFAULT <em class="replaceable"><code>выражение_по_умолчанию</code></em></code></span></dt><dd><p>Предложение <code class="literal">DEFAULT</code> задаёт значение по умолчанию для столбца, в определении которого оно присутствует. Значение задаётся выражением без переменных (подзапросы и перекрёстные ссылки на другие столбцы текущей таблицы в нём не допускаются). Тип данных выражения, задающего значение по умолчанию, должен соответствовать типу данных столбца.</p><p>Это выражение будет использоваться во всех операциях добавления данных, в которых не задаётся значение данного столбца. Если значение по умолчанию не определено, таким значением будет NULL.</p></dd><dt><span class="term"><code class="literal">GENERATED ALWAYS AS ( <em class="replaceable"><code>генерирующее_выражение</code></em> ) STORED</code><a id="id-1.9.3.66.6.2.13.1.2" class="indexterm"></a></span></dt><dd><p>Это предложение создаёт столбец как <em class="firstterm">генерируемый</em>. В такой столбец нельзя записать данные, а при чтении его возвращается результат указанного выражения.</p><p>Ключевое слово <code class="literal">STORED</code> отмечает, что этот столбец будет вычисляться при записи. (Вычисленное значение будет передаваться обёртке сторонних данных, которая должна сохранить его и затем выдавать при чтении.)</p><p>Генерирующее выражение может обращаться к другим столбцам таблицы, но не к другим генерируемым столбцам. Все функции и операторы в нём должны быть постоянными. Обращаться к другим таблицам в таких выражениях нельзя.</p></dd><dt><span class="term"><em class="replaceable"><code>имя_сервера</code></em></span></dt><dd><p>Имя существующего стороннего сервера, предоставляющего данную стороннюю таблицу. О создании сервера можно узнать в <a class="xref" href="sql-createserver.html" title="CREATE SERVER"><span class="refentrytitle">CREATE SERVER</span></a>.</p></dd><dt><span class="term"><code class="literal">OPTIONS ( <em class="replaceable"><code>параметр</code></em> '<em class="replaceable"><code>значение</code></em>' [, ...] )</code></span></dt><dd><p>Параметры, связываемые с новой сторонней таблицей или одним из её столбцов. Допустимые имена и значения параметров у каждой обёртки сторонних данных свои; они контролируются функцией проверки, связанной с этой обёрткой. Имена параметров не должны повторяться (хотя параметр таблицы и параметр столбца вполне могут иметь одно имя).</p></dd></dl></div></div><div class="refsect1" id="id-1.9.3.66.7"><h2>Замечания</h2><p>Ограничения сторонних таблиц (например, <code class="literal">CHECK</code> и <code class="literal">NOT NULL</code>) не контролируются ядром системы <span class="productname">PostgreSQL</span>, как не пытаются их контролировать и большинство обёрток сторонних данных; то есть, система просто предполагает, что ограничение выполняется. Контролировать такое ограничение не имело бы большого смысла, так как оно применялось бы только к строкам, добавляемым или изменяемым через стороннюю таблицу, но не к строкам, модифицируемым другим путём, например, непосредственно на удалённом сервере. Вместо этого, ограничение, связанное со сторонней таблицей, должно представлять ограничение, выполнение которого обеспечивает удалённый сервер.</p><p>Некоторые специализированные обёртки сторонних данных могут быть единственным вариантом обращения к доступным через них данным, и в этом случае может быть уместно реализовать контроль ограничений в самой такой обёртке. Но не следует полагать, что какая-либо обёртка ведёт себя так, если об этом не сказано явно в её документации.</p><p>Хотя <span class="productname">PostgreSQL</span> не пытается контролировать ограничения для сторонних таблиц, он полагает, что они выполняются для целей оптимизации запросов. Если в сторонней таблице будут видны строки, не удовлетворяющие объявленному ограничению, запросы к этой таблице могут выдавать ошибки или некорректные результаты. Ответственность за фактическое выполнение условия ограничения лежит на пользователе.</p><div class="caution"><h3 class="title">Внимание</h3><p>Когда сторонняя таблица используется в качестве секции секционированной таблицы, существует неявное ограничение, согласно которому её содержимое должно отвечать правилу секционирования. Обеспечивать соблюдение этого правила должен пользователь; для этого лучше всего установить соответствующее ограничение на удалённом сервере.</p></div><p>В секционированной таблице, содержащей секции сторонних таблиц, команда <code class="command">UPDATE</code>, изменяющая ключ разбиения, может привести к перемещению строки из локальной секции в секцию в сторонней таблице при условии, что обёртка сторонних данных поддерживает перенаправление кортежей. Однако перемещение строки из секции в сторонней таблице в другую секцию в настоящее время невозможно. Команда <code class="command">UPDATE</code>, вызывающая такое перемещение, прервётся ошибкой из-за ограничения секции, если на удалённом сервере установлено нужное ограничение.</p><p>Подобные соображения распространяются и на генерируемые столбцы. Сохранённые генерируемые столбцы вычисляются при добавлении или изменении данных на локальном сервере <span class="productname">PostgreSQL</span> и передаются обёртке сторонних данных, которая должна записать их в стороннее хранилище данных. При этом сервер не требует, чтобы возвращаемые при обращении к сторонней таблице значения генерируемых столбцов согласовывались с генерирующим выражением. Таким образом, в случае несоответствия этих значений результаты запроса могут оказаться некорректными.</p></div><div class="refsect1" id="SQL-CREATEFOREIGNTABLE-EXAMPLES"><h2>Примеры</h2><p>Создание сторонней таблицы <code class="structname">films</code>, которая будет доступна через сервер <code class="structname">film_server</code>: </p><pre class="programlisting">CREATE FOREIGN TABLE films (
    code        char(5) NOT NULL,
    title       varchar(40) NOT NULL,
    did         integer NOT NULL,
    date_prod   date,
    kind        varchar(10),
    len         interval hour to minute
)
SERVER film_server;</pre><p>Создание сторонней таблицы <code class="structname">measurement_y2016m07</code>, которая будет доступна через сервер <code class="structname">server_07</code>, в виде секции таблицы <code class="structname">measurement</code>, секционированной по диапазонам: </p><pre class="programlisting">CREATE FOREIGN TABLE measurement_y2016m07
    PARTITION OF measurement FOR VALUES FROM ('2016-07-01') TO ('2016-08-01')
    SERVER server_07;</pre></div><div class="refsect1" id="SQL-CREATEFOREIGNTABLE-COMPATIBILITY"><h2>Совместимость</h2><p>Команда <code class="command">CREATE FOREIGN TABLE</code> в основном соответствует стандарту <acronym class="acronym">SQL</acronym>; однако, как и <a class="link" href="sql-createtable.html" title="CREATE TABLE"><code class="command">CREATE TABLE</code></a>, она допускает ограничения <code class="literal">NULL</code> и сторонние таблицы с нулём столбцов. Возможность задавать значения по умолчанию для столбцов также является расширением <span class="productname">PostgreSQL</span>. Наследование таблиц, в форме, определённой в <span class="productname">PostgreSQL</span>, стандарту не соответствует.</p></div><div class="refsect1" id="id-1.9.3.66.10"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-alterforeigntable.html" title="ALTER FOREIGN TABLE"><span class="refentrytitle">ALTER FOREIGN TABLE</span></a>, <a class="xref" href="sql-dropforeigntable.html" title="DROP FOREIGN TABLE"><span class="refentrytitle">DROP FOREIGN TABLE</span></a>, <a class="xref" href="sql-createtable.html" title="CREATE TABLE"><span class="refentrytitle">CREATE TABLE</span></a>, <a class="xref" href="sql-createserver.html" title="CREATE SERVER"><span class="refentrytitle">CREATE SERVER</span></a>, <a class="xref" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA"><span class="refentrytitle">IMPORT FOREIGN SCHEMA</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-createforeigndatawrapper.html" title="CREATE FOREIGN DATA WRAPPER">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-createfunction.html" title="CREATE FUNCTION">След.</a></td></tr><tr><td width="40%" align="left" valign="top">CREATE FOREIGN DATA WRAPPER </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> CREATE FUNCTION</td></tr></table></div></body></html>