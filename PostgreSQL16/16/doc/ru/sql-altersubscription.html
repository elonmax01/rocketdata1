<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>ALTER SUBSCRIPTION</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-alterstatistics.html" title="ALTER STATISTICS" /><link rel="next" href="sql-altersystem.html" title="ALTER SYSTEM" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">ALTER SUBSCRIPTION</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-alterstatistics.html" title="ALTER STATISTICS">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><th width="60%" align="center">Команды SQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-altersystem.html" title="ALTER SYSTEM">След.</a></td></tr></table><hr /></div><div class="refentry" id="SQL-ALTERSUBSCRIPTION"><div class="titlepage"></div><a id="id-1.9.3.33.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">ALTER SUBSCRIPTION</span></h2><p>ALTER SUBSCRIPTION — изменить определение подписки</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">ALTER SUBSCRIPTION <em class="replaceable"><code>имя</code></em> CONNECTION '<em class="replaceable"><code>строка_подключения</code></em>'
ALTER SUBSCRIPTION <em class="replaceable"><code>имя</code></em> SET PUBLICATION <em class="replaceable"><code>имя_публикации</code></em> [, ...] [ WITH ( <em class="replaceable"><code>параметр_публикации</code></em> [= <em class="replaceable"><code>значение</code></em>] [, ... ] ) ]
ALTER SUBSCRIPTION <em class="replaceable"><code>имя</code></em> ADD PUBLICATION <em class="replaceable"><code>имя_публикации</code></em> [, ...] [ WITH ( <em class="replaceable"><code>параметр_публикации</code></em> [= <em class="replaceable"><code>значение</code></em>] [, ... ] ) ]
ALTER SUBSCRIPTION <em class="replaceable"><code>имя</code></em> DROP PUBLICATION <em class="replaceable"><code>имя_публикации</code></em> [, ...] [ WITH ( <em class="replaceable"><code>параметр_публикации</code></em> [= <em class="replaceable"><code>значение</code></em>] [, ... ] ) ]
ALTER SUBSCRIPTION <em class="replaceable"><code>имя</code></em> REFRESH PUBLICATION [ WITH ( <em class="replaceable"><code>параметр_обновления</code></em> [= <em class="replaceable"><code>значение</code></em>] [, ... ] ) ]
ALTER SUBSCRIPTION <em class="replaceable"><code>имя</code></em> ENABLE
ALTER SUBSCRIPTION <em class="replaceable"><code>имя</code></em> DISABLE
ALTER SUBSCRIPTION <em class="replaceable"><code>имя</code></em> SET ( <em class="replaceable"><code>параметр_подписки</code></em> [= <em class="replaceable"><code>значение</code></em>] [, ... ] )
ALTER SUBSCRIPTION <em class="replaceable"><code>имя</code></em> SKIP ( <em class="replaceable"><code>параметр_пропуска</code></em> = <em class="replaceable"><code>значение</code></em> )
ALTER SUBSCRIPTION <em class="replaceable"><code>имя</code></em> OWNER TO { <em class="replaceable"><code>новый_владелец</code></em> | CURRENT_ROLE | CURRENT_USER | SESSION_USER }
ALTER SUBSCRIPTION <em class="replaceable"><code>имя</code></em> RENAME TO <em class="replaceable"><code>новое_имя</code></em></pre></div><div class="refsect1" id="id-1.9.3.33.5"><h2>Описание</h2><p><code class="command">ALTER SUBSCRIPTION</code> может менять многие свойства подписки, которые могут задаваться в <a class="xref" href="sql-createsubscription.html" title="CREATE SUBSCRIPTION"><span class="refentrytitle">CREATE SUBSCRIPTION</span></a>.</p><p>Чтобы выполнить <code class="command">ALTER SUBSCRIPTION</code> для подписки, нужно быть её владельцем. Чтобы переименовать подписку или сменить владельца, необходимо иметь право <code class="literal">CREATE</code> в базе данных. Кроме того, чтобы сменить владельца, необходимо иметь право <code class="literal">SET ROLE</code> для новой роли-владельца. Если для подписки задано <code class="literal">password_required=false</code>, изменять её могут только суперпользователи.</p><p>При обновлении подписки производится удаление отношений, которые были из неё исключены, а также удаление слотов синхронизации этих таблиц, если таковые имеются. Эти слоты необходимо удалять, чтобы были освобождены ресурсы, выделенные для данной подписки на удалённом сервере. Если по причине сбоя в сети или какой-то другой ошибки <span class="productname">PostgreSQL</span> не сможет удалить эти слоты, выполнение команды будет прервано ошибкой. Для разрешения такой ситуации можно либо попробовать повторить эту операцию, либо разорвать связь слота с подпиской и удалить подписку, выполнив <a class="xref" href="sql-dropsubscription.html" title="DROP SUBSCRIPTION"><span class="refentrytitle">DROP SUBSCRIPTION</span></a>.</p><p>Команды <code class="command">ALTER SUBSCRIPTION ... REFRESH PUBLICATION</code> и <code class="command">ALTER SUBSCRIPTION ... {SET|ADD|DROP} PUBLICATION ...</code> с параметром <code class="literal">refresh</code>, равным <code class="literal">true</code>, не могут выполняться внутри блока транзакции. Эти команды также не могут выполняться, если для подписки включён режим <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-TWO-PHASE"><code class="literal">two_phase</code></a>, за исключением случая, когда <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-COPY-DATA"><code class="literal">copy_data</code></a> равен <code class="literal">false</code>. Состояние режима двухфазной фиксации показывается в столбце <code class="structfield">subtwophasestate</code> каталога <a class="link" href="catalog-pg-subscription.html" title="53.54. pg_subscription"><code class="structname">pg_subscription</code></a>.</p></div><div class="refsect1" id="id-1.9.3.33.6"><h2>Параметры</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>имя</code></em></span></dt><dd><p>Имя подписки, свойства которой изменяются.</p></dd><dt><span class="term"><code class="literal">CONNECTION '<em class="replaceable"><code>строка_подключения</code></em>'</code></span></dt><dd><p>Это предложение заменяет строку соединения, изначально установленную командой <a class="xref" href="sql-createsubscription.html" title="CREATE SUBSCRIPTION"><span class="refentrytitle">CREATE SUBSCRIPTION</span></a>. За дополнительными сведениями обратитесь к описанию этой команды.</p></dd><dt><span class="term"><code class="literal">SET PUBLICATION <em class="replaceable"><code>имя_публикации</code></em></code><br /></span><span class="term"><code class="literal">ADD PUBLICATION <em class="replaceable"><code>имя_публикации</code></em></code><br /></span><span class="term"><code class="literal">DROP PUBLICATION <em class="replaceable"><code>имя_публикации</code></em></code></span></dt><dd><p>Изменяет список публикаций, на которые оформлена подписка. Предложение <code class="literal">SET</code> полностью заменяет один список публикаций другим, <code class="literal">ADD</code> добавляет публикации к списку публикаций, а <code class="literal">DROP</code> удаляет публикации из этого списка. В формах <code class="literal">ADD</code> и <code class="literal">SET</code> допускается указание несуществующих публикаций в расчёте на то, что они будут добавлены позже. За подробностями обратитесь к описанию <a class="xref" href="sql-createsubscription.html" title="CREATE SUBSCRIPTION"><span class="refentrytitle">CREATE SUBSCRIPTION</span></a>. По умолчанию эта команда также выполняет действие <code class="literal">REFRESH PUBLICATION</code>.</p><p>В указании <em class="replaceable"><code>параметр_публикации</code></em> задаются дополнительные свойства операции. Поддерживаются следующие параметры: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">refresh</code> (<code class="type">boolean</code>)</span></dt><dd><p>Со значением <code class="literal">false</code> данная команда не будет обновлять информацию о таблицах. В этом случае следует выполнить <code class="literal">REFRESH PUBLICATION</code> отдельно. Значение по умолчанию — <code class="literal">true</code>.</p></dd></dl></div><p> Кроме того, здесь могут задаваться параметры, относящиеся к <code class="literal">REFRESH PUBLICATION</code> и управляющие неявной операцией обновления.</p></dd><dt><span class="term"><code class="literal">REFRESH PUBLICATION</code></span></dt><dd><p>Считывает недостающую информацию о таблицах с публикующего сервера. В результате производится репликация таблиц, добавленных в публикации, на которые оформлена подписка, после <code class="command">CREATE SUBSCRIPTION</code> или последнего вызова <code class="command">REFRESH PUBLICATION</code>.</p><p>В указании <em class="replaceable"><code>параметр_обновления</code></em> задаются дополнительные свойства операции обновления. Поддерживаются следующие параметры: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">copy_data</code> (<code class="type">boolean</code>)</span></dt><dd><p>Определяет, должны ли копироваться уже существующие данные в публикациях, на которые оформляется подписка, когда начинается репликация. Значение по умолчанию — <code class="literal">true</code>.</p><p>Таблицы, входившие в подписку ранее, не копируются, даже если предложение <code class="literal">WHERE</code> фильтра строк таблицы изменилось с момента подписки.</p><p>Подробнее взаимодействие <code class="literal">copy_data = true</code> с параметром <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-ORIGIN"><code class="literal">origin</code></a> описано в <a class="xref" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-NOTES" title="Замечания">Замечания</a>.</p><p>Чтобы получить дополнительные сведения о копировании уже существующих данных в двоичном формате, обратитесь к описанию параметра <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-BINARY"><code class="literal">binary</code></a> команды <code class="command">CREATE SUBSCRIPTION</code>.</p></dd></dl></div></dd><dt><span class="term"><code class="literal">ENABLE</code></span></dt><dd><p>Включает ранее отключённую подписку, запуская процесс логической репликации в конце транзакции.</p></dd><dt><span class="term"><code class="literal">DISABLE</code></span></dt><dd><p>Отключает активную подписку, останавливая процесс логической репликации в конце транзакции.</p></dd><dt><span class="term"><code class="literal">SET ( <em class="replaceable"><code>параметр_подписки</code></em> [= <em class="replaceable"><code>значение</code></em>] [, ... ] )</code></span></dt><dd><p>Это предложение изменяет параметры, изначально установленные командой <a class="xref" href="sql-createsubscription.html" title="CREATE SUBSCRIPTION"><span class="refentrytitle">CREATE SUBSCRIPTION</span></a>. За подробностями обратитесь к её описанию. Данное предложение позволяет изменить параметры <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-SLOT-NAME"><code class="literal">slot_name</code></a>, <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-SYNCHRONOUS-COMMIT"><code class="literal">synchronous_commit</code></a>, <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-BINARY"><code class="literal">binary</code></a>, <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-STREAMING"><code class="literal">streaming</code></a>, <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-DISABLE-ON-ERROR"><code class="literal">disable_on_error</code></a>, <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-PASSWORD-REQUIRED"><code class="literal">password_required</code></a>, <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-RUN-AS-OWNER"><code class="literal">run_as_owner</code></a> и <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-ORIGIN"><code class="literal">origin</code></a>. Указать <code class="literal">password_required = false</code> может только суперпользователь.</p></dd><dt><span class="term"><code class="literal">SKIP ( <em class="replaceable"><code>параметр_пропуска</code></em> = <em class="replaceable"><code>значение</code></em> )</code></span></dt><dd><p>Пропускает применение всех изменений удалённой транзакции. Если входящие данные нарушают какие-либо ограничения, логическая репликация будет остановлена, пока конфликты не будут разрешены. Когда выполняется команда <code class="command">ALTER SUBSCRIPTION ... SKIP</code>, рабочий процесс логической репликации пропускает все изменения данных в транзакции. Этот параметр не влияет на транзакции, которые уже подготовлены на стороне подписчика (в результате действия режима <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-TWO-PHASE"><code class="literal">two_phase</code></a>). После того, как рабочий процесс логической репликации успешно пропускает транзакцию или транзакция завершается, номер LSN (хранящийся в <code class="structname">pg_subscription</code>.<code class="structfield">subskiplsn</code>) очищается. Подробнее конфликты логической репликации описаны в <a class="xref" href="logical-replication-conflicts.html" title="31.5. Конфликты">Разделе 31.5</a>.</p><p><em class="replaceable"><code>Параметр_пропуска</code></em> определяет свойства данной операции. Поддерживается следующий параметр: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">lsn</code> (<code class="type">pg_lsn</code>)</span></dt><dd><p>Указывает LSN завершения удалённой транзакции, изменения которой должны быть пропущены процессом логической репликации. LSN завершения — это LSN, с которым транзакция зафиксирована либо подготовлена. Пропуск отдельных подтранзакций не поддерживается. Значение <code class="literal">NONE</code> сбрасывает ранее установленный LSN.</p></dd></dl></div></dd><dt><span class="term"><em class="replaceable"><code>новый_владелец</code></em></span></dt><dd><p>Имя пользователя, назначаемого новым владельцем подписки.</p></dd><dt><span class="term"><em class="replaceable"><code>новое_имя</code></em></span></dt><dd><p>Новое имя подписки.</p></dd></dl></div><p>Если для параметра типа <code class="type">boolean</code> опустить <code class="literal">=</code> <em class="replaceable"><code>значение</code></em>, это равнозначно указанию значения <code class="literal">TRUE</code>.</p></div><div class="refsect1" id="id-1.9.3.33.7"><h2>Примеры</h2><p>Изменение подписки, заключающееся в подписывании на публикацию <code class="literal">insert_only</code>: </p><pre class="programlisting">ALTER SUBSCRIPTION mysub SET PUBLICATION insert_only;</pre><p>Отключение (остановка) подписки: </p><pre class="programlisting">ALTER SUBSCRIPTION mysub DISABLE;</pre></div><div class="refsect1" id="id-1.9.3.33.8"><h2>Совместимость</h2><p><code class="command">ALTER SUBSCRIPTION</code> является расширением <span class="productname">PostgreSQL</span>.</p></div><div class="refsect1" id="id-1.9.3.33.9"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-createsubscription.html" title="CREATE SUBSCRIPTION"><span class="refentrytitle">CREATE SUBSCRIPTION</span></a>, <a class="xref" href="sql-dropsubscription.html" title="DROP SUBSCRIPTION"><span class="refentrytitle">DROP SUBSCRIPTION</span></a>, <a class="xref" href="sql-createpublication.html" title="CREATE PUBLICATION"><span class="refentrytitle">CREATE PUBLICATION</span></a>, <a class="xref" href="sql-alterpublication.html" title="ALTER PUBLICATION"><span class="refentrytitle">ALTER PUBLICATION</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-alterstatistics.html" title="ALTER STATISTICS">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-altersystem.html" title="ALTER SYSTEM">След.</a></td></tr><tr><td width="40%" align="left" valign="top">ALTER STATISTICS </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> ALTER SYSTEM</td></tr></table></div></body></html>