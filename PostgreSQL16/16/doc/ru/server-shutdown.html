<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>19.5. Выключение сервера</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="kernel-resources.html" title="19.4. Управление ресурсами ядра" /><link rel="next" href="upgrading.html" title="19.6. Обновление кластера PostgreSQL" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">19.5. Выключение сервера</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="kernel-resources.html" title="19.4. Управление ресурсами ядра">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime.html" title="Глава 19. Подготовка к работе и сопровождение сервера">Наверх</a></td><th width="60%" align="center">Глава 19. Подготовка к работе и сопровождение сервера</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="upgrading.html" title="19.6. Обновление кластера PostgreSQL">След.</a></td></tr></table><hr /></div><div class="sect1" id="SERVER-SHUTDOWN"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.5. Выключение сервера <a href="#SERVER-SHUTDOWN" class="id_link">#</a></h2></div></div></div><a id="id-1.6.6.8.2" class="indexterm"></a><p>Сервер баз данных можно отключить несколькими способами. На практике они все сводятся к отправке сигнала управляющему процессу <code class="command">postgres</code>.</p><p>Если вы используете <span class="productname">PostgreSQL</span> в виде готового продукта и запускаете сервер, применяя предусмотренные в этом продукте средства, то и останавливать сервер вы должны, применяя те же средства. За подробностями обратитесь к документации используемого вами продукта.</p><p>Непосредственно управляя сервером, вы можете выбрать тот или иной вариант отключения, посылая разные сигналы главному процессу <code class="command">postgres</code>: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="systemitem">SIGTERM</span><a id="id-1.6.6.8.5.2.1.1.2" class="indexterm"></a></span></dt><dd><p>Запускает так называемое <em class="firstterm">умное выключение</em>. Получив <span class="systemitem">SIGTERM</span>, сервер перестаёт принимать новые подключения, но позволяет всем существующим сеансам закончить работу в штатном режиме. Сервер будет отключён только после завершения всех сеансов. Если получая этот сигнал, сервер находится в процессе восстановления, восстановление и потоковая репликация будут прерваны только после завершения всех обычных сеансов.</p></dd><dt><span class="term"><span class="systemitem">SIGINT</span><a id="id-1.6.6.8.5.2.2.1.2" class="indexterm"></a></span></dt><dd><p>Запускает <em class="firstterm">быстрое выключение</em>. Сервер запрещает новые подключения и посылает всем работающим серверным процессам сигнал <span class="systemitem">SIGTERM</span>, в результате чего их транзакции прерываются и сами процессы завершаются. Управляющий процесс ждёт, пока будут завершены все эти процессы, и затем завершается сам.</p></dd><dt><span class="term"><span class="systemitem">SIGQUIT</span><a id="id-1.6.6.8.5.2.3.1.2" class="indexterm"></a></span></dt><dd><p>Запускает <em class="firstterm">немедленное выключение</em>. Сервер отправляет всем дочерним процессам сигнал <span class="systemitem">SIGQUIT</span> и ждёт их завершения. Если какие-либо из них не завершаются в течение 5 секунд, им посылается <span class="systemitem">SIGKILL</span>. Главный процесс сервера завершается, как только будут завершены все дочерние процессы, не выполняя обычную процедуру остановки БД. В результате при последующем запуске будет запущен процесс восстановления (воспроизведения изменений из журнала). Такой вариант выключения рекомендуется только в экстренных ситуациях.</p></dd></dl></div><p>Удобную возможность отправлять эти сигналы, отключающие сервер, предоставляет программа <a class="xref" href="app-pg-ctl.html" title="pg_ctl"><span class="refentrytitle"><span class="application">pg_ctl</span></span></a>. Кроме того, в системах, отличных от Windows, соответствующий сигнал можно отправить с помощью команды <code class="command">kill</code>. <acronym class="acronym">PID</acronym> основного процесса <code class="command">postgres</code> можно узнать, воспользовавшись программой <code class="command">ps</code>, либо прочитав файл <code class="filename">postmaster.pid</code> в каталоге данных. Например, можно выполнить быстрое выключение так: </p><pre class="screen">
$ <strong class="userinput"><code>kill -INT `head -1 /usr/local/pgsql/data/postmaster.pid`</code></strong>
</pre><div class="important"><h3 class="title">Важно</h3><p>Для выключения сервера не следует использовать сигнал <span class="systemitem">SIGKILL</span>. При таком выключении сервер не сможет освободить разделяемую память и семафоры. Кроме того, при уничтожении главного процесса <code class="command">postgres</code> сигналом <span class="systemitem">SIGKILL</span>, он не успеет передать этот сигнал своим дочерним процессам, так что может потребоваться завершать и их вручную.</p></div><p>Чтобы завершить отдельный сеанс, не прерывая работу других сеансов, воспользуйтесь функцией <code class="function">pg_terminate_backend()</code> (см. <a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-SIGNAL-TABLE" title="Таблица 9.90. Функции для передачи сигналов серверу">Таблицу 9.90</a>) или отправьте сигнал <span class="systemitem">SIGTERM</span> дочернему процессу, обслуживающему этот сеанс.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kernel-resources.html" title="19.4. Управление ресурсами ядра">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime.html" title="Глава 19. Подготовка к работе и сопровождение сервера">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="upgrading.html" title="19.6. Обновление кластера PostgreSQL">След.</a></td></tr><tr><td width="40%" align="left" valign="top">19.4. Управление ресурсами ядра </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 19.6. Обновление кластера <span class="productname">PostgreSQL</span></td></tr></table></div></body></html>