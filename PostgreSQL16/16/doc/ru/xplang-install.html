<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>42.1. Установка процедурных языков</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="xplang.html" title="Глава 42. Процедурные языки" /><link rel="next" href="plpgsql.html" title="Глава 43. PL/pgSQL — процедурный язык SQL" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">42.1. Установка процедурных языков</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="xplang.html" title="Глава 42. Процедурные языки">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="xplang.html" title="Глава 42. Процедурные языки">Наверх</a></td><th width="60%" align="center">Глава 42. Процедурные языки</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="plpgsql.html" title="Глава 43. PL/pgSQL — процедурный язык SQL">След.</a></td></tr></table><hr /></div><div class="sect1" id="XPLANG-INSTALL"><div class="titlepage"><div><div><h2 class="title" style="clear: both">42.1. Установка процедурных языков <a href="#XPLANG-INSTALL" class="id_link">#</a></h2></div></div></div><p>Прежде всего, процедурный язык должен быть <span class="quote">«<span class="quote">установлен</span>»</span> в каждую базу данных, где он будет использоваться. Но процедурные языки, устанавливаемые в базу данных <code class="literal">template1</code>, автоматически становятся доступными во всех впоследствии создаваемых базах, так как их определения в <code class="literal">template1</code> будут скопированы командой <code class="command">CREATE DATABASE</code>. Таким образом, администратор баз данных может выбрать, какие языки будут доступны в определённых базах данных, и при желании сделать некоторые языки доступными по умолчанию.</p><p>Для языков, включённых в стандартный дистрибутив, достаточно выполнить команду <code class="command">CREATE EXTENSION</code> <em class="replaceable"><code>имя_языка</code></em>, чтобы установить язык в текущую базу данных. Описанная ниже ручная процедура рекомендуется только для установки языков, не упакованных в виде расширений.</p><div class="procedure" id="id-1.8.7.5.4"><p class="title"><strong>Установка процедурного языка вручную</strong></p><p>Процедурный язык устанавливается в базу данных в пять этапов, и выполнять их должен администратор баз данных. В большинстве случаев необходимые команды SQL следует упаковать в виде установочного скрипта <span class="quote">«<span class="quote">расширения</span>»</span>, чтобы их можно было выполнить, воспользовавшись командой <code class="command">CREATE EXTENSION</code>.</p><ol class="procedure" type="1"><li class="step" id="XPLANG-INSTALL-CR1"><p>Разделяемый объект для обработчика языка должен быть скомпилирован и установлен в соответствующий каталог библиотек. Это в принципе не отличается от сборки и установки дополнительных модулей с обычными функциями на языке C; см. <a class="xref" href="xfunc-c.html#DFUNC" title="38.10.5. Компиляция и компоновка динамически загружаемых функций">Подраздел 38.10.5</a>. Часто обработчик языка зависит от внешней библиотеки, в которой собственно реализован исполнитель языка программирования; в таких случаях нужно установить и эту библиотеку.</p></li><li class="step" id="XPLANG-INSTALL-CR2"><p>Обработчик должен быть объявлен командой </p><pre class="synopsis">
CREATE FUNCTION <em class="replaceable"><code>имя_функции_обработчика</code></em>()
    RETURNS language_handler
    AS '<em class="replaceable"><code>путь-к-разделяемому-объекту</code></em>'
    LANGUAGE C;
</pre><p> Специальный тип возврата <code class="type">language_handler</code> говорит СУБД, что эта функция не возвращает какой-либо определённый тип данных <acronym class="acronym">SQL</acronym>, и значит её нельзя использовать непосредственно в операторах <acronym class="acronym">SQL</acronym>.</p></li><li class="step" id="XPLANG-INSTALL-CR3"><p>Дополнительно обработчик языка может предоставить функцию обработки <span class="quote">«<span class="quote">внедрённого кода</span>»</span>, которая будет выполнять анонимные блоки кода (команды  (<a class="link" href="sql-do.html" title="DO"><code class="command">DO</code></a>), написанные на этом языке. Если для языка есть обработчик внедрённого кода, объявите его такой командой: </p><pre class="synopsis">
CREATE FUNCTION <em class="replaceable"><code>имя_обработчика_внедрённого_кода</code></em>(internal)
    RETURNS void
    AS '<em class="replaceable"><code>путь-к-разделяемому-объекту</code></em>'
    LANGUAGE C;
</pre></li><li class="step" id="XPLANG-INSTALL-CR4"><p>Кроме того, обработчик языка может предоставить функцию <span class="quote">«<span class="quote">проверки</span>»</span>, которая будет проверять корректность определения функции, собственно не выполняя её. Функция проверки, если она существует, вызывается командой <code class="command">CREATE FUNCTION</code>. Если такая функция для языка определена, объявите её такой командой: </p><pre class="synopsis">
CREATE FUNCTION <em class="replaceable"><code>имя_функции_проверки</code></em>(oid)
    RETURNS void
    AS '<em class="replaceable"><code>путь-к-разделяемому-объекту</code></em>'
    LANGUAGE C STRICT;
</pre></li><li class="step" id="XPLANG-INSTALL-CR5"><p>Наконец, процедурный язык должен быть объявлен командой </p><pre class="synopsis">
CREATE [<span class="optional">TRUSTED</span>] LANGUAGE <em class="replaceable"><code>имя_языка</code></em>
    HANDLER <em class="replaceable"><code>имя_функции_обработчика</code></em>
    [<span class="optional">INLINE <em class="replaceable"><code>имя_обработчика_внедрённого_кода</code></em></span>]
    [<span class="optional">VALIDATOR <em class="replaceable"><code>имя_функции_проверки</code></em></span>] ;
</pre><p> Необязательное ключевое слово <code class="literal">TRUSTED</code> (доверенный) указывает, что язык не предоставляет пользователю доступ к данным, которого он не имел бы без него. Доверенные языки предназначены для обычных пользователей баз данных, не имеющих прав суперпользователя, и их можно использовать для безопасного создания функций и процедур. Так как функции PL выполняются внутри сервера баз данных, флаг <code class="literal">TRUSTED</code> следует устанавливать только для тех языков, которые не позволяют обращаться к внутренним механизмам сервера или файловой системе. Языки <span class="application">PL/pgSQL</span>, <span class="application">PL/Tcl</span> и <span class="application">PL/Perl</span> считаются доверенными; языки <span class="application">PL/TclU</span>, <span class="application">PL/PerlU</span> и <span class="application">PL/PythonU</span> предоставляют неограниченную функциональность, и их <span class="emphasis"><em>не</em></span> следует помечать как доверенные.</p></li></ol></div><p><a class="xref" href="xplang-install.html#XPLANG-INSTALL-EXAMPLE" title="Пример 42.1. Установка PL/Perl вручную">Примере 42.1</a> показывает, как выполняется процедура ручной установки для языка <span class="application">PL/Perl</span>.</p><div class="example" id="XPLANG-INSTALL-EXAMPLE"><p class="title"><strong>Пример 42.1. Установка <span class="application">PL/Perl</span> вручную</strong></p><div class="example-contents"><p>Следующая команда говорит серверу баз данных, где найти разделяемый объект для функции-обработчика языка <span class="application">PL/Perl</span>: </p><pre class="programlisting">CREATE FUNCTION plperl_call_handler() RETURNS language_handler AS
    '$libdir/plperl' LANGUAGE C;</pre><p>Для <span class="application">PL/Perl</span> реализованы обработчик внедрённого кода и функция проверки, так что их мы тоже объявим: </p><pre class="programlisting">CREATE FUNCTION plperl_inline_handler(internal) RETURNS void AS
    '$libdir/plperl' LANGUAGE C STRICT;

CREATE FUNCTION plperl_validator(oid) RETURNS void AS
    '$libdir/plperl' LANGUAGE C STRICT;</pre><p>Следующая команда: </p><pre class="programlisting">CREATE TRUSTED LANGUAGE plperl
    HANDLER plperl_call_handler
    INLINE plperl_inline_handler
    VALIDATOR plperl_validator;</pre><p> определяет, что ранее объявленные функции должны вызываться для функций и процедур с атрибутом языка <code class="literal">plperl</code>.</p></div></div><br class="example-break" /><p>В стандартной инсталляции <span class="productname">PostgreSQL</span> обработчик языка <span class="application">PL/pgSQL</span> уже собран и установлен в каталог <span class="quote">«<span class="quote">библиотек</span>»</span>; более того, сам язык <span class="application">PL/pgSQL</span> установлен во всех базах данных. Если при сборке сконфигурирована поддержка <span class="application">Tcl</span>, то обработчики для <span class="application">PL/Tcl</span> и <span class="application">PL/TclU</span> собираются и устанавливаются в каталог библиотек, но сам язык по умолчанию в базы данных не устанавливается. Подобным образом, если сконфигурирована поддержка Perl, собираются и устанавливаются обработчики <span class="application">PL/Perl</span> и <span class="application">PL/PerlU</span>, а при включении поддержки Python устанавливается обработчик <span class="application">PL/PythonU</span>, но в базы данных эти языки по умолчанию не устанавливаются.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="xplang.html" title="Глава 42. Процедурные языки">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="xplang.html" title="Глава 42. Процедурные языки">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="plpgsql.html" title="Глава 43. PL/pgSQL — процедурный язык SQL">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Глава 42. Процедурные языки </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> Глава 43. <span class="application">PL/pgSQL</span> — процедурный язык <acronym class="acronym">SQL</acronym></td></tr></table></div></body></html>