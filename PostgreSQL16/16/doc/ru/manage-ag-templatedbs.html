<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>23.3. Шаблоны баз данных</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="manage-ag-createdb.html" title="23.2. Создание базы данных" /><link rel="next" href="manage-ag-config.html" title="23.4. Конфигурирование баз данных" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">23.3. Шаблоны баз данных</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="manage-ag-createdb.html" title="23.2. Создание базы данных">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="managing-databases.html" title="Глава 23. Управление базами данных">Наверх</a></td><th width="60%" align="center">Глава 23. Управление базами данных</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="manage-ag-config.html" title="23.4. Конфигурирование баз данных">След.</a></td></tr></table><hr /></div><div class="sect1" id="MANAGE-AG-TEMPLATEDBS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">23.3. Шаблоны баз данных <a href="#MANAGE-AG-TEMPLATEDBS" class="id_link">#</a></h2></div></div></div><p>По факту команда <code class="command">CREATE DATABASE</code> выполняет копирование существующей базы данных. По умолчанию копируется стандартная системная база <code class="literal">template1</code>. <a id="id-1.6.10.6.2.3" class="indexterm"></a> Таким образом, <code class="literal">template1</code> это шаблон, на основе которого создаются новые базы. Если добавить объекты в <code class="literal">template1</code>, то впоследствии они будут копироваться в новые базы данных. Это позволяет внести изменения в стандартный набор объектов. Например, если в <code class="literal">template1</code> установить процедурный язык <span class="application">PL/Perl</span>, то он будет доступен в новых базах без дополнительных действий.</p><p>Однако команда <code class="command">CREATE DATABASE</code> не копирует права <code class="command">GRANT</code> уровня базы из исходной БД. Новая база получает права уровня базы по умолчанию.</p><p>Также существует вторая системная база <code class="literal">template0</code>.<a id="id-1.6.10.6.4.2" class="indexterm"></a> При инициализации она содержит те же самые объекты, что и <code class="literal">template1</code>, предопределённые в рамках устанавливаемой версии <span class="productname">PostgreSQL</span>. В <code class="literal">template0</code> не следует вносить никакие изменения после инициализации кластера. Если в команде <code class="command">CREATE DATABASE</code> указать в качестве шаблона <code class="literal">template0</code> вместо <code class="literal">template1</code>, вы сможете получить <span class="quote">«<span class="quote">чистую</span>»</span> пользовательскую базу данных (в которой никаких пользовательских объектов нет, есть только системные объекты в первозданном виде), не содержащую ничего, что могло быть добавлено на месте в <code class="literal">template1</code>. Это особенно полезно при восстановлении дампа <code class="literal">pg_dump</code>: скрипт выгруженного дампа должен восстанавливаться в чистую базу, чтобы он мог воссоздать нужное содержимое базы, избежав конфликтов с объектами, которые могли быть добавлены в <code class="literal">template1</code>.</p><p>Другая причина, для копирования <code class="literal">template0</code> вместо <code class="literal">template1</code> заключается в том, что можно указать новые параметры локали и кодировку при копировании <code class="literal">template0</code>, в то время как для копий <code class="literal">template1</code> они не должны меняться. Это связано с тем, что <code class="literal">template1</code> может содержать данные в специфических кодировках и локалях, в отличие от <code class="literal">template0</code>.</p><p>Для создания базы данных на основе <code class="literal">template0</code>, используйте: </p><pre class="programlisting">CREATE DATABASE <em class="replaceable"><code>dbname</code></em> TEMPLATE template0;</pre><p> из среды SQL, или: </p><pre class="programlisting">createdb -T template0 <em class="replaceable"><code>dbname</code></em></pre><p> из командной строки ОС.</p><p>Можно создавать дополнительные шаблоны баз данных, и, более того, можно копировать любую базу данных кластера, если указать её имя в качестве шаблона в команде <code class="command">CREATE DATABASE</code>. Важно понимать, что это (пока) не рассматривается в качестве основного инструмента для реализации возможности <span class="quote">«<span class="quote"><code class="command">COPY DATABASE</code></span>»</span>. Важным является то, что при копировании все сеансы к копируемой базе данных, должны быть закрыты. <code class="command">CREATE DATABASE</code> выдаст ошибку, если есть другие подключения; во время операции копирования новые подключения к этой базе данных не разрешены.</p><p>В таблице <code class="literal">pg_database</code><a id="id-1.6.10.6.8.2" class="indexterm"></a> есть два полезных флага для каждой базы данных: столбцы <code class="literal">datistemplate</code> и <code class="literal">datallowconn</code>. <code class="literal">datistemplate</code> указывает на факт того, что база данных может выступать в качестве шаблона в команде <code class="command">CREATE DATABASE</code>. Если флаг установлен, то для пользователей с правом <code class="literal">CREATEDB</code> клонирование доступно; если флаг не установлен, то лишь суперпользователь и владелец базы данных могут её клонировать. Если <code class="literal">datallowconn</code> не установлен, то новые подключения к этой базе не допустимы (однако текущие сеансы не закрываются при сбросе этого флага). База <code class="literal">template0</code> обычно помечена как <code class="literal">datallowconn = false</code> для избежания любых её модификаций. И <code class="literal">template0</code>, и <code class="literal">template1</code> всегда должны быть помечены флагом <code class="literal">datistemplate = true</code>.</p><div class="note"><h3 class="title">Примечание</h3><p><code class="literal">template1</code> и <code class="literal">template0</code> не выделены как-то особенно, кроме того факта, что <code class="literal">template1</code> используется по умолчанию в команде <code class="command">CREATE DATABASE</code>. Например, можно удалить <code class="literal">template1</code> и безболезненно создать заново из <code class="literal">template0</code>. Это можно посоветовать в случае, если <code class="literal">template1</code> был замусорен. (Чтобы удалить <code class="literal">template1</code>, необходимо сбросить флаг <code class="literal">pg_database.datistemplate = false</code>.)</p><p>База данных <code class="literal">postgres</code> также создаётся при инициализации кластера. Она используется пользователями и приложениями для подключения по умолчанию. Представляет собой всего лишь копию <code class="literal">template1</code>, и может быть удалена и повторно создана при необходимости.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="manage-ag-createdb.html" title="23.2. Создание базы данных">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="managing-databases.html" title="Глава 23. Управление базами данных">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="manage-ag-config.html" title="23.4. Конфигурирование баз данных">След.</a></td></tr><tr><td width="40%" align="left" valign="top">23.2. Создание базы данных </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 23.4. Конфигурирование баз данных</td></tr></table></div></body></html>