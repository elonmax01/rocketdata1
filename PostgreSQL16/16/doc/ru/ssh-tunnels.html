<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>19.11. Защита соединений TCP/IP с применением туннелей SSH</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="gssapi-enc.html" title="19.10. Защита соединений TCP/IP с применением GSSAPI" /><link rel="next" href="event-log-registration.html" title="19.12. Регистрация журнала событий в Windows" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">19.11. Защита соединений TCP/IP с применением туннелей <span class="application">SSH</span></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="gssapi-enc.html" title="19.10. Защита соединений TCP/IP с применением GSSAPI">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime.html" title="Глава 19. Подготовка к работе и сопровождение сервера">Наверх</a></td><th width="60%" align="center">Глава 19. Подготовка к работе и сопровождение сервера</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="event-log-registration.html" title="19.12. Регистрация журнала событий в Windows">След.</a></td></tr></table><hr /></div><div class="sect1" id="SSH-TUNNELS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.11. Защита соединений TCP/IP с применением туннелей <span class="application">SSH</span> <a href="#SSH-TUNNELS" class="id_link">#</a></h2></div></div></div><a id="id-1.6.6.14.2" class="indexterm"></a><p>Для защиты сетевых соединений клиентов с сервером <span class="productname">PostgreSQL</span> можно применить <span class="application">SSH</span>. При правильном подходе это позволяет обеспечить должный уровень защиты сетевого трафика, даже для клиентов, не поддерживающих SSL.</p><p>Прежде всего убедитесь, что на компьютере с сервером <span class="productname">PostgreSQL</span> также работает сервер <span class="application">SSH</span> и вы можете подключиться к нему через <code class="command">ssh</code> каким-нибудь пользователем; затем вы сможете установить защищённый туннель с этим удалённым сервером. Защищённый туннель прослушивает локальный порт и перенаправляет весь трафик в порт удалённого компьютера. Трафик, передаваемый в удалённый порт, может поступить на его адрес <code class="literal">localhost</code> или на другой привязанный адрес, если это требуется. При этом не будет видно, что трафик поступает с вашего компьютера. Следующая команда устанавливает защищённый туннель между клиентским компьютером и удалённой машиной <code class="literal">foo.com</code>: </p><pre class="programlisting">ssh -L 63333:localhost:5432 joe@foo.com</pre><p> Первое число в аргументе <code class="option">-L</code>, 63333 — это локальный номер порта туннеля; это может быть любой незанятый порт. (IANA резервирует порты с 49152 по 65535 для частного использования.) Имя или IP-адрес после него обозначает привязанный адрес с удалённой стороны, к которому вы подключаетесь, в данном случае это <code class="literal">localhost</code> (и это же значение по умолчанию). Второе число, 5432 — порт с удалённой стороны туннеля, то есть порт вашего сервера баз данных. Чтобы подключиться к этому серверу через созданный тоннель, нужно подключиться к порту 63333 на локальном компьютере: </p><pre class="programlisting">psql -h localhost -p 63333 postgres</pre><p> Для сервера баз данных это будет выглядеть так, как будто вы пользователь <code class="literal">joe</code> компьютера <code class="literal">foo.com</code>, подключающийся к адресу <code class="literal">localhost</code>, и он будет применять ту процедуру проверки подлинности, которая установлена для подключений данного пользователя к этому привязанному адресу. Заметьте, что сервер не будет считать такое соединение защищённым SSL, так как на самом деле трафик между сервером <span class="application">SSH</span> и сервером <span class="productname">PostgreSQL</span> не защищён. Это не должно нести какие-то дополнительные риски, так как эти серверы работают на одном компьютере.</p><p>Чтобы настроенный таким образом туннель работал, вы должны иметь возможность подключаться к компьютеру через <code class="command">ssh</code> под именем <code class="literal">joe@foo.com</code>, так же, как это происходит при установлении терминального подключения с помощью <code class="command">ssh</code>.</p><p>Вы также можете настроить перенаправление портов примерно так: </p><pre class="programlisting">ssh -L 63333:foo.com:5432 joe@foo.com</pre><p> Но в этом случае с точки зрения сервера подключение будет приходить на его сетевой адрес <code class="literal">foo.com</code>, а он по умолчанию не прослушивается (вследствие указания <code class="literal">listen_addresses = 'localhost'</code>). Обычно требуется другое поведение.</p><p>Если вам нужно <span class="quote">«<span class="quote">перейти</span>»</span> к серверу баз данных через некоторый шлюз, это можно организовать примерно так: </p><pre class="programlisting">ssh -L 63333:db.foo.com:5432 joe@shell.foo.com</pre><p> Заметьте, что в этом случае трафик между <code class="literal">shell.foo.com</code> и <code class="literal">db.foo.com</code> не будет защищён туннелем SSH. SSH предлагает довольно много вариантов конфигурации, что позволяет организовывать защиту сети разными способами. За подробностями обратитесь к документации SSH.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Существуют и другие приложения, которые могут создавать безопасные туннели, применяя по сути тот же подход, что был описан выше.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="gssapi-enc.html" title="19.10. Защита соединений TCP/IP с применением GSSAPI">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime.html" title="Глава 19. Подготовка к работе и сопровождение сервера">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="event-log-registration.html" title="19.12. Регистрация журнала событий в Windows">След.</a></td></tr><tr><td width="40%" align="left" valign="top">19.10. Защита соединений TCP/IP с применением GSSAPI </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 19.12. Регистрация <span class="application">журнала событий</span> в <span class="systemitem">Windows</span></td></tr></table></div></body></html>