<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>pg_dumpall</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="app-pgdump.html" title="pg_dump" /><link rel="next" href="app-pg-isready.html" title="pg_isready" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center"><span class="application">pg_dumpall</span></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="app-pgdump.html" title="pg_dump">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><th width="60%" align="center">Клиентские приложения PostgreSQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="app-pg-isready.html" title="pg_isready">След.</a></td></tr></table><hr /></div><div class="refentry" id="APP-PG-DUMPALL"><div class="titlepage"></div><a id="id-1.9.4.14.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle"><span class="application">pg_dumpall</span></span></h2><p>pg_dumpall — выгрузить кластер баз данных <span class="productname">PostgreSQL</span> в формате скрипта</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><div class="cmdsynopsis"><p id="id-1.9.4.14.4.1"><code class="command">pg_dumpall</code> [<em class="replaceable"><code>параметр-подключения</code></em>...] [<em class="replaceable"><code>параметр</code></em>...]</p></div></div><div class="refsect1" id="APP-PG-DUMPALL-DESCRIPTION"><h2>Описание</h2><p>Утилита <span class="application">pg_dumpall</span> предназначена для записи (<span class="quote">«<span class="quote">выгрузки</span>»</span>) всех баз данных кластера <span class="productname">PostgreSQL</span> в один файл в формате скрипта. Этот файл содержит команды <acronym class="acronym">SQL</acronym>, так что передав его на вход <a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a>, можно восстановить все базы данных. Для формирования этого файла вызывается <a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle"><span class="application">pg_dump</span></span></a> для каждой базы данных в кластере. <span class="application">pg_dumpall</span> также выгружает глобальные объекты, общие для всех баз данных, а именно роли, табличные пространства и права, выданные для параметров конфигурации. (Программа <span class="application">pg_dump</span> не сохраняет эти объекты.)</p><p>Так как утилита <span class="application">pg_dumpall</span> читает таблицы из всех баз данных, для получения полного содержимого баз запускать её, как правило, нужно от имени суперпользователя. Также права суперпользователя требуются при последующем выполнении сохранённого скрипта, чтобы он смог добавить роли и создать базы данных.</p><p>Генерируемый SQL-скрипт записывается в стандартное устройство вывода. Чтобы перенаправить его в файл, воспользуйтесь параметром <code class="option">-f</code>/<code class="option">--file</code> или операторами оболочки.</p><p>Утилите <span class="application">pg_dumpall</span> требуется подключаться к серверу <span class="productname">PostgreSQL</span> несколько раз (к каждой базе по отдельности). Если вы проходите проверку подлинности по паролю, вам придётся каждый раз вводить пароль. Чтобы избежать этого, удобно иметь файл <code class="filename">~/.pgpass</code>. За дополнительными сведениями обратитесь к <a class="xref" href="libpq-pgpass.html" title="34.16. Файл паролей">Разделу 34.16</a>.</p></div><div class="refsect1" id="id-1.9.4.14.6"><h2>Параметры</h2><p>Параметры командной строки для управления содержимым и форматом вывода. </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-a</code><br /></span><span class="term"><code class="option">--data-only</code></span></dt><dd><p>Выгружать только данные, без схемы (определений данных).</p></dd><dt><span class="term"><code class="option">-c</code><br /></span><span class="term"><code class="option">--clean</code></span></dt><dd><p>Выводить SQL-команды для <code class="command">DROP</code> всех выгруженных баз данных, ролей и табличных пространств перед их воссозданием. Этот параметр полезен, когда при восстановлении необходимо перезаписать существующий кластер. Без дополнительного указания <code class="option">--if-exists</code> при этом могут выдаваться безвредные сообщения об ошибках, если таких объектов не окажется в целевой базе данных.</p></dd><dt><span class="term"><code class="option">-E <em class="replaceable"><code>кодировка</code></em></code><br /></span><span class="term"><code class="option">--encoding=<em class="replaceable"><code>кодировка</code></em></code></span></dt><dd><p>Создать копию в заданной кодировке. По умолчанию копия создаётся в кодировке базы данных. (Другой способ достичь того же результата — задать желаемую кодировку в переменной окружения <code class="envar">PGCLIENTENCODING</code>.)</p></dd><dt><span class="term"><code class="option">-f <em class="replaceable"><code>имя_файла</code></em></code><br /></span><span class="term"><code class="option">--file=<em class="replaceable"><code>имя_файла</code></em></code></span></dt><dd><p>Направить вывод в указанный файл. Если этот параметр опущен, скрипт записывается в стандартный вывод.</p></dd><dt><span class="term"><code class="option">-g</code><br /></span><span class="term"><code class="option">--globals-only</code></span></dt><dd><p>Выгружать только глобальные объекты (роли и табличные пространства), без баз данных.</p></dd><dt><span class="term"><code class="option">-O</code><br /></span><span class="term"><code class="option">--no-owner</code></span></dt><dd><p>Не генерировать команды, устанавливающие владение объектами, как в исходной базе данных. По умолчанию, <span class="application">pg_dumpall</span> генерирует команды <code class="command">ALTER OWNER</code> или <code class="command">SET SESSION AUTHORIZATION</code>, восстанавливающие исходных владельцев для создаваемых элементов схемы. Однако выполнить эти команды сможет только суперпользователь (или пользователь, владеющий всеми объектами, создаваемыми скриптом). Чтобы получить скрипт, который сможет восстановить любой пользователь (но при этом он станет владельцем всех объектов), используется <code class="option">-O</code>.</p></dd><dt><span class="term"><code class="option">-r</code><br /></span><span class="term"><code class="option">--roles-only</code></span></dt><dd><p>Выгружать только роли, без баз данных и табличных пространств.</p></dd><dt><span class="term"><code class="option">-s</code><br /></span><span class="term"><code class="option">--schema-only</code></span></dt><dd><p>Выгружать только определения объектов (схемы), без данных.</p></dd><dt><span class="term"><code class="option">-S <em class="replaceable"><code>имя_пользователя</code></em></code><br /></span><span class="term"><code class="option">--superuser=<em class="replaceable"><code>имя_пользователя</code></em></code></span></dt><dd><p>Указать суперпользователя, который будет использоваться для отключения триггеров. Параметр имеет значение только вместе с <code class="option">--disable-triggers</code>. Обычно его лучше не использовать, а запускать полученный скрипт от имени суперпользователя.</p></dd><dt><span class="term"><code class="option">-t</code><br /></span><span class="term"><code class="option">--tablespaces-only</code></span></dt><dd><p>Выгружать только табличные пространства, без баз данных и ролей.</p></dd><dt><span class="term"><code class="option">-v</code><br /></span><span class="term"><code class="option">--verbose</code></span></dt><dd><p>Включить подробный режим. <span class="application">pg_dumpall</span> будет выводить в стандартный поток ошибок подробные комментарии к объектам, включая время начала и окончания выгрузки, а также сообщения о прогрессе выполнения. Если повторить этот ключ, в стандартный поток ошибок будут выдаваться дополнительные отладочные сообщения. Этот ключ также передаётся программе <span class="application">pg_dump</span>.</p></dd><dt><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span></dt><dd><p>Сообщить версию <span class="application">pg_dumpall</span> и завершиться.</p></dd><dt><span class="term"><code class="option">-x</code><br /></span><span class="term"><code class="option">--no-privileges</code><br /></span><span class="term"><code class="option">--no-acl</code></span></dt><dd><p>Не выгружать права доступа (команды GRANT/REVOKE).</p></dd><dt><span class="term"><code class="option">--binary-upgrade</code></span></dt><dd><p>Этот параметр предназначен для утилит обновления сервера. Использование для иных целей не рекомендуется и не поддерживается. Поведение параметра может быть изменено в последующих версиях без предварительного уведомления.</p></dd><dt><span class="term"><code class="option">--column-inserts</code><br /></span><span class="term"><code class="option">--attribute-inserts</code></span></dt><dd><p>Выгружать данные в виде команд <code class="command">INSERT</code> с явно задаваемыми именами столбцов (<code class="literal">INSERT INTO <em class="replaceable"><code>таблица</code></em> (<em class="replaceable"><code>столбец</code></em>, ...) VALUES ...</code>). При этом восстановление будет очень медленным; в основном это применяется для выгрузки данных, которые затем будут загружаться не в <span class="productname">PostgreSQL</span>.</p></dd><dt><span class="term"><code class="option">--disable-dollar-quoting</code></span></dt><dd><p>Этот параметр запрещает заключать в доллары тело функций, что оставляет возможность только заключать их в кавычки, применяя стандартный синтаксис SQL.</p></dd><dt><span class="term"><code class="option">--disable-triggers</code></span></dt><dd><p>Этот параметр действует только при выгрузке одних данных. С ним <span class="application">pg_dumpall</span> добавляет команды, отключающие триггеры в целевых таблицах на время загрузки данных. Используйте его, если в ваших таблицах определены проверки ссылочной целостности или другие триггеры, которые вы не хотели бы выполнять в процессе загрузки данных.</p><p>В настоящее время команды, генерируемые с параметром <code class="option">--disable-triggers</code>, должны исполняться от имени суперпользователя. Таким образом, необходимо также передавать флаг <code class="option">-S</code>, либо при восстановлении выполнять скрипт от имени суперпользователя.</p></dd><dt><span class="term"><code class="option">--exclude-database=<em class="replaceable"><code>шаблон</code></em></code></span></dt><dd><p>Не выгружать базы данных, имена которых соответствуют <em class="replaceable"><code>шаблону</code></em>. Исключить имена по нескольким шаблонам можно, добавив несколько ключей <code class="option">--exclude-database</code>. Параметр <em class="replaceable"><code>шаблон</code></em> в данном аргументе обрабатывается по тем же правилам, что и в командах <span class="application">psql</span> <code class="literal">\d</code> (см. <a class="xref" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска">Шаблоны поиска</a>), что позволяет также исключить несколько баз данных, добавив в шаблон звёздочку. Используя звёздочку, заключайте шаблон в кавычки, если звёздочка может быть развёрнута оболочкой.</p></dd><dt><span class="term"><code class="option">--extra-float-digits=<em class="replaceable"><code>число_цифр</code></em></code></span></dt><dd><p>Выводить числа с плавающей точкой не с максимальной точностью, а с заданным значением extra_float_digits. При выгрузке данных в целях резервного копирования данный параметр использовать не следует.</p></dd><dt><span class="term"><code class="option">--if-exists</code></span></dt><dd><p>Используйте команды <code class="literal">DROP ... IF EXISTS</code> для удаления объектов в режиме <code class="option">--clean</code>. При этом возможные ошибки <span class="quote">«<span class="quote">does not exist</span>»</span> (не существует) не выводятся. Этот параметр недействителен без указания <code class="option">--clean</code>.</p></dd><dt><span class="term"><code class="option">--inserts</code></span></dt><dd><p>Выгружать данные в виде команд <code class="command">INSERT</code>, а не <code class="command">COPY</code>. При этом восстановление значительно замедлится; в основном это применяется для выгрузки данных, которые затем будут загружаться не в <span class="productname">PostgreSQL</span>. Заметьте, что восстановление может вовсе не выполниться при изменении порядка столбцов в таблицах. В этом смысле параметр <code class="option">--column-inserts</code> безопаснее, но восстановление будет ещё медленнее.</p></dd><dt><span class="term"><code class="option">--load-via-partition-root</code></span></dt><dd><p>При выгрузке данных для секции таблицы выводить команды <code class="command">COPY</code> или <code class="command">INSERT</code>, ссылающиеся на корневую таблицу в иерархии секционирования, а не на эту секцию. В результате при загрузке данных подходящая секция будет выбираться заново для каждой строки. Это может быть полезно при восстановлении данных, когда на целевом сервере строки не всегда попадают в те же секции, в которых они находились на исходном. Это возможно, например, когда столбец разбиения имеет текстовый тип и в двух системах по-разному определено правило сортировки, по которому упорядочивается этот столбец.</p></dd><dt><span class="term"><code class="option">--lock-wait-timeout=<em class="replaceable"><code>время_ожидания</code></em></code></span></dt><dd><p>Не ждать бесконечно получения разделяемых блокировок таблиц в начале процедуры выгрузки. Вместо этого выдать ошибку, если не удастся заблокировать таблицы за указанное <em class="replaceable"><code>время_ожидания</code></em>. Это время можно задать в любом из форматов, принимаемых командой <code class="command">SET statement_timeout</code>.</p></dd><dt><span class="term"><code class="option">--no-comments</code></span></dt><dd><p>Не выгружать комментарии.</p></dd><dt><span class="term"><code class="option">--no-publications</code></span></dt><dd><p>Не выгружать публикации.</p></dd><dt><span class="term"><code class="option">--no-role-passwords</code></span></dt><dd><p>Не выгружать пароли ролей. При восстановлении все роли получат пароль NULL и не смогут пройти проверку подлинности, пока им не будут назначены пароли. Так как значения паролей не нужны, когда используется это указание, информация о ролях считывается из системного представления <code class="structname">pg_roles</code>, а не из <code class="structname">pg_authid</code>. Таким образом, данный вариант может быть также полезен, если доступ к <code class="structname">pg_authid</code> ограничен политикой безопасности.</p></dd><dt><span class="term"><code class="option">--no-security-labels</code></span></dt><dd><p>Не выгружать метки безопасности.</p></dd><dt><span class="term"><code class="option">--no-subscriptions</code></span></dt><dd><p>Не выгружать подписки.</p></dd><dt><span class="term"><code class="option">--no-sync</code></span></dt><dd><p>По умолчанию <code class="command">pg_dumpall</code> ждёт, пока все файлы не будут надёжно записаны на диск. С данным параметром <code class="command">pg_dumpall</code> завершается немедленно, то есть выполняется быстрее, но в случае неожиданного сбоя операционной системы выгруженные данные могут оказаться испорченными. Вообще этот параметр предназначен прежде всего для тестирования, для производственной среды он не подходит.</p></dd><dt><span class="term"><code class="option">--no-table-access-method</code></span></dt><dd><p>Не выводить команды для указания табличных методов доступа. При восстановлении все объекты будут создаваться с табличным методом доступа, выбираемым по умолчанию.</p></dd><dt><span class="term"><code class="option">--no-tablespaces</code></span></dt><dd><p>Не выводить команды, создающие или выбирающие табличные пространства для объектов. С этим параметром все объекты будут созданы в пространстве по умолчанию, установленном во время восстановления.</p></dd><dt><span class="term"><code class="option">--no-toast-compression</code></span></dt><dd><p>Не выдавать команды, задающие методы сжатия <acronym class="acronym">TOAST</acronym>. С этим указанием все столбцы будут восстановлены с методом сжатия, выбранным по умолчанию.</p></dd><dt><span class="term"><code class="option">--no-unlogged-table-data</code></span></dt><dd><p>Не выгружать содержимое нежурналируемых таблиц. Этот параметр не влияет на то, как выгружаются определения этих таблиц (схема); он отключает только выгрузку данных из них.</p></dd><dt><span class="term"><code class="option">--on-conflict-do-nothing</code></span></dt><dd><p>Добавить предложения <code class="literal">ON CONFLICT DO NOTHING</code> в команды <code class="command">INSERT</code>. Это указание допускается только при выборе режима <code class="option">--inserts</code> или <code class="option">--column-inserts</code>.</p></dd><dt><span class="term"><code class="option">--quote-all-identifiers</code></span></dt><dd><p>Принудительно экранировать все идентификаторы. Этот параметр рекомендуется при выгрузке базы, когда основная версия сервера <span class="productname">PostgreSQL</span>, с которого выгружается база, отличается от версии <span class="application">pg_dumpall</span>, или когда выгруженная копия предназначена для загрузки на сервере с другой основной версией. По умолчанию <span class="application">pg_dumpall</span> экранирует только те идентификаторы, которые являются зарезервированными словами в собственной основной версии. Иногда это приводит к проблемам совместимости с серверами других версий, в которых множество зарезервированных слов может быть несколько другим. Применение параметра <code class="option">--quote-all-identifiers</code> предотвращает подобные проблемы, ценой ухудшения читаемости скрипта с выгруженными данными.</p></dd><dt><span class="term"><code class="option">--rows-per-insert=<em class="replaceable"><code>число_строк</code></em></code></span></dt><dd><p>Выгружать данные таблиц в виде команд <code class="command">INSERT</code> вместо <code class="command">COPY</code>. В данном параметре задаётся максимальное число строк для одной команды <code class="command">INSERT</code>. Указанное в нём значение должно быть больше 0. При этом в случае каких-либо ошибок при восстановлении данных будут потеряны только строки <code class="command">INSERT</code>, где возникли ошибки, но не всё содержимое таблицы.</p></dd><dt><span class="term"><code class="option">--use-set-session-authorization</code></span></dt><dd><p>Выводить команды <code class="command">SET SESSION AUTHORIZATION</code>, соответствующие стандарту, вместо <code class="command">ALTER OWNER</code>, для назначения владельцев объектов. В результате выгруженный скрипт будет более стандартизированным, но может не восстановиться корректно, в зависимости от истории объектов.</p></dd><dt><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help</code></span></dt><dd><p>Показать справку по аргументам командной строки <span class="application">pg_dumpall</span> и завершиться.</p></dd></dl></div><p>Далее описаны параметры управления подключением. </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-d <em class="replaceable"><code>строка_подключения</code></em></code><br /></span><span class="term"><code class="option">--dbname=<em class="replaceable"><code>строка_подключения</code></em></code></span></dt><dd><p>Указывает параметры подключения к серверу в формате <a class="link" href="libpq-connect.html#LIBPQ-CONNSTRING" title="34.1.1. Строки параметров подключения">строки подключения</a>; они будут переопределять любые одноимённые параметры, заданные в командной строке.</p><p>Этот параметр называется <code class="literal">--dbname</code> для согласованности с другими клиентскими приложениями, но так как <span class="application">pg_dumpall</span> подключается не к одной базе данных, имя базы в строке подключения игнорируется. Чтобы указать имя базы данных для начального подключения, которое будет использоваться для выгрузки глобальных объектов и обнаружения других выгружаемых баз, воспользуйтесь параметром <code class="literal">-l</code>.</p></dd><dt><span class="term"><code class="option">-h <em class="replaceable"><code>сервер</code></em></code><br /></span><span class="term"><code class="option">--host=<em class="replaceable"><code>сервер</code></em></code></span></dt><dd><p>Указывает имя компьютера, на котором работает сервер баз данных. Если значение начинается с косой черты, оно определяет каталог Unix-сокета. Значение по умолчанию берётся из переменной окружения <code class="envar">PGHOST</code>, если она установлена. В противном случае выполняется подключение к Unix-сокету.</p></dd><dt><span class="term"><code class="option">-l <em class="replaceable"><code>имя_бд</code></em></code><br /></span><span class="term"><code class="option">--database=<em class="replaceable"><code>имя_бд</code></em></code></span></dt><dd><p>Задаёт имя базы данных, через подключение к которой будут выгружаться глобальные объекты и находиться другие выгружаемые базы. По умолчанию используется база <code class="literal">postgres</code>, а в случае её отсутствия — <code class="literal">template1</code>.</p></dd><dt><span class="term"><code class="option">-p <em class="replaceable"><code>порт</code></em></code><br /></span><span class="term"><code class="option">--port=<em class="replaceable"><code>порт</code></em></code></span></dt><dd><p>Указывает TCP-порт или расширение файла локального Unix-сокета, через который сервер принимает подключения. Значение по умолчанию определяется переменной окружения <code class="envar">PGPORT</code>, если она установлена, либо числом, заданным при компиляции.</p></dd><dt><span class="term"><code class="option">-U <em class="replaceable"><code>имя_пользователя</code></em></code><br /></span><span class="term"><code class="option">--username=<em class="replaceable"><code>имя_пользователя</code></em></code></span></dt><dd><p>Имя пользователя, под которым производится подключение.</p></dd><dt><span class="term"><code class="option">-w</code><br /></span><span class="term"><code class="option">--no-password</code></span></dt><dd><p>Не выдавать запрос на ввод пароля. Если сервер требует аутентификацию по паролю и пароль не доступен с помощью других средств, таких как файл <code class="filename">.pgpass</code>, попытка соединения не удастся. Этот параметр может быть полезен в пакетных заданиях и скриптах, где нет пользователя, который вводит пароль.</p></dd><dt><span class="term"><code class="option">-W</code><br /></span><span class="term"><code class="option">--password</code></span></dt><dd><p>Принудительно запрашивать пароль перед подключением к базе данных.</p><p>Это несущественный параметр, так как <span class="application">pg_dumpall</span> запрашивает пароль автоматически, если сервер проверяет подлинность по паролю. Однако чтобы понять это, <span class="application">pg_dumpall</span> лишний раз подключается к серверу. Поэтому иногда имеет смысл ввести <code class="option">-W</code>, чтобы исключить эту ненужную попытку подключения.</p><p>Заметьте, что пароль будет запрашиваться повторно для выгрузки каждой базы данных. Поэтому обычно лучше настроить файл <code class="filename">~/.pgpass</code>, и не вводить пароль каждый раз вручную.</p></dd><dt><span class="term"><code class="option">--role=<em class="replaceable"><code>имя роли</code></em></code></span></dt><dd><p>Задаёт имя роли, которая будет осуществлять выгрузку. Получив это имя, <span class="application">pg_dumpall</span> выполнит <code class="command">SET ROLE</code> <em class="replaceable"><code>имя_роли</code></em> после подключения к базе данных. Это полезно, когда проходящий проверку пользователь (указанный в <code class="option">-U</code>) не имеет прав, необходимых для <span class="application">pg_dumpall</span>, но может переключиться на роль, наделённую этими правами. В некоторых окружениях правила запрещают подключаться к серверу непосредственно суперпользователю, и этот параметр позволяет выполнить выгрузку, не нарушая их.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.4.14.7"><h2>Переменные окружения</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="envar">PGHOST</code><br /></span><span class="term"><code class="envar">PGOPTIONS</code><br /></span><span class="term"><code class="envar">PGPORT</code><br /></span><span class="term"><code class="envar">PGUSER</code></span></dt><dd><p>Параметры подключения по умолчанию</p></dd><dt><span class="term"><code class="envar">PG_COLOR</code></span></dt><dd><p>Выбирает вариант использования цвета в диагностических сообщениях. Возможные значения: <code class="literal">always</code> (всегда), <code class="literal">auto</code> (автоматически) и <code class="literal">never</code> (никогда).</p></dd></dl></div><p>Эта утилита, как и большинство других утилит <span class="productname">PostgreSQL</span>, также использует переменные среды, поддерживаемые <span class="application">libpq</span> (см. <a class="xref" href="libpq-envars.html" title="34.15. Переменные окружения">Раздел 34.15</a>).</p></div><div class="refsect1" id="id-1.9.4.14.8"><h2>Замечания</h2><p>Так как <span class="application">pg_dumpall</span> внутри себя вызывает <span class="application">pg_dump</span>, часть диагностических сообщений будет относиться к <span class="application">pg_dump</span>.</p><p>Ключ <code class="option">--clean</code> может быть полезен, даже если вы намереваетесь восстановить копию из скрипта в новом кластере. С <code class="option">--clean</code> скрипт сможет удалить и пересоздать встроенные базы данных <code class="literal">postgres</code> и <code class="literal">template1</code>, так что они получат свойства, которые имели одноимённые базы в исходном кластере (например, локаль и кодировку). Без данного ключа эти базы сохранят свои свойства уровня базы данных, а также всё существующее содержимое.</p><p>После восстановления имеет смысл запустить <code class="command">ANALYZE</code> для каждой базы данных, чтобы оптимизатор получил актуальную статистику. Также можно запустить анализ для всех баз данных, выполнив команду <code class="command">vacuumdb -a -z</code>.</p><p>Не следует ожидать, что скрипт выгрузки будет выполняться абсолютно без ошибок. В частности, так как он будет содержать <code class="command">CREATE ROLE</code> для каждой существующей в исходном кластере роли, при попытке создать суперпользователя определённо произойдёт ошибка <span class="quote">«<span class="quote">role already exists</span>»</span> (роль уже существует), если только целевой кластер был инициализирован не с другим начальным именем суперпользователя. Эта ошибка некритична и её следует просто игнорировать. С ключом <code class="option">--clean</code> весьма вероятны другие незначительные сообщения об ошибках, связанные с несуществующими объектами; их число можно минимизировать, добавив ключ <code class="option">--if-exists</code>.</p><p>При использовании <span class="application">pg_dumpall</span> требуется, чтобы все необходимые каталоги табличных пространств существовали до восстановления; в противном случае создание баз данных в нестандартном размещении завершится ошибкой.</p></div><div class="refsect1" id="APP-PG-DUMPALL-EX"><h2>Примеры</h2><p>Выгрузка всех баз данных: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dumpall &gt; db.out</code></strong>
</pre><p>Восстановить базы данных из этого файла можно так: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>psql -f db.out postgres</code></strong>
</pre><p> К какой базе вы подключаетесь, в принципе не имеет значения, так как скрипт, созданный утилитой <span class="application">pg_dumpall</span>, будет содержать все команды, требующиеся для создания сохранённых баз данных и подключения к ним. Однако это важно, если применяется ключ <code class="option">--clean</code> — тогда вы должны изначально подключиться к базе <code class="literal">postgres</code>; скрипт попытается прежде всего удалить остальные базы данных, но не сможет этого сделать для базы, к которой вы подключены.</p></div><div class="refsect1" id="id-1.9.4.14.10"><h2>См. также</h2><p>Обратитесь к описанию <a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle"><span class="application">pg_dump</span></span></a>, чтобы узнать об условиях, при которых могут возникнуть проблемы.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="app-pgdump.html" title="pg_dump">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="app-pg-isready.html" title="pg_isready">След.</a></td></tr><tr><td width="40%" align="left" valign="top"><span class="application">pg_dump</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> <span class="application">pg_isready</span></td></tr></table></div></body></html>