<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>22.4. Удаление ролей</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="role-membership.html" title="22.3. Членство в роли" /><link rel="next" href="predefined-roles.html" title="22.5. Предопределённые роли" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">22.4. Удаление ролей</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="role-membership.html" title="22.3. Членство в роли">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="user-manag.html" title="Глава 22. Роли базы данных">Наверх</a></td><th width="60%" align="center">Глава 22. Роли базы данных</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="predefined-roles.html" title="22.5. Предопределённые роли">След.</a></td></tr></table><hr /></div><div class="sect1" id="ROLE-REMOVAL"><div class="titlepage"><div><div><h2 class="title" style="clear: both">22.4. Удаление ролей <a href="#ROLE-REMOVAL" class="id_link">#</a></h2></div></div></div><p>Так как роли могут владеть объектами баз данных и иметь права доступа к объектам других, удаление роли не сводится к немедленному действию <a class="link" href="sql-droprole.html" title="DROP ROLE"><code class="command">DROP ROLE</code></a>. Сначала должны быть удалены и переданы другим владельцами все объекты, принадлежащие роли; также должны быть отозваны все права, данные роли.</p><p>Владение объектами можно передавать в индивидуальном порядке, применяя команду <code class="command">ALTER</code>, например: </p><pre class="programlisting">ALTER TABLE bobs_table OWNER TO alice;</pre><p> Кроме того, для переназначения какой-либо другой роли владения сразу всеми объектами, принадлежащими удаляемой роли, можно применить команду <a class="link" href="sql-reassign-owned.html" title="REASSIGN OWNED"><code class="command">REASSIGN OWNED</code></a>. Так как <code class="command">REASSIGN OWNED</code> не может обращаться к объектам в других базах данных, её необходимо выполнить в каждой базе, которая содержит объекты, принадлежащие этой роли. (Заметьте, что первая такая команда <code class="command">REASSIGN OWNED</code> изменит владельца для всех разделяемых между базами объектов, то есть для баз данных или табличных пространств, принадлежащих удаляемой роли.)</p><p>После того как все ценные объекты будут переданы новым владельцам, все оставшиеся объекты, принадлежащие удаляемой роли, могут быть удалены с помощью команды <a class="link" href="sql-drop-owned.html" title="DROP OWNED"><code class="command">DROP OWNED</code></a>. И эта команда не может обращаться к объектам в других базах данных, так что её нужно запускать в каждой базе, которая содержит объекты, принадлежащие роли. Также заметьте, что <code class="command">DROP OWNED</code> не удаляет табличные пространства или базы данных целиком, так что это необходимо сделать вручную, если роли принадлежат базы или табличные пространства, не переданные новым владельцам.</p><p><code class="command">DROP OWNED</code> также удаляет все права, которые даны целевой роли для объектов, не принадлежащих ей. Так как <code class="command">REASSIGN OWNED</code> такие объекты не затрагивает, обычно необходимо запустить и <code class="command">REASSIGN OWNED</code>, и <code class="command">DROP OWNED</code> (в этом порядке!), чтобы полностью ликвидировать зависимости удаляемой роли.</p><p>С учётом этого, общий рецепт удаления роли, которая владела объектами, вкратце таков:</p><pre class="programlisting">REASSIGN OWNED BY doomed_role TO successor_role;
DROP OWNED BY doomed_role;
-- повторить предыдущие команды для каждой базы в кластере
DROP ROLE doomed_role;</pre><p>Когда не все объекты нужно передать одному новому владельцу, лучше сначала вручную отработать исключения, а в завершение выполнить показанные выше действия.</p><p>При попытке выполнить <code class="command">DROP ROLE</code> для роли, у которой сохраняются зависимые объекты, будут выданы сообщения, говорящие, какие объекты нужно передать другому владельцу или удалить.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="role-membership.html" title="22.3. Членство в роли">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="user-manag.html" title="Глава 22. Роли базы данных">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="predefined-roles.html" title="22.5. Предопределённые роли">След.</a></td></tr><tr><td width="40%" align="left" valign="top">22.3. Членство в роли </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 22.5. Предопределённые роли</td></tr></table></div></body></html>