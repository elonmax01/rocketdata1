<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>vacuumdb</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="app-reindexdb.html" title="reindexdb" /><link rel="next" href="reference-server.html" title="Серверные приложения PostgreSQL" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center"><span class="application">vacuumdb</span></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="app-reindexdb.html" title="reindexdb">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><th width="60%" align="center">Клиентские приложения PostgreSQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="reference-server.html" title="Серверные приложения PostgreSQL">След.</a></td></tr></table><hr /></div><div class="refentry" id="APP-VACUUMDB"><div class="titlepage"></div><a id="id-1.9.4.22.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle"><span class="application">vacuumdb</span></span></h2><p>vacuumdb — выполнить очистку и анализ базы данных <span class="productname">PostgreSQL</span></p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><div class="cmdsynopsis"><p id="id-1.9.4.22.4.1"><code class="command">vacuumdb</code> [<em class="replaceable"><code>параметр-подключения</code></em>...] [<em class="replaceable"><code>параметр</code></em>...]  
    [
       <code class="option">-t</code>  |   <code class="option">--table</code>  
     <em class="replaceable"><code>таблица</code></em>
      [( <em class="replaceable"><code>столбец</code></em> [,...] )]
    ]
   ...  [<em class="replaceable"><code>имя_бд</code></em>]</p></div><div class="cmdsynopsis"><p id="id-1.9.4.22.4.2"><code class="command">vacuumdb</code> [<em class="replaceable"><code>параметр-подключения</code></em>...] [<em class="replaceable"><code>параметр</code></em>...]  
    [
       
        [
           <code class="option">-n</code>  |   <code class="option">--schema</code>  
         <em class="replaceable"><code>схема</code></em>
        ]
         |   
        [
           <code class="option">-N</code>  |   <code class="option">--exclude-schema</code>  
         <em class="replaceable"><code>схема</code></em>
        ]
         
    ]
   ...  [<em class="replaceable"><code>имя_бд</code></em>]</p></div><div class="cmdsynopsis"><p id="id-1.9.4.22.4.3"><code class="command">vacuumdb</code> [<em class="replaceable"><code>параметр-подключения</code></em>...] [<em class="replaceable"><code>параметр</code></em>...]   <code class="option">-a</code>  |   <code class="option">--all</code>  </p></div></div><div class="refsect1" id="id-1.9.4.22.5"><h2>Описание</h2><p>Утилита <span class="application">vacuumdb</span> предназначена для очистки базы данных <span class="productname">PostgreSQL</span>. Кроме того, <span class="application">vacuumdb</span> генерирует внутреннюю статистику, которую использует оптимизатор запросов <span class="productname">PostgreSQL</span>.</p><p>Утилита <span class="application">vacuumdb</span> представляют собой обёртку SQL-команды <a class="link" href="sql-vacuum.html" title="VACUUM"><code class="command">VACUUM</code></a>. Выполнение очистки и анализа баз данных с её помощью по сути не отличается от выполнения тех же действий при обращении к серверу другими способами.</p></div><div class="refsect1" id="id-1.9.4.22.6"><h2>Параметры</h2><p>Утилита <span class="application">vacuumdb</span> принимает следующие аргументы командной строки: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-a</code><br /></span><span class="term"><code class="option">--all</code></span></dt><dd><p>Очистить все базы данных.</p></dd><dt><span class="term"><code class="option">--buffer-usage-limit <em class="replaceable"><code>размер</code></em></code></span></dt><dd><p>Указывает размер кольцевого буфера в <a class="glossterm" href="glossary.html#GLOSSARY-BUFFER-ACCESS-STRATEGY"><em class="glossterm"><a class="glossterm" href="glossary.html#GLOSSARY-BUFFER-ACCESS-STRATEGY" title="Стратегия доступа к буферу">стратегии доступа к буферу</a></em></a> для заданного вызова <span class="application">vacuumdb</span>. Указанный размер используется для вычисления числа общих буферов, повторно используемых в рамках стратегии. См. <a class="xref" href="sql-vacuum.html" title="VACUUM"><span class="refentrytitle">VACUUM</span></a>.</p></dd><dt><span class="term"><code class="option">[<span class="optional">-d</span>] <em class="replaceable"><code>имя_бд</code></em></code><br /></span><span class="term"><code class="option">[<span class="optional">--dbname=</span>]<em class="replaceable"><code>имя_бд</code></em></code></span></dt><dd><p>Указывает имя базы данных для очистки или анализа, когда не используется параметр <code class="option">-a</code>/<code class="option">--all</code>. Если это указание отсутствует, имя базы определяется переменной окружения <code class="envar">PGDATABASE</code>. Если эта переменная не задана, именем базы будет имя пользователя, указанное для подключения. В аргументе <em class="replaceable"><code>имя_бд</code></em> может задаваться <a class="link" href="libpq-connect.html#LIBPQ-CONNSTRING" title="34.1.1. Строки параметров подключения">строка подключения</a>. В этом случае параметры в строке подключения переопределяют одноимённые параметры, заданные в командной строке.</p></dd><dt><span class="term"><code class="option">--disable-page-skipping</code></span></dt><dd><p>Запретить пропуск страниц в зависимости от содержимого карты видимости.</p></dd><dt><span class="term"><code class="option">-e</code><br /></span><span class="term"><code class="option">--echo</code></span></dt><dd><p>Выводить команды, которые <span class="application">vacuumdb</span> генерирует и передаёт серверу.</p></dd><dt><span class="term"><code class="option">-f</code><br /></span><span class="term"><code class="option">--full</code></span></dt><dd><p>Произвести <span class="quote">«<span class="quote">полную</span>»</span> очистку.</p></dd><dt><span class="term"><code class="option">-F</code><br /></span><span class="term"><code class="option">--freeze</code></span></dt><dd><p>Агрессивно <span class="quote">«<span class="quote">замораживать</span>»</span> версии строк.</p></dd><dt><span class="term"><code class="option">--force-index-cleanup</code></span></dt><dd><p>Всегда удалять элементы индекса, указывающие на мёртвые кортежи.</p></dd><dt><span class="term"><code class="option">-j <em class="replaceable"><code>число_заданий</code></em></code><br /></span><span class="term"><code class="option">--jobs=<em class="replaceable"><code>число_заданий</code></em></code></span></dt><dd><p>Выполнять команды очистки и анализа в параллельном режиме, запуская их одновременно в количестве <em class="replaceable"><code>число_заданий</code></em>. Это может сократить время обработки, но при этом увеличить нагрузку на сервер.</p><p><span class="application">vacuumdb</span> будет устанавливать несколько подключений к базе данных (в количестве <em class="replaceable"><code>число_заданий</code></em>), так что убедитесь в том, что значение <a class="xref" href="runtime-config-connection.html#GUC-MAX-CONNECTIONS">max_connections</a> достаточно велико, чтобы все эти подключения были приняты.</p><p>Заметьте, что использование этого режима с параметром <code class="option">-f</code> (<code class="literal">FULL</code>) может привести к отказам из-за взаимоблокировок, если параллельно начнут обрабатываться определённые системные каталоги.</p></dd><dt><span class="term"><code class="option">--min-mxid-age <em class="replaceable"><code>возраст_мультитранзакции</code></em></code></span></dt><dd><p>Выполнять команды очистки и анализа только для таблиц, имеющих не менее чем заданный <em class="replaceable"><code>возраст_мультитранзакции</code></em>. Этот параметр полезен для выбора таблиц, первоочередная обработка которых поможет предотвратить зацикливание идентификаторов мультитранзакций (см. <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-MULTIXACT-WRAPAROUND" title="25.1.5.1. Мультитранзакции и зацикливание">Подраздел 25.1.5.1</a>).</p><p>Применительно к данному параметру возрастом мультитранзакции для отношения считается наибольший из возрастов основного отношения и связанной с ним таблицы <acronym class="acronym">TOAST</acronym>, если она существует. Так как команды, выполняемые утилитой <span class="application">vacuumdb</span>, будут при необходимости обрабатывать не только отношение, но и таблицу <acronym class="acronym">TOAST</acronym>, связанную с ним, рассматривать их возрасты по отдельности не имеет смысла.</p></dd><dt><span class="term"><code class="option">--min-xid-age <em class="replaceable"><code>возраст_транзакции</code></em></code></span></dt><dd><p>Выполнять команды очистки и анализа только для таблиц, имеющих не менее чем заданный <em class="replaceable"><code>возраст_транзакции</code></em>. Этот параметр полезен для выбора таблиц, обработка которых в первую очередь поможет предотвратить зацикливание идентификаторов транзакций (см. <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="25.1.5. Предотвращение ошибок из-за зацикливания счётчика транзакций">Подраздел 25.1.5</a>).</p><p>Применительно к данному параметру возрастом транзакции для отношения считается наибольший из возрастов основного отношения и связанной с ним таблицы <acronym class="acronym">TOAST</acronym>, если она существует. Так как команды, выполняемые утилитой <span class="application">vacuumdb</span>, будут при необходимости обрабатывать не только отношение, но и таблицу <acronym class="acronym">TOAST</acronym>, связанную с ним, рассматривать их возрасты по отдельности не имеет смысла.</p></dd><dt><span class="term"><code class="option">-n <em class="replaceable"><code>схема</code></em></code><br /></span><span class="term"><code class="option">--schema=<em class="replaceable"><code>схема</code></em></code></span></dt><dd><p>Производить очистку или анализ всех таблиц только в одной <em class="replaceable"><code>схеме</code></em>. Добавив дополнительные ключи <code class="option">-n</code>, можно очистить таблицы в нескольких схемах.</p></dd><dt><span class="term"><code class="option">-N <em class="replaceable"><code>схема</code></em></code><br /></span><span class="term"><code class="option">--exclude-schema=<em class="replaceable"><code>схема</code></em></code></span></dt><dd><p>Не производить очистку или анализ каких-либо таблиц в указанной <em class="replaceable"><code>схеме</code></em>. Добавив дополнительные ключи <code class="option">-N</code>, можно исключить из очистки таблицы в нескольких схемах.</p></dd><dt><span class="term"><code class="option">--no-index-cleanup</code></span></dt><dd><p>Не удалять элементы индекса, указывающие на мёртвые кортежи.</p></dd><dt><span class="term"><code class="option">--no-process-main</code></span></dt><dd><p>Пропускать основное отношение.</p></dd><dt><span class="term"><code class="option">--no-process-toast</code></span></dt><dd><p>Пропускать TOAST-таблицу, связанную с очищаемой таблицей (при наличии).</p></dd><dt><span class="term"><code class="option">--no-truncate</code></span></dt><dd><p>Не отсекать пустые страницы в конце таблицы.</p></dd><dt><span class="term"><code class="option">-P <em class="replaceable"><code>параллельные_исполнители</code></em></code><br /></span><span class="term"><code class="option">--parallel=<em class="replaceable"><code>параллельные_исполнители</code></em></code></span></dt><dd><p>Задаёт количество параллельных исполнителей для <em class="firstterm">параллельной очистки</em>. Это позволяет в ходе очистки задействовать мощности нескольких процессоров для обработки индексов. См. <a class="xref" href="sql-vacuum.html" title="VACUUM"><span class="refentrytitle">VACUUM</span></a>.</p></dd><dt><span class="term"><code class="option">-q</code><br /></span><span class="term"><code class="option">--quiet</code></span></dt><dd><p>Подавлять вывод сообщений о прогрессе выполнения.</p></dd><dt><span class="term"><code class="option">--skip-locked</code></span></dt><dd><p>Пропускать отношения, которые не удаётся немедленно заблокировать для обработки.</p></dd><dt><span class="term"><code class="option">-t <em class="replaceable"><code>таблица</code></em> [ (<em class="replaceable"><code>столбец</code></em> [,...]) ]</code><br /></span><span class="term"><code class="option">--table=<em class="replaceable"><code>таблица</code></em> [ (<em class="replaceable"><code>столбец</code></em> [,...]) ]</code></span></dt><dd><p>Производить очистку или анализ только указанной <em class="replaceable"><code>таблицы</code></em>. Имена столбцов можно указать только в сочетании с параметрами <code class="option">--analyze</code> и <code class="option">--analyze-only</code>. Добавив дополнительные ключи <code class="option">-t</code>, можно обработать несколько таблиц.</p><div class="tip"><h3 class="title">Подсказка</h3><p>Если вы указываете столбцы, вам, вероятно, придётся экранировать скобки в оболочке. (См. примеры ниже.)</p></div></dd><dt><span class="term"><code class="option">-v</code><br /></span><span class="term"><code class="option">--verbose</code></span></dt><dd><p>Вывести подробную информацию во время процесса.</p></dd><dt><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span></dt><dd><p>Сообщить версию <span class="application">vacuumdb</span> и завершиться.</p></dd><dt><span class="term"><code class="option">-z</code><br /></span><span class="term"><code class="option">--analyze</code></span></dt><dd><p>Также вычислить статистику для оптимизатора.</p></dd><dt><span class="term"><code class="option">-Z</code><br /></span><span class="term"><code class="option">--analyze-only</code></span></dt><dd><p>Только вычислить статистику для оптимизатора (не производить очистку).</p></dd><dt><span class="term"><code class="option">--analyze-in-stages</code></span></dt><dd><p>Только вычислить статистику для оптимизатора (без очистки), подобно <code class="option">--analyze-only</code>. При этом анализ выполняется в три этапа: на первом этапе для скорейшего получения полезной статистики используется минимально возможный ориентир статистики (см. <a class="xref" href="runtime-config-query.html#GUC-DEFAULT-STATISTICS-TARGET">default_statistics_target</a>), а на последующих этапах вычисляется полная статистика.</p><p>Этот параметр полезен, только когда нужно провести анализ базы данных, статистика в которой отсутствует или абсолютно неактуальна, например когда база была только что наполнена данными из копии или в результате процедуры <code class="command">pg_upgrade</code>. Имейте в виду, что использование этого параметра для базы, в которой уже есть статистика, может привести к тому, что качество решений оптимизатора может временно ухудшиться из-за небольших ориентиров статистики на ранних этапах.</p></dd><dt><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help</code></span></dt><dd><p>Показать справку по аргументам командной строки <span class="application">vacuumdb</span> и завершиться.</p></dd></dl></div><p>Утилита <span class="application">vacuumdb</span> также принимает следующие аргументы командной строки в качестве параметров подключения: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-h <em class="replaceable"><code>сервер</code></em></code><br /></span><span class="term"><code class="option">--host=<em class="replaceable"><code>сервер</code></em></code></span></dt><dd><p>Указывает имя компьютера, на котором работает сервер. Если значение начинается с косой черты, оно определяет каталог Unix-сокета.</p></dd><dt><span class="term"><code class="option">-p <em class="replaceable"><code>порт</code></em></code><br /></span><span class="term"><code class="option">--port=<em class="replaceable"><code>порт</code></em></code></span></dt><dd><p>Указывает TCP-порт или расширение файла локального Unix-сокета, через который сервер принимает подключения.</p></dd><dt><span class="term"><code class="option">-U <em class="replaceable"><code>имя_пользователя</code></em></code><br /></span><span class="term"><code class="option">--username=<em class="replaceable"><code>имя_пользователя</code></em></code></span></dt><dd><p>Имя пользователя, под которым производится подключение.</p></dd><dt><span class="term"><code class="option">-w</code><br /></span><span class="term"><code class="option">--no-password</code></span></dt><dd><p>Не выдавать запрос на ввод пароля. Если сервер требует аутентификацию по паролю и пароль не доступен с помощью других средств, таких как файл <code class="filename">.pgpass</code>, попытка соединения не удастся. Этот параметр может быть полезен в пакетных заданиях и скриптах, где нет пользователя, который вводит пароль.</p></dd><dt><span class="term"><code class="option">-W</code><br /></span><span class="term"><code class="option">--password</code></span></dt><dd><p>Принудительно запрашивать пароль перед подключением к базе данных.</p><p>Это несущественный параметр, так как <span class="application">vacuumdb</span> запрашивает пароль автоматически, если сервер проверяет подлинность по паролю. Однако чтобы понять это, <span class="application">vacuumdb</span> лишний раз подключается к серверу. Поэтому иногда имеет смысл ввести <code class="option">-W</code>, чтобы исключить эту ненужную попытку подключения.</p></dd><dt><span class="term"><code class="option">--maintenance-db=<em class="replaceable"><code>имя_бд</code></em></code></span></dt><dd><p>Указывает имя базы данных, к которой будет выполняться подключение для определения подлежащих очистке баз данных, когда используется ключ <code class="option">-a</code>/<code class="option">--all</code>. Если это имя не указано, будет выбрана база <code class="literal">postgres</code>, а если она не существует — <code class="literal">template1</code>. В данном аргументе может задаваться <a class="link" href="libpq-connect.html#LIBPQ-CONNSTRING" title="34.1.1. Строки параметров подключения">строка подключения</a>. В этом случае параметры в строке подключения переопределяют одноимённые параметры, заданные в командной строке. Кроме того, все параметры в строке подключения, за исключением имени базы, будут использоваться и при подключении к другим базам данных.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.4.22.7"><h2>Переменные окружения</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="envar">PGDATABASE</code><br /></span><span class="term"><code class="envar">PGHOST</code><br /></span><span class="term"><code class="envar">PGPORT</code><br /></span><span class="term"><code class="envar">PGUSER</code></span></dt><dd><p>Параметры подключения по умолчанию</p></dd><dt><span class="term"><code class="envar">PG_COLOR</code></span></dt><dd><p>Выбирает вариант использования цвета в диагностических сообщениях. Возможные значения: <code class="literal">always</code> (всегда), <code class="literal">auto</code> (автоматически) и <code class="literal">never</code> (никогда).</p></dd></dl></div><p>Эта утилита, как и большинство других утилит <span class="productname">PostgreSQL</span>, также использует переменные среды, поддерживаемые <span class="application">libpq</span> (см. <a class="xref" href="libpq-envars.html" title="34.15. Переменные окружения">Раздел 34.15</a>).</p></div><div class="refsect1" id="id-1.9.4.22.8"><h2>Диагностика</h2><p>В случае возникновения трудностей, обратитесь к описаниям <a class="xref" href="sql-vacuum.html" title="VACUUM"><span class="refentrytitle">VACUUM</span></a> и <a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a>, где обсуждаются потенциальные проблемы и сообщения об ошибках. Учтите, что на целевом компьютере должен работать сервер баз данных. При этом применяются все свойства подключения по умолчанию и переменные окружения, которые использует клиентская библиотека <span class="application">libpq</span>.</p></div><div class="refsect1" id="id-1.9.4.22.9"><h2>Замечания</h2><p>Утилите <span class="application">vacuumdb</span> может потребоваться подключаться к серверу <span class="productname">PostgreSQL</span> несколько раз, и при этом она будет каждый раз запрашивать пароль. В таких случаях удобно иметь файл <code class="filename">~/.pgpass</code>. За дополнительными сведениями обратитесь к <a class="xref" href="libpq-pgpass.html" title="34.16. Файл паролей">Разделу 34.16</a>.</p></div><div class="refsect1" id="id-1.9.4.22.10"><h2>Примеры</h2><p>Очистка базы данных <code class="literal">test</code>: </p><pre class="screen">
<code class="prompt">$ </code><strong class="userinput"><code>vacuumdb test</code></strong>
</pre><p>Очистка и анализ для оптимизатора базы данных <code class="literal">bigdb</code>: </p><pre class="screen">
<code class="prompt">$ </code><strong class="userinput"><code>vacuumdb --analyze bigdb</code></strong>
</pre><p>Очистка одной таблицы <code class="literal">foo</code> в базе данных <code class="literal">xyzzy</code> и анализ только столбца <code class="literal">bar</code> таблицы для оптимизатора: </p><pre class="screen">
<code class="prompt">$ </code><strong class="userinput"><code>vacuumdb --analyze --verbose --table='foo(bar)' xyzzy</code></strong>
</pre><p>Очистка всех таблиц в схемах <code class="literal">foo</code> и <code class="literal">bar</code> в базе данных <code class="literal">xyzzy</code>: </p><pre class="screen">
<code class="prompt">$ </code><strong class="userinput"><code>vacuumdb --schema='foo' --schema='bar' xyzzy</code></strong>
</pre></div><div class="refsect1" id="id-1.9.4.22.11"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-vacuum.html" title="VACUUM"><span class="refentrytitle">VACUUM</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="app-reindexdb.html" title="reindexdb">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="reference-server.html" title="Серверные приложения PostgreSQL">След.</a></td></tr><tr><td width="40%" align="left" valign="top"><span class="application">reindexdb</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> Серверные приложения PostgreSQL</td></tr></table></div></body></html>