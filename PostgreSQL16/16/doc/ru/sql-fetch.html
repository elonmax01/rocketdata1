<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>FETCH</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-explain.html" title="EXPLAIN" /><link rel="next" href="sql-grant.html" title="GRANT" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">FETCH</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-explain.html" title="EXPLAIN">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><th width="60%" align="center">Команды SQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-grant.html" title="GRANT">След.</a></td></tr></table><hr /></div><div class="refentry" id="SQL-FETCH"><div class="titlepage"></div><a id="id-1.9.3.149.1" class="indexterm"></a><a id="id-1.9.3.149.2" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">FETCH</span></h2><p>FETCH — получить результат запроса через курсор</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">FETCH [ <em class="replaceable"><code>направление</code></em> ] [ FROM | IN ] <em class="replaceable"><code>имя_курсора</code></em>

<span class="phrase">Здесь допускается <em class="replaceable"><code>направление</code></em>:</span>

    NEXT
    PRIOR
    FIRST
    LAST
    ABSOLUTE <em class="replaceable"><code>число</code></em>
    RELATIVE <em class="replaceable"><code>число</code></em>
    <em class="replaceable"><code>число</code></em>
    ALL
    FORWARD
    FORWARD <em class="replaceable"><code>число</code></em>
    FORWARD ALL
    BACKWARD
    BACKWARD <em class="replaceable"><code>число</code></em>
    BACKWARD ALL</pre></div><div class="refsect1" id="id-1.9.3.149.6"><h2>Описание</h2><p><code class="command">FETCH</code> получает строки через ранее созданный курсор.</p><p>Курсор связан с определённым положением, что и использует команда <code class="command">FETCH</code>. Курсор может располагаться перед первой строкой результата запроса, на любой строке этого результата, либо после последней строки. При создании курсор оказывается перед первой строкой. Когда <code class="command">FETCH</code> доходит до конца набора строк, курсор остаётся в положении после последней строки, либо перед первой, при движении назад. После команд <code class="command">FETCH ALL</code> и <code class="command">FETCH BACKWARD ALL</code> курсор всегда оказывается после последней строки или перед первой, соответственно.</p><p>Формы <code class="literal">NEXT</code>, <code class="literal">PRIOR</code>, <code class="literal">FIRST</code>, <code class="literal">LAST</code>, <code class="literal">ABSOLUTE</code> и <code class="literal">RELATIVE</code> выбирают одну строку после соответствущего перемещения курсора. Если в этом положении строки не оказывается, возвращается пустой результат, а курсор остаётся в достигнутом положении перед первой строкой или после последней.</p><p>Формы <code class="literal">FORWARD</code> и <code class="literal">BACKWARD</code> получают указанное число строк, сдвигаясь соответственно вперёд или назад; в результате курсор оказывается на последней выданной строке (или перед/после всех строк, если <em class="replaceable"><code>число</code></em> превышает количество доступных строк).</p><p>Формы <code class="literal">RELATIVE 0</code>, <code class="literal">FORWARD 0</code> и <code class="literal">BACKWARD 0</code> действуют одинаково — они считывают текущую строку, не перемещая курсор, то есть, повторно выбирая строку, выбранную последней. Эта операция будет успешна, только если курсор не расположен до первой или после последней строки; в этом случае строка возвращена не будет.</p><div class="note"><h3 class="title">Примечание</h3><p>На этой странице описывается применение курсоров на уровне команд SQL. Если вы попытаетесь использовать курсоры внутри функции <span class="application">PL/pgSQL</span>, правила будут другими — см. <a class="xref" href="plpgsql-cursors.html#PLPGSQL-CURSOR-USING" title="43.7.3. Использование курсоров">Подраздел 43.7.3</a>.</p></div></div><div class="refsect1" id="id-1.9.3.149.7"><h2>Параметры</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>направление</code></em></span></dt><dd><p>Параметр <em class="replaceable"><code>направление</code></em> задаёт направление движения и число выбираемых строк. Он может принимать одно из следующих значений: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">NEXT</code></span></dt><dd><p>Выбрать следующую строку. Это действие подразумевается по умолчанию, если <em class="replaceable"><code>направление</code></em> опущено.</p></dd><dt><span class="term"><code class="literal">PRIOR</code></span></dt><dd><p>Выбрать предыдущую строку.</p></dd><dt><span class="term"><code class="literal">FIRST</code></span></dt><dd><p>Выбрать первую строку запроса (аналогично указанию <code class="literal">ABSOLUTE 1</code>).</p></dd><dt><span class="term"><code class="literal">LAST</code></span></dt><dd><p>Выбрать последнюю строку запроса (аналогично <code class="literal">ABSOLUTE -1</code>).</p></dd><dt><span class="term"><code class="literal">ABSOLUTE <em class="replaceable"><code>число</code></em></code></span></dt><dd><p>Выбрать строку под номером <em class="replaceable"><code>число</code></em> с начала, либо под номером <code class="literal">abs(<em class="replaceable"><code>число</code></em>)</code> с конца, если <em class="replaceable"><code>число</code></em> отрицательно. Если <em class="replaceable"><code>число</code></em> выходит за границы набора строк, курсор размещается перед первой или после последней строки; в частности, с <code class="literal">ABSOLUTE 0</code> курсор оказывается перед первой строкой.</p></dd><dt><span class="term"><code class="literal">RELATIVE <em class="replaceable"><code>число</code></em></code></span></dt><dd><p>Выбрать строку под номером <em class="replaceable"><code>число</code></em>, считая со следующей вперёд, либо под номером <code class="literal">abs(<em class="replaceable"><code>число</code></em>)</code>, считая с предыдущей назад, если <em class="replaceable"><code>число</code></em> отрицательно. <code class="literal">RELATIVE 0</code> повторно считывает текущую строку, если таковая имеется.</p></dd><dt><span class="term"><em class="replaceable"><code>число</code></em></span></dt><dd><p>Выбрать следующее <em class="replaceable"><code>число</code></em> строк (аналогично <code class="literal">FORWARD <em class="replaceable"><code>число</code></em></code>).</p></dd><dt><span class="term"><code class="literal">ALL</code></span></dt><dd><p>Выбрать все оставшиеся строки (аналогично <code class="literal">FORWARD ALL</code>).</p></dd><dt><span class="term"><code class="literal">FORWARD</code></span></dt><dd><p>Выбрать следующую строку (аналогично <code class="literal">NEXT</code>).</p></dd><dt><span class="term"><code class="literal">FORWARD <em class="replaceable"><code>число</code></em></code></span></dt><dd><p>Выбрать следующее <em class="replaceable"><code>число</code></em> строк. <code class="literal">FORWARD 0</code> повторно выбирает текущую строку.</p></dd><dt><span class="term"><code class="literal">FORWARD ALL</code></span></dt><dd><p>Выбрать все оставшиеся строки.</p></dd><dt><span class="term"><code class="literal">BACKWARD</code></span></dt><dd><p>Выбрать предыдущую строку (аналогично <code class="literal">PRIOR</code>).</p></dd><dt><span class="term"><code class="literal">BACKWARD <em class="replaceable"><code>число</code></em></code></span></dt><dd><p>Выбрать предыдущее <em class="replaceable"><code>число</code></em> строк (с перемещением назад). <code class="literal">BACKWARD 0</code> повторно выбирает текущую строку.</p></dd><dt><span class="term"><code class="literal">BACKWARD ALL</code></span></dt><dd><p>Выбрать все предыдущие строки (с перемещением назад).</p></dd></dl></div></dd><dt><span class="term"><em class="replaceable"><code>число</code></em></span></dt><dd><p>Здесь <em class="replaceable"><code>число</code></em> — целочисленная константа, возможно со знаком, определяющая смещение или количество выбираемых строк. Для вариантов <code class="literal">FORWARD</code> и <code class="literal">BACKWARD</code> указание отрицательного <em class="replaceable"><code>числа</code></em> равнозначно смене направления <code class="literal">FORWARD</code> на <code class="literal">BACKWARD</code> и наоборот.</p></dd><dt><span class="term"><em class="replaceable"><code>имя_курсора</code></em></span></dt><dd><p>Имя открытого курсора.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.3.149.8"><h2>Выводимая информация</h2><p>При успешном выполнении <code class="command">FETCH</code> возвращает метку команды вида </p><pre class="screen">
FETCH <em class="replaceable"><code>число</code></em>
</pre><p> Здесь <em class="replaceable"><code>count</code></em> — количество выбранных строк (может быть и нулевым). Заметьте, что в <span class="application">psql</span> метка команды не выдаётся, так как вместо неё <span class="application">psql</span> выводит выбранные строки.</p></div><div class="refsect1" id="id-1.9.3.149.9"><h2>Замечания</h2><p>Если перемещение курсора в <code class="command">FETCH</code> не ограничивается вариантами <code class="command">FETCH NEXT</code> или <code class="command">FETCH FORWARD</code> с положительным числом, курсор должен быть объявлен с указанием <code class="literal">SCROLL</code>. Для простых запросов <span class="productname">PostgreSQL</span> допускает обратное перемещение курсора, объявленного без <code class="literal">SCROLL</code>, но на это поведение лучше не рассчитывать. Если курсор объявлен с указанием <code class="literal">NO SCROLL</code>, перемещение назад запрещается.</p><p>Вариант <code class="literal">ABSOLUTE</code> нисколько не быстрее, чем перемещение к требуемой строке с относительным сдвигом: нижележащий механизм всё равно должен прочитать все промежуточные строки. Выборки по абсолютному отрицательному положению ещё хуже: сначала запрос необходимо прочитать до конца и найти последнюю строку, а затем вернуться назад к указанной строке. Однако перемотка к началу запроса (<code class="literal">FETCH ABSOLUTE 0</code>) выполняется быстро.</p><p>Определить курсор позволяет команда <a class="link" href="sql-declare.html" title="DECLARE"><code class="command">DECLARE</code></a>, а переместить его, не читая данные, — команда <a class="link" href="sql-move.html" title="MOVE"><code class="command">MOVE</code></a>.</p></div><div class="refsect1" id="id-1.9.3.149.10"><h2>Примеры</h2><p>Следующий пример демонстрирует перемещение курсора в таблице: </p><pre class="programlisting">BEGIN WORK;

-- Создание курсора:
DECLARE liahona SCROLL CURSOR FOR SELECT * FROM films;

-- Получение первых 5 строк через курсор liahona:
FETCH FORWARD 5 FROM liahona;

 code  |          title          | did | date_prod  |   kind   |  len
-------+-------------------------+-----+------------+----------+-------
 BL101 | The Third Man           | 101 | 1949-12-23 | Drama    | 01:44
 BL102 | The African Queen       | 101 | 1951-08-11 | Romantic | 01:43
 JL201 | Une Femme est une Femme | 102 | 1961-03-12 | Romantic | 01:25
 P_301 | Vertigo                 | 103 | 1958-11-14 | Action   | 02:08
 P_302 | Becket                  | 103 | 1964-02-03 | Drama    | 02:28

-- Получение предыдущей строки:
FETCH PRIOR FROM liahona;

 code  |  title  | did | date_prod  |  kind  |  len
-------+---------+-----+------------+--------+-------
 P_301 | Vertigo | 103 | 1958-11-14 | Action | 02:08

-- Закрытие курсора и завершение транзакции:
CLOSE liahona;
COMMIT WORK;</pre></div><div class="refsect1" id="id-1.9.3.149.11"><h2>Совместимость</h2><p>В стандарте SQL команда <code class="command">FETCH</code> определена только для встраиваемого SQL. Описанная здесь реализация <code class="command">FETCH</code> возвращает данные подобно оператору <code class="command">SELECT</code>, а не помещает их в переменные исполняющей среды. В остальном, <code class="command">FETCH</code> полностью прямо-совместима со стандартом SQL.</p><p>Формы <code class="command">FETCH</code> с <code class="literal">FORWARD</code> и <code class="literal">BACKWARD</code>, а также формы <code class="literal">FETCH <em class="replaceable"><code>число</code></em></code> и <code class="literal">FETCH ALL</code> (в которых <code class="literal">FORWARD</code> подразумевается) являются расширениями <span class="productname">PostgreSQL</span>.</p><p>В стандарте SQL перед именем курсора допускается только указание <code class="literal">FROM</code>; возможность указать <code class="literal">IN</code> или опустить оба указания относится к расширениям.</p></div><div class="refsect1" id="id-1.9.3.149.12"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-close.html" title="CLOSE"><span class="refentrytitle">CLOSE</span></a>, <a class="xref" href="sql-declare.html" title="DECLARE"><span class="refentrytitle">DECLARE</span></a>, <a class="xref" href="sql-move.html" title="MOVE"><span class="refentrytitle">MOVE</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-explain.html" title="EXPLAIN">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-grant.html" title="GRANT">След.</a></td></tr><tr><td width="40%" align="left" valign="top">EXPLAIN </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> GRANT</td></tr></table></div></body></html>