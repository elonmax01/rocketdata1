<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>20.10. Автоматическая очистка</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="runtime-config-statistics.html" title="20.9. Статистика времени выполнения" /><link rel="next" href="runtime-config-client.html" title="20.11. Параметры клиентских сеансов по умолчанию" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">20.10. Автоматическая очистка</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="runtime-config-statistics.html" title="20.9. Статистика времени выполнения">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime-config.html" title="Глава 20. Настройка сервера">Наверх</a></td><th width="60%" align="center">Глава 20. Настройка сервера</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="runtime-config-client.html" title="20.11. Параметры клиентских сеансов по умолчанию">След.</a></td></tr></table><hr /></div><div class="sect1" id="RUNTIME-CONFIG-AUTOVACUUM"><div class="titlepage"><div><div><h2 class="title" style="clear: both">20.10. Автоматическая очистка <a href="#RUNTIME-CONFIG-AUTOVACUUM" class="id_link">#</a></h2></div></div></div><a id="id-1.6.7.13.2" class="indexterm"></a><p>Эти параметры управляют поведением механизма <em class="firstterm">автоочистки</em>. За дополнительными сведениями обратитесь к <a class="xref" href="routine-vacuuming.html#AUTOVACUUM" title="25.1.6. Демон автоочистки">Подразделу 25.1.6</a>. Заметьте, что многие из этих параметров могут быть переопределены на уровне таблиц; см. <a class="xref" href="sql-createtable.html#SQL-CREATETABLE-STORAGE-PARAMETERS" title="Параметры хранения">Параметры хранения</a>.</p><div class="variablelist"><dl class="variablelist"><dt id="GUC-AUTOVACUUM"><span class="term"><code class="varname">autovacuum</code> (<code class="type">boolean</code>) <a id="id-1.6.7.13.4.1.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM" class="id_link">#</a></dt><dd><p>Управляет состоянием демона, запускающего автоочистку. По умолчанию он включён, но чтобы автоочистка работала, нужно также включить <a class="xref" href="runtime-config-statistics.html#GUC-TRACK-COUNTS">track_counts</a>. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако автоочистку можно отключить для отдельных таблиц, изменив их параметры хранения.</p><p>Заметьте, что даже если этот параметр отключён, система будет запускать процессы автоочистки, когда это необходимо для предотвращения зацикливания идентификаторов транзакций. За дополнительными сведениями обратитесь к <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="25.1.5. Предотвращение ошибок из-за зацикливания счётчика транзакций">Подразделу 25.1.5</a>.</p></dd><dt id="GUC-AUTOVACUUM-MAX-WORKERS"><span class="term"><code class="varname">autovacuum_max_workers</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.2.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-MAX-WORKERS" class="id_link">#</a></dt><dd><p>Задаёт максимальное число процессов автоочистки (не считая процесс, запускающий автоочистку), которые могут выполняться одновременно. По умолчанию это число равно трём. Задать этот параметр можно только при запуске сервера.</p></dd><dt id="GUC-AUTOVACUUM-NAPTIME"><span class="term"><code class="varname">autovacuum_naptime</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.3.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-NAPTIME" class="id_link">#</a></dt><dd><p>Задаёт минимальную задержку между двумя запусками автоочистки для отдельной базы данных. Демон автоочистки проверяет базу данных через заданный интервал времени и выдаёт команды <code class="command">VACUUM</code> и <code class="command">ANALYZE</code>, когда это требуется для таблиц этой базы. Если это значение задаётся без единиц измерения, оно считается заданным в секундах. По умолчанию задержка равна одной минуте (<code class="literal">1min</code>). Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера.</p></dd><dt id="GUC-AUTOVACUUM-VACUUM-THRESHOLD"><span class="term"><code class="varname">autovacuum_vacuum_threshold</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.4.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-VACUUM-THRESHOLD" class="id_link">#</a></dt><dd><p>Задаёт минимальное число изменённых или удалённых кортежей, при котором будет выполняться <code class="command">VACUUM</code> для отдельно взятой таблицы. Значение по умолчанию — 50 кортежей. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt id="GUC-AUTOVACUUM-VACUUM-INSERT-THRESHOLD"><span class="term"><code class="varname">autovacuum_vacuum_insert_threshold</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.5.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-VACUUM-INSERT-THRESHOLD" class="id_link">#</a></dt><dd><p>Задаёт число добавленных кортежей, при достижении которого будет выполняться <code class="command">VACUUM</code> для отдельно взятой таблицы. Значение по умолчанию — 1000 кортежей. При значении -1 процедура автоочистки не будет производить операции <code class="command">VACUUM</code> с таблицами в зависимости от числа добавленных строк. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt id="GUC-AUTOVACUUM-ANALYZE-THRESHOLD"><span class="term"><code class="varname">autovacuum_analyze_threshold</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.6.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-ANALYZE-THRESHOLD" class="id_link">#</a></dt><dd><p>Задаёт минимальное число добавленных, изменённых или удалённых кортежей, при котором будет выполняться <code class="command">ANALYZE</code> для отдельно взятой таблицы. Значение по умолчанию — 50 кортежей. Этот параметр можно задать только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt id="GUC-AUTOVACUUM-VACUUM-SCALE-FACTOR"><span class="term"><code class="varname">autovacuum_vacuum_scale_factor</code> (<code class="type">floating point</code>) <a id="id-1.6.7.13.4.7.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-VACUUM-SCALE-FACTOR" class="id_link">#</a></dt><dd><p>Задаёт процент от размера таблицы, который будет добавляться к <code class="varname">autovacuum_vacuum_threshold</code> при выборе порога срабатывания команды <code class="command">VACUUM</code>. Значение по умолчанию — 0.2 (20% от размера таблицы). Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt id="GUC-AUTOVACUUM-VACUUM-INSERT-SCALE-FACTOR"><span class="term"><code class="varname">autovacuum_vacuum_insert_scale_factor</code> (<code class="type">floating point</code>) <a id="id-1.6.7.13.4.8.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-VACUUM-INSERT-SCALE-FACTOR" class="id_link">#</a></dt><dd><p>Задаёт процент от размера таблицы, который будет добавляться к <code class="varname">autovacuum_vacuum_insert_threshold</code> при выборе порога срабатывания команды <code class="command">VACUUM</code>. Значение по умолчанию — 0.2 (20% от размера таблицы). Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt id="GUC-AUTOVACUUM-ANALYZE-SCALE-FACTOR"><span class="term"><code class="varname">autovacuum_analyze_scale_factor</code> (<code class="type">floating point</code>) <a id="id-1.6.7.13.4.9.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-ANALYZE-SCALE-FACTOR" class="id_link">#</a></dt><dd><p>Задаёт процент от размера таблицы, который будет добавляться к <code class="varname">autovacuum_analyze_threshold</code> при выборе порога срабатывания команды <code class="command">ANALYZE</code>. Значение по умолчанию — 0.1 (10% от размера таблицы). Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако данное значение можно переопределить для избранных таблиц, изменив их параметры хранения.</p></dd><dt id="GUC-AUTOVACUUM-FREEZE-MAX-AGE"><span class="term"><code class="varname">autovacuum_freeze_max_age</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.10.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-FREEZE-MAX-AGE" class="id_link">#</a></dt><dd><p>Задаёт максимальный возраст (в транзакциях) для поля <code class="structname">pg_class</code>.<code class="structfield">relfrozenxid</code> некоторой таблицы, при достижении которого будет запущена операция <code class="command">VACUUM</code> для предотвращения зацикливания идентификаторов транзакций в этой таблице. Заметьте, что система запустит процессы автоочистки для предотвращения зацикливания, даже если для всех других целей автоочистка отключена.</p><p>При очистке могут также удаляться старые файлы из подкаталога <code class="filename">pg_xact</code>, поэтому значение по умолчанию сравнительно мало — 200 миллионов транзакций. Задать этот параметр можно только при запуске сервера, но для отдельных таблиц его можно определить по-другому, изменив их параметры хранения. За дополнительными сведениями обратитесь к <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="25.1.5. Предотвращение ошибок из-за зацикливания счётчика транзакций">Подразделу 25.1.5</a>.</p></dd><dt id="GUC-AUTOVACUUM-MULTIXACT-FREEZE-MAX-AGE"><span class="term"><code class="varname">autovacuum_multixact_freeze_max_age</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.11.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-MULTIXACT-FREEZE-MAX-AGE" class="id_link">#</a></dt><dd><p>Задаёт максимальный возраст (в мультитранзакциях) для поля <code class="structname">pg_class</code>.<code class="structfield">relminmxid</code> таблицы, при достижении которого будет запущена операция <code class="command">VACUUM</code> для предотвращения зацикливания идентификаторов мультитранзакций в этой таблице. Заметьте, что система запустит процессы автоочистки для предотвращения зацикливания, даже если для всех других целей автоочистка отключена.</p><p>При очистке мультитранзакций могут также удаляться старые файлы из подкаталогов <code class="filename">pg_multixact/members</code> и <code class="filename">pg_multixact/offsets</code>, поэтому значение по умолчанию сравнительно мало — 400 миллионов мультитранзакций. Этот параметр можно задать только при запуске сервера, но для отдельных таблиц его можно определить по-другому, изменив их параметры хранения. За дополнительными сведениями обратитесь к <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-MULTIXACT-WRAPAROUND" title="25.1.5.1. Мультитранзакции и зацикливание">Подразделу 25.1.5.1</a>.</p></dd><dt id="GUC-AUTOVACUUM-VACUUM-COST-DELAY"><span class="term"><code class="varname">autovacuum_vacuum_cost_delay</code> (<code class="type">floating point</code>) <a id="id-1.6.7.13.4.12.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-VACUUM-COST-DELAY" class="id_link">#</a></dt><dd><p>Задаёт задержку при превышении предела стоимости, которая будет применяться при автоматических операциях <code class="command">VACUUM</code>. Если это значение задаётся без единиц измерения, оно считается заданным в миллисекундах. При значении -1 применяется обычная задержка <a class="xref" href="runtime-config-resource.html#GUC-VACUUM-COST-DELAY">vacuum_cost_delay</a>. Значение по умолчанию — 2 миллисекунды. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако его можно переопределить для отдельных таблиц, изменив их параметры хранения.</p></dd><dt id="GUC-AUTOVACUUM-VACUUM-COST-LIMIT"><span class="term"><code class="varname">autovacuum_vacuum_cost_limit</code> (<code class="type">integer</code>) <a id="id-1.6.7.13.4.13.1.3" class="indexterm"></a></span> <a href="#GUC-AUTOVACUUM-VACUUM-COST-LIMIT" class="id_link">#</a></dt><dd><p>Задаёт предел стоимости, который будет учитываться при автоматических операциях <code class="command">VACUUM</code>. При значении -1 (по умолчанию) применяется обычное значение <a class="xref" href="runtime-config-resource.html#GUC-VACUUM-COST-LIMIT">vacuum_cost_limit</a>. Заметьте, что это значение распределяется пропорционально среди всех работающих процессов автоочистки, если их больше одного, так что сумма ограничений всех процессов никогда не превосходит данный предел. Задать этот параметр можно только в <code class="filename">postgresql.conf</code> или в командной строке при запуске сервера. Однако его можно переопределить для отдельных таблиц, изменив их параметры хранения.</p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-statistics.html" title="20.9. Статистика времени выполнения">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html" title="Глава 20. Настройка сервера">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-client.html" title="20.11. Параметры клиентских сеансов по умолчанию">След.</a></td></tr><tr><td width="40%" align="left" valign="top">20.9. Статистика времени выполнения </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 20.11. Параметры клиентских сеансов по умолчанию</td></tr></table></div></body></html>