<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>ALTER OPERATOR FAMILY</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-alteropclass.html" title="ALTER OPERATOR CLASS" /><link rel="next" href="sql-alterpolicy.html" title="ALTER POLICY" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">ALTER OPERATOR FAMILY</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-alteropclass.html" title="ALTER OPERATOR CLASS">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><th width="60%" align="center">Команды SQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-alterpolicy.html" title="ALTER POLICY">След.</a></td></tr></table><hr /></div><div class="refentry" id="SQL-ALTEROPFAMILY"><div class="titlepage"></div><a id="id-1.9.3.22.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">ALTER OPERATOR FAMILY</span></h2><p>ALTER OPERATOR FAMILY — изменить определение семейства операторов</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">ALTER OPERATOR FAMILY <em class="replaceable"><code>имя</code></em> USING <em class="replaceable"><code>индексный_метод</code></em> ADD
  {  OPERATOR <em class="replaceable"><code>номер_стратегии</code></em> <em class="replaceable"><code>имя_оператора</code></em> ( <em class="replaceable"><code>тип_операнда</code></em>, <em class="replaceable"><code>тип_операнда</code></em> )
              [ FOR SEARCH | FOR ORDER BY <em class="replaceable"><code>семейство_сортировки</code></em> ]
   | FUNCTION <em class="replaceable"><code>номер_опорной_функции</code></em> [ ( <em class="replaceable"><code>тип_операнда</code></em> [ , <em class="replaceable"><code>тип_операнда</code></em> ] ) ]
              <em class="replaceable"><code>имя_функции</code></em> [ ( <em class="replaceable"><code>тип_аргумента</code></em> [, ...] ) ]
  } [, ... ]

ALTER OPERATOR FAMILY <em class="replaceable"><code>имя</code></em> USING <em class="replaceable"><code>индексный_метод</code></em> DROP
  {  OPERATOR <em class="replaceable"><code>номер_стратегии</code></em> ( <em class="replaceable"><code>тип_операнда</code></em> [ , <em class="replaceable"><code>тип_операнда</code></em> ] )
   | FUNCTION <em class="replaceable"><code>номер_опорной_функции</code></em> ( <em class="replaceable"><code>тип_операнда</code></em> [ , <em class="replaceable"><code>тип_операнда</code></em> ] )
  } [, ... ]

ALTER OPERATOR FAMILY <em class="replaceable"><code>имя</code></em> USING <em class="replaceable"><code>индексный_метод</code></em>
    RENAME TO <em class="replaceable"><code>новое_имя</code></em>

ALTER OPERATOR FAMILY <em class="replaceable"><code>имя</code></em> USING <em class="replaceable"><code>индексный_метод</code></em>
    OWNER TO { <em class="replaceable"><code>новый_владелец</code></em> | CURRENT_ROLE | CURRENT_USER | SESSION_USER }

ALTER OPERATOR FAMILY <em class="replaceable"><code>имя</code></em> USING <em class="replaceable"><code>индексный_метод</code></em>
    SET SCHEMA <em class="replaceable"><code>новая_схема</code></em></pre></div><div class="refsect1" id="id-1.9.3.22.5"><h2>Описание</h2><p><code class="command">ALTER OPERATOR FAMILY</code> меняет определение семейства операторов. Она позволяет добавлять в семейство операторы и опорные функции, удалять их из семейства или менять имя и владельца семейства операторов.</p><p>Когда операторы и опорные функции добавляются в семейство с помощью <code class="command">ALTER OPERATOR FAMILY</code>, они не становятся частью какого-либо определённого класса операторов в семействе, а просто считаются <span class="quote">«<span class="quote">слабосвязанными</span>»</span> с семейством. Это показывает, что эти операторы и функции семантически совместимы с семейством, но не требуются для корректной работы какого-либо индекса. (Операторы и функции, которые действительно требуются для этого, должны быть включены не в семейство, а в класс операторов; см. <a class="xref" href="sql-createopclass.html" title="CREATE OPERATOR CLASS"><span class="refentrytitle">CREATE OPERATOR CLASS</span></a>.) <span class="productname">PostgreSQL</span> позволяет удалять слабосвязанные члены из семейства в любое время, но члены класса операторов не могут быть удалены, пока не будет удалён весь класс и все зависимые от него индексы. Обычно в классы операторов включаются операторы и функции, работающие с одним типом данным (так как они нужны для поддержки индексов данных такого типа), а межтиповые функции и операторы становятся слабосвязанными членами семейства.</p><p>Выполнить <code class="command">ALTER OPERATOR FAMILY</code> может только суперпользователь. (Это ограничение введено потому, что ошибочное определение семейства операторов может вызвать нарушения или даже сбой в работе сервера.)</p><p><code class="command">ALTER OPERATOR FAMILY</code> в настоящее время не проверяет, включает ли определение семейства операторов все операторы и функции, требуемые для индексного метода, и образуют ли они целостный набор. Ответственность за правильность определения семейства лежит на пользователе.</p><p>За дополнительными сведениями обратитесь к <a class="xref" href="xindex.html" title="38.16. Интерфейсы расширений для индексов">Разделу 38.16</a>.</p></div><div class="refsect1" id="id-1.9.3.22.6"><h2>Параметры</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>имя</code></em></span></dt><dd><p>Имя существующего семейства операторов (возможно, дополненное схемой).</p></dd><dt><span class="term"><em class="replaceable"><code>индексный_метод</code></em></span></dt><dd><p>Имя индексного метода, для которого предназначено это семейство операторов.</p></dd><dt><span class="term"><em class="replaceable"><code>номер_стратегии</code></em></span></dt><dd><p>Номер стратегии индексного метода для оператора, связанного с данным семейством операторов.</p></dd><dt><span class="term"><em class="replaceable"><code>имя_оператора</code></em></span></dt><dd><p>Имя (возможно, дополненное схемой) оператора, связанного с данным семейством операторов.</p></dd><dt><span class="term"><em class="replaceable"><code>тип_операнда</code></em></span></dt><dd><p>В предложении <code class="literal">OPERATOR</code> указывается тип(ы) данных оператора или <code class="literal">NONE</code>, если это префиксный оператор. В отличие от похожего синтаксиса в <code class="command">CREATE OPERATOR CLASS</code>, здесь типы операндов должны указываться всегда.</p><p>В предложении <code class="literal">ADD FUNCTION</code> это тип данных, который должна поддерживать эта функция, если он отличается от входного типа данных функции. Для функций сравнения B-деревьев и хеш-функций указывать <em class="replaceable"><code>тип_операнда</code></em> необязательно, так как их входные типы данных всегда будут подходящими. Однако для опорных функций сортировки и функций равенства образов в B-деревьях и всех функций в классах операторов GiST, SP-GiST и GIN необходимо указать тип(ы) операндов, с которыми будут использоваться эти функции.</p><p>В предложении <code class="literal">DROP FUNCTION</code> тип операнда, который должна поддерживать эта функция.</p></dd><dt><span class="term"><em class="replaceable"><code>семейство_сортировки</code></em></span></dt><dd><p>Имя (возможно, дополненное схемой) существующего семейства операторов <code class="literal">btree</code>, описывающего порядок сортировки, связанный с оператором сортировки.</p><p>Если не указано ни <code class="literal">FOR SEARCH</code> (для поиска), ни <code class="literal">FOR ORDER BY</code> (для сортировки), подразумевается <code class="literal">FOR SEARCH</code>.</p></dd><dt><span class="term"><em class="replaceable"><code>номер_опорной_функции</code></em></span></dt><dd><p>Номер опорной функции индексного метода для функции, связанной с данным семейством операторов.</p></dd><dt><span class="term"><em class="replaceable"><code>имя_функции</code></em></span></dt><dd><p>Имя (возможно, дополненное схемой) функции, которая является опорной функцией индексного метода для данного семейства операторов. Если список аргументов отсутствует, имя функции должно быть уникальным в её схеме.</p></dd><dt><span class="term"><em class="replaceable"><code>тип_аргумента</code></em></span></dt><dd><p>Тип данных параметра функции.</p></dd><dt><span class="term"><em class="replaceable"><code>новое_имя</code></em></span></dt><dd><p>Новое имя семейства операторов.</p></dd><dt><span class="term"><em class="replaceable"><code>новый_владелец</code></em></span></dt><dd><p>Новый владелец семейства операторов.</p></dd><dt><span class="term"><em class="replaceable"><code>новая_схема</code></em></span></dt><dd><p>Новая схема семейства операторов.</p></dd></dl></div><p>Предложения <code class="literal">OPERATOR</code> и <code class="literal">FUNCTION</code> могут указываться в любом порядке.</p></div><div class="refsect1" id="id-1.9.3.22.7"><h2>Замечания</h2><p>Заметьте, что в синтаксисе <code class="literal">DROP</code> указывается только <span class="quote">«<span class="quote">слот</span>»</span> в семействе операторов, по номеру стратегии или опорной функции, и входные типы данных. Имя оператора или функции, занимающих этот слот, не упоминается. Также учтите, что в <code class="literal">DROP FUNCTION</code> указываются типы входных данных, которые должна поддерживать функция, но для индексов GiST, SP-GiST и GIN они могут не иметь ничего общего с типами фактических аргументов функции.</p><p>Так как механизмы индексов не проверяют права доступа к функциям прежде чем вызывать их, включение функций или операторов в семейство операторов по сути даёт всем право на выполнение их. Обычно это не проблема для таких функций, какие бывают полезны в семействе операторов.</p><p>Операторы не должны реализовываться в функциях на языке SQL. SQL-функция вероятнее всего будет встроена в вызывающий запрос, что помешает оптимизатору понять, что этот запрос соответствует индексу.</p><p>До <span class="productname">PostgreSQL</span> 8.4 предложение <code class="literal">OPERATOR</code> могло включать указание <code class="literal">RECHECK</code>. Теперь это не поддерживается, так как оператор индекса может быть <span class="quote">«<span class="quote">неточным</span>»</span> и это определяется на ходу в момент выполнения. Это позволяет эффективно справляться с ситуациями, когда оператор может быть или не быть неточным.</p></div><div class="refsect1" id="id-1.9.3.22.8"><h2>Примеры</h2><p>Следующий пример добавляет опорные функции и межтиповые операторы в семейство операторов, уже содержащее классы операторов B-дерева для типов данных <code class="type">int4</code> и <code class="type">int2</code>.</p><pre class="programlisting">ALTER OPERATOR FAMILY integer_ops USING btree ADD

  -- int4 и int2
  OPERATOR 1 &lt; (int4, int2) ,
  OPERATOR 2 &lt;= (int4, int2) ,
  OPERATOR 3 = (int4, int2) ,
  OPERATOR 4 &gt;= (int4, int2) ,
  OPERATOR 5 &gt; (int4, int2) ,
  FUNCTION 1 btint42cmp(int4, int2) ,

  -- int2 и int4
  OPERATOR 1 &lt; (int2, int4) ,
  OPERATOR 2 &lt;= (int2, int4) ,
  OPERATOR 3 = (int2, int4) ,
  OPERATOR 4 &gt;= (int2, int4) ,
  OPERATOR 5 &gt; (int2, int4) ,
  FUNCTION 1 btint24cmp(int2, int4) ;</pre><p>Удаление этих же элементов:</p><pre class="programlisting">ALTER OPERATOR FAMILY integer_ops USING btree DROP

  -- int4 vs int2
  OPERATOR 1 (int4, int2) ,
  OPERATOR 2 (int4, int2) ,
  OPERATOR 3 (int4, int2) ,
  OPERATOR 4 (int4, int2) ,
  OPERATOR 5 (int4, int2) ,
  FUNCTION 1 (int4, int2) ,

  -- int2 vs int4
  OPERATOR 1 (int2, int4) ,
  OPERATOR 2 (int2, int4) ,
  OPERATOR 3 (int2, int4) ,
  OPERATOR 4 (int2, int4) ,
  OPERATOR 5 (int2, int4) ,
  FUNCTION 1 (int2, int4) ;</pre></div><div class="refsect1" id="id-1.9.3.22.9"><h2>Совместимость</h2><p>Команда <code class="command">ALTER OPERATOR FAMILY</code> отсутствует в стандарте SQL.</p></div><div class="refsect1" id="id-1.9.3.22.10"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-createopfamily.html" title="CREATE OPERATOR FAMILY"><span class="refentrytitle">CREATE OPERATOR FAMILY</span></a>, <a class="xref" href="sql-dropopfamily.html" title="DROP OPERATOR FAMILY"><span class="refentrytitle">DROP OPERATOR FAMILY</span></a>, <a class="xref" href="sql-createopclass.html" title="CREATE OPERATOR CLASS"><span class="refentrytitle">CREATE OPERATOR CLASS</span></a>, <a class="xref" href="sql-alteropclass.html" title="ALTER OPERATOR CLASS"><span class="refentrytitle">ALTER OPERATOR CLASS</span></a>, <a class="xref" href="sql-dropopclass.html" title="DROP OPERATOR CLASS"><span class="refentrytitle">DROP OPERATOR CLASS</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-alteropclass.html" title="ALTER OPERATOR CLASS">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-alterpolicy.html" title="ALTER POLICY">След.</a></td></tr><tr><td width="40%" align="left" valign="top">ALTER OPERATOR CLASS </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> ALTER POLICY</td></tr></table></div></body></html>