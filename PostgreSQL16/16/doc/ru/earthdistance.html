<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.15. earthdistance — вычисление расстояний между точками на Земле</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="dict-xsyn.html" title="F.14. dict_xsyn — пример словаря текстового поиска синонимов" /><link rel="next" href="file-fdw.html" title="F.16. file_fdw — обращение к файлам данных в файловой системе сервера" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.15. earthdistance — вычисление расстояний между точками на Земле</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="dict-xsyn.html" title="F.14. dict_xsyn — пример словаря текстового поиска синонимов">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><th width="60%" align="center">Приложение F. Дополнительно поставляемые модули и расширения</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="file-fdw.html" title="F.16. file_fdw — обращение к файлам данных в файловой системе сервера">След.</a></td></tr></table><hr /></div><div class="sect1" id="EARTHDISTANCE"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.15. earthdistance — вычисление расстояний между точками на Земле <a href="#EARTHDISTANCE" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="earthdistance.html#EARTHDISTANCE-CUBE-BASED">F.15.1. Земные расстояния по кубам</a></span></dt><dt><span class="sect2"><a href="earthdistance.html#EARTHDISTANCE-POINT-BASED">F.15.2. Земные расстояния по точкам</a></span></dt></dl></div><a id="id-1.11.7.25.2" class="indexterm"></a><p>Модуль <code class="filename">earthdistance</code> реализует два разных варианта вычисления ортодромии (расстояния между точками на поверхности Земли). Первый описанный вариант зависит от модуля <code class="filename">cube</code>. Второй вариант основан на встроенном типе данных <code class="type">point</code>, в котором в качестве координат задаются широта и долгота.</p><p>В этом модуле Земля считается идеальной сферой. (Если для вас это слишком грубо, обратите внимание на проект <span class="application"><a class="ulink" href="https://postgis.net/" target="_top">PostGIS</a></span>.)</p><p>Прежде чем устанавливать <code class="filename">earthdistance</code>, вы должны установить модуль <code class="filename">cube</code> (хотя можно воспользоваться указанием <code class="literal">CASCADE</code> команды <code class="command">CREATE EXTENSION</code> и установить сразу оба расширения).</p><div class="caution"><h3 class="title">Внимание</h3><p>Расширения <code class="filename">earthdistance</code> и <code class="filename">cube</code> настоятельно рекомендуется устанавливать в одну схему, и при этом в данной схеме недоверенные пользователи не должны в настоящем и будущем иметь право CREATE. В противном случае, если в схеме <code class="filename">earthdistance</code> окажутся объекты, созданные злонамеренным пользователем, возможна угроза безопасности. Более того, используя функции <code class="filename">earthdistance</code> после установки расширения, следует ограничивать путь поиска только доверенными схемами.</p></div><div class="sect2" id="EARTHDISTANCE-CUBE-BASED"><div class="titlepage"><div><div><h3 class="title">F.15.1. Земные расстояния по кубам <a href="#EARTHDISTANCE-CUBE-BASED" class="id_link">#</a></h3></div></div></div><p>Данные хранятся в кубах, представляющих точки (оба угла куба совпадают) по 3 координатам, выражающим смещения x, y и z от центра Земли. Этот модуль предоставляет <a class="glossterm" href="glossary.html#GLOSSARY-DOMAIN"><em class="glossterm"><a class="glossterm" href="glossary.html#GLOSSARY-DOMAIN" title="Домен">домен</a></em></a> <code class="type">earth</code> на базе <code class="type">cube</code>, включающий проверки того, что значение соответствует этим ограничениям и представляет точку, достаточно близкую к сферической поверхности Земли.</p><p>Радиус Земли выдаёт функция <code class="function">earth()</code> (в метрах). Изменив одну эту функцию, вы можете сделать так, чтобы модуль работал с другими единицами, либо выдать другое значение радиуса, которое кажется вам более подходящим.</p><p>Этот пакет может также применяться и для астрономических расчётов. Астрономы обычно меняют функцию <code class="function">earth()</code>, чтобы она возвращала радиус, равный <code class="literal">180/pi()</code>, и расстояния в результате выдавались в градусах.</p><p>В этом модуле реализованы функции для ввода данных, выражающих широту и долготу (в градусах), для вывода ширины и долготы, для вычисления ортодромии между двумя точками и простого указания окружающего прямоугольника, что полезно для поиска по индексу.</p><p>Предоставляемые этим модулем функции показаны в <a class="xref" href="earthdistance.html#EARTHDISTANCE-CUBE-FUNCTIONS" title="Таблица F.5. Функции земных расстояний по кубам">Таблица F.5</a>.</p><div class="table" id="EARTHDISTANCE-CUBE-FUNCTIONS"><p class="title"><strong>Таблица F.5. Функции земных расстояний по кубам</strong></p><div class="table-contents"><table class="table" summary="Функции земных расстояний по кубам" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.25.7.7.2.2.1.1.1.1" class="indexterm"></a> <code class="function">earth</code> () → <code class="returnvalue">float8</code></p>
       <p>Возвращает предполагаемый радиус Земли.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.25.7.7.2.2.2.1.1.1" class="indexterm"></a> <code class="function">sec_to_gc</code> ( <code class="type">float8</code> ) → <code class="returnvalue">float8</code></p>
       <p>Переводит расстояние по обычной прямой (по секущей) между двумя точками на поверхности Земли в расстояние между ними по сфере.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.25.7.7.2.2.3.1.1.1" class="indexterm"></a> <code class="function">gc_to_sec</code> ( <code class="type">float8</code> ) → <code class="returnvalue">float8</code></p>
       <p>Переводит расстояние по сфере между двумя точками на поверхности Земли в расстояние по обычной прямой (по секущей) между ними.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.25.7.7.2.2.4.1.1.1" class="indexterm"></a> <code class="function">ll_to_earth</code> ( <code class="type">float8</code>, <code class="type">float8</code> ) → <code class="returnvalue">earth</code></p>
       <p>Возвращает положение точки на поверхности Земли по заданной широте (аргумент 1) и долготе (аргумент 2) в градусах.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.25.7.7.2.2.5.1.1.1" class="indexterm"></a> <code class="function">latitude</code> ( <code class="type">earth</code> ) → <code class="returnvalue">float8</code></p>
       <p>Возвращает широту (в градусах) точки на поверхности Земли.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.25.7.7.2.2.6.1.1.1" class="indexterm"></a> <code class="function">longitude</code> ( <code class="type">earth</code> ) → <code class="returnvalue">float8</code></p>
       <p>Возвращает долготу (в градусах) точки на поверхности Земли.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.25.7.7.2.2.7.1.1.1" class="indexterm"></a> <code class="function">earth_distance</code> ( <code class="type">earth</code>, <code class="type">earth</code> ) → <code class="returnvalue">float8</code></p>
       <p>Возвращает расстояние по сфере между двумя точками на поверхности Земли.</p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.11.7.25.7.7.2.2.8.1.1.1" class="indexterm"></a> <code class="function">earth_box</code> ( <code class="type">earth</code>, <code class="type">float8</code> ) → <code class="returnvalue">cube</code></p>
       <p>Выдаёт охватывающий куб, подходящий для поиска по индексу с применением реализованного для типа <code class="type">cube</code> оператора <code class="literal">@&gt;</code> для точек в пределах заданной ортодромии от цели. Некоторые точки в этом кубе будут отстоять от цели дальше, чем на заданную ортодромию, поэтому в запрос нужно включить вторую проверку с функцией <code class="function">earth_distance</code>.</p></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="EARTHDISTANCE-POINT-BASED"><div class="titlepage"><div><div><h3 class="title">F.15.2. Земные расстояния по точкам <a href="#EARTHDISTANCE-POINT-BASED" class="id_link">#</a></h3></div></div></div><p>Вторая часть этого модуля основана на представлении точек на Земле в виде значений типа <code class="type">point</code>, в которых первый компонент представляет долготу в градусах, а второй — широту. Точки воспринимаются как (долгота, широта), а не наоборот, так как долгота ближе к интуитивному представлению как оси X, а широта — оси Y.</p><p>В модуле реализован один оператор, показанный в <a class="xref" href="earthdistance.html#EARTHDISTANCE-POINT-OPERATORS" title="Таблица F.6. Операторы земных расстояний по точкам">Таблице F.6</a>.</p><div class="table" id="EARTHDISTANCE-POINT-OPERATORS"><p class="title"><strong>Таблица F.6. Операторы земных расстояний по точкам</strong></p><div class="table-contents"><table class="table" summary="Операторы земных расстояний по точкам" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Оператор</p>
       <p>Описание</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">point</code> <code class="literal">&lt;@&gt;</code> <code class="type">point</code>
        → <code class="returnvalue">float8</code>
       </p>
       <p>Вычисляет расстояние в сухопутных милях между точками на поверхности Земли.</p></td></tr></tbody></table></div></div><br class="table-break" /><p>Заметьте, что в этой части модуля, в отличие от части, построенной на <code class="type">cube</code>, единицы зашиты жёстко: изменение функции <code class="function">earth()</code> не повлияет на результат этого оператора.</p><p>Представление в виде долготы/широты плохо тем, что вам придётся учитывать граничные условия возле полюсов и в районе +/- 180 градусов долготы. Представление на базе <code class="type">cube</code> лишено таких нарушений непрерывности.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="dict-xsyn.html" title="F.14. dict_xsyn — пример словаря текстового поиска синонимов">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="file-fdw.html" title="F.16. file_fdw — обращение к файлам данных в файловой системе сервера">След.</a></td></tr><tr><td width="40%" align="left" valign="top">F.14. dict_xsyn — пример словаря текстового поиска синонимов </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> F.16. file_fdw — обращение к файлам данных в файловой системе сервера</td></tr></table></div></body></html>