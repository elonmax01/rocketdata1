<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>pg_dump</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="app-pgconfig.html" title="pg_config" /><link rel="next" href="app-pg-dumpall.html" title="pg_dumpall" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center"><span class="application">pg_dump</span></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="app-pgconfig.html" title="pg_config">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><th width="60%" align="center">Клиентские приложения PostgreSQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="app-pg-dumpall.html" title="pg_dumpall">След.</a></td></tr></table><hr /></div><div class="refentry" id="APP-PGDUMP"><div class="titlepage"></div><a id="id-1.9.4.13.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle"><span class="application">pg_dump</span></span></h2><p>pg_dump — выгрузить базу данных <span class="productname">PostgreSQL</span> в виде скрипта или в архивном формате</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><div class="cmdsynopsis"><p id="id-1.9.4.13.4.1"><code class="command">pg_dump</code> [<em class="replaceable"><code>параметр-подключения</code></em>...] [<em class="replaceable"><code>параметр</code></em>...] [<em class="replaceable"><code>имя_бд</code></em>]</p></div></div><div class="refsect1" id="PG-DUMP-DESCRIPTION"><h2>Описание</h2><p><span class="application">pg_dump</span> — это программа для создания резервных копий базы данных <span class="productname">PostgreSQL</span>. Она создаёт целостные копии, даже если база параллельно используется. Программа <span class="application">pg_dump</span> не препятствует доступу других пользователей к базе данных (ни для чтения, ни для записи).</p><p>Программа <span class="application">pg_dump</span> выгружает только одну базу данных. Чтобы выгрузить весь кластер или сохранить глобальные объекты, относящиеся ко всем базам в кластере, например, роли и табличные пространства, воспользуйтесь программой <a class="xref" href="app-pg-dumpall.html" title="pg_dumpall"><span class="refentrytitle"><span class="application">pg_dumpall</span></span></a>.</p><p>Выгружаемые данные могут быть сохранены в виде скрипта, либо в одном из архивных форматов. Скрипты представляют собой текстовые файлы, содержащие SQL-команды, необходимые для воссоздания базы данных до состояния на момент создания скрипта. Для восстановления из скрипта его содержимое можно передать <a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a>. Скрипты можно использовать для восстановления базы на других машинах, в том числе с иной архитектурой, а с некоторыми коррективами даже в других СУБД.</p><p>Для восстановления из архивных форматов файлов используется утилита <a class="xref" href="app-pgrestore.html" title="pg_restore"><span class="refentrytitle"><span class="application">pg_restore</span></span></a>. Эти форматы позволяют указывать <span class="application">pg_restore</span> какие объекты базы данных восстановить, а также позволяют изменить порядок следования восстанавливаемых объектов. Архивные форматы файлов спроектированы так, чтобы их можно были переносить на другие платформы с другой архитектурой.</p><p>Применение архивных форматов в сочетании утилит <span class="application">pg_restore</span> и <span class="application">pg_dump</span> позволяет организовывать эффективный механизм архивации и переноса данных. <span class="application">pg_dump</span> можно использовать для резервирования всей базы данных, а затем при применении <span class="application">pg_restore</span> выбрать нужные объекты для восстановления. Наиболее гибкие форматы выходных файлов это <span class="quote">«<span class="quote">custom</span>»</span> (<code class="option">-Fc</code>) и <span class="quote">«<span class="quote">directory</span>»</span> (<code class="option">-Fd</code>). Они позволяют выбрать и изменить порядок объектов, поддерживают восстановление в несколько потоков, а также сжимаются по умолчанию. При этом только формат <span class="quote">«<span class="quote">directory</span>»</span> поддерживает выгрузку данных в несколько потоков.</p><p>Во время работы <span class="application">pg_dump</span> следует обращать внимание на предупреждения, которые печатаются в стандартный поток ошибок, особенно ввиду рассмотренных далее ограничений.</p></div><div class="refsect1" id="PG-DUMP-OPTIONS"><h2>Параметры</h2><p>Параметры командной строки для управления содержимым и форматом вывода. </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>имя_бд</code></em></span></dt><dd><p>Указывает имя базы данных, из которой будут выгружаться данные. Если имя не задано, то используется значение переменной окружения <code class="envar">PGDATABASE</code>. Если и переменная не задана, то в качестве имени базы будет взято имя пользователя, под которым осуществляется подключение.</p></dd><dt><span class="term"><code class="option">-a</code><br /></span><span class="term"><code class="option">--data-only</code></span></dt><dd><p>Выводить только данные, но не схемы объектов (DDL). Будут копироваться данные таблиц, большие объекты, значения последовательностей.</p><p>Флаг похож на <code class="option">--section=data</code>, но по историческим причинам не равнозначен ему.</p></dd><dt><span class="term"><code class="option">-b</code><br /></span><span class="term"><code class="option">--large-objects</code><br /></span><span class="term"><code class="option">--blobs</code> (устаревший параметр)</span></dt><dd><p>Включить большие объекты в выгрузку. Это поведение по умолчанию при отсутствии ключей <code class="option">--schema</code>, <code class="option">--table</code> или <code class="option">--schema-only</code>. Таким образом, ключ <code class="option">-b</code> полезен, лишь когда нужно добавить большие объекты при выгрузке только избранной схемы или таблицы. Заметьте, что большие объекты относятся к данным, и поэтому будут выгружаться, когда используется ключ <code class="option">--data-only</code>, но не ключ <code class="option">--schema-only</code>.</p></dd><dt><span class="term"><code class="option">-B</code><br /></span><span class="term"><code class="option">--no-large-objects</code><br /></span><span class="term"><code class="option">--no-blobs</code> (устаревший параметр)</span></dt><dd><p>Исключить из выгрузки большие объекты.</p><p>Когда задаётся и <code class="option">-b</code>, и <code class="option">-B</code>, большие объекты при выгрузке данных будут выводиться (см. описание ключа <code class="option">-b</code>).</p></dd><dt><span class="term"><code class="option">-c</code><br /></span><span class="term"><code class="option">--clean</code></span></dt><dd><p>Включить в выходной файл команды удаления <code class="command">DROP</code> всех выгружаемых объектов базы данных перед командами создания этих объектов. Этот параметр полезен, если при восстановлении необходимо перезаписать существующую базу данных. Если дополнительно не указать флаг <code class="option">--if-exists</code>, то при восстановлении в базу данных, где некоторые объекты отсутствуют, попытка удаления несуществующего объекта будет приводить к ошибке, которую можно игнорировать.</p><p>Этот параметр игнорируется, когда данные выгружаются в архивных форматах (не в текстовом). Для таких форматов данный параметр можно указать при вызове <code class="command">pg_restore</code>.</p></dd><dt><span class="term"><code class="option">-C</code><br /></span><span class="term"><code class="option">--create</code></span></dt><dd><p>Сформировать в начале вывода команду для создания базы данных и затем подключения к ней. В этом случае не важно, какая база указана в параметрах подключения перед выполнением скрипта. Также, если указан ключ <code class="option">--clean</code>, то скрипт сначала удалит, а затем пересоздаст базу данных перед подключением к ней.</p><p>С ключом <code class="option">--create</code> в выходной файл также включается комментарий к базе данных (если он задан) и все назначения переменных конфигурации, связанные с базой данных, то есть все команды <code class="command">ALTER DATABASE ... SET ...</code> и <code class="command">ALTER ROLE ... IN DATABASE ... SET ...</code>, ссылающиеся на эту базу данных. Также выгружаются права доступа к самой базе данных, если не добавлен ключ <code class="option">--no-acl</code>.</p><p>Этот параметр игнорируется, когда данные выгружаются в архивных форматах (не в текстовом). Для таких форматов данный параметр можно указать при вызове <code class="command">pg_restore</code>.</p></dd><dt><span class="term"><code class="option">-e <em class="replaceable"><code>шаблон</code></em></code><br /></span><span class="term"><code class="option">--extension=<em class="replaceable"><code>шаблон</code></em></code></span></dt><dd><p>Выгрузить только расширения, соответствующие <em class="replaceable"><code>шаблону</code></em>. Когда этот параметр отсутствует, выгружаются все несистемные расширения в целевой базе данных. Чтобы выгрузить несколько расширений, ключ <code class="option">-e</code> можно задать несколько раз. Параметр <em class="replaceable"><code>шаблон</code></em> интерпретируется по тем же правилам, что и шаблон в командах <span class="application">psql</span> <code class="literal">\d</code> (см. <a class="xref" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска">Шаблоны поиска</a> ниже), так что несколько расширений можно выбрать и шаблоном со знаками подстановки. Используя знаки подстановки, при необходимости заключайте шаблон в кавычки, чтобы эти знаки не разворачивала оболочка системы.</p><p>Для расширения, указанного в <code class="option">--extension</code>, в выгрузку включаются все его конфигурационные данные, зарегистрированные функцией <code class="function">pg_extension_config_dump</code>.</p><div class="note"><h3 class="title">Примечание</h3><p>При использовании <code class="option">-e</code>, <span class="application">pg_dump</span> не выгружает прочие объекты, от которых выгружаемые расширения могут зависеть. Таким образом не гарантируется, что выгруженные расширения будут успешно восстановлены в чистой базе данных.</p></div></dd><dt><span class="term"><code class="option">-E <em class="replaceable"><code>кодировка</code></em></code><br /></span><span class="term"><code class="option">--encoding=<em class="replaceable"><code>кодировка</code></em></code></span></dt><dd><p>Создать копию в заданной кодировке. По умолчанию копия создаётся в кодировке, используемой базой данных. Другой способ достичь того же результата — задать желаемую кодировку в переменной окружения <code class="envar">PGCLIENTENCODING</code>. Поддерживаемые кодировки описаны в <a class="xref" href="multibyte.html#MULTIBYTE-CHARSET-SUPPORTED" title="24.3.1. Поддерживаемые кодировки">Подразделе 24.3.1</a>.</p></dd><dt><span class="term"><code class="option">-f <em class="replaceable"><code>файл</code></em></code><br /></span><span class="term"><code class="option">--file=<em class="replaceable"><code>файл</code></em></code></span></dt><dd><p>Отправить вывод в указанный файл. Параметр можно не указывать, если используется формат с выводом в файл. В этом случае будет использован стандартный вывод. Однако для формата с выводом в каталог параметр является обязательным и должен задавать путь к каталогу. В этом случае целевой каталог будет создан командой <code class="command">pg_dump</code> и не должен существовать заранее.</p></dd><dt><span class="term"><code class="option">-F <em class="replaceable"><code>format</code></em></code><br /></span><span class="term"><code class="option">--format=<em class="replaceable"><code>format</code></em></code></span></dt><dd><p>Указывает формат вывода копии. <em class="replaceable"><code>format</code></em> может принимать следующие значения: </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">p</code><br /></span><span class="term"><code class="literal">plain</code></span></dt><dd><p>Сформировать текстовый <acronym class="acronym">SQL</acronym>-скрипт. Это поведение по умолчанию.</p></dd><dt><span class="term"><code class="literal">c</code><br /></span><span class="term"><code class="literal">custom</code></span></dt><dd><p>Выгрузить данные в специальном архивном формате, пригодном для дальнейшего использования утилитой <span class="application">pg_restore</span>. Наряду с форматом <code class="literal">directory</code> является наиболее гибким форматом, позволяющим вручную выбирать и сортировать восстанавливаемые объекты. Вывод в этом формате по умолчанию сжимается.</p></dd><dt><span class="term"><code class="literal">d</code><br /></span><span class="term"><code class="literal">directory</code></span></dt><dd><p>Выгрузить данные в формате каталога. Этот формат пригоден для дальнейшего использования утилитой <span class="application">pg_restore</span>. При этом будет создан каталог, в котором для каждой таблицы и большого объекта будут созданы отдельные файлы, а также файл оглавления в машинно-читаемом формате, понятном для <span class="application">pg_restore</span>. С полученной резервной копией можно работать штатными средствами Unix, например, несжатую копию можно сжать посредством <span class="application">gzip</span>, <span class="application">lz4</span> или <span class="application">zstd</span>. Этот формат по умолчанию сжимается с использованием <code class="literal">gzip</code>, а также поддерживает работу в несколько потоков.</p></dd><dt><span class="term"><code class="literal">t</code><br /></span><span class="term"><code class="literal">tar</code></span></dt><dd><p>Выгрузить данные в формате <code class="command">tar</code>, для дальнейшего использования с утилитой <span class="application">pg_restore</span>. Этот формат совместим с форматом вывода в каталог: если архив распаковать, получится корректная копия в формате каталога. Однако формат tar не поддерживает сжатие. Также, применяя формат tar, при восстановлении нельзя изменить относительный порядок элементов данных.</p></dd></dl></div></dd><dt><span class="term"><code class="option">-j <em class="replaceable"><code>число_заданий</code></em></code><br /></span><span class="term"><code class="option">--jobs=<em class="replaceable"><code>число_заданий</code></em></code></span></dt><dd><p>Осуществить выгрузку в параллельном режиме, обрабатывая одновременно несколько таблиц (в количестве <em class="replaceable"><code>число_заданий</code></em>). Это может сократить время, необходимое для выгрузки, но увеличивает нагрузку на сервер. Этот параметр можно использовать только с форматом вывода в каталог, так как это единственный формат, позволяющий нескольким процессам записывать данные одновременно.</p><p><span class="application">pg_dump</span> откроет <em class="replaceable"><code>число_заданий</code></em> + 1 соединений с базой данных. Таким образом необходимо обеспечить достаточное значение параметра <a class="xref" href="runtime-config-connection.html#GUC-MAX-CONNECTIONS">max_connections</a>.</p><p>Если во время выгрузки в несколько потоков параллельно работающие сеансы будут запрашивать эксклюзивные блокировки на объекты базы данных, то <span class="application">pg_dump</span> может завершиться аварийно. Дело в том, что головной процесс <span class="application">pg_dump</span> вначале запрашивает разделяемые блокировки (<a class="link" href="explicit-locking.html#LOCKING-TABLES" title="13.3.1. Блокировки на уровне таблицы">ACCESS SHARE</a>) на объекты, которые позже будут выгружать рабочие процессы. Это делается для того, чтобы никто не смог удалить объекты на время работы <span class="application">pg_dump</span>. Если же другой сеанс запросит эксклюзивную блокировку на объект, то запрос на блокировку будет поставлен в очередь, до тех пор пока разделяемая блокировка головного процесса <span class="application">pg_dump</span> не будет снята. В последующем, любая попытка доступа к этому объекту будет вставать в очередь, вслед за эксклюзивной блокировкой. В том числе в очередь попадет и рабочий процесс <span class="application">pg_dump</span>. Если не принять меры предосторожности, то получим классическую взаимоблокировку. Для предупреждения подобных конфликтов, рабочий процесс <span class="application">pg_dump</span> ещё раз запрашивает разделяемую блокировку на объект с указанием <code class="literal">NOWAIT</code>. И если он не смог получить блокировку, значит кто-то ещё запросил эксклюзивную блокировку объекта. А это значит, что нет возможности продолжить выгрузку, поэтому <span class="application">pg_dump</span> прерывает дальнейшую работу.</p><p>Для выполнения параллельной выгрузки сервер баз данных должен поддерживать функциональность синхронизированных снимков, которая была введена в версии <span class="productname">PostgreSQL</span> 9.2 для ведущих серверов и в 10 для ведомых. Это позволяет разным клиентам работать с одной и той же версией данных, несмотря на использование разных подключений. <code class="command">pg_dump -j</code> использует множественные подключения. Первое подключение осуществляется головным процессом, а последующие — рабочими процессами. Без функциональности синхронизируемых снимков нет гарантии того, что каждое подключение увидит одни и те же данные, что может привести к несогласованности данных резервной копии.</p></dd><dt><span class="term"><code class="option">-n <em class="replaceable"><code>шаблон</code></em></code><br /></span><span class="term"><code class="option">--schema=<em class="replaceable"><code>шаблон</code></em></code></span></dt><dd><p>Выгрузить только схемы, соответствующие <em class="replaceable"><code>шаблону</code></em>; вместе с этими схемами будут выгружены и все содержащиеся в них объекты. Когда этот параметр отсутствует, выгружаются все несистемные схемы в целевой базе данных. Чтобы выгрузить несколько схем, ключ <code class="option">-n</code> можно указать несколько раз. Параметр <em class="replaceable"><code>шаблон</code></em> интерпретируется по тем же правилам, что и шаблон в командах <span class="application">psql</span> <code class="literal">\d</code> (см. <a class="xref" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска">Шаблоны поиска</a>), так что несколько схем можно выбрать и шаблоном со знаками подстановки. Используя знаки подстановки, при необходимости заключайте шаблон в кавычки, чтобы эти знаки не разворачивала оболочка системы (см. <a class="xref" href="app-pgdump.html#PG-DUMP-EXAMPLES" title="Примеры">Примеры</a> ниже).</p><div class="note"><h3 class="title">Примечание</h3><p>При использовании <code class="option">-n</code>, <span class="application">pg_dump</span> не выгружает объекты других схем, от которых выгружаемая схема может зависеть. Таким образом не гарантируется, что выгруженная схема будет успешно восстановлена в чистой базе данных.</p></div><div class="note"><h3 class="title">Примечание</h3><p>Не принадлежащие схемам объекты (например, большие объекты), не выгружаются с параметром <code class="option">-n</code>. Однако можно указать <code class="option">--large-objects</code>, чтобы они попали в выгрузку.</p></div></dd><dt><span class="term"><code class="option">-N <em class="replaceable"><code>шаблон</code></em></code><br /></span><span class="term"><code class="option">--exclude-schema=<em class="replaceable"><code>шаблон</code></em></code></span></dt><dd><p>Не выгружать схемы, соответствующие <em class="replaceable"><code>шаблону</code></em>. Шаблон интерпретируется по тем же правилам, что и для параметра <code class="option">-n</code>. Параметр <code class="option">-N</code> можно использовать в команде несколько раз для исключения схем, соответствующих нескольким шаблонам.</p><p>При одновременном использовании параметров <code class="option">-n</code> и <code class="option">-N</code> будут выгружаться схемы, соответствующие шаблону параметра <code class="option">-n</code> и не противоречащие шаблону параметра <code class="option">-N</code>.</p></dd><dt><span class="term"><code class="option">-O</code><br /></span><span class="term"><code class="option">--no-owner</code></span></dt><dd><p>Не формировать команды, устанавливающие владельца объектов базы данных. По умолчанию <span class="application">pg_dump</span> генерирует команды <code class="command">ALTER OWNER</code> или <code class="command">SET SESSION AUTHORIZATION</code> для назначения владельцев объектов базы. Эти команды завершатся неудачно, если скрипт будет запущен не суперпользователем или не владельцем объектов. Чтобы создать скрипт, который можно выполнить при восстановлении от лица произвольного пользователя и назначить его в качестве владельца объектов восстанавливаемой базы, необходимо указать флаг <code class="option">-O</code>.</p><p>Этот параметр игнорируется, когда данные выгружаются в архивных форматах (не в текстовом). Для таких форматов данный параметр можно указать при вызове <code class="command">pg_restore</code>.</p></dd><dt><span class="term"><code class="option">-R</code><br /></span><span class="term"><code class="option">--no-reconnect</code></span></dt><dd><p>Параметр является устаревшим, но в целях совместимости ещё работает.</p></dd><dt><span class="term"><code class="option">-s</code><br /></span><span class="term"><code class="option">--schema-only</code></span></dt><dd><p>Выгружать только определения объектов (схемы), без данных.</p><p>Действие параметра противоположно действию <code class="option">--data-only</code>. Это похоже на указание <code class="option">--section=pre-data --section=post-data</code>, но по историческим причинам не равнозначно ему.</p><p>(Не путайте этот параметр с <code class="option">--schema</code>, где слово <span class="quote">«<span class="quote">схема</span>»</span> используется в другом значении.)</p><p>Чтобы не выгружать данные отдельных таблиц, используйте параметр <code class="option">--exclude-table-data</code>.</p></dd><dt><span class="term"><code class="option">-S <em class="replaceable"><code>имя_пользователя</code></em></code><br /></span><span class="term"><code class="option">--superuser=<em class="replaceable"><code>имя_пользователя</code></em></code></span></dt><dd><p>Указать суперпользователя, который будет использоваться для отключения триггеров. Параметр имеет значение только вместе с <code class="option">--disable-triggers</code>. Обычно его лучше не использовать, а запускать полученный скрипт от имени суперпользователя.</p></dd><dt><span class="term"><code class="option">-t <em class="replaceable"><code>шаблон</code></em></code><br /></span><span class="term"><code class="option">--table=<em class="replaceable"><code>шаблон</code></em></code></span></dt><dd><p>Выгрузить только таблицы, соответствующие <em class="replaceable"><code>шаблону</code></em>. Чтобы выбрать несколько таблиц, ключ <code class="option">-t</code> можно указать несколько раз. Параметр <em class="replaceable"><code>шаблон</code></em> интерпретируется по тем же правилам, что и шаблон в командах <span class="application">psql</span> <code class="literal">\d</code> (см. <a class="xref" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска">Шаблоны поиска</a>), так что несколько таблиц можно выбрать и шаблоном со знаками подстановки. Используя знаки подстановки, при необходимости заключайте шаблон в кавычки, чтобы эти знаки не разворачивала оболочка системы (см. <a class="xref" href="app-pgdump.html#PG-DUMP-EXAMPLES" title="Примеры">Примеры</a> ниже).</p><p>Помимо обычных таблиц, с этим указанием можно выгрузить определения соответствующих шаблону последовательностей, представлений, материализованных представлений и сторонних таблиц. При этом содержимое представлений и матпредставлений выгружаться не будет, а содержимое сторонних таблиц будет выгружено, только если в аргументе <code class="option">--include-foreign-data</code> указан соответствующий сторонний сервер.</p><p>Параметры <code class="option">-n</code> и <code class="option">-N</code> не действуют в присутствии параметра <code class="option">-t</code>, так как отобранные им таблицы всё равно будут выгружены, а не табличные объекты выгружаться не будут.</p><div class="note"><h3 class="title">Примечание</h3><p>При использовании <code class="option">-t</code>, <span class="application">pg_dump</span> не выгружает прочие объекты, от которых выгружаемые таблицы могут зависеть. Таким образом не гарантируется, что выгруженные таблицы будут успешно восстановлены в чистой базе данных.</p></div></dd><dt><span class="term"><code class="option">-T <em class="replaceable"><code>шаблон</code></em></code><br /></span><span class="term"><code class="option">--exclude-table=<em class="replaceable"><code>шаблон</code></em></code></span></dt><dd><p>Не выгружать таблицы, соответствующие <em class="replaceable"><code>шаблону</code></em>. Шаблон интерпретируется по тем же правилам, что и для параметра <code class="option">-t</code>. Параметр <code class="option">-T</code> можно использовать в команде несколько раз для исключения таблиц, соответствующих нескольким шаблонам.</p><p>При одновременном использовании параметров <code class="option">-t</code> и <code class="option">-T</code> будут выгружаться таблицы, соответствующие шаблону параметра <code class="option">-t</code> и не противоречащие шаблону параметра <code class="option">-T</code>.</p></dd><dt><span class="term"><code class="option">-v</code><br /></span><span class="term"><code class="option">--verbose</code></span></dt><dd><p>Включить подробный режим. <span class="application">pg_dump</span> будет выводить в стандартный поток ошибок подробные комментарии к объектам, включая время начала и окончания выгрузки, а также сообщения о прогрессе выполнения. Если повторить этот ключ, в стандартный поток ошибок будут выдаваться дополнительные отладочные сообщения.</p></dd><dt><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span></dt><dd><p>Вывести версию <span class="application">pg_dump</span>.</p></dd><dt><span class="term"><code class="option">-x</code><br /></span><span class="term"><code class="option">--no-privileges</code><br /></span><span class="term"><code class="option">--no-acl</code></span></dt><dd><p>Не выгружать права доступа (команды GRANT/REVOKE).</p></dd><dt><span class="term"><code class="option">-Z <em class="replaceable"><code>уровень</code></em></code><br /></span><span class="term"><code class="option">-Z <em class="replaceable"><code>метод</code></em></code>[:<em class="replaceable"><code>строка_информации</code></em>]<br /></span><span class="term"><code class="option">--compress=<em class="replaceable"><code>уровень</code></em></code><br /></span><span class="term"><code class="option">--compress=<em class="replaceable"><code>метод</code></em></code>[:<em class="replaceable"><code>строка_информации</code></em>]</span></dt><dd><p>Указывает метод и/или уровень сжатия. В качестве метода сжатия можно выбрать <code class="literal">gzip</code>, <code class="literal">lz4</code>, <code class="literal">zstd</code> или <code class="literal">none</code> (без сжатия). В качестве дополнительной информации можно передать параметры сжатия. Если в строке информации передаётся целое число, оно задаёт уровень сжатия. В противном случае она должна содержать список элементов, разделённых запятыми, в форме <em class="replaceable"><code>ключевое_слово</code></em> или <em class="replaceable"><code>ключевое_слово=значение</code></em>. На данный момент поддерживаются ключевые слова <code class="literal">level</code> и <code class="literal">long</code>.</p><p>Если уровень сжатия не указан, будет выбран уровень сжатия по умолчанию. Если указан только уровень сжатия, но не указан метод, будет применяться метод сжатия <code class="literal">gzip</code>, когда уровень больше <code class="literal">0</code>, а когда уровень равен <code class="literal">0</code>, сжатие не будет выполняться.</p><p>Для специального формата и формата каталога будут сжиматься файлы отдельных таблиц. По умолчанию применяется умеренный уровень сжатия с использованием <code class="literal">gzip</code>. Если указать отличный от нулевого уровень сжатия для простого формата, то сжиматься будет весь выходной файл, как это было бы при передаче файла команде <span class="application">gzip</span>, <span class="application">lz4</span> или <span class="application">zstd</span>. Однако по умолчанию для простого формата сжатие не производится. Сжатие с использованием <span class="application">zstd</span> можно проводить с указанием <code class="literal">long</code>, что может улучшить коэффициент сжатия за счёт повышения нагрузки на память.</p><p>Формат <code class="literal">tar</code> в настоящий момент не поддерживает сжатие.</p></dd><dt><span class="term"><code class="option">--binary-upgrade</code></span></dt><dd><p>Этот параметр предназначен для утилит обновления сервера. Использование для иных целей не рекомендуется и не поддерживается. Поведение параметра может быть изменено в последующих версиях без предварительного уведомления.</p></dd><dt><span class="term"><code class="option">--column-inserts</code><br /></span><span class="term"><code class="option">--attribute-inserts</code></span></dt><dd><p>Выгружать данные таблиц в виде команд <code class="command">INSERT</code> с явным указанием столбцов (<code class="literal">INSERT INTO <em class="replaceable"><code>таблица</code></em> (<em class="replaceable"><code>столбец</code></em>, ...) VALUES ...</code>). Скорость восстановления при этом значительно снизится, но данный вариант оправдан, когда загружать данные нужно не в <span class="productname">PostgreSQL</span>. При этом в случае каких-либо ошибок при загрузке данных будут потеряны только строки <code class="command">INSERT</code>, где возникли ошибки, но не всё содержимое таблицы.</p></dd><dt><span class="term"><code class="option">--disable-dollar-quoting</code></span></dt><dd><p>Этот параметр запрещает заключать в доллары тело функций, что оставляет возможность только заключать их в кавычки, применяя стандартный синтаксис SQL.</p></dd><dt><span class="term"><code class="option">--disable-triggers</code></span></dt><dd><p>Используется при выгрузке одних данных. Указывает <span class="application">pg_dump</span> включать в вывод команды для временного выключения триггеров при восстановлении в целевой базе данных. Применяется в ситуациях, когда существуют проверки ссылочной целостности или другие триггеры, которые необходимо выключить на время восстановления.</p><p>В настоящее время команды, генерируемые с параметром <code class="option">--disable-triggers</code>, должны исполняться от имени суперпользователя. Таким образом, необходимо также передавать флаг <code class="option">-S</code>, либо при восстановлении выполнять скрипт от имени суперпользователя.</p><p>Этот параметр игнорируется, когда данные выгружаются в архивных форматах (не в текстовом). Для таких форматов данный параметр можно указать при вызове <code class="command">pg_restore</code>.</p></dd><dt><span class="term"><code class="option">--enable-row-security</code></span></dt><dd><p>Этот параметр имеет смысл только при выгрузке содержимого таблицы, для которой включена защита строк. По умолчанию <span class="application">pg_dump</span> устанавливает для <a class="xref" href="runtime-config-client.html#GUC-ROW-SECURITY">row_security</a> значение off, чтобы убедиться, что выгружаются все данные из таблицы. Если пользователь не имеет достаточных прав для обхода защиты строк, выдаётся ошибка. Этот параметр указывает <span class="application">pg_dump</span> включить <a class="xref" href="runtime-config-client.html#GUC-ROW-SECURITY">row_security</a>, что позволит пользователю выгрузить часть содержимого таблицы, к которой он имеет доступ.</p><p>Заметьте, что в настоящее время для использования этого параметра обычно желательно, чтобы данные были выгружены в формате <code class="command">INSERT</code>, так как команда <code class="command">COPY FROM</code> в процессе восстановления не поддерживает защиту строк.</p></dd><dt><span class="term"><code class="option">--exclude-table-and-children=<em class="replaceable"><code>шаблон</code></em></code></span></dt><dd><p>Этот параметр делает то же, что <code class="option">-T</code>/<code class="option">--exclude-table</code>, кроме того, что с ним также исключаются любые наследуемые дочерние таблицы или секции таблиц, соответствующих <em class="replaceable"><code>шаблону</code></em>.</p></dd><dt><span class="term"><code class="option">--exclude-table-data=<em class="replaceable"><code>шаблон</code></em></code></span></dt><dd><p>Не выгружать содержимое таблиц, соответствующих <em class="replaceable"><code>шаблону</code></em>. Шаблон таблицы интерпретируется по тем же правилам, что и для параметра <code class="option">-t</code>. Параметр <code class="option">--exclude-table-data</code> можно использовать в команде несколько раз для исключения таблиц, соответствующих нескольким шаблонам. Полезно, когда нужно получить определение таблицы, без содержимого.</p><p>Чтобы не выгружать содержимое всех таблиц базы, используйте параметр <code class="option">--schema-only</code>.</p></dd><dt><span class="term"><code class="option">--exclude-table-data-and-children=<em class="replaceable"><code>шаблон</code></em></code></span></dt><dd><p>Этот параметр делает то же, что <code class="option">--exclude-table-data</code>, кроме того, что с ним также исключаются данные любых наследуемых дочерних таблиц или секций таблиц, соответствующих <em class="replaceable"><code>шаблону</code></em>.</p></dd><dt><span class="term"><code class="option">--extra-float-digits=<em class="replaceable"><code>число_цифр</code></em></code></span></dt><dd><p>Выводить числа с плавающей точкой не с максимальной точностью, а с заданным значением <code class="option">extra_float_digits</code>. При выгрузке данных в целях резервного копирования данный параметр использовать не следует.</p></dd><dt><span class="term"><code class="option">--if-exists</code></span></dt><dd><p>Используйте команды <code class="literal">DROP ... IF EXISTS</code> для удаления объектов в режиме <code class="option">--clean</code>. При этом возможные ошибки <span class="quote">«<span class="quote">does not exist</span>»</span> (не существует) не выводятся. Этот параметр недействителен без указания <code class="option">--clean</code>.</p></dd><dt><span class="term"><code class="option">--include-foreign-data=<em class="replaceable"><code>сторонний_сервер</code></em></code></span></dt><dd><p>Выгрузить данные всех сторонних таблиц со стороннего сервера, имя которого соответствует шаблону <em class="replaceable"><code>сторонний_сервер</code></em>. Для выгрузки данных с нескольких сторонних серверов параметр <code class="option">--include-foreign-data</code> можно использовать несколько раз. К тому же, значение <em class="replaceable"><code>сторонний_сервер</code></em> интерпретируется как шаблон, согласно правилам, используемым командами <code class="literal">\d</code> утилиты <span class="application">psql</span> (см. <a class="xref" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска">Шаблоны поиска</a>). Поэтому несколько сторонних серверов можно также выбрать, используя в шаблоне символы подстановки. Когда используются символы подстановки, шаблон лучше экранировать кавычками, чтобы командная оболочка ОС не интерпретировала их по-своему (см. <a class="xref" href="app-pgdump.html#PG-DUMP-EXAMPLES" title="Примеры">Примеры</a> ниже). Единственное отличие от вышеупомянутых правил — шаблон не может быть пустым.</p><div class="note"><h3 class="title">Примечание</h3><p>Когда используется параметр <code class="option">--include-foreign-data</code>, <span class="application">pg_dump</span> не проверяет возможность записи в стороннюю таблицу. Таким образом, не гарантируется, что выгруженная сторонняя таблица может быть успешно восстановлена.</p></div></dd><dt><span class="term"><code class="option">--inserts</code></span></dt><dd><p>Выгружать данные таблиц в виде команд <code class="command">INSERT</code> вместо <code class="command">COPY</code>. Скорость восстановления при этом значительно снизится, но данный вариант оправдан, когда загружать данные нужно не в <span class="productname">PostgreSQL</span>. При этом в случае каких-либо ошибок при загрузке данных будут потеряны только строки <code class="command">INSERT</code>, где возникли ошибки, но не всё содержимое таблицы. Заметьте, что восстановление может провалиться полностью, если у таблицы изменён порядок столбцов. В такой ситуации можно использовать параметр <code class="option">--column-inserts</code>, для которого порядок столбцов не важен, но он работает ещё медленнее.</p></dd><dt><span class="term"><code class="option">--load-via-partition-root</code></span></dt><dd><p>При выгрузке данных для секции таблицы выводить команды <code class="command">COPY</code> или <code class="command">INSERT</code>, ссылающиеся на корневую таблицу в иерархии секционирования, а не на эту секцию. В результате при загрузке данных подходящая секция будет выбираться заново для каждой строки. Это может быть полезно при восстановлении данных, когда на целевом сервере строки не всегда попадают в те же секции, в которых они находились на исходном. Это возможно, например, когда столбец разбиения имеет текстовый тип и в двух системах по-разному определено правило сортировки, по которому упорядочивается этот столбец.</p></dd><dt><span class="term"><code class="option">--lock-wait-timeout=<em class="replaceable"><code>время_ожидания</code></em></code></span></dt><dd><p>Не ждать бесконечно получения разделяемых блокировок таблиц в начале процедуры выгрузки. Вместо этого выдать ошибку, если не удастся заблокировать таблицы за указанное <em class="replaceable"><code>время_ожидания</code></em>. Это время можно задать в любом из форматов, принимаемых командой <code class="command">SET statement_timeout</code>. (Допустимые форматы зависят от версии сервера, выгружающего данные, но количество миллисекунд в виде целого числа принимают все версии.)</p></dd><dt><span class="term"><code class="option">--no-comments</code></span></dt><dd><p>Не выгружать комментарии.</p></dd><dt><span class="term"><code class="option">--no-publications</code></span></dt><dd><p>Не выгружать публикации.</p></dd><dt><span class="term"><code class="option">--no-security-labels</code></span></dt><dd><p>Не выгружать метки безопасности.</p></dd><dt><span class="term"><code class="option">--no-subscriptions</code></span></dt><dd><p>Не выгружать подписки.</p></dd><dt><span class="term"><code class="option">--no-sync</code></span></dt><dd><p>По умолчанию <code class="command">pg_dump</code> ждёт, пока все файлы не будут надёжно записаны на диск. С данным параметром <code class="command">pg_dump</code> завершается немедленно, то есть выполняется быстрее, но в случае неожиданного сбоя операционной системы выгруженные данные могут оказаться испорченными. Вообще этот параметр предназначен прежде всего для тестирования, для производственной среды он не подходит.</p></dd><dt><span class="term"><code class="option">--no-table-access-method</code></span></dt><dd><p>Не формировать команды для указания табличных методов доступа. При восстановлении все объекты будут создаваться с табличным методом доступа, выбираемым по умолчанию.</p><p>Этот параметр игнорируется, когда данные выгружаются в архивных форматах (не в текстовом). Для таких форматов данный параметр можно указать при вызове <code class="command">pg_restore</code>.</p></dd><dt><span class="term"><code class="option">--no-tablespaces</code></span></dt><dd><p>Не формировать команды для указания табличных пространств. При восстановлении все объекты будут создаваться в табличном пространстве по умолчанию.</p><p>Этот параметр игнорируется, когда данные выгружаются в архивных форматах (не в текстовом). Для таких форматов данный параметр можно указать при вызове <code class="command">pg_restore</code>.</p></dd><dt><span class="term"><code class="option">--no-toast-compression</code></span></dt><dd><p>Не выдавать команды, задающие методы сжатия <acronym class="acronym">TOAST</acronym>. С этим указанием все столбцы будут восстановлены с методом сжатия, выбранным по умолчанию.</p></dd><dt><span class="term"><code class="option">--no-unlogged-table-data</code></span></dt><dd><p>Не выгружать данные нежурналируемых таблиц и последовательностей. Параметр не влияет на выгрузку определений таблиц и последовательностей, он только подавляет вывод их содержимого. С резервного сервера содержимое нежурналируемых таблиц и последовательностей не выгружается никогда.</p></dd><dt><span class="term"><code class="option">--on-conflict-do-nothing</code></span></dt><dd><p>Добавить предложения <code class="literal">ON CONFLICT DO NOTHING</code> в команды <code class="command">INSERT</code>. Это указание допускается только при выборе режима <code class="option">--inserts</code>, <code class="option">--column-inserts</code> или <code class="option">--rows-per-insert</code>.</p></dd><dt><span class="term"><code class="option">--quote-all-identifiers</code></span></dt><dd><p>Принудительно экранировать все идентификаторы. Этот параметр рекомендуется при выгрузке базы, когда основная версия сервера <span class="productname">PostgreSQL</span>, с которого выгружается база, отличается от версии <span class="application">pg_dump</span>, или когда выгруженная копия предназначена для загрузки на сервере с другой основной версией. По умолчанию <span class="application">pg_dump</span> экранирует только те идентификаторы, которые являются зарезервированными словами в собственной основной версии. Иногда это приводит к проблемам совместимости с серверами других версий, в которых множество зарезервированных слов может быть несколько другим. Применение параметра <code class="option">--quote-all-identifiers</code> предотвращает подобные проблемы, ценой ухудшения читаемости скрипта с выгруженными данными.</p></dd><dt><span class="term"><code class="option">--rows-per-insert=<em class="replaceable"><code>число_строк</code></em></code></span></dt><dd><p>Выгружать данные таблиц в виде команд <code class="command">INSERT</code> вместо <code class="command">COPY</code>. В данном параметре задаётся максимальное число строк для одной команды <code class="command">INSERT</code>. Указанное в нём значение должно быть больше 0. При этом в случае каких-либо ошибок при загрузке данных будут потеряны только строки <code class="command">INSERT</code>, где возникли ошибки, но не всё содержимое таблицы.</p></dd><dt><span class="term"><code class="option">--section=<em class="replaceable"><code>имя_секции</code></em></code></span></dt><dd><p>Выгружать лишь указанную секцию. Имя секции может принимать значения <code class="option">pre-data</code>, <code class="option">data</code> или <code class="option">post-data</code>. Для выгрузки нескольких секций, параметр можно использовать несколько раз в одной команде. По умолчанию резервируются все секции.</p><p>Секция <code class="option">data</code> содержит непосредственно данные таблиц, больших объектов и значения последовательностей. Секция <code class="option">post-data</code> содержит определения индексов, триггеров, правил и ограничений (кроме ограничений проверки, созданных без <code class="option">NOT VALID</code> ). Секция <code class="option">pre-data</code> включает определения остальных элементов.</p></dd><dt><span class="term"><code class="option">--serializable-deferrable</code></span></dt><dd><p>Использовать при выгрузке транзакцию с уровнем изоляции <code class="literal">serializable</code> для получения снимка, согласованного с последующими состояниями базы. Правда для этого нужно выждать момент, когда в потоке транзакций нет аномалий, и поэтому нет риска, что выгрузка завершится неудачно, и риска отката других транзакций с ошибкой <code class="literal">serialization_failure</code>. Более подробно изоляция транзакций и управление одновременным доступом описывается в <a class="xref" href="mvcc.html" title="Глава 13. Управление конкурентным доступом">Главе 13</a>.</p><p>Параметр не особо полезен в случаях, когда требуется восстановление после сбоя. Он полезен для создания копии базы данных, в которой формируются отчёты и выполняются другие операции чтения, в то время как в основной базе продолжается обычная работа. Без этого параметра выгрузка может содержать не целостное состояние базы данных. Например, если используется пакетная обработка, статус пакета может отражаться как завершённый, в то время как в выгрузке будут не все элементы пакета.</p><p>Параметр не будет влиять на результат, если во время запуска <span class="application">pg_dump</span> нет активных транзакций на чтение-запись. Если же активные транзакции чтения-записи есть, то начало выгрузки может быть отложено на неопределённый период времени. После того как выгрузка началась, производительность с этим ключом или без него будет одинаковой.</p></dd><dt><span class="term"><code class="option">--snapshot=<em class="replaceable"><code>имя_снимка</code></em></code></span></dt><dd><p>Использовать заданный синхронный снимок при выгрузке данных из базы (за подробностями обратитесь к <a class="xref" href="functions-admin.html#FUNCTIONS-SNAPSHOT-SYNCHRONIZATION-TABLE" title="Таблица 9.94. Функции синхронизации снимков">Таблице 9.94</a>).</p><p>Этот параметр полезен, когда требуется синхронизировать выгружаемые данные со слотом логической репликации (см. <a class="xref" href="logicaldecoding.html" title="Глава 49. Логическое декодирование">Главу 49</a>) или с другим одновременным сеансом.</p><p>В случае с параллельной выгрузкой будет использоваться имя снимка, определённое этим параметром; новый снимок не будет сделан.</p></dd><dt><span class="term"><code class="option">--strict-names</code></span></dt><dd><p>Требует, чтобы каждому шаблону расширения (<code class="option">-e</code>/<code class="option">--extension</code>), схемы (<code class="option">-n</code>/<code class="option">--schema</code>) и таблицы (<code class="option">-t</code>/<code class="option">--table</code>) соответствовал минимум один объект расширение/схема/таблица в выгружаемой базе данных. Заметьте, что если не находится вообще ни одного такого объекта для заданных шаблонов, <span class="application">pg_dump</span> выдаёт ошибку и без ключа <code class="option">--strict-names</code>.</p><p>Этот параметр не действует на ключи <code class="option">-N</code>/<code class="option">--exclude-schema</code>, <code class="option">-T</code>/<code class="option">--exclude-table</code> или <code class="option">--exclude-table-data</code>. Если не находятся объекты, соответствующие шаблонам исключения, это не считается ошибкой.</p></dd><dt><span class="term"><code class="option">--table-and-children=<em class="replaceable"><code>шаблон</code></em></code></span></dt><dd><p>Этот параметр делает то же, что <code class="option">-t</code>/<code class="option">--table</code>, кроме того, что с ним также включаются любые наследуемые дочерние таблицы или секции таблиц, соответствующих <em class="replaceable"><code>шаблону</code></em>.</p></dd><dt><span class="term"><code class="option">--use-set-session-authorization</code></span></dt><dd><p>Выводить команды <code class="command">SET SESSION AUTHORIZATION</code>, соответствующие стандарту, вместо <code class="command">ALTER OWNER</code>, для назначения владельцев объектов. В результате выгруженный скрипт будет более стандартизированным, но может не восстановиться корректно, в зависимости от истории объектов. Кроме того, для использования <code class="command">SET SESSION AUTHORIZATION</code> при восстановлении нужны права суперпользователя, в то время как <code class="command">ALTER OWNER</code> требует меньших привилегий.</p></dd><dt><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help</code></span></dt><dd><p>Показать справку по аргументам командной строки <span class="application">pg_dump</span> и завершиться.</p></dd></dl></div><p>Далее описаны параметры управления подключением. </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-d <em class="replaceable"><code>имя_бд</code></em></code><br /></span><span class="term"><code class="option">--dbname=<em class="replaceable"><code>имя_бд</code></em></code></span></dt><dd><p>Указывает имя базы данных для подключения. Равнозначно указанию <em class="replaceable"><code>имя_бд</code></em> в первом аргументе, не являющемся ключом, в командной строке. Вместо имени может задаваться <a class="link" href="libpq-connect.html#LIBPQ-CONNSTRING" title="34.1.1. Строки параметров подключения">строка подключения</a>. В этом случае параметры в строке подключения переопределяют одноимённые параметры, заданные в командной строке.</p></dd><dt><span class="term"><code class="option">-h <em class="replaceable"><code>сервер</code></em></code><br /></span><span class="term"><code class="option">--host=<em class="replaceable"><code>сервер</code></em></code></span></dt><dd><p>Указывает имя компьютера, на котором работает сервер. Если значение начинается с косой черты, оно определяет каталог Unix-сокета. Значение по умолчанию берётся из переменной окружения <code class="envar">PGHOST</code>, если она установлена. В противном случае выполняется подключение к Unix-сокету.</p></dd><dt><span class="term"><code class="option">-p <em class="replaceable"><code>порт</code></em></code><br /></span><span class="term"><code class="option">--port=<em class="replaceable"><code>порт</code></em></code></span></dt><dd><p>Указывает TCP-порт или расширение файла локального Unix-сокета, через который сервер принимает подключения. Значение по умолчанию определяется переменной окружения <code class="envar">PGPORT</code>, если она установлена, либо числом, заданным при компиляции.</p></dd><dt><span class="term"><code class="option">-U <em class="replaceable"><code>имя_пользователя</code></em></code><br /></span><span class="term"><code class="option">--username=<em class="replaceable"><code>имя_пользователя</code></em></code></span></dt><dd><p>Имя пользователя, под которым производится подключение.</p></dd><dt><span class="term"><code class="option">-w</code><br /></span><span class="term"><code class="option">--no-password</code></span></dt><dd><p>Не выдавать запрос на ввод пароля. Если сервер требует аутентификацию по паролю и пароль не доступен с помощью других средств, таких как файл <code class="filename">.pgpass</code>, попытка соединения не удастся. Этот параметр может быть полезен в пакетных заданиях и скриптах, где нет пользователя, который вводит пароль.</p></dd><dt><span class="term"><code class="option">-W</code><br /></span><span class="term"><code class="option">--password</code></span></dt><dd><p>Принудительно запрашивать пароль перед подключением к базе данных.</p><p>Это несущественный параметр, так как <span class="application">pg_dump</span> запрашивает пароль автоматически, если сервер проверяет подлинность по паролю. Однако чтобы понять это, <span class="application">pg_dump</span> лишний раз подключается к серверу. Поэтому иногда имеет смысл ввести <code class="option">-W</code>, чтобы исключить эту ненужную попытку подключения.</p></dd><dt><span class="term"><code class="option">--role=<em class="replaceable"><code>имя роли</code></em></code></span></dt><dd><p>Задаёт имя роли, которая будет осуществлять выгрузку. Получив это имя, <span class="application">pg_dump</span> выполнит <code class="command">SET ROLE</code> <em class="replaceable"><code>имя_роли</code></em> после подключения к базе данных. Это полезно, когда проходящий проверку пользователь (указанный в <code class="option">-U</code>) не имеет прав, необходимых для <span class="application">pg_dump</span>, но может переключиться на роль, наделённую этими правами. В некоторых окружениях правила запрещают подключаться к серверу непосредственно суперпользователю, и этот параметр позволяет выполнить выгрузку, не нарушая их.</p></dd></dl></div></div><div class="refsect1" id="id-1.9.4.13.7"><h2>Переменные окружения</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="envar">PGDATABASE</code><br /></span><span class="term"><code class="envar">PGHOST</code><br /></span><span class="term"><code class="envar">PGOPTIONS</code><br /></span><span class="term"><code class="envar">PGPORT</code><br /></span><span class="term"><code class="envar">PGUSER</code></span></dt><dd><p>Параметры подключения по умолчанию.</p></dd><dt><span class="term"><code class="envar">PG_COLOR</code></span></dt><dd><p>Выбирает вариант использования цвета в диагностических сообщениях. Возможные значения: <code class="literal">always</code> (всегда), <code class="literal">auto</code> (автоматически) и <code class="literal">never</code> (никогда).</p></dd></dl></div><p>Эта утилита, как и большинство других утилит <span class="productname">PostgreSQL</span>, также использует переменные среды, поддерживаемые <span class="application">libpq</span> (см. <a class="xref" href="libpq-envars.html" title="34.15. Переменные окружения">Раздел 34.15</a>).</p></div><div class="refsect1" id="APP-PGDUMP-DIAGNOSTICS"><h2>Диагностика</h2><p><span class="application">pg_dump</span> на низком уровне выполняет команды <code class="command">SELECT</code>. Если есть проблемы с работой <span class="application">pg_dump</span>, убедитесь, что в базе данных можно выполнить <code class="command">SELECT</code>, например из <a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a>. Также следует учитывать, что при этом применяются все свойства подключения по умолчанию и переменные окружения, которые использует клиентская библиотека <span class="application">libpq</span>.</p><p>Обычно действия <span class="application">pg_dump</span> в базе данных отслеживаются системой накопительной статистики. Если это нежелательно, то можно установить параметр <code class="varname">track_counts</code> в false в переменной окружения <code class="envar">PGOPTIONS</code> или в команде <code class="literal">ALTER USER</code>.</p></div><div class="refsect1" id="PG-DUMP-NOTES"><h2>Замечания</h2><p>Если в базу данных кластера <code class="literal">template1</code> устанавливались дополнительные объекты, то следует убедиться, что выгрузка <span class="application">pg_dump</span> загружается в пустую базу данных. Иначе существует вероятность возникновения ошибок дублирования создаваемых объектов. Чтобы создать пустую базу данных, копируйте её из шаблона <code class="literal">template0</code>, вместо <code class="literal">template1</code>, например: </p><pre class="programlisting">CREATE DATABASE foo WITH TEMPLATE template0;</pre><p>Если выгружаются только данные с одновременным использованием <code class="option">--disable-triggers</code>, <span class="application">pg_dump</span> сформирует команды для выключения табличных триггеров перед вставкой данных, а после них — команды, включающие триггеры обратно. Если восстановление будет прервано в середине процесса, системный каталог может остаться в неверном состоянии.</p><p>Сформированный <span class="application">pg_dump</span> файл не содержит статистики, которую использует планировщик для принятия решений при планировании запросов. Поэтому после восстановления разумно будет выполнить <code class="command">ANALYZE</code> для достижения оптимальной производительности; за дополнительными сведениями обратитесь к <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-STATISTICS" title="25.1.3. Обновление статистики планировщика">Подразделу 25.1.3</a> и <a class="xref" href="routine-vacuuming.html#AUTOVACUUM" title="25.1.6. Демон автоочистки">Подразделу 25.1.6</a>.</p><p>Так как <span class="application">pg_dump</span> применяется для переноса данных в новые версии <span class="productname">PostgreSQL</span>, предполагается, что вывод <span class="application">pg_dump</span> можно загрузить на сервер <span class="productname">PostgreSQL</span> более новой версии, чем версия <span class="application">pg_dump</span>. <span class="application">pg_dump</span> может также выгружать данные серверов <span class="productname">PostgreSQL</span> более старых версий, чем его собственная. (В настоящее время поддерживаются версии, начиная с 9.2.) Однако утилита <span class="application">pg_dump</span> не может выгружать данные с серверов <span class="productname">PostgreSQL</span> более новых основных версий; она не будет даже пытаться делать это, во избежание некорректной выгрузки. Также не гарантируется, что вывод <span class="application">pg_dump</span> может быть загружен на сервере более старой основной версии — даже если данные были выгружены с сервера той же версии. Для загрузки такого файла на старом сервере может потребоваться вручную исправить в нём синтаксис, не воспринимаемый старой версией. Имея дело с разными версиями, рекомендуется применять параметр <code class="option">--quote-all-identifiers</code>, так как он может предотвратить проблемы, возникающие при изменении множества зарезервированных слов в разных версиях <span class="productname">PostgreSQL</span>.</p><p>Выгружая подписки на логическую репликацию, <span class="application">pg_dump</span> будет выдавать команды <code class="command">CREATE SUBSCRIPTION</code> с указанием <code class="literal">connect = false</code>, так что при восстановлении подписки не будут устанавливаться удалённые подключения для создания слота репликации или для начального копирования таблиц. Таким образом, выгруженные данные могут быть восстановлены без сетевого доступа к удалённым серверам. Вновь активировать подписки должным образом — задача пользователя. Если задействованные серверы поменялись, возможно, придётся скорректировать информацию о подключении. Также может быть уместно опустошить целевые таблицы перед началом полного копирования таблиц. Если пользователь намерен копировать исходные данные во время обновления, он должен создать слот с параметром <code class="literal">two_phase = false</code>. После начальной синхронизации параметр <a class="link" href="sql-createsubscription.html#SQL-CREATESUBSCRIPTION-WITH-TWO-PHASE"><code class="literal">two_phase</code></a> будет автоматически включён подписчиком, если подписка изначально была создана с параметром <code class="literal">two_phase = true</code>.</p></div><div class="refsect1" id="PG-DUMP-EXAMPLES"><h2>Примеры</h2><p>Выгрузка базы данных <code class="literal">mydb</code> в файл SQL-скрипта: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dump mydb &gt; db.sql</code></strong>
</pre><p>Восстановление из ранее полученного скрипта в чистую базу <code class="literal">newdb</code>: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>psql -d newdb -f db.sql</code></strong>
</pre><p>Выгрузка базы данных в специальном формате: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dump -Fc mydb &gt; db.dump</code></strong>
</pre><p>Выгрузка базы данных в формате каталога: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dump -Fd mydb -f dumpdir</code></strong>
</pre><p>Выгрузка базы данных в формате каталога в 5 параллельных потоков: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dump -Fd mydb -j 5 -f dumpdir</code></strong>
</pre><p>Восстановление из архива в чистую новую базу данных <code class="literal">newdb</code>: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_restore -d newdb db.dump</code></strong>
</pre><p>Восстановление архива в ту же базу данных, из которой он был выгружен, с предварительным удалением текущего содержимого этой базы данных: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_restore -d postgres --clean --create db.dump</code></strong>
</pre><p>Выгрузка отдельной таблицы <code class="literal">mytab</code>: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dump -t mytab mydb &gt; db.sql</code></strong>
</pre><p>Выгрузка всех таблиц, имена которых начинаются с <code class="literal">emp</code> и которые принадлежат схеме <code class="literal">detroit</code>, кроме таблицы <code class="literal">employee_log</code>: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dump -t 'detroit.emp*' -T detroit.employee_log mydb &gt; db.sql</code></strong>
</pre><p>Выгрузка всех схем, имена которых начинаются с <code class="literal">east</code> или <code class="literal">west</code>, заканчиваются на <code class="literal">gsm</code> и не содержат <code class="literal">test</code>: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dump -n 'east*gsm' -n 'west*gsm' -N '*test*' mydb &gt; db.sql</code></strong>
</pre><p>То же самое, но с использованием регулярного выражения: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dump -n '(east|west)*gsm' -N '*test*' mydb &gt; db.sql</code></strong>
</pre><p>Выгрузка всех объектов базы данных, кроме таблиц, имена которых начинаются с <code class="literal">ts_</code>: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dump -T 'ts_*' mydb &gt; db.sql</code></strong>
</pre><p>Чтобы указать имя в верхнем или смешанном регистре в ключе <code class="option">-t</code> и связанных с ним, это имя нужно заключить в кавычки; иначе оно будет приведено к нижнему регистру (см. <a class="xref" href="app-psql.html#APP-PSQL-PATTERNS" title="Шаблоны поиска">Шаблоны поиска</a>). Но кавычки являются спецсимволом для оболочки, поэтому и они, в свою очередь, должны заключаться в кавычки. Так, чтобы выгрузить одну таблицу с именем в смешанном регистре, нужно написать примерно следующее: </p><pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>pg_dump -t "\"MixedCaseName\"" mydb &gt; mytab.sql</code></strong>
</pre></div><div class="refsect1" id="id-1.9.4.13.11"><h2>См. также</h2><span class="simplelist"><a class="xref" href="app-pg-dumpall.html" title="pg_dumpall"><span class="refentrytitle"><span class="application">pg_dumpall</span></span></a>, <a class="xref" href="app-pgrestore.html" title="pg_restore"><span class="refentrytitle"><span class="application">pg_restore</span></span></a>, <a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="app-pgconfig.html" title="pg_config">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="reference-client.html" title="Клиентские приложения PostgreSQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="app-pg-dumpall.html" title="pg_dumpall">След.</a></td></tr><tr><td width="40%" align="left" valign="top"><span class="application">pg_config</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> <span class="application">pg_dumpall</span></td></tr></table></div></body></html>