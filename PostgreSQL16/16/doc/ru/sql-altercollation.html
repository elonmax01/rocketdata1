<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>ALTER COLLATION</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-alteraggregate.html" title="ALTER AGGREGATE" /><link rel="next" href="sql-alterconversion.html" title="ALTER CONVERSION" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">ALTER COLLATION</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-alteraggregate.html" title="ALTER AGGREGATE">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><th width="60%" align="center">Команды SQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-alterconversion.html" title="ALTER CONVERSION">След.</a></td></tr></table><hr /></div><div class="refentry" id="SQL-ALTERCOLLATION"><div class="titlepage"></div><a id="id-1.9.3.5.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">ALTER COLLATION</span></h2><p>ALTER COLLATION — изменить определение правила сортировки</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">ALTER COLLATION <em class="replaceable"><code>имя</code></em> REFRESH VERSION

ALTER COLLATION <em class="replaceable"><code>имя</code></em> RENAME TO <em class="replaceable"><code>новое_имя</code></em>
ALTER COLLATION <em class="replaceable"><code>имя</code></em> OWNER TO { <em class="replaceable"><code>новый_владелец</code></em> | CURRENT_ROLE | CURRENT_USER | SESSION_USER }
ALTER COLLATION <em class="replaceable"><code>имя</code></em> SET SCHEMA <em class="replaceable"><code>новая_схема</code></em></pre></div><div class="refsect1" id="id-1.9.3.5.5"><h2>Описание</h2><p><code class="command">ALTER COLLATION</code> изменяет определение правила сортировки.</p><p>Выполнить <code class="command">ALTER COLLATION</code> может только владелец соответствующего правила сортировки. Чтобы сменить владельца, необходимо иметь право <code class="literal">SET ROLE</code> для новой роли-владельца, а эта роль должна иметь право <code class="literal">CREATE</code> в схеме правила сортировки. (С такими ограничениями при смене владельца не происходит ничего такого, что нельзя было бы сделать, имея право удалить и вновь создать правило сортировки. Однако суперпользователь может сменить владельца правила сортировки в любом случае.)</p></div><div class="refsect1" id="id-1.9.3.5.6"><h2>Параметры</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>имя</code></em></span></dt><dd><p>Имя существующего правила сортировки (возможно, дополненное схемой).</p></dd><dt><span class="term"><em class="replaceable"><code>новое_имя</code></em></span></dt><dd><p>Новое имя правила сортировки.</p></dd><dt><span class="term"><em class="replaceable"><code>новый_владелец</code></em></span></dt><dd><p>Новый владелец правила сортировки.</p></dd><dt><span class="term"><em class="replaceable"><code>новая_схема</code></em></span></dt><dd><p>Новая схема правила сортировки.</p></dd><dt><span class="term"><code class="literal">REFRESH VERSION</code></span></dt><dd><p>Обновить версию правила сортировки. Подробности в разделе <a class="xref" href="sql-altercollation.html#SQL-ALTERCOLLATION-NOTES" title="Замечания">Замечания</a> ниже.</p></dd></dl></div></div><div class="refsect1" id="SQL-ALTERCOLLATION-NOTES"><h2>Замечания</h2><p>Когда создаётся объект правила сортировки, в системный каталог записывается версия этого правила, определяемая его провайдером. Когда такое правило используется, текущая версия сравнивается с записанной и в случае несовпадения выдаётся предупреждение, например такое: </p><pre class="screen">
WARNING:  collation "xx-x-icu" has version mismatch
DETAIL:  The collation in the database was created using version 1.2.3.4, but the operating system provides version 2.3.4.5.
HINT:  Rebuild all objects affected by this collation and run ALTER COLLATION pg_catalog."xx-x-icu" REFRESH VERSION, or build PostgreSQL with the right library version.
</pre><p> Изменения в определениях правил сортировки могут приводить к разрушению индексов и другим проблемам, так как СУБД рассчитывает на то, что хранимые объекты отсортированы в определённом порядке. Вообще этого следует избегать, но это может иметь место в совершенно легальных обстоятельствах, например при переходе на более новую версию ОС или при обновлении с использованием <code class="command">pg_upgrade</code> исполняемых файлов сервера, скомпонованных с более новой версией ICU. Когда возникает такая ситуация, все объекты, зависящие от данного правила сортировки, должны быть перестроены, например командой <code class="command">REINDEX</code>. После этой операции можно обновить версию правила сортировки, выполнив команду <code class="literal">ALTER COLLATION ... REFRESH VERSION</code>. При этом системный каталог будет обновлён, в него будет записана текущая версия правила, и предупреждение уйдёт. Заметьте, что эта команда собственно не проверяет, были ли все зависимые объекты перестроены корректно.</p><p>Когда применяются правила сортировки, предоставляемые библиотекой <code class="literal">libc</code>, информация о версии записывается в системах, где используется GNU C (в большинстве ОС Linux), а также во FreeBSD и Windows. Когда применяются правила сортировки, которые предоставляет библиотека ICU, информация о версии выдаётся библиотекой ICU и доступна на всех платформах.</p><div class="note"><h3 class="title">Примечание</h3><p>Когда правила сортировки предоставляются библиотекой GNU C, версии этих правил косвенным образом определяются по версии библиотеки. Во многих дистрибутивах Linux определения правил сортировки меняются только при обновлении библиотеки C, но возможны исключения, так как авторы дистрибутива могут по своему желанию перенести обновлённые определения в старые версии библиотеки.</p><p>В Windows информация о версии правил сортировки доступна только для правил, определённых с меткой языка в формате BCP 47, например <code class="literal">en-US</code>.</p></div><p>Для основного правила сортировки базы данных существует аналогичная команда <code class="literal">ALTER DATABASE ... REFRESH COLLATION VERSION</code>.</p><p>Следующий запрос позволяет выбрать все правила сортировки в текущей базе данных, которые требуют обновления, и зависящие от них объекты: </p><pre class="programlisting">
SELECT pg_describe_object(refclassid, refobjid, refobjsubid) AS "Collation",
       pg_describe_object(classid, objid, objsubid) AS "Object"
  FROM pg_depend d JOIN pg_collation c
       ON refclassid = 'pg_collation'::regclass AND refobjid = c.oid
  WHERE c.collversion &lt;&gt; pg_collation_actual_version(c.oid)
  ORDER BY 1, 2;
</pre></div><div class="refsect1" id="id-1.9.3.5.8"><h2>Примеры</h2><p>Переименование правила сортировки <code class="literal">de_DE</code> в <code class="literal">german</code>: </p><pre class="programlisting">ALTER COLLATION "de_DE" RENAME TO german;</pre><p>Изменение владельца правила сортировки <code class="literal">en_US</code> на <code class="literal">joe</code>: </p><pre class="programlisting">ALTER COLLATION "en_US" OWNER TO joe;</pre></div><div class="refsect1" id="id-1.9.3.5.9"><h2>Совместимость</h2><p>Оператор <code class="command">ALTER COLLATION</code> отсутствует в стандарте SQL.</p></div><div class="refsect1" id="id-1.9.3.5.10"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-createcollation.html" title="CREATE COLLATION"><span class="refentrytitle">CREATE COLLATION</span></a>, <a class="xref" href="sql-dropcollation.html" title="DROP COLLATION"><span class="refentrytitle">DROP COLLATION</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-alteraggregate.html" title="ALTER AGGREGATE">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-alterconversion.html" title="ALTER CONVERSION">След.</a></td></tr><tr><td width="40%" align="left" valign="top">ALTER AGGREGATE </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> ALTER CONVERSION</td></tr></table></div></body></html>