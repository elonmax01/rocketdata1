<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>35.4. Серверные функции</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="lo-interfaces.html" title="35.3. Клиентские интерфейсы" /><link rel="next" href="lo-examplesect.html" title="35.5. Пример программы" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">35.4. Серверные функции</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="lo-interfaces.html" title="35.3. Клиентские интерфейсы">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="largeobjects.html" title="Глава 35. Большие объекты">Наверх</a></td><th width="60%" align="center">Глава 35. Большие объекты</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="lo-examplesect.html" title="35.5. Пример программы">След.</a></td></tr></table><hr /></div><div class="sect1" id="LO-FUNCS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">35.4. Серверные функции <a href="#LO-FUNCS" class="id_link">#</a></h2></div></div></div><p>Функции, предназначенные для работы с большими объектами на стороне сервера из SQL, перечислены в <a class="xref" href="lo-funcs.html#LO-FUNCS-TABLE" title="Таблица 35.1. SQL-ориентированные функции для работы с большими объектами">Таблице 35.1</a>.</p><div class="table" id="LO-FUNCS-TABLE"><p class="title"><strong>Таблица 35.1. SQL-ориентированные функции для работы с большими объектами</strong></p><div class="table-contents"><table class="table" summary="SQL-ориентированные функции для работы с большими объектами" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">Функция</p>
       <p>Описание</p>
       <p>Примеры</p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.7.4.9.3.2.2.1.1.1.1" class="indexterm"></a> <code class="function">lo_from_bytea</code> ( <em class="parameter"><code>loid</code></em> <code class="type">oid</code>, <em class="parameter"><code>data</code></em> <code class="type">bytea</code> ) → <code class="returnvalue">oid</code></p>
       <p>Создаёт большой объёкт и сохраняет в нём переданные данные (<em class="parameter"><code>data</code></em>). Если <em class="parameter"><code>loid</code></em> равен нулю, система выбирает свободный OID, а иначе использует заданный идентификатор OID (и выдаёт ошибку, если этот OID уже назначен какому-то большому объекту). В случае успеха возвращается OID созданного большого объекта.</p>
       <p>
        <code class="literal">lo_from_bytea(0, '\xffffff00')</code>
        → <code class="returnvalue">24528</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.7.4.9.3.2.2.2.1.1.1" class="indexterm"></a> <code class="function">lo_put</code> ( <em class="parameter"><code>loid</code></em> <code class="type">oid</code>, <em class="parameter"><code>offset</code></em> <code class="type">bigint</code>, <em class="parameter"><code>data</code></em> <code class="type">bytea</code> ) → <code class="returnvalue">void</code></p>
       <p>Записывает данные (<em class="parameter"><code>data</code></em>) в большой объект по заданному смещению; в случае необходимости большой объект расширяется.</p>
       <p>
        <code class="literal">lo_put(24528, 1, '\xaa')</code>
        → <code class="returnvalue"></code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature"><a id="id-1.7.4.9.3.2.2.3.1.1.1" class="indexterm"></a> <code class="function">lo_get</code> ( <em class="parameter"><code>loid</code></em> <code class="type">oid</code> [<span class="optional">, <em class="parameter"><code>offset</code></em> <code class="type">bigint</code>, <em class="parameter"><code>length</code></em> <code class="type">integer</code></span>] ) → <code class="returnvalue">bytea</code></p>
       <p>Извлекает содержимое большого объекта или его часть.</p>
       <p>
        <code class="literal">lo_get(24528, 0, 3)</code>
        → <code class="returnvalue">\xffaaff</code>
       </p></td></tr></tbody></table></div></div><br class="table-break" /><p>Каждой из клиентских функций, описанных ранее, соответствуют дополнительные функции на стороне сервера; на самом деле, по большей части клиентские функции представляют собой просто интерфейсы к равнозначным серверным функциям. К функциям, которые так же удобно вызывать командами SQL, относятся: <code class="function">lo_creat</code><a id="id-1.7.4.9.4.2" class="indexterm"></a>, <code class="function">lo_create</code>, <code class="function">lo_unlink</code><a id="id-1.7.4.9.4.5" class="indexterm"></a>, <code class="function">lo_import</code><a id="id-1.7.4.9.4.7" class="indexterm"></a> и <code class="function">lo_export</code><a id="id-1.7.4.9.4.9" class="indexterm"></a>. Ниже приведены примеры их использования: </p><pre class="programlisting">CREATE TABLE image (
    name            text,
    raster          oid
);

SELECT lo_creat(-1);       -- возвращает OID нового пустого большого объекта

SELECT lo_create(43213);   -- пытается создать большой объект с OID 43213

SELECT lo_unlink(173454);  -- удаляет большой объект с OID 173454

INSERT INTO image (name, raster)
    VALUES ('beautiful image', lo_import('/etc/motd'));

INSERT INTO image (name, raster)  -- то же, что выше, но с предопределённым OID
    VALUES ('beautiful image', lo_import('/etc/motd', 68583));

SELECT lo_export(image.raster, '/tmp/motd') FROM image
    WHERE name = 'beautiful image';</pre><p>Серверные функции <code class="function">lo_import</code> и <code class="function">lo_export</code> значительно отличаются от их аналогов, выполняемых на стороне клиента. Эти две функции читают и пишут файлы в файловой системе сервера с правами пользователя-владельца базы данных. Поэтому по умолчанию использовать их разрешено только суперпользователям. Клиентские функции импорта и экспорта, напротив, используют права клиентской программы для чтения и записи файлов в файловой системе клиента. Для выполнения клиентских функций никакие права в базе данных не требуется, кроме права на чтение или запись требуемого большого объекта.</p><div class="caution"><h3 class="title">Внимание</h3><p>Использование серверных функций <code class="function">lo_import</code> и <code class="function">lo_export</code> можно разрешить (воспользовавшись <a class="xref" href="sql-grant.html" title="GRANT"><span class="refentrytitle">GRANT</span></a>) не только суперпользователям, но при этом следует серьёзно оценить возможные угрозы безопасности. Злонамеренный пользователь, имея такие права, легко может стать суперпользователем (например, перезаписав файлы конфигурации сервера) или атаковать другие области файловой системы сервера, не стремясь получить полномочия суперпользователя в базе данных. <span class="emphasis"><em>Поэтому доступ к ролям с такими правами должен ограничиваться так же строго, как и доступ к ролям суперпользователей.</em></span> Тем не менее, если серверные функции <code class="function">lo_import</code> и <code class="function">lo_export</code> необходимо применять для каких-либо регулярных операций, безопаснее будет использовать роль с такими правами, чем с правами суперпользователя, так как это помогает предохраниться от случайных ошибок.</p></div><p>Функциональность <code class="function">lo_read</code> и <code class="function">lo_write</code> также представляется через вызовы на стороне сервера, но имена серверных функций, в отличие от клиентских, не содержат символы подчёркивания. Эти функции нужно вызывать по именам <code class="function">loread</code> и <code class="function">lowrite</code>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="lo-interfaces.html" title="35.3. Клиентские интерфейсы">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="largeobjects.html" title="Глава 35. Большие объекты">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="lo-examplesect.html" title="35.5. Пример программы">След.</a></td></tr><tr><td width="40%" align="left" valign="top">35.3. Клиентские интерфейсы </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 35.5. Пример программы</td></tr></table></div></body></html>