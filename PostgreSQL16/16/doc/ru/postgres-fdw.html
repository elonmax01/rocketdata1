<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.38. postgres_fdw — обращение к данным, находящимся на внешних серверах PostgreSQL</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="pgwalinspect.html" title="F.37. pg_walinspect — просмотр журнала предзаписи на низком уровне" /><link rel="next" href="seg.html" title="F.39. seg — тип данных для отрезков или интервалов чисел с плавающей точкой" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.38. postgres_fdw — обращение к данным, находящимся на внешних серверах <span class="productname">PostgreSQL</span></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="pgwalinspect.html" title="F.37. pg_walinspect — просмотр журнала предзаписи на низком уровне">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><th width="60%" align="center">Приложение F. Дополнительно поставляемые модули и расширения</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="seg.html" title="F.39. seg — тип данных для отрезков или интервалов чисел с плавающей точкой">След.</a></td></tr></table><hr /></div><div class="sect1" id="POSTGRES-FDW"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.38. postgres_fdw — обращение к данным, находящимся на внешних серверах <span class="productname">PostgreSQL</span> <a href="#POSTGRES-FDW" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="postgres-fdw.html#POSTGRES-FDW-OPTIONS">F.38.1. Параметры обёртки для postgres_fdw</a></span></dt><dt><span class="sect2"><a href="postgres-fdw.html#POSTGRES-FDW-FUNCTIONS">F.38.2. Функции</a></span></dt><dt><span class="sect2"><a href="postgres-fdw.html#POSTGRES-FDW-CONNECTION-MANAGEMENT">F.38.3. Управление соединением</a></span></dt><dt><span class="sect2"><a href="postgres-fdw.html#POSTGRES-FDW-TRANSACTION-MANAGEMENT">F.38.4. Управление транзакциями</a></span></dt><dt><span class="sect2"><a href="postgres-fdw.html#POSTGRES-FDW-REMOTE-QUERY-OPTIMIZATION">F.38.5. Оптимизация удалённых запросов</a></span></dt><dt><span class="sect2"><a href="postgres-fdw.html#POSTGRES-FDW-REMOTE-QUERY-EXECUTION-ENVIRONMENT">F.38.6. Окружение удалённого выполнения запросов</a></span></dt><dt><span class="sect2"><a href="postgres-fdw.html#POSTGRES-FDW-CROSS-VERSION-COMPATIBILITY">F.38.7. Совместимость с разными версиями</a></span></dt><dt><span class="sect2"><a href="postgres-fdw.html#POSTGRES-FDW-CONFIGURATION-PARAMETERS">F.38.8. Параметры конфигурации</a></span></dt><dt><span class="sect2"><a href="postgres-fdw.html#POSTGRES-FDW-EXAMPLES">F.38.9. Примеры</a></span></dt><dt><span class="sect2"><a href="postgres-fdw.html#POSTGRES-FDW-AUTHOR">F.38.10. Автор</a></span></dt></dl></div><a id="id-1.11.7.48.2" class="indexterm"></a><p>Модуль <code class="filename">postgres_fdw</code> предоставляет обёртку сторонних данных <code class="literal">postgres_fdw</code>, используя которую можно обращаться к данным, находящимся на внешних серверах <span class="productname">PostgreSQL</span>.</p><p>Функциональность этого модуля во многом пересекается с функциональностью старого модуля <a class="xref" href="dblink.html" title="F.12. dblink — подключение к другим базам данных PostgreSQL">dblink</a>. Однако <code class="filename">postgres_fdw</code> предоставляет более прозрачный и стандартизированный синтаксис для обращения к удалённым таблицам и во многих случаях даёт лучшую производительность.</p><p>Чтобы подготовиться к обращению к удалённым данным через <code class="filename">postgres_fdw</code>: </p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>Установите расширение <code class="filename">postgres_fdw</code> с помощью команды <a class="xref" href="sql-createextension.html" title="CREATE EXTENSION"><span class="refentrytitle">CREATE EXTENSION</span></a>.</p></li><li class="listitem"><p>Создайте объект стороннего сервера, используя <a class="xref" href="sql-createserver.html" title="CREATE SERVER"><span class="refentrytitle">CREATE SERVER</span></a>, который будет представлять удалённую базу данных, к которой вы хотите подключаться. Укажите свойства подключения, кроме <code class="literal">user</code> и <code class="literal">password</code>, в параметрах объекта сервера.</p></li><li class="listitem"><p>Создайте сопоставление пользователей, используя <a class="xref" href="sql-createusermapping.html" title="CREATE USER MAPPING"><span class="refentrytitle">CREATE USER MAPPING</span></a>, для каждого пользователя базы, которому нужен доступ к удалённому серверу. Укажите имя и пароль удалённого пользователя в параметрах <code class="literal">user</code> и <code class="literal">password</code> сопоставления.</p></li><li class="listitem"><p>Создайте стороннюю таблицу, используя <a class="xref" href="sql-createforeigntable.html" title="CREATE FOREIGN TABLE"><span class="refentrytitle">CREATE FOREIGN TABLE</span></a> или <a class="xref" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA"><span class="refentrytitle">IMPORT FOREIGN SCHEMA</span></a>, для каждой удалённой таблицы, к которой вы хотите обращаться. Столбцы сторонней таблицы должны соответствовать столбцам целевой удалённой таблицы. Однако вы можете использовать локально имена таблиц и/или столбцов, отличные от удалённых, если укажете корректные удалённые имена в параметрах объекта сторонней таблицы.</p></li></ol></div><p>После этого для обращения к данным, хранящимся в нижележащей удалённой таблице, вам нужно только выполнять <code class="command">SELECT</code>. Вы также можете изменять данные в удалённой таблице, выполняя <code class="command">INSERT</code>, <code class="command">UPDATE</code>, <code class="command">DELETE</code>, <code class="command">COPY</code> или <code class="command">TRUNCATE</code>. (Разумеется, удалённый пользователь, указанный в сопоставлении, должен иметь необходимые права для этого.)</p><p>Обратите внимание, что в запросах на чтение или изменение данных в удалённых таблицах указание <code class="literal">ONLY</code> в командах <code class="command">SELECT</code>, <code class="command">UPDATE</code>, <code class="command">DELETE</code> и <code class="command">TRUNCATE</code> не действует.</p><p>Заметьте, что в настоящее время в <code class="filename">postgres_fdw</code> не поддерживаются операторы <code class="command">INSERT</code> с предложением <code class="literal">ON CONFLICT DO UPDATE</code>. Однако предложение <code class="literal">ON CONFLICT DO NOTHING</code> поддерживается, при отсутствии указания для выбора уникального индекса. Заметьте также, что <code class="filename">postgres_fdw</code> поддерживает перемещение строк, вызванное командами <code class="command">UPDATE</code>, выполняемыми для секционированных таблиц. Однако в настоящее время невозможно выполнить изменение, при котором удалённая секция, выбранная для добавления перемещаемой строки, также является целевой секцией для <code class="command">UPDATE</code> и должна модифицироваться в другой части той же команды.</p><p>Обычно рекомендуется объявлять столбцы сторонней таблицы точно с теми же типами данных и правилами сортировки, если они применимы, как у целевых столбцов удалённой таблицы. Хотя <code class="filename">postgres_fdw</code> в настоящее время довольно лоялен к преобразованиям типов данных при необходимости, но когда типы или правила сортировки не совпадают, возможны неожиданные семантические аномалии, вследствие того, что удалённый сервер будет обрабатывать условия запроса не так, как локальный сервер.</p><p>Заметьте, что сторонняя таблица может быть объявлена с меньшим количеством или с другим порядком столбцов, чем в нижележащей удалённой таблице. Сопоставление столбцов удалённой таблицы осуществляется по имени, а не по позиции.</p><div class="sect2" id="POSTGRES-FDW-OPTIONS"><div class="titlepage"><div><div><h3 class="title">F.38.1. Параметры обёртки для postgres_fdw <a href="#POSTGRES-FDW-OPTIONS" class="id_link">#</a></h3></div></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-CONNECTION"><div class="titlepage"><div><div><h4 class="title">F.38.1.1. Параметры подключения <a href="#POSTGRES-FDW-OPTIONS-CONNECTION" class="id_link">#</a></h4></div></div></div><p>Для стороннего сервера, настраиваемого с использованием обёртки сторонних данных <code class="filename">postgres_fdw</code>, можно задать те же параметры, что принимает <span class="application">libpq</span> в строках подключения, как описано в <a class="xref" href="libpq-connect.html#LIBPQ-PARAMKEYWORDS" title="34.1.2. Ключевые слова-параметры">Подразделе 34.1.2</a>, за исключением следующих параметров, которые не допускаются или обрабатывается по-другому: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">user</code>, <code class="literal">password</code> и <code class="literal">sslpassword</code> (их следует задавать в сопоставлениях пользователей или в файле описания служб)</p></li><li class="listitem"><p><code class="literal">client_encoding</code> (автоматически принимается равной локальной кодировке сервера)</p></li><li class="listitem"><p><code class="literal">application_name</code> может задаваться как параметр подключения <span class="emphasis"><em>и/или</em></span> значение <a class="xref" href="postgres-fdw.html#GUC-PGFDW-APPLICATION-NAME">postgres_fdw.application_name</a>. Если задаётся и там, и там, <code class="varname">postgres_fdw.application_name</code> переопределяет значение параметра подключения. В отличие от <span class="application">libpq</span>, <code class="filename">postgres_fdw</code> допускает использование спецпоследовательностей в <code class="varname">application_name</code>. За дополнительной информацией обратитесь к <a class="xref" href="postgres-fdw.html#GUC-PGFDW-APPLICATION-NAME">postgres_fdw.application_name</a>.</p></li><li class="listitem"><p><code class="literal">fallback_application_name</code> (всегда <code class="literal">postgres_fdw</code>)</p></li><li class="listitem"><p><code class="literal">sslkey</code> и <code class="literal">sslcert</code> могут задаваться в свойствах соединения и/или сопоставления пользователя. Если они задаются и там, и там, приоритет имеет свойство сопоставления пользователя.</p></li></ul></div><p>Создавать и изменять сопоставления пользователей, устанавливающие параметр <code class="literal">sslcert</code> или <code class="literal">sslkey</code>, могут только суперпользователи.</p><p>Обычные пользователи могут подключаться к сторонним серверам с аутентификацией по паролю или с делегированными учётными данными GSSAPI, поэтому в сопоставлениях для обычных пользователей, где требуется аутентификация по паролю, необходимо указывать параметр <code class="literal">password</code>.</p><p>Суперпользователь может отключить проверку пароля на уровне сопоставления пользователя, установив параметр <code class="literal">password_required 'false'</code>, например: </p><pre class="programlisting">ALTER USER MAPPING FOR some_non_superuser SERVER loopback_nopw
OPTIONS (ADD password_required 'false');</pre><p> Чтобы недоверенные пользователи не могли злоупотреблять правами пользователя, от имени которого работает сервер postgres, и повысить свои привилегии, изменять это свойство в сопоставлении пользователя разрешено только суперпользователю.</p><p>Позаботьтесь о том, чтобы через установленное сопоставление пользователь не мог подключиться к другой базе с правами суперпользователя, как в случаях CVE-2007-3278 и CVE-2007-6601. Не задавайте параметр <code class="literal">password_required=false</code> для роли <code class="literal">public</code>. Помните, что сопоставляемый пользователь имеет возможность использовать любые клиентские сертификаты, а также записи в файлах <code class="filename">.pgpass</code>, <code class="filename">.pg_service.conf</code> и т. п. в домашнем каталоге системного пользователя, от имени которого работает сервер postgres. Они также могут использовать отношения доверия, установленные режимами аутентификации, например <code class="literal">peer</code> или <code class="literal">ident</code>.</p></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-OBJECT-NAME"><div class="titlepage"><div><div><h4 class="title">F.38.1.2. Параметры имени объекта <a href="#POSTGRES-FDW-OPTIONS-OBJECT-NAME" class="id_link">#</a></h4></div></div></div><p>Эти параметры позволяют управлять тем, как на удалённый сервер <span class="productname">PostgreSQL</span> будут передаваться имена, фигурирующие в операторах SQL. Данные параметры нужны, когда сторонняя таблица создаётся с именами, отличными от имён удалённой таблицы.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">schema_name</code> (<code class="type">string</code>)</span></dt><dd><p>Этот параметр, который может задаваться для сторонней таблицы, указывает имя схемы для обращения к этой таблице на удалённом сервере. Если данный параметр опускается, применяется схема сторонней таблицы.</p></dd><dt><span class="term"><code class="literal">table_name</code> (<code class="type">string</code>)</span></dt><dd><p>Этот параметр, который может задаваться для сторонней таблицы, указывает имя таблицы для обращения к этой таблице на удалённом сервере. Если данный параметр опускается, применяется имя сторонней таблицы.</p></dd><dt><span class="term"><code class="literal">column_name</code> (<code class="type">string</code>)</span></dt><dd><p>Этот параметр, который может задаваться для столбца сторонней таблицы, указывает имя столбца для обращения к этому столбцу на удалённом сервере. Если данный параметр опускается, применяется исходное имя столбца.</p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-COST-ESTIMATION"><div class="titlepage"><div><div><h4 class="title">F.38.1.3. Параметры оценки стоимости <a href="#POSTGRES-FDW-OPTIONS-COST-ESTIMATION" class="id_link">#</a></h4></div></div></div><p>Модуль <code class="filename">postgres_fdw</code> получает удалённые данные, выполняя запросы на удалённых серверах, поэтому в идеале ожидаемая стоимость сканирования сторонней таблицы должна равняться стоимости выполнения на удалённом сервере плюс издержки сетевого взаимодействия. Самый надёжный способ получить такие оценки — узнать стоимость у удалённого сервера и добавить некоторую надбавку — но для простых запросов может быть невыгодно передавать дополнительный запрос, только чтобы получить оценку стоимости. Поэтому <code class="filename">postgres_fdw</code> предоставляет следующие параметры, позволяющие управлять вычислением оценки стоимости:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">use_remote_estimate</code> (<code class="type">boolean</code>)</span></dt><dd><p>Этот параметр, который может задаваться для сторонней таблицы или для стороннего сервера, определяет, будет ли <code class="filename">postgres_fdw</code> выполнять удалённо команды <code class="command">EXPLAIN</code> для получения оценок стоимости. Параметр, заданный для сторонней таблицы, переопределяет параметр сервера, но только для данной таблицы. Значение по умолчанию — <code class="literal">false</code> (выкл.).</p></dd><dt><span class="term"><code class="literal">fdw_startup_cost</code> (<code class="type">floating point</code>)</span></dt><dd><p>Этот параметр, который может задаваться для стороннего сервера, устанавливает значение с плавающей точкой, добавляемое к оценке стоимости запуска для любого сканирования сторонней таблицы на этом сервере. Он выражает дополнительные издержки на установление подключения, разбор и планирование запроса на удалённой стороне и т. д. Значение по умолчанию — <code class="literal">100</code>.</p></dd><dt><span class="term"><code class="literal">fdw_tuple_cost</code> (<code class="type">floating point</code>)</span></dt><dd><p>Этот параметр, который может задаваться для стороннего сервера, устанавливает значение с плавающей точкой, выражающее дополнительную цену чтения одного кортежа из сторонней таблицы на этом сервере. Это число можно увеличить или уменьшить, отражая меньшую или большую фактическую скорость сетевого взаимодействия с удалённым сервером. Значение по умолчанию — <code class="literal">0.01</code>.</p></dd></dl></div><p>Когда поведение <code class="literal">use_remote_estimate</code> включено, <code class="filename">postgres_fdw</code> получает количество строк и оценку стоимости с удалённого сервера, а затем добавляет к оценке стоимости <code class="literal">fdw_startup_cost</code> и <code class="literal">fdw_tuple_cost</code>. Когда поведение <code class="literal">use_remote_estimate</code> отключено, <code class="filename">postgres_fdw</code> рассчитывает число строк и оценку стоимости локально, а затем так же добавляет к этой оценке <code class="literal">fdw_startup_cost</code> и <code class="literal">fdw_tuple_cost</code>. Локальная оценка может быть точной только при условии наличия локальной копии статистики удалённых таблиц. Обновить эту статистику для сторонней таблицы можно с помощью команды <a class="xref" href="sql-analyze.html" title="ANALYZE"><span class="refentrytitle">ANALYZE</span></a>; при этом удалённая таблица будет просканирована, и по её содержимому будут вычислена и сохранена статистика как для локальной таблицы. Локальное хранение статистики может быть полезно для сокращения издержек планирования для удалённой таблицы — но если удалённая таблица меняется часто, локальная статистика будет быстро устаревать.</p><p>Следующий параметр определяет поведение операции <code class="command">ANALYZE</code>:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">analyze_sampling</code> (<code class="type">string</code>)</span></dt><dd><p>Этот параметр, который может быть указан для сторонней таблицы или стороннего сервера, определяет логику работы <code class="command">ANALYZE</code>: будут ли данные при применении команды для сторонней таблицы выбираться на стороннем сервере или все данные будут считываться и переноситься для выборки локально. Поддерживаются значения <code class="literal">off</code>, <code class="literal">random</code>, <code class="literal">system</code>, <code class="literal">bernoulli</code> и <code class="literal">auto</code>. Значение <code class="literal">off</code> позволяет отключать выборку данных на стороннем сервере, в результате чего все данные переносятся и выборка выполняется локально. Значение <code class="literal">random</code> позволяет производить удалённую выборку данных с помощью функции <code class="function">random()</code>, тогда как при значениях <code class="literal">system</code> и <code class="literal">bernoulli</code> используются встроенные методы <code class="literal">TABLESAMPLE</code> с соответствующими названиями. <code class="literal">random</code> работает со всеми версиями сторонних серверов, тогда как <code class="literal">TABLESAMPLE</code> поддерживается только в версии 9.5 и новее. При значении <code class="literal">auto</code> (по умолчанию) метод выборки выбирается автоматически — сейчас это <code class="literal">bernoulli</code> или <code class="literal">random</code> в зависимости от версии стороннего сервера.</p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-REMOTE-EXECUTION"><div class="titlepage"><div><div><h4 class="title">F.38.1.4. Параметры удалённого выполнения <a href="#POSTGRES-FDW-OPTIONS-REMOTE-EXECUTION" class="id_link">#</a></h4></div></div></div><p>По умолчанию ограничения <code class="literal">WHERE</code>, содержащие встроенные операторы и функции, обрабатываются на удалённом сервере, а ограничения, содержащие вызовы не встроенных функций, проверяются локально после получения строк. Если же расширенные функции доступны на удалённом сервере и можно рассчитывать, что они дадут те же результаты, что и локально, производительность можно увеличить, передавая и такие предложения <code class="literal">WHERE</code> для удалённого выполнения. Этим поведением позволяет управлять следующий параметр:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">extensions</code> (<code class="type">string</code>)</span></dt><dd><p>В этом параметре задаётся список имён расширений <span class="productname">PostgreSQL</span> через запятую, которые установлены и имеют совместимые версии и на локальном, и на удалённом сервере. Относящиеся к перечисленным расширениям и при этом постоянные (immutable) функции и операторы могут передаваться на выполнение удалённому серверу. Этот параметр можно задать только для стороннего сервера, но не для таблицы.</p><p>При использовании параметра <code class="literal">extensions</code> <span class="emphasis"><em>пользователь сам отвечает</em></span> за то, чтобы перечисленные расширения существовали и их поведение было одинаковым на локальном и удалённом сервере. В противном случае удалённые запросы могут выдавать ошибки или неожиданные результаты.</p></dd><dt><span class="term"><code class="literal">fetch_size</code> (<code class="type">integer</code>)</span></dt><dd><p>Этот параметр определяет, сколько строк должна получать <code class="filename">postgres_fdw</code> в одной операции выборки. Его можно задать для сторонней таблицы или стороннего сервера. Значение по умолчанию — <code class="literal">100</code> строк.</p></dd><dt><span class="term"><code class="literal">batch_size</code> (<code class="type">integer</code>)</span></dt><dd><p>Этот параметр определяет, сколько строк должна вставлять <code class="filename">postgres_fdw</code> в одной операции вставки. Его можно задать для сторонней таблицы или стороннего сервера. Значение по умолчанию — <code class="literal">1</code> строка.</p><p>Обратите внимание, что фактическое количество строк, вставляемых <code class="filename">postgres_fdw</code> в одной порции, зависит от количества столбцов и значения <code class="literal">batch_size</code>. Порция передаётся в одном запросе, а протокол libpq, используя который <code class="filename">postgres_fdw</code> подключается к удалённому серверу, ограничивает количество параметров одного запроса числом 65535. Когда <span class="quote">«<span class="quote">число столбцов</span>»</span> * <code class="literal">batch_size</code> превышает этот предел, значение <code class="literal">batch_size</code> корректируется во избежание ошибки.</p><p>Этот параметр также используется при копировании строк в сторонние таблицы. В этом случае фактическое число строк, которые копирует <code class="filename">postgres_fdw</code> в рамках одной операции, определяется так же, как и при операции вставки. Тем не менее ввиду ограничений реализации команды <code class="command">COPY</code> максимальное число копируемых строк не может превышать 1000.</p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-ASYNCHRONOUS-EXECUTION"><div class="titlepage"><div><div><h4 class="title">F.38.1.5. Параметры асинхронного выполнения <a href="#POSTGRES-FDW-OPTIONS-ASYNCHRONOUS-EXECUTION" class="id_link">#</a></h4></div></div></div><p>Обёртка <code class="filename">postgres_fdw</code> поддерживает асинхронное выполнение, когда для улучшения производительности несколько частей узла <code class="structname">Append</code> выполняются одновременно, а не последовательно. Асинхронным выполнением управляет следующий параметр:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">async_capable</code> (<code class="type">boolean</code>)</span></dt><dd><p>Этот параметр определяет, будет ли <code class="filename">postgres_fdw</code> допускать одновременное сканирование сторонних таблиц для асинхронного выполнения. Его можно задать для сторонней таблицы или для стороннего сервера. Параметр, определённый на уровне таблицы, переопределяет параметр уровня сервера. Значение по умолчанию — <code class="literal">false</code>.</p><p>Чтобы получаемые со стороннего сервера данные были согласованными, <code class="filename">postgres_fdw</code> открывает только одно соединение для каждого стороннего сервера и выполняет все запросы к нему последовательно, даже если в запросе задействуются несколько сторонних таблиц (несколько подключений будет установлено, только если для этих таблиц используются разные сопоставления пользователей). Поэтому возможно, что производительность увеличится, если отключить этот параметр и тем самым исключить издержки, связанные с асинхронным выполнением запросов.</p><p>Асинхронное выполнение используется, даже когда узел <code class="structname">Append</code> содержит как подпланы, выполняемые синхронно, так и подпланы, выполняемые асинхронно. В таких случаях, если <code class="filename">postgres_fdw</code> обрабатывает асинхронные подпланы, кортежи этих подпланов не возвращаются до тех пор, пока хотя бы один синхронный подплан не вернёт все кортежи, поскольку этот подплан выполняется, пока асинхронные подпланы ожидают результатов асинхронных запросов к сторонним серверам. Такое поведение может измениться в будущих версиях.</p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-TRANSACTION-MANAGEMENT"><div class="titlepage"><div><div><h4 class="title">F.38.1.6. Параметры управления транзакциями <a href="#POSTGRES-FDW-OPTIONS-TRANSACTION-MANAGEMENT" class="id_link">#</a></h4></div></div></div><p>Как описано в разделе «Управление транзакциями», для управления транзакциями и подтранзакциями <code class="filename">postgres_fdw</code> создаёт соответствующие удалённые транзакции и подтранзакции. Если текущей локальной транзакции соответствует несколько удалённых транзакций, по умолчанию <code class="filename">postgres_fdw</code> фиксирует или прерывает эти удалённые транзакции последовательно, когда фиксируется или прерывается локальная транзакция. Удалённые подтранзакции <code class="filename">postgres_fdw</code> по умолчанию фиксирует или прерывает также последовательно. Ускорить эту процедуру позволяют следующие параметры:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">parallel_commit</code> (<code class="type">boolean</code>)</span></dt><dd><p>Этот параметр определяет, будет ли <code class="filename">postgres_fdw</code> при фиксировании локальной транзакции фиксировать все соответствующие ей удалённые транзакции одновременно. Действие этого параметра также распространяется на подтранзакции. Его можно определить только для удалённого сервера, а не на уровне таблицы. Значение по умолчанию — <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">parallel_abort</code> (<code class="type">boolean</code>)</span></dt><dd><p>Этот параметр определяет, будет ли <code class="filename">postgres_fdw</code> при прерывании локальной транзакции прерывать все соответствующие ей удалённые транзакции одновременно. Действие этого параметра также распространяется на подтранзакции. Его можно определить только для удалённого сервера, а не на уровне таблицы. Значение по умолчанию — <code class="literal">false</code>.</p></dd></dl></div><p>Если текущая локальная транзакция задействует несколько сторонних серверов, для которых включены эти параметры, удалённые транзакции на них фиксируются или прерываются одновременно, когда фиксируется или прерывается локальная транзакция.</p><p>Включение этих параметров может негативно повлиять на производительность стороннего сервера с большим количеством удалённых транзакций при фиксации или прерывании локальной транзакции.</p></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-UPDATABILITY"><div class="titlepage"><div><div><h4 class="title">F.38.1.7. Параметры изменения данных <a href="#POSTGRES-FDW-OPTIONS-UPDATABILITY" class="id_link">#</a></h4></div></div></div><p>По умолчанию все сторонние таблицы, доступные через <code class="filename">postgres_fdw</code>, считаются допускающими изменения. Это можно переопределить с помощью следующего параметра:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">updatable</code> (<code class="type">boolean</code>)</span></dt><dd><p>Этот параметр определяет, будет ли <code class="filename">postgres_fdw</code> допускать изменения в сторонних таблицах посредством команд <code class="command">INSERT</code>, <code class="command">UPDATE</code> и <code class="command">DELETE</code>. Его можно задать для сторонней таблицы или для стороннего сервера. Параметр, определённый на уровне таблицы, переопределяет параметр уровня сервера. Значение по умолчанию — <code class="literal">true</code> (изменения разрешены).</p><p>Конечно, если удалённая таблица на самом деле не допускает изменения, всё равно произойдёт ошибка. Использование этого параметра прежде всего позволяет выдать ошибку локально, не обращаясь к удалённому серверу. Заметьте, однако, что представление <code class="literal">information_schema</code> будет показывать, что определённая сторонняя таблица <code class="filename">postgres_fdw</code> является изменяемой (или нет), согласно значению данного параметра, не проверяя это на удалённом сервере.</p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-TRUNCATABILITY"><div class="titlepage"><div><div><h4 class="title">F.38.1.8. Параметры операции опустошения таблиц <a href="#POSTGRES-FDW-OPTIONS-TRUNCATABILITY" class="id_link">#</a></h4></div></div></div><p>По умолчанию все сторонние таблицы, доступные через <code class="filename">postgres_fdw</code>, считаются допускающими опустошение. Это можно переопределить с помощью следующего параметра:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">truncatable</code> (<code class="type">boolean</code>)</span></dt><dd><p>Этот параметр определяет, будет ли <code class="filename">postgres_fdw</code> допускать опустошение сторонних таблиц посредством команды <code class="command">TRUNCATE</code>. Его можно задать для сторонней таблицы или для стороннего сервера. Параметр, определённый на уровне таблицы, переопределяет параметр уровня сервера. Значение по умолчанию — <code class="literal">true</code> (опустошение разрешено).</p><p>Конечно, если удалённая таблица на самом деле не допускает опустошение, всё равно произойдёт ошибка. Использование этого параметра прежде всего позволяет выдать ошибку локально, не обращаясь к удалённому серверу.</p></dd></dl></div></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-IMPORTING"><div class="titlepage"><div><div><h4 class="title">F.38.1.9. Параметры импорта <a href="#POSTGRES-FDW-OPTIONS-IMPORTING" class="id_link">#</a></h4></div></div></div><p>Обёртка <code class="filename">postgres_fdw</code> позволяет импортировать определения сторонних таблиц с применением команды <a class="xref" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA"><span class="refentrytitle">IMPORT FOREIGN SCHEMA</span></a>. Эта команда создаёт на локальном сервере определения сторонних таблиц, соответствующие таблицам или представлениям, существующим на удалённом сервере. Если импортируемые удалённые таблицы содержат столбцы пользовательских типов данных, на локальном сервере должны быть совместимые типы с теми же именами.</p><p>Поведение процедуры импорта можно настроить следующими параметрами (задаваемыми в команде <code class="command">IMPORT FOREIGN SCHEMA</code>):</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">import_collate</code> (<code class="type">boolean</code>)</span></dt><dd><p>Этот параметр устанавливает, будут ли в определения сторонних таблиц, импортируемых с внешнего сервера, включаться характеристики столбцов <code class="literal">COLLATE</code>. По умолчанию они включаются. Вам может потребоваться отключить его, если на удалённом сервере набор имён правил сортировки отличается от локального, что скорее всего будет иметь место, если серверы работают в разных операционных системах. Тем не менее отключение чревато тем, что правила сортировки в столбцах импортируемых таблиц не совпадут с правилами для нижележащих данных, что приведёт к аномальному поведению запросов.</p><p>Даже когда этот параметр равен <code class="literal">true</code>, импортировать столбцы с правилом сортировки, выбираемым на удалённом сервере по умолчанию, рискованно. Столбцы импортируются со свойством <code class="literal">COLLATE "default"</code>, а в результате будет применяться правило сортировки, выбираемое по умолчанию на локальном сервере, которое может отличаться от выбираемого на удалённом.</p></dd><dt><span class="term"><code class="literal">import_default</code> (<code class="type">boolean</code>)</span></dt><dd><p>Этот параметр устанавливает, будут ли в определения сторонних таблиц, импортируемых с внешнего сервера, включаться заданные для столбцов выражения <code class="literal">DEFAULT</code>. По умолчанию они не включаются. Если вы включите этот параметр, остерегайтесь выражений по умолчанию, которые могут вычисляться на локальном сервере не так, как на удалённом; например, частый источник проблем — <code class="function">nextval()</code>. Если в импортируемом выражении используются функции или операторы, несуществующие локально, команда <code class="command">IMPORT</code> в целом выдаст сбой.</p></dd><dt><span class="term"><code class="literal">import_generated</code> (<code class="type">boolean</code>)</span></dt><dd><p>Этот параметр определяет, включаются ли выражения генерируемых столбцов (<code class="literal">GENERATED</code>) в определения сторонних таблиц, импортируемых со стороннего сервера. Значение по умолчанию — <code class="literal">true</code>. Выполнение <code class="command">IMPORT</code> завершится ошибкой, если в импортируемом генерирующем выражении используются функции или операторы, не существующие локально.</p></dd><dt><span class="term"><code class="literal">import_not_null</code> (<code class="type">boolean</code>)</span></dt><dd><p>Этот параметр устанавливает, будут ли в определения сторонних таблиц, импортируемых с внешнего сервера, включаться ограничения столбцов <code class="literal">NOT NULL</code>. По умолчанию они включаются.</p></dd></dl></div><p>Заметьте, что никакие другие ограничения, кроме <code class="literal">NOT NULL</code>, из удалённых таблиц импортироваться не будут. Хотя <span class="productname">PostgreSQL</span> поддерживает ограничения-проверки для сторонних таблиц, никаких средств для автоматического импорта их нет из-за риска различного вычисления выражения ограничения на локальном и удалённом серверах. Любая такая несогласованность в поведении ограничений-проверок могла бы привести к сложно выявляемым ошибкам в оптимизации запросов. Поэтому, если вы хотите импортировать ограничения-проверки, вы должны сделать это вручную и должны внимательно проверить семантику каждого. Более подробно интерпретация ограничений-проверок для сторонних таблиц описана в <a class="xref" href="sql-createforeigntable.html" title="CREATE FOREIGN TABLE"><span class="refentrytitle">CREATE FOREIGN TABLE</span></a>.</p><p>Таблицы или сторонние таблицы, являющиеся секциями некоторой другой таблицы, импортируются, только когда они явным образом указаны в предложении <code class="literal">LIMIT TO</code>. В противном случае команда <a class="xref" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA"><span class="refentrytitle">IMPORT FOREIGN SCHEMA</span></a> автоматически исключает их. Так как все данные могут быть доступны через корневую таблицу в иерархии секционирования, должно быть достаточно импортировать только секционированные таблицы, чтобы получить доступ ко всем данным, не создавая дополнительные объекты.</p></div><div class="sect3" id="POSTGRES-FDW-OPTIONS-CONNECTION-MANAGEMENT"><div class="titlepage"><div><div><h4 class="title">F.38.1.10. Параметры управления соединением <a href="#POSTGRES-FDW-OPTIONS-CONNECTION-MANAGEMENT" class="id_link">#</a></h4></div></div></div><p>По умолчанию все соединения, устанавливаемые <code class="filename">postgres_fdw</code> со сторонними серверами, остаются открытыми в текущем сеансе для повторного использования.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">keep_connections</code> (<code class="type">boolean</code>)</span></dt><dd><p>Этот параметр определяет, будет ли <code class="filename">postgres_fdw</code> оставлять открытыми соединения со сторонними серверами, чтобы последующие запросы также могли использовать эти соединения. Этот параметр можно задать только для стороннего сервера. Значение по умолчанию — <code class="literal">on</code>. Если задано значение <code class="literal">off</code>, все соединения с этим сторонним сервером будут закрываться в конце каждой транзакции.</p></dd></dl></div></div></div><div class="sect2" id="POSTGRES-FDW-FUNCTIONS"><div class="titlepage"><div><div><h3 class="title">F.38.2. Функции <a href="#POSTGRES-FDW-FUNCTIONS" class="id_link">#</a></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="function">postgres_fdw_get_connections(OUT server_name text, OUT valid boolean) returns setof record</code></span></dt><dd><p>Эта функция возвращает имена всех сторонних серверов, с которыми <code class="filename">postgres_fdw</code> установил соединение в локальном сеансе. Она также возвращает признак действительного соединения. Этот признак — <code class="literal">false</code>, если это соединение со сторонним сервером использовалось в текущей локальной транзакции, но объект стороннего сервера или сопоставление пользователя были изменены или удалены (обратите внимание, что если объект стороннего сервера удалён, вместо имени сервера в записи этого соединения будет <code class="literal">NULL</code>). Такое недействующее соединение будет закрыто в конце транзакции. Для действительных соединений этот признак установлен. Если открытых соединений нет, эта функция не возвращает никакие записи. Пример использования функции: </p><pre class="screen">
postgres=# SELECT * FROM postgres_fdw_get_connections() ORDER BY 1;
 server_name | valid
-------------+-------
 loopback1   | t
 loopback2   | f
</pre></dd><dt><span class="term"><code class="function">postgres_fdw_disconnect(server_name text) returns boolean</code></span></dt><dd><p>Эта функция закрывает открытые соединения, установленные <code class="filename">postgres_fdw</code> с указанным сторонним сервером в локальном сеансе. Обратите внимание, что с одним сервером может быть установлено несколько соединений, использующих различные сопоставления пользователей. Если какие-либо соединения используются в текущей локальной транзакции, они не будут разорваны, о чём сообщат соответствующие предупреждения. Если функция закрывает хотя бы одно соединение, она возвращает <code class="literal">true</code>; в противном случае <code class="literal">false</code>. Если сторонний сервер с указанным именем не найден, выводится сообщение об ошибке. Пример использования функции: </p><pre class="screen">
postgres=# SELECT postgres_fdw_disconnect('loopback1');
 postgres_fdw_disconnect
-------------------------
 t
</pre></dd><dt><span class="term"><code class="function">postgres_fdw_disconnect_all() returns boolean</code></span></dt><dd><p>Эта функция закрывает все открытые соединения, установленные <code class="filename">postgres_fdw</code> со сторонними серверами в локальном сеансе. Если какие-либо соединения используются в текущей локальной транзакции, они не будут разорваны, о чем сообщат соответствующие предупреждения. Если функция закрывает хотя бы одно соединение, она возвращает <code class="literal">true</code>; в противном случае <code class="literal">false</code>. Пример использования функции: </p><pre class="screen">
postgres=# SELECT postgres_fdw_disconnect_all();
 postgres_fdw_disconnect_all
-----------------------------
 t
</pre></dd></dl></div></div><div class="sect2" id="POSTGRES-FDW-CONNECTION-MANAGEMENT"><div class="titlepage"><div><div><h3 class="title">F.38.3. Управление соединением <a href="#POSTGRES-FDW-CONNECTION-MANAGEMENT" class="id_link">#</a></h3></div></div></div><p>Модуль <code class="filename">postgres_fdw</code> устанавливает соединение со сторонним сервером при первом запросе, в котором участвует сторонняя таблица, связанная со сторонним сервером. По умолчанию это соединение сохраняется и повторно используется для последующих запросов в том же сеансе. Этим поведением управляет параметр стороннего сервера <code class="literal">keep_connections</code>. Если для обращения к стороннему серверу задействуются разные пользователи (сопоставления пользователей), отдельное соединение устанавливается для каждого сопоставления пользователей.</p><p>При изменении или удалении определения стороннего сервера или сопоставления пользователей, связанные с ними соединения закрываются. Но обратите внимание, что если какие-либо соединения используются в текущей локальной транзакции, то они сохраняются до конца транзакции. Если для запросов, задействующих сторонние таблицы, понадобятся уже закрытые соединения, они будут открытыми заново.</p><p>По умолчанию установленное соединение сохраняется до конца локального или соответствующего удалённого сеанса. Чтобы соединения закрывались явно, можно отключить параметр <code class="literal">keep_connections</code> или использовать функции <code class="function">postgres_fdw_disconnect</code> и <code class="function">postgres_fdw_disconnect_all</code>. В частности, эти функции полезны тем, что позволяют освободить подключения на стороннем сервере, закрыв уже не нужные.</p></div><div class="sect2" id="POSTGRES-FDW-TRANSACTION-MANAGEMENT"><div class="titlepage"><div><div><h3 class="title">F.38.4. Управление транзакциями <a href="#POSTGRES-FDW-TRANSACTION-MANAGEMENT" class="id_link">#</a></h3></div></div></div><p>В процессе выполнения запроса, в котором участвуют какие-либо удалённые таблицы на стороннем сервере, <code class="filename">postgres_fdw</code> открывает транзакцию на удалённом сервере, если такая транзакция ещё не была открыта для текущей локальной транзакции. Эта удалённая транзакция фиксируется или прерывается, когда фиксируется или прерывается локальная транзакция. Подобным образом реализуется и управление точками сохранения.</p><p>Для удалённой транзакции выбирается режим изоляции <code class="literal">SERIALIZABLE</code>, когда локальная транзакция открыта в режиме <code class="literal">SERIALIZABLE</code>; в противном случае применяется режим <code class="literal">REPEATABLE READ</code>. Этот выбор гарантирует, что если запрос сканирует несколько таблиц на удалённом сервере, он будет получать согласованные данные одного снимка для всех сканирований. Как следствие, последовательные запросы в одной транзакции будут видеть одни данные удалённого сервера, даже если на нём параллельно происходят изменения, вызванные другими действиями. Это поведение ожидаемо для локальной транзакции в режимах <code class="literal">SERIALIZABLE</code> и <code class="literal">REPEATABLE READ</code>, но для локальной транзакции в режиме <code class="literal">READ COMMITTED</code> оно может быть неожиданным. В будущих выпусках <span class="productname">PostgreSQL</span> эти правила могут быть изменены.</p><p>Заметьте, что подготовку удалённой транзакции для двухфазной фиксации <code class="filename">postgres_fdw</code> в настоящее время не поддерживает.</p></div><div class="sect2" id="POSTGRES-FDW-REMOTE-QUERY-OPTIMIZATION"><div class="titlepage"><div><div><h3 class="title">F.38.5. Оптимизация удалённых запросов <a href="#POSTGRES-FDW-REMOTE-QUERY-OPTIMIZATION" class="id_link">#</a></h3></div></div></div><p>Обёртка <code class="filename">postgres_fdw</code> пытается оптимизировать удалённые запросы, уменьшая объём обмена данными со сторонними серверами. Для этого она может передавать на выполнение удалённому серверу предложения <code class="literal">WHERE</code> и не получать столбцы таблицы, не требующиеся для текущего запроса. Чтобы уменьшить риск некорректного выполнения запросов, предложения <code class="literal">WHERE</code> передаются удалённому серверу, только если в них используются типы данных, операторы и функции, встроенные в ядро или относящиеся к расширениям, перечисленным в параметре <code class="literal">extensions</code>. Операторы и функции в таких предложениях также должны быть постоянными (<code class="literal">IMMUTABLE</code>). Для запросов <code class="command">UPDATE</code> или <code class="command">DELETE</code> обёртка <code class="filename">postgres_fdw</code> пытается оптимизировать выполнение, передавая весь запрос на удалённый сервер, если в запросе нет предложения <code class="literal">WHERE</code>, которое нельзя было бы передать, не выполняется локальное соединение, в целевой таблице отсутствуют хранимые генерируемые столбцы и локальные триггеры <code class="literal">BEFORE</code>/<code class="literal">AFTER</code> уровня строки, а в родительских представлениях нет ограничения <code class="literal">CHECK OPTION</code>. Кроме того, в запросах <code class="command">UPDATE</code> выражения, присваиваемые целевым столбцам, должны задействовать только встроенные типы данных и постоянные (<code class="literal">IMMUTABLE</code>) операторы и функции, чтобы уменьшить риск неверного выполнения запроса.</p><p>Когда обёртка <code class="filename">postgres_fdw</code> обнаруживает соединение сторонних таблиц на одном стороннем сервере, она передаёт всё соединение этому серверу, если только по какой-то причине не решит, что будет эффективнее выбирать строки из каждой таблицы по отдельности, или сопоставляемые при обращении к таблицам пользователи оказываются разными. При передаче предложений <code class="literal">JOIN</code> принимаются те же меры предосторожности, что были описаны выше для предложений <code class="literal">WHERE</code>.</p><p>Запрос, фактически отправляемый удалённому серверу для выполнения, можно изучить с помощью команды <code class="command">EXPLAIN VERBOSE</code>.</p></div><div class="sect2" id="POSTGRES-FDW-REMOTE-QUERY-EXECUTION-ENVIRONMENT"><div class="titlepage"><div><div><h3 class="title">F.38.6. Окружение удалённого выполнения запросов <a href="#POSTGRES-FDW-REMOTE-QUERY-EXECUTION-ENVIRONMENT" class="id_link">#</a></h3></div></div></div><p>В удалённых сеансах, установленных обёрткой <code class="filename">postgres_fdw</code>, в параметре <a class="xref" href="runtime-config-client.html#GUC-SEARCH-PATH">search_path</a> задаётся только <code class="literal">pg_catalog</code>, так что без указания схемы видны только встроенные объекты. Это не проблема для запросов, которые генерирует сама <code class="filename">postgres_fdw</code>, так как она всегда добавляет такие указания. Однако это может быть опасно для функций, которые выполняются на удалённом сервере при срабатывании триггеров или правил для удалённых таблиц. Например, если удалённая таблица на самом деле представляет собой представление, любые функции, используемые в этом представлении, будут выполняться с таким ограниченным путём поиска. Поэтому рекомендуется в таких функциях дополнять схемой все имена либо добавлять параметры <code class="literal">SET search_path</code> (см. <a class="xref" href="sql-createfunction.html" title="CREATE FUNCTION"><span class="refentrytitle">CREATE FUNCTION</span></a>) в определения таких функций, чтобы установить ожидаемый ими путь поиска в окружении.</p><p>Обёртка <code class="filename">postgres_fdw</code> подобным образом устанавливает для удалённого сеанса различные параметры: </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="runtime-config-client.html#GUC-TIMEZONE">TimeZone</a> — <code class="literal">UTC</code></p></li><li class="listitem"><p><a class="xref" href="runtime-config-client.html#GUC-DATESTYLE">DateStyle</a> — <code class="literal">ISO</code></p></li><li class="listitem"><p><a class="xref" href="runtime-config-client.html#GUC-INTERVALSTYLE">IntervalStyle</a> — <code class="literal">postgres</code></p></li><li class="listitem"><p><a class="xref" href="runtime-config-client.html#GUC-EXTRA-FLOAT-DIGITS">extra_float_digits</a> принимает значение <code class="literal">3</code> для удалённых серверов версии 9.0 и новее либо <code class="literal">2</code> для более старых версий</p></li></ul></div><p> С ними проблемы менее вероятны, чем с <code class="varname">search_path</code>, но если они возникнут, их можно урегулировать, установив нужные значения с помощью <code class="literal">SET</code>.</p><p>Это поведение <span class="emphasis"><em>не</em></span> рекомендуется переопределять, устанавливая значения этих параметров на уровне сеанса; это скорее всего приведёт к поломке <code class="filename">postgres_fdw</code>.</p></div><div class="sect2" id="POSTGRES-FDW-CROSS-VERSION-COMPATIBILITY"><div class="titlepage"><div><div><h3 class="title">F.38.7. Совместимость с разными версиями <a href="#POSTGRES-FDW-CROSS-VERSION-COMPATIBILITY" class="id_link">#</a></h3></div></div></div><p>Модуль <code class="filename">postgres_fdw</code> может применяться с удалёнными серверами версий, начиная с <span class="productname">PostgreSQL</span> 8.3. Способность только чтения данных доступна, начиная с 8.1. Однако при этом есть ограничение, вызванное тем, что <code class="filename">postgres_fdw</code> полагает, что постоянные встроенные функции и операторы могут безопасно передаваться на удалённый сервер для выполнения, если они фигурируют в предложении <code class="literal">WHERE</code> для сторонней таблицы. Таким образом, встроенная функция, добавленная в более новой версии, чем на удалённом сервере, может быть отправлена на выполнение, что в результате приведёт к ошибке <span class="quote">«<span class="quote">функция не существует</span>»</span> или подобной. Отказы такого типа можно предотвратить, переписав запрос, например, поместив ссылку на стороннюю таблицу во вложенный <code class="literal">SELECT</code> с <code class="literal">OFFSET 0</code> в качестве защиты от оптимизации, и применив проблематичную функцию или оператор снаружи этого вложенного <code class="literal">SELECT</code>.</p></div><div class="sect2" id="POSTGRES-FDW-CONFIGURATION-PARAMETERS"><div class="titlepage"><div><div><h3 class="title">F.38.8. Параметры конфигурации <a href="#POSTGRES-FDW-CONFIGURATION-PARAMETERS" class="id_link">#</a></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="GUC-PGFDW-APPLICATION-NAME"><span class="term"><code class="varname">postgres_fdw.application_name</code> (<code class="type">string</code>) <a id="id-1.11.7.48.18.2.1.1.3" class="indexterm"></a></span> <a href="#GUC-PGFDW-APPLICATION-NAME" class="id_link">#</a></dt><dd><p>Задаёт значение конфигурационного параметра <a class="xref" href="runtime-config-logging.html#GUC-APPLICATION-NAME">application_name</a>, используемого при соединении <code class="filename">postgres_fdw</code> со сторонним сервером. Этот параметр переопределяет свойство <code class="varname">application_name</code>, заданное для объекта стороннего сервера. Обратите внимание, что изменение этого параметра не затронет существующие подключение, а повлияет только на вновь устанавливаемые.</p><p>В <code class="varname">postgres_fdw.application_name</code> можно задать любую строку произвольной длины, содержащую не только ASCII-символы. Однако обратите внимание, что когда она передаётся стороннему серверу в качестве параметра <code class="varname">application_name</code>, она усекается до <code class="symbol">NAMEDATALEN</code> символов, а символы не из набора ASCII заменяются <a class="link" href="sql-syntax-lexical.html#SQL-SYNTAX-STRINGS-ESCAPE" title="4.1.2.2. Строковые константы со спецпоследовательностями в стиле C">шестнадцатеричными спецсимволами в стиле C</a>. За дополнительной информацией обратитесь к <a class="xref" href="runtime-config-logging.html#GUC-APPLICATION-NAME">application_name</a>.</p><p>Символы <code class="literal">%</code> в этой строке обозначают начало спецпоследовательностей, заменяемых описанной далее информацией. Неизвестные управляющие последовательности игнорируются. Все остальные символы переносятся в имя приложения без изменений. Обратите внимание, что использовать знаки плюс/минус и число между знаком <code class="literal">%</code> и спецсимволом (чтобы обозначить выравнивание или дополнение) нельзя.</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>Спецпоследовательность</th><th>Назначение</th></tr></thead><tbody><tr><td><code class="literal">%a</code></td><td>Имя приложения на локальном сервере</td></tr><tr><td><code class="literal">%c</code></td><td>ID сеанса на локальном сервере (подробнее см. <a class="xref" href="runtime-config-logging.html#GUC-LOG-LINE-PREFIX">log_line_prefix</a>)</td></tr><tr><td><code class="literal">%C</code></td><td>Имя кластера на локальном сервере (подробнее см. <a class="xref" href="runtime-config-logging.html#GUC-CLUSTER-NAME">cluster_name</a>)</td></tr><tr><td><code class="literal">%u</code></td><td>Имя пользователя на локальном сервере</td></tr><tr><td><code class="literal">%d</code></td><td>Имя базы данных на локальном сервере</td></tr><tr><td><code class="literal">%p</code></td><td>PID обслуживающего процесса на локальном сервере</td></tr><tr><td><code class="literal">%%</code></td><td>Буквально %</td></tr></tbody></table></div><p>Например, если пользователь <code class="literal">local_user</code> устанавливает подключение из базы данных <code class="literal">local_db</code> к базе данных <code class="literal">foreign_db</code> от имени <code class="literal">foreign_user</code>, значение <code class="literal">'db=%d, user=%u'</code> заменяется на <code class="literal">'db=local_db, user=local_user'</code>.</p></dd></dl></div></div><div class="sect2" id="POSTGRES-FDW-EXAMPLES"><div class="titlepage"><div><div><h3 class="title">F.38.9. Примеры <a href="#POSTGRES-FDW-EXAMPLES" class="id_link">#</a></h3></div></div></div><p>Ниже приведён пример создания сторонней таблицы с применением <code class="literal">postgres_fdw</code>. Сначала установите расширение:</p><pre class="programlisting">CREATE EXTENSION postgres_fdw;</pre><p>Затем создайте сторонний сервер с помощью команды <a class="xref" href="sql-createserver.html" title="CREATE SERVER"><span class="refentrytitle">CREATE SERVER</span></a>. В данном примере мы хотим подключиться к серверу <span class="productname">PostgreSQL</span>, работающему по адресу <code class="literal">192.83.123.89</code>, порт <code class="literal">5432</code>. База данных, к которой устанавливается подключение, на удалённом сервере называется <code class="literal">foreign_db</code>: </p><pre class="programlisting">CREATE SERVER foreign_server
        FOREIGN DATA WRAPPER postgres_fdw
        OPTIONS (host '192.83.123.89', port '5432', dbname 'foreign_db');</pre><p>Для определения роли, которая будет задействована на удалённом сервере, с помощью <a class="xref" href="sql-createusermapping.html" title="CREATE USER MAPPING"><span class="refentrytitle">CREATE USER MAPPING</span></a> задаётся сопоставление пользователей: </p><pre class="programlisting">CREATE USER MAPPING FOR local_user
        SERVER foreign_server
        OPTIONS (user 'foreign_user', password 'password');</pre><p>Теперь можно создать стороннюю таблицу, применив команду <a class="xref" href="sql-createforeigntable.html" title="CREATE FOREIGN TABLE"><span class="refentrytitle">CREATE FOREIGN TABLE</span></a>. В этом примере мы хотим обратиться к таблице <code class="structname">some_schema.some_table</code> на удалённом сервере. Локальным именем этой таблицы будет <code class="structname">foreign_table</code>: </p><pre class="programlisting">CREATE FOREIGN TABLE foreign_table (
        id integer NOT NULL,
        data text
)
        SERVER foreign_server
        OPTIONS (schema_name 'some_schema', table_name 'some_table');</pre><p> Важно, чтобы типы данных и другие свойства столбцов, объявленных в <code class="command">CREATE FOREIGN TABLE</code>, соответствовали фактической удалённой таблице. Также должны соответствовать имена столбцов, если только вы не добавите параметры <code class="literal">column_name</code> для отдельных столбцов, задающие их реальные имена в удалённой таблице. Во многих случаях использовать <a class="link" href="sql-importforeignschema.html" title="IMPORT FOREIGN SCHEMA"><code class="command">IMPORT FOREIGN SCHEMA</code></a> предпочтительнее, чем конструировать определения сторонних таблиц вручную.</p></div><div class="sect2" id="POSTGRES-FDW-AUTHOR"><div class="titlepage"><div><div><h3 class="title">F.38.10. Автор <a href="#POSTGRES-FDW-AUTHOR" class="id_link">#</a></h3></div></div></div><p>Шигеру Ханада <code class="email">&lt;<a class="email" href="mailto:shigeru.hanada@gmail.com">shigeru.hanada@gmail.com</a>&gt;</code></p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pgwalinspect.html" title="F.37. pg_walinspect — просмотр журнала предзаписи на низком уровне">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html" title="Приложение F. Дополнительно поставляемые модули и расширения">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="seg.html" title="F.39. seg — тип данных для отрезков или интервалов чисел с плавающей точкой">След.</a></td></tr><tr><td width="40%" align="left" valign="top">F.37. pg_walinspect — просмотр журнала предзаписи на низком уровне </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> F.39. seg — тип данных для отрезков или интервалов чисел с плавающей точкой</td></tr></table></div></body></html>