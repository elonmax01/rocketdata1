<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>19.7. Защита от подмены сервера</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="upgrading.html" title="19.6. Обновление кластера PostgreSQL" /><link rel="next" href="encryption-options.html" title="19.8. Возможности шифрования" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">19.7. Защита от подмены сервера</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="upgrading.html" title="19.6. Обновление кластера PostgreSQL">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime.html" title="Глава 19. Подготовка к работе и сопровождение сервера">Наверх</a></td><th width="60%" align="center">Глава 19. Подготовка к работе и сопровождение сервера</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="encryption-options.html" title="19.8. Возможности шифрования">След.</a></td></tr></table><hr /></div><div class="sect1" id="PREVENTING-SERVER-SPOOFING"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.7. Защита от подмены сервера <a href="#PREVENTING-SERVER-SPOOFING" class="id_link">#</a></h2></div></div></div><a id="id-1.6.6.10.2" class="indexterm"></a><p>Когда сервер работает, злонамеренный пользователь не может подставить свой сервер вместо него. Однако если сервер отключён, локальный пользователь может подменить нормальный сервер, запустив свой собственный. Поддельный сервер сможет читать пароли и запросы клиентов, хотя не сможет вернуть никакие данные, так как каталог <code class="varname">PGDATA</code> будет защищён от чтения посторонними пользователями. Такая подмена возможна потому, что любой пользователь может запустить сервер баз данных; клиент, со своей стороны, не может обнаружить подмену, если его не настроить дополнительно.</p><p>Один из способов предотвратить подмену для <code class="literal">локальных</code> подключений — использовать каталог Unix-сокетов (<a class="xref" href="runtime-config-connection.html#GUC-UNIX-SOCKET-DIRECTORIES">unix_socket_directories</a>), в который сможет писать только проверенный локальный пользователь. Это не позволит злонамеренному пользователю создать в этом каталоге свой файл сокета. Если вас беспокоит, что некоторые приложения при этом могут обращаться к файлу сокета в <code class="filename">/tmp</code> и, таким образом, всё же будут уязвимыми, создайте при загрузке операционной системы символическую ссылку <code class="filename">/tmp/.s.PGSQL.5432</code>, указывающую на перемещённый файл сокета. Возможно, вам также придётся изменить скрипт очистки <code class="filename">/tmp</code>, чтобы он не удалял эту ссылку.</p><p>Также клиенты могут защитить <code class="literal">локальные</code> подключения, установив в параметре <a class="link" href="libpq-connect.html#LIBPQ-CONNECT-REQUIREPEER"><code class="literal">requirepeer</code></a> имя пользователя, который должен владеть серверным процессом, подключённым к сокету.</p><p>Для защиты от подмены TCP-соединений можно либо использовать сертификаты SSL и проверять сертификат сервера со стороны клиентов, либо применять шифрование GSSAPI (или и то, и другое при использовании независимых подключений).</p><p>Для защиты от подмены соединения с SSL сервер надо настроить так, чтобы он принимал только подключения <code class="literal">hostssl</code> (см. <a class="xref" href="auth-pg-hba-conf.html" title="21.1. Файл pg_hba.conf">Раздел 21.1</a>) и имел ключ и сертификаты SSL (см. <a class="xref" href="ssl-tcp.html" title="19.9. Защита соединений TCP/IP с применением SSL">Раздел 19.9</a>). Тогда TCP-клиент должен будет подключаться к серверу с параметром <code class="literal">sslmode=verify-ca</code> или <code class="literal">verify-full</code> и у него должен быть установлен соответствующий корневой сертификат (см. <a class="xref" href="libpq-ssl.html#LIBQ-SSL-CERTIFICATES" title="34.19.1. Проверка сертификатов сервера на стороне клиента">Подраздел 34.19.1</a>). Как вариант, можно применять системный пул ЦС с помощью <code class="literal">sslrootcert=system</code>. В этом случае для безопасности принудительно применяется режим <code class="literal">sslmode=verify-full</code>, так как получение сертификатов, подписываемых публичным ЦС, является обычной практикой.</p><p>Для защиты от подмены соединения с сервером во время использования сетевой аутентификации по паролю с методом <a class="link" href="auth-password.html" title="21.5. Аутентификация password">scram-sha-256</a> следует удостовериться, что подключение к серверу происходит по SSL-протоколу и с одним из методов, защищающих от подмены соединения, которые описаны в предыдущем абзаце. Кроме того, реализация SCRAM в <span class="application">libpq</span> не защищает на протяжении всего процесса обмена информацией при аутентификации, однако использование параметра соединения <code class="literal">channel_binding=require</code> позволяет минимизировать вероятность подмены соединения. Злоумышленник, использующий подставной сервер для перехвата данных при обмене по SCRAM, может прибегнуть к офлайн-анализу, чтобы попытаться определить хешированный пароль клиента.</p><p>Для защиты от подмены соединения с GSSAPI сервер надо настроить так, чтобы он принимал только подключения <code class="literal">hostgssenc</code> (см. <a class="xref" href="auth-pg-hba-conf.html" title="21.1. Файл pg_hba.conf">Раздел 21.1</a>) и для них использовалась аутентификация <code class="literal">gss</code>. TCP-клиент в этом случае должен подключаться с параметром <code class="literal">gssencmode=require</code>.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="upgrading.html" title="19.6. Обновление кластера PostgreSQL">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime.html" title="Глава 19. Подготовка к работе и сопровождение сервера">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="encryption-options.html" title="19.8. Возможности шифрования">След.</a></td></tr><tr><td width="40%" align="left" valign="top">19.6. Обновление кластера <span class="productname">PostgreSQL</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 19.8. Возможности шифрования</td></tr></table></div></body></html>