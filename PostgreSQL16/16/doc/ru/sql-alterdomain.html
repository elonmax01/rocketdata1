<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>ALTER DOMAIN</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="sql-alterdefaultprivileges.html" title="ALTER DEFAULT PRIVILEGES" /><link rel="next" href="sql-altereventtrigger.html" title="ALTER EVENT TRIGGER" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">ALTER DOMAIN</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-alterdefaultprivileges.html" title="ALTER DEFAULT PRIVILEGES">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><th width="60%" align="center">Команды SQL</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-altereventtrigger.html" title="ALTER EVENT TRIGGER">След.</a></td></tr></table><hr /></div><div class="refentry" id="SQL-ALTERDOMAIN"><div class="titlepage"></div><a id="id-1.9.3.9.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">ALTER DOMAIN</span></h2><p>ALTER DOMAIN — изменить определение домена</p></div><div class="refsynopsisdiv"><h2>Синтаксис</h2><pre class="synopsis">ALTER DOMAIN <em class="replaceable"><code>имя</code></em>
    { SET DEFAULT <em class="replaceable"><code>выражение</code></em> | DROP DEFAULT }
ALTER DOMAIN <em class="replaceable"><code>имя</code></em>
    { SET | DROP } NOT NULL
ALTER DOMAIN <em class="replaceable"><code>имя</code></em>
    ADD <em class="replaceable"><code>ограничение_домена</code></em> [ NOT VALID ]
ALTER DOMAIN <em class="replaceable"><code>имя</code></em>
    DROP CONSTRAINT [ IF EXISTS ] <em class="replaceable"><code>имя_ограничения</code></em> [ RESTRICT | CASCADE ]
ALTER DOMAIN <em class="replaceable"><code>имя</code></em>
     RENAME CONSTRAINT <em class="replaceable"><code>имя_ограничения</code></em> TO <em class="replaceable"><code>имя_нового_ограничения</code></em>
ALTER DOMAIN <em class="replaceable"><code>имя</code></em>
    VALIDATE CONSTRAINT <em class="replaceable"><code>имя_ограничения</code></em>
ALTER DOMAIN <em class="replaceable"><code>имя</code></em>
    OWNER TO { <em class="replaceable"><code>новый_владелец</code></em> | CURRENT_ROLE | CURRENT_USER | SESSION_USER }
ALTER DOMAIN <em class="replaceable"><code>имя</code></em>
    RENAME TO <em class="replaceable"><code>новое_имя</code></em>
ALTER DOMAIN <em class="replaceable"><code>имя</code></em>
    SET SCHEMA <em class="replaceable"><code>новая_схема</code></em></pre></div><div class="refsect1" id="id-1.9.3.9.5"><h2>Описание</h2><p><code class="command">ALTER DOMAIN</code> изменяет определение существующего домена. Эта команда имеет несколько разновидностей:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">SET</code>/<code class="literal">DROP DEFAULT</code></span></dt><dd><p>Эти формы задают/убирают значение по умолчанию для домена. Заметьте, что эти значения по умолчанию применяются только при последующих командах <code class="command">INSERT</code>; они не меняются в строках с данным доменом, уже добавленных в таблицу.</p></dd><dt><span class="term"><code class="literal">SET</code>/<code class="literal">DROP NOT NULL</code></span></dt><dd><p>Эти формы определяют, будет ли домен принимать значения NULL или нет. <code class="literal">SET NOT NULL</code> можно выполнить, только если столбцы с этим доменом ещё не содержат значений NULL.</p></dd><dt><span class="term"><code class="literal">ADD <em class="replaceable"><code>ограничение_домена</code></em> [ NOT VALID ]</code></span></dt><dd><p>Эта форма добавляет новое ограничение для домена с тем же синтаксисом, что описан в <a class="link" href="sql-createdomain.html" title="CREATE DOMAIN"><code class="command">CREATE DOMAIN</code></a>. Когда добавляется новое ограничение домена, все столбцы с этим доменом будут проверены на соответствие этому ограничению. Эти проверки можно подавить, добавив указание <code class="literal">NOT VALID</code>, а затем активировать позднее с помощью команды <code class="command">ALTER DOMAIN ... VALIDATE CONSTRAINT</code>. Вновь вставленные или изменённые строки всегда проверяются по всем ограничениям, даже тем, что отмечены как <code class="literal">NOT VALID</code>. Указание <code class="literal">NOT VALID</code> допускается только для ограничений <code class="literal">CHECK</code>.</p></dd><dt><span class="term"><code class="literal">DROP CONSTRAINT [ IF EXISTS ]</code></span></dt><dd><p>Эта форма убирает ограничения домена. Если указано <code class="literal">IF EXISTS</code> и заданное ограничение не существует, это не считается ошибкой. В этом случае выдаётся только замечание.</p></dd><dt><span class="term"><code class="literal">RENAME CONSTRAINT</code></span></dt><dd><p>Эта форма меняет название ограничения домена.</p></dd><dt><span class="term"><code class="literal">VALIDATE CONSTRAINT</code></span></dt><dd><p>Эта форма включает проверку ограничения, ранее добавленного как <code class="literal">NOT VALID</code>, то есть проверяет все значения в столбцах с этим типом домена на соответствие этому ограничению.</p></dd><dt><span class="term"><code class="literal">OWNER</code></span></dt><dd><p>Эта форма меняет владельца домена на заданного пользователя.</p></dd><dt><span class="term"><code class="literal">RENAME</code></span></dt><dd><p>Эта форма меняет название домена.</p></dd><dt><span class="term"><code class="literal">SET SCHEMA</code></span></dt><dd><p>Эта форма меняет схему домена. Все ограничения, связанные с данным доменом, так же переносятся в новую схему.</p></dd></dl></div><p>Выполнить <code class="command">ALTER DOMAIN</code> может только владелец соответствующего домена. Чтобы сменить схему домена, необходимо также иметь право <code class="literal">CREATE</code> в новой схеме. Чтобы сменить владельца, необходимо иметь право <code class="literal">SET ROLE</code> для новой роли-владельца, а эта роль должна иметь право <code class="literal">CREATE</code> в схеме домена. (С такими ограничениями при смене владельца не происходит ничего такого, что нельзя было бы сделать, имея право удалить и вновь создать домен. Однако суперпользователь может сменить владельца домена в любом случае.)</p></div><div class="refsect1" id="id-1.9.3.9.6"><h2>Параметры</h2><p>
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>имя</code></em></span></dt><dd><p>Имя существующего домена (возможно, дополненное схемой), подлежащего изменению.</p></dd><dt><span class="term"><em class="replaceable"><code>ограничение_домена</code></em></span></dt><dd><p>Новое ограничение домена.</p></dd><dt><span class="term"><em class="replaceable"><code>имя_ограничения</code></em></span></dt><dd><p>Имя существующего ограничения, подлежащего удалению или переименованию.</p></dd><dt><span class="term"><code class="literal">NOT VALID</code></span></dt><dd><p>Не проверять существующие сохранённые данные на соответствие ограничению.</p></dd><dt><span class="term"><code class="literal">CASCADE</code></span></dt><dd><p>Автоматически удалять объекты, зависящие от данного ограничения, и, в свою очередь, все зависящие от них объекты (см. <a class="xref" href="ddl-depend.html" title="5.14. Отслеживание зависимостей">Раздел 5.14</a>).</p></dd><dt><span class="term"><code class="literal">RESTRICT</code></span></dt><dd><p>Отказать в удалении ограничения, если существуют зависящие от него объекты. Это поведение по умолчанию.</p></dd><dt><span class="term"><em class="replaceable"><code>новое_имя</code></em></span></dt><dd><p>Новое имя домена.</p></dd><dt><span class="term"><em class="replaceable"><code>имя_нового_ограничения</code></em></span></dt><dd><p>Новое имя ограничения.</p></dd><dt><span class="term"><em class="replaceable"><code>новый_владелец</code></em></span></dt><dd><p>Имя пользователя, назначаемого новым владельцем домена.</p></dd><dt><span class="term"><em class="replaceable"><code>новая_схема</code></em></span></dt><dd><p>Новая схема домена.</p></dd></dl></div><p>
   </p></div><div class="refsect1" id="id-1.9.3.9.7"><h2>Замечания</h2><p>Хотя команда <code class="command">ALTER DOMAIN ADD CONSTRAINT</code> пытается проверить, удовлетворяют ли уже существующие данные новому ограничению, эта проверка не очень надёжна, так как данная команда не <span class="quote">«<span class="quote">видит</span>»</span> строки таблицы, которые были только что добавлены или изменены, но ещё не зафиксированы. Если есть риск того, что параллельные операции могут вставить неподходящие данные, можно применить следующий подход: создать ограничение с указанием <code class="literal">NOT VALID</code>, зафиксировать эту команду, подождать окончания всех транзакций, начатых до фиксирования, а затем выполнить <code class="command">ALTER DOMAIN VALIDATE CONSTRAINT</code> для проведения контроля данных. В этом случае проверка будет надёжной, так как после фиксирования ограничения оно будет гарантированно действовать на все новые значения типа домена, вносимые последующими транзакциями.</p><p>В настоящее время команды <code class="command">ALTER DOMAIN ADD CONSTRAINT</code>, <code class="command">ALTER DOMAIN VALIDATE CONSTRAINT</code> и <code class="command">ALTER DOMAIN SET NOT NULL</code> выдают ошибку, если указанный домен или любой производный от него используется в столбце с типом-контейнером (это может быть составной, диапазонный тип или массив) в какой-либо таблице базы данных. В дальнейшем они будут доработаны, с тем чтобы новое ограничение проверялось и при такой вложенности.</p></div><div class="refsect1" id="id-1.9.3.9.8"><h2>Примеры</h2><p>Добавление ограничения <code class="literal">NOT NULL</code> к домену: </p><pre class="programlisting">ALTER DOMAIN zipcode SET NOT NULL;</pre><p> Удаление ограничения <code class="literal">NOT NULL</code> из домена: </p><pre class="programlisting">ALTER DOMAIN zipcode DROP NOT NULL;</pre><p>Добавление ограничения-проверки к домену: </p><pre class="programlisting">ALTER DOMAIN zipcode ADD CONSTRAINT zipchk CHECK (char_length(VALUE) = 5);</pre><p>Удаление ограничения-проверки из домена: </p><pre class="programlisting">ALTER DOMAIN zipcode DROP CONSTRAINT zipchk;</pre><p>Переименование ограничения-проверки в домене: </p><pre class="programlisting">ALTER DOMAIN zipcode RENAME CONSTRAINT zipchk TO zip_check;</pre><p>Перемещение домена в другую схему: </p><pre class="programlisting">ALTER DOMAIN zipcode SET SCHEMA customers;</pre></div><div class="refsect1" id="SQL-ALTERDOMAIN-COMPATIBILITY"><h2>Совместимость</h2><p><code class="command">ALTER DOMAIN</code> соответствует стандарту <acronym class="acronym">SQL</acronym>, за исключением подвидов <code class="literal">OWNER</code>, <code class="literal">RENAME</code>, <code class="literal">SET SCHEMA</code> и <code class="literal">VALIDATE CONSTRAINT</code>, которые являются расширениями <span class="productname">PostgreSQL</span>. Предложение <code class="literal">NOT VALID</code> вариации <code class="literal">ADD CONSTRAINT</code> также является расширением <span class="productname">PostgreSQL</span>.</p></div><div class="refsect1" id="SQL-ALTERDOMAIN-SEE-ALSO"><h2>См. также</h2><span class="simplelist"><a class="xref" href="sql-createdomain.html" title="CREATE DOMAIN"><span class="refentrytitle">CREATE DOMAIN</span></a>, <a class="xref" href="sql-dropdomain.html" title="DROP DOMAIN"><span class="refentrytitle">DROP DOMAIN</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-alterdefaultprivileges.html" title="ALTER DEFAULT PRIVILEGES">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="Команды SQL">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-altereventtrigger.html" title="ALTER EVENT TRIGGER">След.</a></td></tr><tr><td width="40%" align="left" valign="top">ALTER DEFAULT PRIVILEGES </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> ALTER EVENT TRIGGER</td></tr></table></div></body></html>