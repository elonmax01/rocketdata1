<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>36.9. Директивы препроцессора</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="ecpg-errors.html" title="36.8. Обработка ошибок" /><link rel="next" href="ecpg-process.html" title="36.10. Компиляция программ со встраиваемым SQL" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">36.9. Директивы препроцессора</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="ecpg-errors.html" title="36.8. Обработка ошибок">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="ecpg.html" title="Глава 36. ECPG — Встраиваемый SQL в C">Наверх</a></td><th width="60%" align="center">Глава 36. <span class="application">ECPG</span> — Встраиваемый <acronym class="acronym">SQL</acronym> в C</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="ecpg-process.html" title="36.10. Компиляция программ со встраиваемым SQL">След.</a></td></tr></table><hr /></div><div class="sect1" id="ECPG-PREPROC"><div class="titlepage"><div><div><h2 class="title" style="clear: both">36.9. Директивы препроцессора <a href="#ECPG-PREPROC" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="ecpg-preproc.html#ECPG-INCLUDE">36.9.1. Включение файлов</a></span></dt><dt><span class="sect2"><a href="ecpg-preproc.html#ECPG-DEFINE">36.9.2. Директивы define и undef</a></span></dt><dt><span class="sect2"><a href="ecpg-preproc.html#ECPG-IFDEF">36.9.3. Директивы ifdef, ifndef, elif, else и endif</a></span></dt></dl></div><p>Препроцессор <code class="command">ecpg</code> поддерживает ряд директив, которые позволяют управлять разбором и обработкой исходных файлов.</p><div class="sect2" id="ECPG-INCLUDE"><div class="titlepage"><div><div><h3 class="title">36.9.1. Включение файлов <a href="#ECPG-INCLUDE" class="id_link">#</a></h3></div></div></div><p>Для включения внешнего файла в программу со встраиваемым SQL, используется конструкция: </p><pre class="programlisting">EXEC SQL INCLUDE <em class="replaceable"><code>имя_файла</code></em>;
EXEC SQL INCLUDE &lt;<em class="replaceable"><code>имя_файла</code></em>&gt;;
EXEC SQL INCLUDE "<em class="replaceable"><code>имя_файла</code></em>";</pre><p> Встретив такую директиву, препроцессор встраиваемого SQL будет искать файл <code class="literal"><em class="replaceable"><code>имя_файла</code></em>.h</code>, обрабатывать его и включать в выходной код C. В результате встраиваемые SQL-операторы во включённом таким образом файле будут обработаны корректно.</p><p>Препроцессор <code class="command">ecpg</code> будет искать указанный файл в нескольких каталогах в следующем порядке: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">текущий каталог</li><li class="listitem"><code class="filename">/usr/local/include</code></li><li class="listitem">каталог включаемых файлов PostgreSQL, определённый во время сборки (например, <code class="filename">/usr/local/pgsql/include</code>)</li><li class="listitem"><code class="filename">/usr/include</code></li></ul></div><p> Но когда используется форма <code class="literal">EXEC SQL INCLUDE "<em class="replaceable"><code>имя_файла</code></em>"</code>, просматривается только текущий каталог.</p><p>В каждом каталоге препроцессор будет сначала искать файл с заданным именем, а если не обнаружит его, попытается найти файл с добавленным расширением <code class="literal">.h</code> (если только заданное имя файла уже не содержит это расширение).</p><p>Заметьте, что команда <code class="command">EXEC SQL INCLUDE</code> <span class="emphasis"><em>не</em></span> равнозначна включению: </p><pre class="programlisting">#include &lt;<em class="replaceable"><code>имя_файла</code></em>.h&gt;</pre><p> так как во втором случае включаемый файл не проходит через препроцессор SQL-команд. Естественно, директиву C <code class="literal">#include</code> можно по-прежнему применять для включения других заголовочных файлов.</p><div class="note"><h3 class="title">Примечание</h3><p>Имя включаемого файла чувствительно к регистру, несмотря на то, что остальная команда <code class="literal">EXEC SQL INCLUDE</code> подчиняется обычным правилам чувствительности к регистру SQL.</p></div></div><div class="sect2" id="ECPG-DEFINE"><div class="titlepage"><div><div><h3 class="title">36.9.2. Директивы define и undef <a href="#ECPG-DEFINE" class="id_link">#</a></h3></div></div></div><p>Во встраиваемом SQL есть конструкция, подобная директиве <code class="literal">#define</code>, известной в C: </p><pre class="programlisting">EXEC SQL DEFINE <em class="replaceable"><code>имя</code></em>;
EXEC SQL DEFINE <em class="replaceable"><code>имя</code></em> <em class="replaceable"><code>значение</code></em>;</pre><p> Используя её, можно определить имя: </p><pre class="programlisting">EXEC SQL DEFINE HAVE_FEATURE;</pre><p> И также можно определить константы: </p><pre class="programlisting">EXEC SQL DEFINE MYNUMBER 12;
EXEC SQL DEFINE MYSTRING 'abc';</pre><p> Удалить предыдущее определение позволяет команда <code class="literal">undef</code>: </p><pre class="programlisting">EXEC SQL UNDEF MYNUMBER;</pre><p>Разумеется, в программе со встраиваемым SQL можно продолжать использовать версии <code class="literal">#define</code> и <code class="literal">#undef</code> языка C. Отличие состоит в том, когда вычисляются определяемые значения. Когда применяется команда <code class="literal">EXEC SQL DEFINE</code>, вычислять определения и подставлять значения будет препроцессор <code class="command">ecpg</code>. Например, если написать: </p><pre class="programlisting">EXEC SQL DEFINE MYNUMBER 12;
...
EXEC SQL UPDATE Tbl SET col = MYNUMBER;</pre><p> подстановку выполнит <code class="command">ecpg</code> и компилятор C никогда не увидит имени или идентификатора <code class="literal">MYNUMBER</code>. Заметьте, что с другой стороны <code class="literal">#define</code> не подходит для определения константы, которую вы хотите использовать во встраиваемом SQL, так как препроцессор встраиваемого SQL не сможет увидеть это определение.</p><p>Если в командной строке препроцессора <code class="command">ecpg</code> указано несколько входных файлов, <code class="literal">EXEC SQL DEFINE</code> и <code class="literal">EXEC SQL UNDEF</code> не влияют на них: каждый файл начинается только с символов, определённых ключами <code class="option">-D</code> в командной строке.</p></div><div class="sect2" id="ECPG-IFDEF"><div class="titlepage"><div><div><h3 class="title">36.9.3. Директивы ifdef, ifndef, elif, else и endif <a href="#ECPG-IFDEF" class="id_link">#</a></h3></div></div></div><p>Для условной компиляции блоков кода можно использовать следующие указания: </p><div class="variablelist"><dl class="variablelist"><dt id="ECPG-IFDEF-IFDEF"><span class="term"><code class="literal">EXEC SQL ifdef <em class="replaceable"><code>имя</code></em>;</code></span> <a href="#ECPG-IFDEF-IFDEF" class="id_link">#</a></dt><dd><p>Проверяет <em class="replaceable"><code>имя</code></em> и обрабатывает последующие строки, если <em class="replaceable"><code>имя</code></em> было определено командой <code class="literal">EXEC SQL define <em class="replaceable"><code>имя</code></em></code>.</p></dd><dt id="ECPG-IFDEF-IFNDEF"><span class="term"><code class="literal">EXEC SQL ifndef <em class="replaceable"><code>имя</code></em>;</code></span> <a href="#ECPG-IFDEF-IFNDEF" class="id_link">#</a></dt><dd><p>Проверяет <em class="replaceable"><code>имя</code></em> и обрабатывает последующие строки, если <em class="replaceable"><code>имя</code></em> <span class="emphasis"><em>не</em></span> было определено командой <code class="literal">EXEC SQL define <em class="replaceable"><code>имя</code></em></code>.</p></dd><dt id="ECPG-IFDEF-ELIF"><span class="term"><code class="literal">EXEC SQL elif <em class="replaceable"><code>имя</code></em>;</code></span> <a href="#ECPG-IFDEF-ELIF" class="id_link">#</a></dt><dd><p>Начинает необязательный альтернативный блок после указания <code class="literal">EXEC SQL ifdef <em class="replaceable"><code>имя</code></em></code> или <code class="literal">EXEC SQL ifndef <em class="replaceable"><code>имя</code></em></code>. Количество блоков <code class="literal">elif</code> может быть любым. Строки, следующие за <code class="literal">elif</code>, будут обрабатываться, если <em class="replaceable"><code>имя</code></em> определено <span class="emphasis"><em>и</em></span> при этом не был обработан ни один из блоков той же конструкции <code class="literal">ifdef</code>/<code class="literal">ifndef</code>...<code class="literal">endif</code>.</p></dd><dt id="ECPG-IFDEF-ELSE"><span class="term"><code class="literal">EXEC SQL else;</code></span> <a href="#ECPG-IFDEF-ELSE" class="id_link">#</a></dt><dd><p>Начинает необязательный заключительный блок после указания EXEC SQL ifdef <em class="replaceable"><code>имя</code></em> или EXEC SQL ifndef <em class="replaceable"><code>имя</code></em>. Последующие строки будут обрабатываться, если не был обработан ни один из блоков той же конструкции <code class="literal">ifdef</code>/<code class="literal">ifndef</code>...<code class="literal">endif</code>.</p></dd><dt id="ECPG-IFDEF-ENDIF"><span class="term"><code class="literal">EXEC SQL endif;</code></span> <a href="#ECPG-IFDEF-ENDIF" class="id_link">#</a></dt><dd><p>Завершает конструкцию <code class="literal">ifdef</code>/<code class="literal">ifndef</code>...<code class="literal">endif</code>. Последующие строки обрабатываются обычным образом.</p></dd></dl></div><p>Конструкции <code class="literal">ifdef</code>/<code class="literal">ifndef</code>...<code class="literal">endif</code> могут быть вложенными, на глубину до 127 уровней.</p><p>Так будет скомпилирована только одна из трёх команд <code class="literal">SET TIMEZONE</code>: </p><pre class="programlisting">EXEC SQL ifdef TZVAR;
EXEC SQL SET TIMEZONE TO TZVAR;
EXEC SQL elif TZNAME;
EXEC SQL SET TIMEZONE TO TZNAME;
EXEC SQL else;
EXEC SQL SET TIMEZONE TO 'GMT';
EXEC SQL endif;</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ecpg-errors.html" title="36.8. Обработка ошибок">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="ecpg.html" title="Глава 36. ECPG — Встраиваемый SQL в C">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="ecpg-process.html" title="36.10. Компиляция программ со встраиваемым SQL">След.</a></td></tr><tr><td width="40%" align="left" valign="top">36.8. Обработка ошибок </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 36.10. Компиляция программ со встраиваемым SQL</td></tr></table></div></body></html>