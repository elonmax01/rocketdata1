<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>55.10. Сводка изменений по сравнению с протоколом версии 2.0</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="protocol-logicalrep-message-formats.html" title="55.9. Форматы сообщений логической репликации" /><link rel="next" href="source.html" title="Глава 56. Соглашения по оформлению кода PostgreSQL" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">55.10. Сводка изменений по сравнению с протоколом версии 2.0</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="protocol-logicalrep-message-formats.html" title="55.9. Форматы сообщений логической репликации">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="protocol.html" title="Глава 55. Клиент-серверный протокол">Наверх</a></td><th width="60%" align="center">Глава 55. Клиент-серверный протокол</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="source.html" title="Глава 56. Соглашения по оформлению кода PostgreSQL">След.</a></td></tr></table><hr /></div><div class="sect1" id="PROTOCOL-CHANGES"><div class="titlepage"><div><div><h2 class="title" style="clear: both">55.10. Сводка изменений по сравнению с протоколом версии 2.0 <a href="#PROTOCOL-CHANGES" class="id_link">#</a></h2></div></div></div><p>В этом разделе представлен краткий список изменений к сведению разработчиков, желающих модернизировать существующие клиентские библиотеки до протокола 3.0.</p><p>В начальном стартовом пакете вместо фиксированного формата применяется гибкий формат списка строк. Заметьте, что теперь сеансовые значения по умолчанию для параметров времени выполнения можно задать непосредственно в стартовом пакете. (Вообще, это можно было делать и раньше, используя поле <code class="literal">options</code>, но из-за ограниченного размера <code class="literal">options</code> и невозможности задавать значения с пробелами, это вариант был не очень безопасным.)</p><p>Во всех сообщениях непосредственно за байтом типа сообщения следует счётчик длины (за исключением стартовых пакетов, в которых нет байта типа). Также заметьте, что байт типа теперь есть в сообщении PasswordMessage.</p><p>Сообщения ErrorResponse и NoticeResponse ('<code class="literal">E</code>' и '<code class="literal">N</code>') могут содержать несколько полей, из которых клиентский код может собрать сообщение об ошибке желаемого уровня детализации. Заметьте, что текст отдельных полей обычно не завершается новой строкой, тогда как в старом протоколе одиночная строка всегда завершалась так.</p><p>Сообщение ReadyForQuery ('<code class="literal">Z</code>') включает индикатор статуса транзакции.</p><p>Различие между типами данных BinaryRow и DataRow ушло; один тип сообщений DataRow позволяет возвращать данные во всех форматах. Заметьте, что формат DataRow был изменён для упрощения его разбора. Также изменилось представление двоичных значений: оно больше не привязано к внутреннему представлению сервера.</p><p>В протоколе появился новый раздел <span class="quote">«<span class="quote">расширенный протокол запросов</span>»</span>, в котором добавлены типы сообщений для команд Parse, Bind, Execute, Describe, Close, Flush и Sync, а также типы серверных сообщений ParseComplete, BindComplete, PortalSuspended, ParameterDescription, NoData и CloseComplete. Существующие клиенты могут не подстраиваться под этот раздел протокола, но если они задействует его, это позволит улучшить производительность или функциональность.</p><p>Данные <code class="command">COPY</code> теперь внедряются в сообщения CopyData и CopyDone. Есть чётко определённый способ восстановить работу в случае ошибок в процессе <code class="command">COPY</code>. Специальная последняя строка <span class="quote">«<span class="quote"><code class="literal">\.</code></span>»</span> больше не нужна, она не передаётся при выполнении <code class="command">COPY OUT</code>. (Она по-прежнему воспринимается как завершающая последовательность в потоке <code class="command">COPY IN</code>, но это считается устаревшим способом завершения, и в конце концов он будет исключён.) Поддерживается <code class="command">COPY</code> в двоичном режиме. Сообщения CopyInResponse и CopyOutResponse включают поля, определяющие число столбцов и формат каждого столбца.</p><p>Изменилась структура сообщений FunctionCall и FunctionCallResponse. Сообщение FunctionCall теперь позволяет передавать функциям аргументы NULL. Ещё в нём могут передаваться параметры и получаться результаты в текстовом или двоичном формате. Не осталось повода считать сообщение FunctionCall потенциально небезопасным, так как оно не даёт прямого доступа к внутренней презентации данных на сервере.</p><p>Сервер отправляет сообщения ParameterStatus ('<code class="literal">S</code>') при попытке подключения для всех параметров, которые он считает интересными для клиентской библиотеки. Как следствие, при любом изменении активного значения одного из этих параметров также выдаётся сообщение ParameterStatus.</p><p>Сообщение RowDescription ('<code class="literal">T</code>') содержит поля с OID таблицы и номером столбца для каждого столбца описываемой строки. В нём также передаётся код формата для каждого столбца.</p><p>Сервер более не выдаёт сообщение CursorResponse ('<code class="literal">P</code>').</p><p>В сообщении NotificationResponse ('<code class="literal">A</code>') добавилось ещё одно строковое поле, в котором может передаваться строка <span class="quote">«<span class="quote">сообщения</span>»</span> от отправителя события <code class="command">NOTIFY</code>.</p><p>Раньше сообщение EmptyQueryResponse ('<code class="literal">I</code>') включало пустой строковый параметр; теперь он ликвидирован.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="protocol-logicalrep-message-formats.html" title="55.9. Форматы сообщений логической репликации">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="protocol.html" title="Глава 55. Клиент-серверный протокол">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="source.html" title="Глава 56. Соглашения по оформлению кода PostgreSQL">След.</a></td></tr><tr><td width="40%" align="left" valign="top">55.9. Форматы сообщений логической репликации </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> Глава 56. Соглашения по оформлению кода PostgreSQL</td></tr></table></div></body></html>