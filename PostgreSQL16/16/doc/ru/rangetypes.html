<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>8.17. Диапазонные типы</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="rowtypes.html" title="8.16. Составные типы" /><link rel="next" href="domains.html" title="8.18. Типы доменов" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">8.17. Диапазонные типы</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="rowtypes.html" title="8.16. Составные типы">Пред.</a> </td><td width="10%" align="left"><a accesskey="u" href="datatype.html" title="Глава 8. Типы данных">Наверх</a></td><th width="60%" align="center">Глава 8. Типы данных</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="10%" align="right"> <a accesskey="n" href="domains.html" title="8.18. Типы доменов">След.</a></td></tr></table><hr /></div><div class="sect1" id="RANGETYPES"><div class="titlepage"><div><div><h2 class="title" style="clear: both">8.17. Диапазонные типы <a href="#RANGETYPES" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="rangetypes.html#RANGETYPES-BUILTIN">8.17.1. Встроенные диапазонные и мультидиапазонные типы</a></span></dt><dt><span class="sect2"><a href="rangetypes.html#RANGETYPES-EXAMPLES">8.17.2. Примеры</a></span></dt><dt><span class="sect2"><a href="rangetypes.html#RANGETYPES-INCLUSIVITY">8.17.3. Включение и исключение границ</a></span></dt><dt><span class="sect2"><a href="rangetypes.html#RANGETYPES-INFINITE">8.17.4. Неограниченные (бесконечные) диапазоны</a></span></dt><dt><span class="sect2"><a href="rangetypes.html#RANGETYPES-IO">8.17.5. Ввод/вывод диапазонов</a></span></dt><dt><span class="sect2"><a href="rangetypes.html#RANGETYPES-CONSTRUCT">8.17.6. Конструирование диапазонов и мультидиапазонов</a></span></dt><dt><span class="sect2"><a href="rangetypes.html#RANGETYPES-DISCRETE">8.17.7. Типы дискретных диапазонов</a></span></dt><dt><span class="sect2"><a href="rangetypes.html#RANGETYPES-DEFINING">8.17.8. Определение новых диапазонных типов</a></span></dt><dt><span class="sect2"><a href="rangetypes.html#RANGETYPES-INDEXING">8.17.9. Индексация</a></span></dt><dt><span class="sect2"><a href="rangetypes.html#RANGETYPES-CONSTRAINT">8.17.10. Ограничения для диапазонов</a></span></dt></dl></div><a id="id-1.5.7.25.2" class="indexterm"></a><a id="id-1.5.7.25.3" class="indexterm"></a><p>Диапазонные типы представляют диапазоны значений некоторого типа данных (он также называется <em class="firstterm">подтипом</em> диапазона). Например, диапазон типа <code class="type">timestamp</code> может представлять временной интервал, когда зарезервирован зал заседаний. В данном случае типом данных будет <code class="type">tsrange</code> (сокращение от <span class="quote">«<span class="quote">timestamp range</span>»</span>), а подтипом — <code class="type">timestamp</code>. Подтип должен быть полностью упорядочиваемым, чтобы можно было однозначно определить, где находится значение по отношению к диапазону: внутри, до или после него.</p><p>Диапазонные типы полезны тем, что позволяют представить множество возможных значений в одной структуре данных и чётко выразить такие понятия, как пересечение диапазонов. Наиболее очевидный вариант их использования — применять диапазоны даты и времени для составления расписания, но также полезными могут оказаться диапазоны цен, интервалы измерений и т. д.</p><p>Для каждого диапазонного типа есть соответствующий мультидиапазонный тип. Мультидиапазон представляет собой упорядоченный список несмежных, непустых и отличных от NULL диапазонов. Большинство диапазонных операторов работают и с мультидиапазонами. Кроме того, есть функции для работы именно с мультидиапазонными типами.</p><div class="sect2" id="RANGETYPES-BUILTIN"><div class="titlepage"><div><div><h3 class="title">8.17.1. Встроенные диапазонные и мультидиапазонные типы <a href="#RANGETYPES-BUILTIN" class="id_link">#</a></h3></div></div></div><p>PostgreSQL имеет следующие встроенные диапазонные типы: </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="type">int4range</code> — диапазон подтипа <code class="type">integer</code>, <code class="type">int4multirange</code> — соответствующий мультидиапазон</p></li><li class="listitem"><p><code class="type">int8range</code> — диапазон подтипа <code class="type">bigint</code>, <code class="type">int8multirange</code> — соответствующий мультидиапазон</p></li><li class="listitem"><p><code class="type">numrange</code> — диапазон подтипа <code class="type">numeric</code>, <code class="type">nummultirange</code> — соответствующий мультидиапазон</p></li><li class="listitem"><p><code class="type">tsrange</code> — диапазон подтипа <code class="type">timestamp without time zone</code>, <code class="type">tsmultirange</code> — соответствующий мультидиапазон</p></li><li class="listitem"><p><code class="type">tstzrange</code> — диапазон подтипа <code class="type">timestamp with time zone</code>, <code class="type">tstzmultirange</code> — соответствующий мультидиапазон</p></li><li class="listitem"><p><code class="type">daterange</code> — диапазон подтипа <code class="type">date</code>, <code class="type">datemultirange</code> — соответствующий мультидиапазон</p></li></ul></div><p> Помимо этого, вы можете определять собственные типы; подробнее это описано в <a class="xref" href="sql-createtype.html" title="CREATE TYPE"><span class="refentrytitle">CREATE TYPE</span></a>.</p></div><div class="sect2" id="RANGETYPES-EXAMPLES"><div class="titlepage"><div><div><h3 class="title">8.17.2. Примеры <a href="#RANGETYPES-EXAMPLES" class="id_link">#</a></h3></div></div></div><pre class="programlisting">CREATE TABLE reservation (room int, during tsrange);
INSERT INTO reservation VALUES
    (1108, '[2010-01-01 14:30, 2010-01-01 15:30)');

-- Вхождение
SELECT int4range(10, 20) @&gt; 3;

-- Перекрытие
SELECT numrange(11.1, 22.2) &amp;&amp; numrange(20.0, 30.0);

-- Получение верхней границы
SELECT upper(int8range(15, 25));

-- Вычисление пересечения
SELECT int4range(10, 20) * int4range(15, 25);

-- Является ли диапазон пустым?
SELECT isempty(numrange(1, 5));</pre><p> Полный список операторов и функций, предназначенных для диапазонных типов, приведён в <a class="xref" href="functions-range.html#RANGE-OPERATORS-TABLE" title="Таблица 9.55. Диапазонные операторы">Таблице 9.55</a> и <a class="xref" href="functions-range.html#RANGE-FUNCTIONS-TABLE" title="Таблица 9.57. Диапазонные функции">Таблице 9.57</a>.</p></div><div class="sect2" id="RANGETYPES-INCLUSIVITY"><div class="titlepage"><div><div><h3 class="title">8.17.3. Включение и исключение границ <a href="#RANGETYPES-INCLUSIVITY" class="id_link">#</a></h3></div></div></div><p>Любой непустой диапазон имеет две границы, верхнюю и нижнюю, и включает все точки между этими значениями. В него также может входить точка, лежащая на границе, если диапазон включает эту границу. И наоборот, если диапазон не включает границу, считается, что точка, лежащая на этой границе, в него не входит.</p><p>В текстовой записи диапазона включение нижней границы обозначается символом <span class="quote">«<span class="quote"><code class="literal">[</code></span>»</span>, а исключением — символом <span class="quote">«<span class="quote"><code class="literal">(</code></span>»</span>. Для верхней границы включение обозначается аналогично, символом <span class="quote">«<span class="quote"><code class="literal">]</code></span>»</span>, а исключение — символом <span class="quote">«<span class="quote"><code class="literal">)</code></span>»</span>. (Подробнее это описано в <a class="xref" href="rangetypes.html#RANGETYPES-IO" title="8.17.5. Ввод/вывод диапазонов">Подразделе 8.17.5</a>.)</p><p>Для проверки, включается ли нижняя или верхняя граница в диапазон, предназначены функции <code class="literal">lower_inc</code> и <code class="literal">upper_inc</code>, соответственно.</p></div><div class="sect2" id="RANGETYPES-INFINITE"><div class="titlepage"><div><div><h3 class="title">8.17.4. Неограниченные (бесконечные) диапазоны <a href="#RANGETYPES-INFINITE" class="id_link">#</a></h3></div></div></div><p>Нижнюю границу диапазона можно опустить и определить тем самым диапазон, включающий все значения, лежащие ниже верхней границы, например: <code class="literal">(,3]</code>. Подобным образом, если не определить верхнюю границу, в диапазон войдут все значения, лежащие выше нижней границы. Если же опущена и нижняя, и верхняя границы, такой диапазон будет включать все возможные значения своего подтипа. Указание отсутствующей границы как включаемой в диапазон автоматически преобразуется в исключающее; например, <code class="literal">[,]</code> преобразуется в <code class="literal">(,)</code>. Можно воспринимать отсутствующие значения как плюс/минус бесконечность, но всё же это особые значения диапазонного типа, которые охватывают и возможные для подтипа значения плюс/минус бесконечность.</p><p>Для подтипов, в которых есть понятие <span class="quote">«<span class="quote">бесконечность</span>»</span>, <code class="literal">infinity</code> может использоваться в качестве явного значения границы. При этом, например, в диапазон <code class="literal">[today,infinity)</code> с подтипом <code class="type">timestamp</code> не будет входить специальное значение <code class="literal">infinity</code> данного подтипа, однако это значение будет входить в диапазон <code class="literal">[today,infinity]</code>, как и в диапазоны <code class="literal">[today,)</code> и <code class="literal">[today,]</code>.</p><p>Проверить, определена ли верхняя или нижняя граница, можно с помощью функций <code class="literal">lower_inf</code> и <code class="literal">upper_inf</code>, соответственно.</p></div><div class="sect2" id="RANGETYPES-IO"><div class="titlepage"><div><div><h3 class="title">8.17.5. Ввод/вывод диапазонов <a href="#RANGETYPES-IO" class="id_link">#</a></h3></div></div></div><p>Вводимое значение диапазона должно записываться в одной из следующих форм: </p><pre class="synopsis">
(<em class="replaceable"><code>нижняя-граница</code></em>,<em class="replaceable"><code>верхняя-граница</code></em>)
(<em class="replaceable"><code>нижняя-граница</code></em>,<em class="replaceable"><code>верхняя-граница</code></em>]
[<em class="replaceable"><code>нижняя-граница</code></em>,<em class="replaceable"><code>верхняя-граница</code></em>)
[<em class="replaceable"><code>нижняя-граница</code></em>,<em class="replaceable"><code>верхняя-граница</code></em>]
empty
</pre><p> Тип скобок (квадратные или круглые) определяет, включаются ли в диапазон соответствующие границы, как описано выше. Заметьте, что последняя форма содержит только слово <code class="literal">empty</code> и определяет пустой диапазон (диапазон, не содержащий точек).</p><p>Здесь <em class="replaceable"><code>нижняя-граница</code></em> может быть строкой с допустимым значением подтипа или быть пустой (тогда диапазон будет без нижней границы). Аналогично, <em class="replaceable"><code>верхняя-граница</code></em> может задаваться одним из значений подтипа или быть неопределённой (пустой).</p><p>Любое значение границы диапазона можно заключить в кавычки (<code class="literal">"</code>). А если значение содержит круглые или квадратные скобки, запятые, кавычки или обратную косую черту, использовать кавычки необходимо, чтобы эти символы не рассматривались как часть синтаксиса диапазона. Чтобы включить в значение границы диапазона, заключённое в кавычки, такие символы, как кавычки или обратная косая черта, перед ними нужно добавить обратную косую черту. (Кроме того, продублированные кавычки в значении диапазона, заключённого в кавычки, воспринимаются как одинарные, подобно апострофам в строках SQL.) С другой стороны, можно обойтись без кавычек, защитив все символы в данных, которые могут быть восприняты как часть синтаксиса диапазона, с помощью спецпоследовательностей. Чтобы задать в качестве границы пустую строку, нужно ввести <code class="literal">""</code>, так как пустая строка без кавычек будет означать отсутствие границы.</p><p>Пробельные символы до и после определения диапазона игнорируются, но когда они присутствуют внутри скобок, они воспринимаются как часть значения верхней или нижней границы. (Хотя они могут также игнорироваться в зависимости от подтипа диапазона.)</p><div class="note"><h3 class="title">Примечание</h3><p>Эти правила очень похожи на правила записи значений для полей составных типов. Дополнительные замечания приведены в <a class="xref" href="rowtypes.html#ROWTYPES-IO-SYNTAX" title="8.16.6. Синтаксис вводимых и выводимых значений составного типа">Подразделе 8.16.6</a>.</p></div><p>Примеры: </p><pre class="programlisting">-- в диапазон включается 3, не включается 7 и включаются все точки между ними
SELECT '[3,7)'::int4range;

-- в диапазон не включаются 3 и 7, но включаются все точки между ними
SELECT '(3,7)'::int4range;

-- в диапазон включается только одно значение 4
SELECT '[4,4]'::int4range;

-- диапазон не включает никаких точек (нормализация заменит его определение
--  на 'empty')
SELECT '[4,4)'::int4range;</pre><p>Вводимое значение мультидиапазона заключается в фигурные скобки (<code class="literal">{</code> и <code class="literal">}</code>) и содержит ноль или более диапазонов, разделённых запятыми. До и после скобок и запятых допускаются пробельные символы. Синтаксис сделан похожим на синтаксис массивов, но мультидиапазоны намного проще: они имеют только одну размерность, а их содержимое не нужно заключать в кавычки. (Как показано выше, границы диапазонов могут заключаться в кавычки.)</p><p>Примеры: </p><pre class="programlisting">SELECT '{}'::int4multirange;
SELECT '{[3,7)}'::int4multirange;
SELECT '{[3,7), [8,9)}'::int4multirange;</pre></div><div class="sect2" id="RANGETYPES-CONSTRUCT"><div class="titlepage"><div><div><h3 class="title">8.17.6. Конструирование диапазонов и мультидиапазонов <a href="#RANGETYPES-CONSTRUCT" class="id_link">#</a></h3></div></div></div><p>Для каждого диапазонного типа определена функция конструктора, имеющая то же имя, что и данный тип. Использовать этот конструктор обычно удобнее, чем записывать текстовую константу диапазона, так как это избавляет от потребности в дополнительных кавычках. Функция конструктора может принимать два или три параметра. Вариант с двумя параметрами создаёт диапазон в стандартной форме (нижняя граница включается, верхняя исключается), тогда как для варианта с тремя параметрами включение границ определяется третьим параметром. Третий параметр должен содержать одну из строк: <span class="quote">«<span class="quote"><code class="literal">()</code></span>»</span>, <span class="quote">«<span class="quote"><code class="literal">(]</code></span>»</span>, <span class="quote">«<span class="quote"><code class="literal">[)</code></span>»</span> или <span class="quote">«<span class="quote"><code class="literal">[]</code></span>»</span>. Например: </p><pre class="programlisting">-- Полная форма: нижняя граница, верхняя граница и текстовая строка, определяющая
-- включение/исключение границ.
SELECT numrange(1.0, 14.0, '(]');

-- Если третий аргумент опущен, подразумевается '[)'.
SELECT numrange(1.0, 14.0);

-- Хотя здесь указывается '(]', при выводе значение будет приведено к
-- каноническому виду, так как int8range — тип дискретного диапазона (см. ниже).
SELECT int8range(1, 14, '(]');

-- Когда вместо любой границы указывается NULL, соответствующей границы
--  у диапазона не будет.
SELECT numrange(NULL, 2.2);</pre><p>Для каждого диапазонного типа также есть конструктор мультидиапазона с тем же именем, что и у мультидиапазонного типа. Функция-конструктор принимает ноль или более аргументов, представляющих собой диапазоны соответствующего типа. Например: </p><pre class="programlisting">SELECT nummultirange();
SELECT nummultirange(numrange(1.0, 14.0));
SELECT nummultirange(numrange(1.0, 14.0), numrange(20.0, 25.0));</pre></div><div class="sect2" id="RANGETYPES-DISCRETE"><div class="titlepage"><div><div><h3 class="title">8.17.7. Типы дискретных диапазонов <a href="#RANGETYPES-DISCRETE" class="id_link">#</a></h3></div></div></div><p>Дискретным диапазоном считается диапазон, для подтипа которого однозначно определён <span class="quote">«<span class="quote">шаг</span>»</span>, как например для типов <code class="type">integer</code> и <code class="type">date</code>. Значения этих двух типов можно назвать соседними, когда между ними нет никаких других значений. В непрерывных диапазонах, напротив, всегда (или почти всегда) можно найти ещё одно значение между двумя данными. Например, непрерывным диапазоном будет диапазон с подтипами <code class="type">numeric</code> и <code class="type">timestamp</code>. (Хотя <code class="type">timestamp</code> имеет ограниченную точность, то есть теоретически он является дискретным, но всё же лучше считать его непрерывным, так как шаг его обычно не определён.)</p><p>Можно также считать дискретным подтип диапазона, в котором чётко определены понятия <span class="quote">«<span class="quote">следующего</span>»</span> и <span class="quote">«<span class="quote">предыдущего</span>»</span> элемента для каждого значения. Такие определения позволяют преобразовывать границы диапазона из включаемых в исключаемые, выбирая следующий или предыдущий элемент вместо заданного значения. Например, диапазоны целочисленного типа <code class="literal">[4,8]</code> и <code class="literal">(3,9)</code> описывают одно и то же множество значений; но для диапазона подтипа numeric это не так.</p><p>Для типа дискретного диапазона определяется функция <em class="firstterm">канонизации</em>, учитывающая размер шага для данного подтипа. Задача этой функции — преобразовать равнозначные диапазоны к единственному представлению, в частности нормализовать включаемые и исключаемые границы. Если функция канонизации не определена, диапазоны с различным определением будут всегда считаться разными, даже когда они на самом деле представляют одно множество значений.</p><p>Для встроенных типов <code class="type">int4range</code>, <code class="type">int8range</code> и <code class="type">daterange</code> каноническое представление включает нижнюю границу и не включает верхнюю; то есть диапазон приводится к виду <code class="literal">[)</code>. Однако для нестандартных типов можно использовать и другие соглашения.</p></div><div class="sect2" id="RANGETYPES-DEFINING"><div class="titlepage"><div><div><h3 class="title">8.17.8. Определение новых диапазонных типов <a href="#RANGETYPES-DEFINING" class="id_link">#</a></h3></div></div></div><p>Пользователи могут определять собственные диапазонные типы. Это может быть полезно, когда нужно использовать диапазоны с подтипами, для которых нет встроенных диапазонных типов. Например, можно определить новый тип диапазона для подтипа <code class="type">float8</code>: </p><pre class="programlisting">CREATE TYPE floatrange AS RANGE (
    subtype = float8,
    subtype_diff = float8mi
);

SELECT '[1.234, 5.678]'::floatrange;</pre><p> Так как для <code class="type">float8</code> осмысленное значение <span class="quote">«<span class="quote">шага</span>»</span> не определено, функция канонизации в данном примере не задаётся.</p><p>Когда вы определяете собственный диапазон, система автоматически создаёт мультидиапазонный тип.</p><p>Определяя собственный диапазонный тип, вы также можете выбрать другие правила сортировки или класс оператора B-дерева для его подтипа, что позволит изменить порядок значений, от которого зависит, какие значения попадают в заданный диапазон.</p><p>Если подтип можно рассматривать как дискретный, а не непрерывный, в команде <code class="command">CREATE TYPE</code> следует также задать функцию <code class="literal">канонизации</code>. Этой функции будет передаваться значение диапазона, а она должна вернуть равнозначное значение, но, возможно, с другими границами и форматированием. Для двух диапазонов, представляющих одно множество значений, например, целочисленные диапазоны <code class="literal">[1, 7]</code> и <code class="literal">[1, 8)</code>, функция канонизации должна выдавать один результат. Какое именно представление будет считаться каноническим, не имеет значения — главное, чтобы два равнозначных диапазона, отформатированных по-разному, всегда преобразовывались в одно значение с одинаковым форматированием. Помимо исправления формата включаемых/исключаемых границ, функция канонизации может округлять значения границ, если размер шага превышает точность хранения подтипа. Например, в типе диапазона для подтипа <code class="type">timestamp</code> можно определить размер шага, равный часу, тогда функция канонизации должна будет округлить границы, заданные, например с точностью до минут, либо вместо этого выдать ошибку.</p><p>Помимо этого, для любого диапазонного типа, ориентированного на использование с индексами GiST или SP-GiST, должна быть определена разница значений подтипов, функция <code class="literal">subtype_diff</code>. (Индекс сможет работать и без <code class="literal">subtype_diff</code>, но в большинстве случаев это будет не так эффективно.) Эта функция принимает на вход два значения подтипа и возвращает их разницу (т. е. <em class="replaceable"><code>X</code></em> минус <em class="replaceable"><code>Y</code></em>) в значении типа <code class="type">float8</code>. В показанном выше примере может использоваться функция <code class="function">float8mi</code>, определяющая нижележащую реализацию обычного оператора <span class="quote">«<span class="quote">минус</span>»</span> для типа <code class="type">float8</code>, но для другого подтипа могут потребоваться дополнительные преобразования. Иногда для представления разницы в числовом виде требуется ещё и творческий подход. Функция <code class="literal">subtype_diff</code>, насколько это возможно, должна быть согласована с порядком сортировки, вытекающим из выбранных правил сортировки и класса оператора; то есть, её результат должен быть положительным, если согласно порядку сортировки первый её аргумент больше второго.</p><p>Ещё один, не столь тривиальный пример функции <code class="literal">subtype_diff</code>:</p><pre class="programlisting">CREATE FUNCTION time_subtype_diff(x time, y time) RETURNS float8 AS
'SELECT EXTRACT(EPOCH FROM (x - y))' LANGUAGE sql STRICT IMMUTABLE;

CREATE TYPE timerange AS RANGE (
    subtype = time,
    subtype_diff = time_subtype_diff
);

SELECT '[11:10, 23:00]'::timerange;</pre><p>Дополнительные сведения о создании диапазонных типов можно найти в описании <a class="xref" href="sql-createtype.html" title="CREATE TYPE"><span class="refentrytitle">CREATE TYPE</span></a>.</p></div><div class="sect2" id="RANGETYPES-INDEXING"><div class="titlepage"><div><div><h3 class="title">8.17.9. Индексация <a href="#RANGETYPES-INDEXING" class="id_link">#</a></h3></div></div></div><a id="id-1.5.7.25.15.2" class="indexterm"></a><p>Для столбцов, имеющих диапазонный тип, можно создать индексы GiST и SP-GiST. Также индексы GiST можно создавать для столбцов мультидиапазонных типов. Например, так создаётся индекс GiST: </p><pre class="programlisting">CREATE INDEX reservation_idx ON reservation USING GIST (during);</pre><p> Индекс GiST или SP-GiST для диапазонов помогает ускорить запросы со следующими операторами: <code class="literal">=</code>, <code class="literal">&amp;&amp;</code>, <code class="literal">&lt;@</code>, <code class="literal">@&gt;</code>, <code class="literal">&lt;&lt;</code>, <code class="literal">&gt;&gt;</code>, <code class="literal">-|-</code>, <code class="literal">&amp;&lt;</code> и <code class="literal">&amp;&gt;</code> (дополнительно о них можно узнать в <a class="xref" href="functions-range.html#RANGE-OPERATORS-TABLE" title="Таблица 9.55. Диапазонные операторы">Таблице 9.55</a>. Индекс GiST для мультидиапазонов может ускорить запросы, задействующие один набор мультидиапазонных операторов. Индекс GiST для диапазонов и индекс GiST для мультидиапазонов могут также соответственно ускорить запросы, задействующие следующие межтиповые операторы диапазон-мультидиапазон и мультидиапазон-диапазон: <code class="literal">&amp;&amp;</code>, <code class="literal">&lt;@</code>, <code class="literal">@&gt;</code>, <code class="literal">&lt;&lt;</code>, <code class="literal">&gt;&gt;</code>, <code class="literal">-|-</code>, <code class="literal">&amp;&lt;</code> и <code class="literal">&amp;&gt;</code>. Дополнительные сведения можно найти в <a class="xref" href="functions-range.html#RANGE-OPERATORS-TABLE" title="Таблица 9.55. Диапазонные операторы">Таблице 9.55</a>.</p><p>Кроме того, для таких столбцов можно создать индексы на основе хеша и B-деревьев. Для индексов таких типов полезен по сути только один оператор диапазона — равно. Порядок сортировки B-дерева определяется для значений диапазона соответствующими операторами <code class="literal">&lt;</code> и <code class="literal">&gt;</code>, но этот порядок может быть произвольным и он не очень важен в реальном мире. Поддержка B-деревьев и хешей диапазонными типами нужна в основном для сортировки и хеширования при выполнении запросов, но не для создания самих индексов.</p></div><div class="sect2" id="RANGETYPES-CONSTRAINT"><div class="titlepage"><div><div><h3 class="title">8.17.10. Ограничения для диапазонов <a href="#RANGETYPES-CONSTRAINT" class="id_link">#</a></h3></div></div></div><a id="id-1.5.7.25.16.2" class="indexterm"></a><p>Тогда как для скалярных значений естественным ограничением является <code class="literal">UNIQUE</code>, оно обычно не подходит для диапазонных типов. Вместо этого чаще оказываются полезнее ограничения-исключения (см. <a class="link" href="sql-createtable.html#SQL-CREATETABLE-EXCLUDE">CREATE TABLE ... CONSTRAINT ... EXCLUDE</a>). Такие ограничения позволяют, например определить условие <span class="quote">«<span class="quote">непересечения</span>»</span> диапазонов. Например: </p><pre class="programlisting">CREATE TABLE reservation (
    during tsrange,
    EXCLUDE USING GIST (during WITH &amp;&amp;)
);</pre><p> Это ограничение не позволит одновременно сохранить в таблице несколько диапазонов, которые накладываются друг на друга: </p><pre class="programlisting">INSERT INTO reservation VALUES
    ('[2010-01-01 11:30, 2010-01-01 15:00)');
INSERT 0 1

INSERT INTO reservation VALUES
    ('[2010-01-01 14:45, 2010-01-01 15:45)');
ОШИБКА:  конфликтующее значение ключа нарушает ограничение-исключение "reservation_during_excl"
ПОДРОБНОСТИ: Ключ (during)=(["2010-01-01 14:45:00","2010-01-01 15:45:00"))
конфликтует с существующим ключом (during)=(["2010-01-01 11:30:00","2010-01-01 15:00:00"))</pre><p>Для максимальной гибкости в ограничении-исключении можно сочетать простые скалярные типы данных с диапазонами, используя расширение <a class="link" href="btree-gist.html" title="F.9. btree_gist — классы операторов GiST с поведением B-дерева"><code class="literal">btree_gist</code></a>. Например, если <code class="literal">btree_gist</code> установлено, следующее ограничение не будет допускать пересекающиеся диапазоны, только если совпадают также и номера комнат: </p><pre class="programlisting">CREATE EXTENSION btree_gist;
CREATE TABLE room_reservation (
    room text,
    during tsrange,
    EXCLUDE USING GIST (room WITH =, during WITH &amp;&amp;)
);

INSERT INTO room_reservation VALUES
    ('123A', '[2010-01-01 14:00, 2010-01-01 15:00)');
INSERT 0 1

INSERT INTO room_reservation VALUES
    ('123A', '[2010-01-01 14:30, 2010-01-01 15:30)');
ОШИБКА:  конфликтующее значение ключа нарушает ограничение-исключение
  "room_reservation_room_during_excl"
ПОДРОБНОСТИ:  Ключ (room, during)=(123A, [ 2010-01-01 14:30:00,
  2010-01-01 15:30:00 )) конфликтует
с существующим ключом (room, during)=(123A, ["2010-01-01 14:00:00","2010-01-01 15:00:00")).

INSERT INTO room_reservation VALUES
    ('123B', '[2010-01-01 14:30, 2010-01-01 15:30)');
INSERT 0 1</pre></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="rowtypes.html" title="8.16. Составные типы">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="datatype.html" title="Глава 8. Типы данных">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="domains.html" title="8.18. Типы доменов">След.</a></td></tr><tr><td width="40%" align="left" valign="top">8.16. Составные типы </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="Документация к PostgreSQL 16.3">Начало</a></td><td width="40%" align="right" valign="top"> 8.18. Типы доменов</td></tr></table></div></body></html>